[{"title":"Day1-ä¸¤æ•°ä¹‹å’Œ","url":"/2025/04/23/Day1-%E4%B8%A4%E6%95%B0%E4%B9%8B%E5%92%8C/","content":"ğŸ”— LeetCode 1 - Two Sum\nğŸ“Œ é¢˜ç›®æè¿°ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ nums å’Œä¸€ä¸ªæ•´æ•°ç›®æ ‡å€¼ targetï¼Œè¯·ä½ åœ¨è¯¥æ•°ç»„ä¸­æ‰¾å‡º å’Œä¸ºç›®æ ‡å€¼ target çš„é‚£ ä¸¤ä¸ªæ•´æ•°ï¼Œå¹¶è¿”å›å®ƒä»¬çš„æ•°ç»„ä¸‹æ ‡ã€‚\nä½ å¯ä»¥å‡è®¾æ¯ç§è¾“å…¥åªä¼šå¯¹åº”ä¸€ä¸ªç­”æ¡ˆã€‚ä½†æ˜¯ï¼Œæ•°ç»„ä¸­åŒä¸€ä¸ªå…ƒç´ åœ¨ç­”æ¡ˆé‡Œä¸èƒ½é‡å¤å‡ºç°ã€‚\nä½ å¯ä»¥æŒ‰ä»»æ„é¡ºåºè¿”å›ç­”æ¡ˆã€‚\nç¤ºä¾‹ï¼š\nè¾“å…¥ï¼šnums &#x3D; [2,7,11,15], target &#x3D; 9è¾“å‡ºï¼š[0,1]è§£é‡Šï¼šå› ä¸º nums[0] + nums[1] &#x3D;&#x3D; 9 ï¼Œè¿”å› [0, 1]\n\nğŸ’¡ è§£é¢˜æ€è·¯\nä½¿ç”¨å“ˆå¸Œè¡¨ï¼ˆå­—å…¸ï¼‰å­˜å‚¨å·²è®¿é—®çš„æ•°å­—åŠå…¶ä¸‹æ ‡ï¼›\néå†æ•°ç»„ï¼Œå¯¹äºæ¯ä¸ªå…ƒç´  xï¼Œæ£€æŸ¥ target - x æ˜¯å¦å­˜åœ¨äºå“ˆå¸Œè¡¨ä¸­ï¼›\nå¦‚æœå­˜åœ¨ï¼Œè¯´æ˜æ‰¾åˆ°äº†ç­”æ¡ˆï¼›\nå¦åˆ™å°†å½“å‰æ•°å­—å’Œä¸‹æ ‡åŠ å…¥å“ˆå¸Œè¡¨ç»§ç»­æŸ¥æ‰¾ã€‚\n\næ—¶é—´å¤æ‚åº¦ï¼šO(n)ç©ºé—´å¤æ‚åº¦ï¼šO(n)\n\nâœ… JavaScript å®ç°var twoSum = function(nums, target) &#123;    const map = &#123;&#125;;    for (let i = 0; i &lt; nums.length; i++) &#123;        let complement = target - nums[i];        if (map[complement] !== undefined) &#123;            return [map[complement], i];        &#125;        map[nums[i]] = i;    &#125;    return [];&#125;;\n\n\nğŸŸ£ Swift å®ç°class Solution &#123;    func twoSum(_ nums: [Int], _ target: Int) -&gt; [Int] &#123;        var map = [Int: Int]()        for (i, num) in nums.enumerated() &#123;            let complement = target - num            if let index = map[complement] &#123;                return [index, i]            &#125;            map[num] = i        &#125;        return []    &#125;&#125;\n\n\nğŸ§  æ€è€ƒä¸æ‹“å±•\nå¦‚æœè¦æ±‚è¿”å›æ‰€æœ‰æ»¡è¶³æ¡ä»¶çš„æ•°å¯¹å‘¢ï¼Ÿ\n å¯ä»¥åœ¨éå†æ—¶è®°å½•æ‰€æœ‰åŒ¹é…çš„ç»„åˆï¼Œå­˜å‚¨åœ¨æ•°ç»„ä¸­ã€‚\n\nå¦‚æœè¾“å…¥æ•°æ®æœ‰å¤šä¸ªè§£ï¼Œä½ è¯¥å¦‚ä½•å¤„ç†ï¼Ÿ\n\nå½“å‰é¢˜ç›®å‡è®¾ã€Œåªæœ‰ä¸€ä¸ªè§£ã€ï¼Œä½†åœ¨å®é™…é¡¹ç›®ä¸­é€šå¸¸éœ€è¦æ‰¾åˆ°æ‰€æœ‰è§£ã€‚\nå¯é‡‡ç”¨åŒå±‚å¾ªç¯æˆ–åœ¨ map ä¸­è®°å½•æ‰€æœ‰ä¸‹æ ‡ï¼ˆæ•°ç»„ï¼‰ï¼Œè¿›è¡Œç»„åˆå°è¯•ã€‚\n\n\nå¦‚æœä¸èƒ½ä½¿ç”¨é¢å¤–ç©ºé—´ï¼Œåªèƒ½ O(1) ç©ºé—´ï¼Ÿ\n\nå…ˆå¯¹æ•°ç»„è¿›è¡Œæ’åºï¼ˆéœ€è¦é¢å¤–è®°å½•åŸå§‹ä¸‹æ ‡ï¼‰ï¼Œç„¶åä½¿ç”¨ åŒæŒ‡é’ˆ æ€è·¯è§£å†³ï¼›\næ—¶é—´å¤æ‚åº¦ä¸º O(nlogn)ï¼Œä½†ç©ºé—´å¤æ‚åº¦å¯é™ä¸º O(1)ï¼ˆå¦‚æœå…è®¸ä¿®æ”¹åŸæ•°ç»„ï¼‰ã€‚\n\n\né«˜é¢‘æ‹“å±•é¢˜\n\nLeetCode 15. ä¸‰æ•°ä¹‹å’Œ\nLeetCode 18. å››æ•°ä¹‹å’Œ\nLeetCode 167. ä¸¤æ•°ä¹‹å’Œ II - è¾“å…¥æœ‰åºæ•°ç»„\nLeetCode 653. ä¸¤æ•°ä¹‹å’Œ IV - è¾“å…¥ BST\n\n\n\n","categories":["ç®—æ³•"],"tags":["ç®—æ³•"]},{"title":"Day1-UIKitäº‹ä»¶ä¼ é€’æœºåˆ¶ & Responder Chain","url":"/2025/04/23/Day1-UIKit%E4%BA%8B%E4%BB%B6%E4%BC%A0%E9%80%92%E6%9C%BA%E5%88%B6-Responder-Chain/","content":"UIKit äº‹ä»¶ä¼ é€’æœºåˆ¶ &amp; Responder Chainä¸€ã€äº‹ä»¶ç±»å‹UIKit ä¸­ä¸»è¦çš„äº‹ä»¶ç±»å‹åŒ…æ‹¬ï¼š\n\nè§¦æ‘¸äº‹ä»¶ï¼ˆTouch Eventsï¼‰ï¼šå¦‚ tapã€swipeã€pinch ç­‰ã€‚\nè¿åŠ¨äº‹ä»¶ï¼ˆMotion Eventsï¼‰ï¼šå¦‚æ‘‡åŠ¨è®¾å¤‡ã€‚\nè¿œç¨‹æ§åˆ¶äº‹ä»¶ï¼ˆRemote-Control Eventsï¼‰ï¼šå¦‚è€³æœºæ§åˆ¶ã€CarPlayã€‚\næŒ‰é”®äº‹ä»¶ï¼ˆPress Eventsï¼‰ï¼ˆä»…é™ tvOS æˆ–æ”¯æŒç¡¬ä»¶é”®ç›˜æ—¶çš„ iOSï¼‰ã€‚\n\n\näºŒã€äº‹ä»¶ä¼ é€’æµç¨‹\näº‹ä»¶äº§ç”Ÿï¼š\n\näº‹ä»¶ç”±ç¡¬ä»¶ï¼ˆå±å¹•ã€ä¼ æ„Ÿå™¨ç­‰ï¼‰æ£€æµ‹åäº¤ç»™ç³»ç»Ÿã€‚\niOS å°†äº‹ä»¶åŠ å…¥åˆ°ä¸»çº¿ç¨‹çš„ UIApplication å¯¹è±¡ä¸­è¿›è¡Œåˆ†å‘ã€‚\n\n\näº‹ä»¶åˆ†å‘è·¯å¾„ï¼š\n\nUIApplication â†’ UIWindow â†’ UIView\n\n\nå‘½ä¸­æµ‹è¯•ï¼ˆHit-Testingï¼‰ï¼š\n\nä»æ ¹è§†å›¾ï¼ˆwindow çš„ rootViewï¼‰å¼€å§‹é€’å½’æŸ¥æ‰¾ç›®æ ‡è§†å›¾ã€‚\nä½¿ç”¨ä¸¤ä¸ªæ–¹æ³•ï¼š\npoint(inside:with:)\nhitTest(_:with:)\n\n\næœ€ç»ˆæ‰¾åˆ°æœ€åˆé€‚çš„è§†å›¾æ¥æ”¶è§¦æ‘¸äº‹ä»¶ã€‚\n\n\n\n\nä¸‰ã€Responder Chainï¼ˆå“åº”è€…é“¾ï¼‰1. ä»€ä¹ˆæ˜¯ Responder Chainï¼ŸResponder Chain æ˜¯ä¸€æ¡äº‹ä»¶å“åº”é“¾ï¼Œç”¨æ¥å¤„ç†è§†å›¾æ— æ³•å“åº”çš„äº‹ä»¶ã€‚\n2. Responder Chain æ„æˆä¸€ä¸ª UIResponder å¯¹è±¡ï¼ˆå¦‚ UIViewã€UIViewControllerï¼‰å¯ä»¥ä¼ é€’äº‹ä»¶ç»™å…¶ä¸Šå±‚å“åº”è€…ï¼šUIView â†’ UIViewController â†’ UIWindow â†’ UIApplication â†’ AppDelegate\nå¦‚æœæŸä¸ªå¯¹è±¡æ— æ³•å¤„ç†äº‹ä»¶ï¼Œå®ƒä¼šæŠŠäº‹ä»¶ä¼ é€’ç»™ä¸‹ä¸€ä¸ªå“åº”è€…ã€‚\n3. UIResponder æ–¹æ³•\n\n\næ–¹æ³•å\nè¯´æ˜\n\n\n\ntouchesBegan(_:with:)\nå¼€å§‹è§¦æ‘¸\n\n\ntouchesMoved(_:with:)\nè§¦æ‘¸ç§»åŠ¨\n\n\ntouchesEnded(_:with:)\nè§¦æ‘¸ç»“æŸ\n\n\ntouchesCancelled(_:with:)\nè§¦æ‘¸è¢«å–æ¶ˆ\n\n\nè¿˜å¯ä»¥é€šè¿‡ canBecomeFirstResponder å’Œ becomeFirstResponder() æ§åˆ¶ç„¦ç‚¹ã€‚\n\nå››ã€è‡ªå®šä¹‰äº‹ä»¶ä¼ é€’ï¼ˆå¸¸è§åœºæ™¯ï¼‰1. UIView ä¸å“åº”äº‹ä»¶å¯èƒ½æ˜¯å› ä¸ºä»¥ä¸‹åŸå› ï¼š\n\nisUserInteractionEnabled = false\nalpha &lt; 0.01\nhidden = true\n\n2. è‡ªå®šä¹‰æ§ä»¶äº‹ä»¶ä¼ é€’å¯é‡å†™ä»¥ä¸‹æ–¹æ³•ï¼š\n\nhitTest(_:with:)ï¼šå†³å®šè°æ˜¯äº‹ä»¶çš„æœ€ç»ˆå“åº”è€…ã€‚\npoint(inside:with:)ï¼šåˆ¤æ–­ç‚¹æ˜¯å¦åœ¨å½“å‰è§†å›¾å†…ã€‚\n\n\näº”ã€Responder Chain åº”ç”¨åœºæ™¯\næ§ä»¶äº‹ä»¶ä¼ é€’ï¼šå¦‚ UIButton ç‚¹å‡»äº‹ä»¶å‘ä¸Šä¼ é€’ã€‚\nèœå•å¤„ç†ï¼šå¦‚å¤åˆ¶ç²˜è´´èœå•å“åº”ã€‚\né”®ç›˜å“åº”ç®¡ç†ã€‚\nè‡ªå®šä¹‰äº‹ä»¶è·¯ç”±ï¼ˆtarget-action æ— æ³•å¤„ç†æ—¶ï¼‰ã€‚\n\n\nå…­ã€è°ƒè¯•æŠ€å·§\nä½¿ç”¨ View Debugger æ£€æŸ¥è§†å›¾å±‚çº§ã€‚\næ‰“æ–­ç‚¹è°ƒè¯• hitTest å’Œ touchesBeganã€‚\næŸ¥çœ‹ next å±æ€§è¿½è¸ª Responder Chainã€‚\n\n\nä¸ƒã€æ€»ç»“\nUIKit äº‹ä»¶ä» UIApplication å¼€å§‹ï¼Œç»è¿‡ UIWindow æœ€ç»ˆä¼ é€’ç»™å…·ä½“çš„ UIViewã€‚\nResponder Chain æ˜¯äº‹ä»¶å†’æ³¡æœºåˆ¶çš„å®ç°ï¼Œæ”¯æŒäº‹ä»¶çš„å¤šçº§å¤„ç†ã€‚\né€šè¿‡åˆç†åˆ©ç”¨ hitTest: å’Œ Responder Chainï¼Œå¯ä»¥å®ç°å¤æ‚äº¤äº’éœ€æ±‚ã€‚\n\n","categories":["åŸºç¡€"]},{"title":"Day10-GCD è¿›é˜¶","url":"/2025/05/08/Day10-GCD-%E8%BF%9B%E9%98%B6/","content":"ä¸€ã€GCD é˜Ÿåˆ—åº•å±‚åŸç†1.1 é˜Ÿåˆ—ç±»å‹\nä¸²è¡Œé˜Ÿåˆ—ï¼šä¸€æ¬¡åªæ‰§è¡Œä¸€ä¸ªä»»åŠ¡ã€‚\nå¹¶å‘é˜Ÿåˆ—ï¼šå¯ä»¥å¹¶å‘æ‰§è¡Œå¤šä¸ªä»»åŠ¡ã€‚\nä¸»é˜Ÿåˆ—ï¼šä¸»çº¿ç¨‹çš„ä¸²è¡Œé˜Ÿåˆ—ï¼Œç”¨äºæ›´æ–° UIã€‚\n\n1.2 é˜Ÿåˆ—èƒŒåçš„çº¿ç¨‹\nGCD ä½¿ç”¨ çº¿ç¨‹æ±  ç®¡ç†çº¿ç¨‹ï¼Œå…·ä½“ç”± libdispatch + pthread å®ç°ã€‚\nå¹¶å‘é˜Ÿåˆ—ä»»åŠ¡å®é™…æ˜¯ä¸²è¡Œè°ƒåº¦ã€å¹¶å‘æ‰§è¡Œï¼ˆç”±ç³»ç»Ÿæ ¹æ®çº¿ç¨‹æ± å’Œèµ„æºè‡ªåŠ¨è°ƒåº¦ï¼‰ã€‚\n\näºŒã€å¸¸è§ GCD é«˜çº§ç”¨æ³•2.1 dispatch_barrierï¼ˆæ …æ å‡½æ•°ï¼‰dispatch_queue_t queue = dispatch_queue_create(&quot;com.example.queue&quot;, DISPATCH_QUEUE_CONCURRENT);dispatch_async(queue, ^&#123;    // ä»»åŠ¡1&#125;);dispatch_barrier_async(queue, ^&#123;    // æ …æ ä»»åŠ¡ï¼šå†™æ“ä½œ&#125;);dispatch_async(queue, ^&#123;    // ä»»åŠ¡2&#125;);\n\n2.2 dispatch_groupï¼ˆä»»åŠ¡ç»„ï¼‰dispatch_group_t group = dispatch_group_create();dispatch_queue_t queue = dispatch_get_global_queue(0, 0);dispatch_group_async(group, queue, ^&#123;    // ä»»åŠ¡1&#125;);dispatch_group_async(group, queue, ^&#123;    // ä»»åŠ¡2&#125;);dispatch_group_notify(group, dispatch_get_main_queue(), ^&#123;    // æ‰€æœ‰ä»»åŠ¡å®Œæˆåæ‰§è¡Œ&#125;);\n\n2.3 dispatch_semaphoreï¼ˆä¿¡å·é‡ï¼‰dispatch_semaphore_t semaphore = dispatch_semaphore_create(1);dispatch_async(queue, ^&#123;    dispatch_semaphore_wait(semaphore, DISPATCH_TIME_FOREVER);    // ä¸´ç•ŒåŒº    dispatch_semaphore_signal(semaphore);&#125;);\n\nä¸‰ã€é¿å…æ­»é”ä¸ä¼˜é›…ä½¿ç”¨3.1 æ­»é”ç¤ºä¾‹ï¼ˆä¸»é˜Ÿåˆ—åŒæ­¥è°ƒç”¨ï¼‰dispatch_sync(dispatch_get_main_queue(), ^&#123;    // æ­»é”ï¼šå½“å‰å·²ç»åœ¨ä¸»çº¿ç¨‹ï¼Œåˆç­‰ä¸»é˜Ÿåˆ—æ‰§è¡Œ&#125;);\n\n3.2 dispatch_onceï¼ˆçº¿ç¨‹å®‰å…¨çš„å•ä¾‹åˆå§‹åŒ–ï¼‰static dispatch_once_t onceToken;dispatch_once(&amp;onceToken, ^&#123;    // åˆå§‹åŒ–é€»è¾‘&#125;);\n\nå››ã€GCD ä¼˜åŒ–æŠ€å·§ä¸å®è·µ4.1 æ§åˆ¶æœ€å¤§å¹¶å‘æ•°ï¼ˆç»“åˆ semaphoreï¼‰dispatch_semaphore_t sema = dispatch_semaphore_create(3);for (int i = 0; i &lt; 10; i++) &#123;    dispatch_async(queue, ^&#123;        dispatch_semaphore_wait(sema, DISPATCH_TIME_FOREVER);        // ä¸‹è½½ä»»åŠ¡        dispatch_semaphore_signal(sema);    &#125;);&#125;\n\n4.2 ä½¿ç”¨ QoSï¼ˆæœåŠ¡è´¨é‡ï¼‰dispatch_queue_attr_t attr = dispatch_queue_attr_make_with_qos_class(DISPATCH_QUEUE_CONCURRENT, QOS_CLASS_USER_INITIATED, 0);dispatch_queue_t queue = dispatch_queue_create(&quot;com.example.qosqueue&quot;, attr);\n\näº”ã€å’Œ NSOperation æ¯”è¾ƒ\n\n\nç‰¹æ€§\nGCD\nNSOperation\n\n\n\nç®€æ´æ€§\nâœ…\nâŒï¼ˆæ›´å¤æ‚ï¼‰\n\n\nä¾èµ–ç®¡ç†\nâŒ\nâœ…ï¼ˆoperation.addDependencyï¼‰\n\n\nå–æ¶ˆä»»åŠ¡\nâŒ\nâœ…ï¼ˆoperation.cancelï¼‰\n\n\né‡ç”¨æ€§&#x2F;æ‰©å±•æ€§\nâŒ\nâœ…ï¼ˆå­ç±»åŒ–ï¼‰\n\n\nå¹¶å‘æ§åˆ¶ï¼ˆæ•°é‡ï¼‰\nå€ŸåŠ© semaphore\nâœ…ï¼ˆmaxConcurrentOperationCountï¼‰\n\n\nGCD çš„åº•å±‚å®ç°åŸç†Grand Central Dispatchï¼ˆGCDï¼‰æ˜¯è‹¹æœæä¾›çš„ä¸€ä¸ªå¤šçº¿ç¨‹å¹¶å‘ç¼–ç¨‹æ¡†æ¶ï¼Œå…¶åº•å±‚å®ç°åŸç†å¯ä»¥ä»å‡ ä¸ªå…³é”®çš„æŠ€æœ¯ç‚¹æ¥ç†è§£ï¼ŒåŒ…æ‹¬ï¼š\n\nä¸€ã€æ ¸å¿ƒç»“æ„ä¸å®ç°åŸºç¡€1. GCD åŸºäº libdispatch å®ç°GCD çš„åº•å±‚æ˜¯å¼€æºçš„ libdispatch åº“ï¼Œæ ¸å¿ƒç”¨ C å’Œ C++ ç¼–å†™ï¼Œè¿è¡Œåœ¨ç³»ç»Ÿå†…æ ¸ä¹‹ä¸Šï¼Œå°è£…äº†çº¿ç¨‹è°ƒåº¦ã€ä»»åŠ¡åˆ†å‘ã€é˜Ÿåˆ—ç®¡ç†ç­‰åŠŸèƒ½ã€‚\n\näºŒã€ä»»åŠ¡ä¸é˜Ÿåˆ—æ¨¡å‹1. ä»»åŠ¡ï¼šBlock å½¢å¼çš„å°è£…ä»£ç ï¼ˆå®è´¨æ˜¯é—­åŒ…ï¼‰æ¯ä¸ªä»»åŠ¡æ˜¯ä¸€ä¸ª dispatch_block_tï¼Œæœ¬è´¨æ˜¯å°è£…åœ¨ç»“æ„ä½“ä¸­çš„å‡½æ•°æŒ‡é’ˆå’Œä¸Šä¸‹æ–‡æ•°æ®ã€‚\n2. é˜Ÿåˆ—ï¼šä¸²è¡Œ or å¹¶å‘\nä¸²è¡Œé˜Ÿåˆ—ï¼šä»»åŠ¡ä¸€ä¸ªä¸ªé¡ºåºæ‰§è¡Œã€‚\nå¹¶å‘é˜Ÿåˆ—ï¼šä»»åŠ¡å¯åŒæ—¶æ‰§è¡Œï¼Œå…·ä½“æ˜¯å¦å¹¶è¡Œå–å†³äºç³»ç»Ÿèµ„æºã€‚\n\nåº•å±‚ç”±ç»“æ„ä½“ dispatch_queue_s è¡¨ç¤ºï¼Œå†…éƒ¨åŒ…å«ï¼š\n\né˜Ÿåˆ—åç§°\nä¼˜å…ˆçº§ï¼ˆQoSï¼‰\nTarget Queueï¼ˆç”¨äºç»§æ‰¿è¡Œä¸ºï¼‰\né˜Ÿåˆ—çŠ¶æ€ï¼ˆæ˜¯å¦æ­£åœ¨æ‰§è¡Œä»»åŠ¡ï¼‰\né˜Ÿåˆ—ç±»å‹ï¼ˆä¸²è¡Œ&#x2F;å¹¶å‘ï¼‰\n\n\nä¸‰ã€çº¿ç¨‹è°ƒåº¦åŸç†1. çº¿ç¨‹æ± æœºåˆ¶GCD ä¸ç›´æ¥åˆ›å»ºçº¿ç¨‹ï¼Œè€Œæ˜¯å¤ç”¨ä¸€ä¸ªç³»ç»Ÿç®¡ç†çš„çº¿ç¨‹æ± ï¼ˆManaged Thread Poolï¼‰ï¼š\n\nApple ä½¿ç”¨å†…æ ¸çš„ pthread å’Œ kqueue æœºåˆ¶åŠ¨æ€åˆ›å»ºå’Œè°ƒåº¦çº¿ç¨‹ã€‚\nè°ƒç”¨ dispatch_async ç­‰æ–¹æ³•æ—¶ä»»åŠ¡è¿›å…¥é˜Ÿåˆ—ï¼Œç­‰å¾…è°ƒåº¦å™¨ï¼ˆlibdispatchï¼‰åˆ¤æ–­æ˜¯å¦éœ€è¦ä»çº¿ç¨‹æ± ä¸­å–çº¿ç¨‹æ‰§è¡Œã€‚\n\n2. ç»“åˆå†…æ ¸çš„è°ƒåº¦å™¨\nä½¿ç”¨ XNU å†…æ ¸æä¾›çš„ workloopï¼ˆåŸºäº kqueueï¼‰æ¥ç›‘è§†é˜Ÿåˆ—å˜åŒ–ã€‚\nåˆ©ç”¨ä¿¡å·é‡ã€åŸå­æ“ä½œã€äº’æ–¥é”æ§åˆ¶ä»»åŠ¡åŒæ­¥ã€‚\n\n\nå››ã€é˜Ÿåˆ—çš„è°ƒåº¦æœºåˆ¶1. dispatch_async &#x2F; dispatch_sync çš„åŒºåˆ«\n\n\næ–¹æ³•\nè°ƒåº¦è¡Œä¸º\næ˜¯å¦é˜»å¡çº¿ç¨‹\n\n\n\ndispatch_async\nå¼‚æ­¥å…¥é˜Ÿ\nå¦\n\n\ndispatch_sync\nåŒæ­¥æ‰§è¡Œï¼Œå½“å‰çº¿ç¨‹ç­‰å¾…ä»»åŠ¡å®Œæˆ\næ˜¯\n\n\nåº•å±‚é€šè¿‡ï¼š\n\ndispatch_asyncï¼šåˆ›å»ºä»»åŠ¡å¯¹è±¡ -&gt; æ”¾å…¥ç›®æ ‡é˜Ÿåˆ— -&gt; å”¤é†’çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹å¤„ç†\ndispatch_syncï¼šç›´æ¥è°ƒç”¨ä»»åŠ¡ï¼Œå¹¶ä½¿ç”¨ semaphore é˜»å¡å½“å‰çº¿ç¨‹ï¼Œç›´åˆ°ä»»åŠ¡æ‰§è¡Œå®Œ\n\n\näº”ã€QoSï¼ˆæœåŠ¡è´¨é‡ï¼‰æ§åˆ¶GCD æ”¯æŒ QoSï¼ˆQuality of Serviceï¼‰ç­‰çº§ï¼Œä¾‹å¦‚ï¼š\n\nuserInteractiveï¼ˆæœ€é«˜ï¼‰\nuserInitiated\ndefault\nutility\nbackgroundï¼ˆæœ€ä½ï¼‰\n\nè¿™äº›ä¼˜å…ˆçº§é€šè¿‡åº•å±‚è®¾ç½®çº¿ç¨‹è°ƒåº¦å±æ€§ï¼Œåœ¨å†…æ ¸ä¸­ä¼šå½±å“çº¿ç¨‹æŠ¢å å’Œæ‰§è¡Œé¡ºåºã€‚\n\nå…­ã€å…³é”®æ•°æ®ç»“æ„ï¼ˆæºç è§’åº¦ï¼‰1. dispatch_queue_sï¼ˆé˜Ÿåˆ—ç»“æ„ä½“ï¼‰åŒ…å«ï¼š\nstruct dispatch_queue_s &#123;    ...    dispatch_object_t _head;    // é˜Ÿåˆ—å¤´éƒ¨    dispatch_object_t _tail;    // é˜Ÿåˆ—å°¾éƒ¨    pthread_priority_t _priority; // ä¼˜å…ˆçº§    ...&#125;;\n\n2. dispatch_continuation_sï¼ˆå°è£… block çš„ä»»åŠ¡ç»“æ„ä½“ï¼‰struct dispatch_continuation_s &#123;    void *dc_func;     // block å‡½æ•°æŒ‡é’ˆ    void *dc_ctxt;     // block ä¸Šä¸‹æ–‡    ...&#125;;\n\n\nä¸ƒã€å¹¶å‘æ§åˆ¶ï¼šä¿¡å·é‡ã€æ …æ ã€ç»„\ndispatch_semaphoreï¼šåº•å±‚åŸºäº semaphore_tï¼ˆMach ä¿¡å·é‡ï¼‰\ndispatch_barrierï¼šå†™æ“ä½œæ—¶é˜»å¡å…¶ä»–ä»»åŠ¡ï¼Œåº•å±‚ä½¿ç”¨ä»»åŠ¡ä¾èµ–å’Œæ ‡è®°æœºåˆ¶å®ç°\ndispatch_groupï¼šé€šè¿‡è®¡æ•°å™¨è¿½è¸ªä»»åŠ¡ç»„çŠ¶æ€ï¼Œé…åˆä¿¡å·é‡å®ç°é€šçŸ¥\n\n\næ€»ç»“GCD æ˜¯åŸºäº libdispatch æ„å»ºçš„çº¿ç¨‹æ±  + é˜Ÿåˆ—è°ƒåº¦æ¡†æ¶ï¼Œå…¶æ ¸å¿ƒä¼˜åŠ¿åŒ…æ‹¬ï¼š\n\né«˜æ•ˆçš„çº¿ç¨‹å¤ç”¨\nç®€æ´çš„ API å°è£…ï¼ˆblockï¼‰\nåŠ¨æ€ä¼˜å…ˆçº§ç®¡ç†ï¼ˆQoSï¼‰\nåº•å±‚ç»“åˆå†…æ ¸æœºåˆ¶ï¼ˆå¦‚ kqueue å’Œ pthreadï¼‰\n\n","categories":["åŸºç¡€"]},{"title":"Day10-ä¸‰æ•°ä¹‹å’Œ","url":"/2025/05/08/Day10-%E4%B8%89%E6%95%B0%E4%B9%8B%E5%92%8C/","content":"ğŸ”— LeetCode 15 - ä¸‰æ•°ä¹‹å’Œ\nğŸ“Œ é¢˜ç›®æè¿°ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ numsï¼Œåˆ¤æ–­æ˜¯å¦å­˜åœ¨ä¸‰å…ƒç»„ [nums[i], nums[j], nums[k]]ï¼Œæ»¡è¶³ï¼š\ni â‰  jã€i â‰  k ä¸” j â‰  knums[i] + nums[j] + nums[k] == 0\n\nè¯·ä½ è¿”å›æ‰€æœ‰å’Œä¸º 0 ä¸”ä¸é‡å¤çš„ä¸‰å…ƒç»„ã€‚ä½ ä¸èƒ½åŒ…å«é‡å¤çš„ä¸‰å…ƒç»„ã€‚\nç¤ºä¾‹ï¼š\nè¾“å…¥ï¼šnums = [-1,0,1,2,-1,-4]è¾“å‡ºï¼š[[-1,-1,2],[-1,0,1]]\n\n\nğŸ’¡ è§£é¢˜æ€è·¯\nå…ˆå°†æ•°ç»„æ’åºï¼›\nå›ºå®šä¸€ä¸ªæ•° nums[i]ï¼Œå†ç”¨åŒæŒ‡é’ˆåœ¨ i+1...n-1 èŒƒå›´å†…æ‰¾ä¸¤ä¸ªæ•°çš„å’Œä¸º -nums[i]ï¼›\næ³¨æ„è·³è¿‡é‡å¤æ•°å­—ä»¥é¿å…é‡å¤ç»“æœã€‚\n\næ—¶é—´å¤æ‚åº¦ä¸º O(n^2)ã€‚\n\nâœ… JavaScript å®ç°var threeSum = function(nums) &#123;    nums.sort(function(a, b) &#123; return a - b; &#125;);    let res = [];    for (let i = 0; i &lt; nums.length - 2; i++) &#123;        if (i &gt; 0 &amp;&amp; nums[i] === nums[i - 1]) continue;        let left = i + 1, right = nums.length - 1;        while (left &lt; right) &#123;            let sum = nums[i] + nums[left] + nums[right];            if (sum === 0) &#123;                res.push([nums[i], nums[left], nums[right]]);                while (left &lt; right &amp;&amp; nums[left] === nums[left + 1]) left++;                while (left &lt; right &amp;&amp; nums[right] === nums[right - 1]) right--;                left++;                right--;            &#125; else if (sum &lt; 0) &#123;                left++;            &#125; else &#123;                right--;            &#125;        &#125;    &#125;    return res;&#125;;\n\n\nğŸŸ£ Swift å®ç°class Solution &#123;    func threeSum(_ nums: [Int]) -&gt; [[Int]] &#123;        let nums = nums.sorted()        var res = [[Int]]()        for i in 0..&lt;nums.count &#123;            if i &gt; 0 &amp;&amp; nums[i] == nums[i - 1] &#123; continue &#125;            var left = i + 1            var right = nums.count - 1            while left &lt; right &#123;                let sum = nums[i] + nums[left] + nums[right]                if sum == 0 &#123;                    res.append([nums[i], nums[left], nums[right]])                    while left &lt; right &amp;&amp; nums[left] == nums[left + 1] &#123; left += 1 &#125;                    while left &lt; right &amp;&amp; nums[right] == nums[right - 1] &#123; right -= 1 &#125;                    left += 1                    right -= 1                &#125; else if sum &lt; 0 &#123;                    left += 1                &#125; else &#123;                    right -= 1                &#125;            &#125;        &#125;        return res    &#125;&#125;","categories":["ç®—æ³•"]},{"title":"Day11-GCD vs NSOperation æ¡†æ¶å¯¹æ¯”","url":"/2025/05/09/Day11-GCD-vs-NSOperation-%E6%A1%86%E6%9E%B6%E5%AF%B9%E6%AF%94/","content":"ä¸€ã€åŸºæœ¬ä»‹ç»\n\n\næ–¹é¢\nGCD\nNSOperation\n\n\n\næ‰€å±æ¡†æ¶\nC è¯­è¨€åº•å±‚ APIï¼ŒFoundation æ¡†æ¶\nFoundation æ¡†æ¶çš„é¢å‘å¯¹è±¡å°è£…\n\n\nç¼–ç¨‹èŒƒå¼\nå‡½æ•°å¼ï¼ˆBlockï¼‰\né¢å‘å¯¹è±¡ï¼ˆOperation å¯¹è±¡ï¼‰\n\n\nçº¿ç¨‹ç®¡ç†\nè‡ªåŠ¨ç®¡ç†çº¿ç¨‹\nåŸºäº NSOperationQueueï¼Œå°è£…è‰¯å¥½\n\n\né€‚ç”¨åœºæ™¯\næ€§èƒ½ä¼˜å…ˆï¼Œè½»é‡å¹¶å‘æ§åˆ¶\næ›´å¤æ‚çš„ä»»åŠ¡ä¾èµ–å’Œç®¡ç†éœ€æ±‚\n\n\näºŒã€æ ¸å¿ƒç»„ä»¶å¯¹æ¯”\n\n\nåŠŸèƒ½\nGCD\nNSOperation\n\n\n\næ‰§è¡Œä½“\ndispatch_async + Block\nè‡ªå®šä¹‰ NSOperation å­ç±» æˆ– BlockOperation\n\n\né˜Ÿåˆ—ç®¡ç†\ndispatch_queue\nNSOperationQueue\n\n\næœ€å¤§å¹¶å‘æ•°æ§åˆ¶\nä¸æ”¯æŒï¼ˆé™¤éç”¨ä¿¡å·é‡ï¼‰\næ”¯æŒï¼ˆmaxConcurrentOperationCountï¼‰\n\n\nä»»åŠ¡å–æ¶ˆ\nä¸æ”¯æŒ\næ”¯æŒï¼ˆcancel æ–¹æ³• + è‡ªå®šä¹‰å–æ¶ˆé€»è¾‘ï¼‰\n\n\nä»»åŠ¡ä¾èµ–\nä¸æ”¯æŒ\næ”¯æŒï¼ˆaddDependency:ï¼‰\n\n\nä»»åŠ¡çŠ¶æ€ç›‘æ§\nä¸æ”¯æŒ\næ”¯æŒï¼ˆå¦‚ isReady, isExecuting, isFinishedï¼‰\n\n\nQoS æ”¯æŒ\næ”¯æŒ\næ”¯æŒ\n\n\nåŒæ­¥ã€å¼‚æ­¥æ”¯æŒ\næ”¯æŒ\nä¸»è¦æ˜¯å¼‚æ­¥ï¼Œä¾èµ–é˜Ÿåˆ—æ§åˆ¶\n\n\nå®šæ—¶è°ƒåº¦\næ”¯æŒï¼ˆdispatch_after, dispatch_timerï¼‰\nä¸ç›´æ¥æ”¯æŒ\n\n\nä¸‰ã€ä½¿ç”¨å¯¹æ¯”ç¤ºä¾‹GCD ç¤ºä¾‹ï¼šDispatchQueue.global(qos: .background).async &#123;    // åå°çº¿ç¨‹ä»»åŠ¡    DispatchQueue.main.async &#123;        // å›åˆ°ä¸»çº¿ç¨‹æ›´æ–° UI    &#125;&#125;\n\nNSOperation ç¤ºä¾‹ï¼šlet operationQueue = OperationQueue()let operation = BlockOperation &#123;    // åå°ä»»åŠ¡    OperationQueue.main.addOperation &#123;        // æ›´æ–° UI    &#125;&#125;operationQueue.addOperation(operation)\n\nå››ã€ä½¿ç”¨å»ºè®®\n\n\nåœºæ™¯\næ¨èæ¡†æ¶\nç†ç”±\n\n\n\nç®€å•å¼‚æ­¥ä»»åŠ¡\nGCD\nè½»é‡ã€ç®€æ´ã€æ€§èƒ½å¥½\n\n\néœ€è¦å–æ¶ˆ&#x2F;æš‚åœä»»åŠ¡\nNSOperation\nå†…å»ºæ”¯æŒå–æ¶ˆã€æš‚åœã€çŠ¶æ€ç®¡ç†\n\n\néœ€è¦ä»»åŠ¡ä¾èµ–\nNSOperation\næä¾› addDependency\n\n\nä»»åŠ¡è¾ƒä¸ºç‹¬ç«‹\nGCD\nå¼€é”€å°\n\n\nå¤æ‚çš„ä»»åŠ¡è°ƒåº¦ç³»ç»Ÿ\nNSOperation\né¢å‘å¯¹è±¡ï¼Œåˆ©äºç»´æŠ¤å’Œæ‰©å±•\n\n\näº”ã€æ€»ç»“\n\n\né¡¹ç›®\nGCD\nNSOperation\n\n\n\nç®€æ´æ€§\nâœ… é«˜\nâŒ ç›¸å¯¹å¤æ‚\n\n\nçµæ´»æ€§\nâŒ ä½\nâœ… é«˜\n\n\næ€§èƒ½\nâœ… é«˜ï¼ˆååº•å±‚ï¼‰\nâŒ ç¨é€Šä¸€ç­¹\n\n\nå¯è¯»æ€§&#x2F;å¯ç»´æŠ¤æ€§\nâŒ å·®ï¼ˆblock é“¾åµŒå¥—ï¼‰\nâœ… é«˜ï¼ˆå°è£…æ˜ç¡®ï¼‰\n\n\næ§åˆ¶èƒ½åŠ›\nâŒ é™\nâœ… å®Œæ•´\n\n\n","categories":["åŸºç¡€"]},{"title":"Day11-ç¯å½¢é“¾è¡¨","url":"/2025/05/09/Day11-%E7%8E%AF%E5%BD%A2%E9%93%BE%E8%A1%A8/","content":"ğŸ”— LeetCode 141 - Linked List Cycle\nğŸ“Œ é¢˜ç›®æè¿°ç»™å®šä¸€ä¸ªé“¾è¡¨ï¼Œåˆ¤æ–­é“¾è¡¨ä¸­æ˜¯å¦æœ‰ç¯ã€‚\nä¸ºäº†è¡¨ç¤ºç»™å®šé“¾è¡¨ä¸­çš„ç¯ï¼Œæˆ‘ä»¬ä½¿ç”¨æ•´æ•° pos æ¥è¡¨ç¤ºé“¾è¡¨å°¾è¿æ¥åˆ°é“¾è¡¨ä¸­çš„ä½ç½®ï¼ˆç´¢å¼•ä» 0 å¼€å§‹ï¼‰ã€‚å¦‚æœ pos æ˜¯ -1ï¼Œåˆ™åœ¨è¯¥é“¾è¡¨ä¸­æ²¡æœ‰ç¯ã€‚\nç¤ºä¾‹ï¼š\nè¾“å…¥ï¼šhead = [3,2,0,-4], pos = 1è¾“å‡ºï¼štrue\n\n\nğŸ’¡ è§£é¢˜æ€è·¯ä½¿ç”¨å¿«æ…¢æŒ‡é’ˆï¼š\n\næ…¢æŒ‡é’ˆä¸€æ¬¡èµ°ä¸€æ­¥ï¼›\n\nå¿«æŒ‡é’ˆä¸€æ¬¡èµ°ä¸¤æ­¥ï¼›\n\nå¦‚æœé“¾è¡¨æœ‰ç¯ï¼Œå¿«æ…¢æŒ‡é’ˆæœ€ç»ˆä¼šåœ¨æŸä¸ªèŠ‚ç‚¹ç›¸é‡ï¼›\n\nå¦‚æœæ— ç¯ï¼Œå¿«æŒ‡é’ˆä¼šå…ˆèµ°åˆ° nullã€‚\n\næ—¶é—´å¤æ‚åº¦ï¼šO(n)\n\nç©ºé—´å¤æ‚åº¦ï¼šO(1)\n\n\n\nâœ… JavaScript å®ç°ï¼ˆå¿«æ…¢æŒ‡é’ˆï¼‰var hasCycle = function(head) &#123;    if (!head || !head.next) return false;    let slow = head;    let fast = head.next;    while (slow !== fast) &#123;        if (!fast || !fast.next) return false;        slow = slow.next;        fast = fast.next.next;    &#125;    return true;&#125;;\n\n\nğŸ§  æ€è€ƒæ‹“å±•\nå¦‚æœéœ€è¦æ‰¾å‡ºç¯çš„å…¥å£èŠ‚ç‚¹æ€ä¹ˆåšï¼Ÿï¼ˆå‚è§ LeetCode 142ï¼‰\nå¦‚æœæƒ³ç»Ÿè®¡ç¯çš„é•¿åº¦å‘¢ï¼Ÿ\nä½¿ç”¨å“ˆå¸Œè¡¨æ˜¯å¦ä¹Ÿèƒ½è§£å†³ï¼Ÿæ—¶é—´ä¸ç©ºé—´å¤æ‚åº¦å¦‚ä½•å˜åŒ–ï¼Ÿ\n\n","categories":["ç®—æ³•"]},{"title":"Day12-ARC æœ¬è´¨ã€Weak å®ç°ã€å¾ªç¯å¼•ç”¨å¤„ç†","url":"/2025/05/12/Day12-ARC-%E6%9C%AC%E8%B4%A8%E3%80%81Weak-%E5%AE%9E%E7%8E%B0%E3%80%81%E5%BE%AA%E7%8E%AF%E5%BC%95%E7%94%A8%E5%A4%84%E7%90%86/","content":"ä¸€ã€ARC çš„æœ¬è´¨ï¼ˆAutomatic Reference Countingï¼‰ARC æ˜¯ç¼–è¯‘å™¨çº§åˆ«çš„å†…å­˜ç®¡ç†æœºåˆ¶ï¼Œç”± Clang ç¼–è¯‘å™¨åœ¨ç¼–è¯‘æ—¶æ’å…¥ retain&#x2F;release&#x2F;autorelease ç›¸å…³çš„ä»£ç ã€‚\næ ¸å¿ƒæœºåˆ¶\næ¯ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€ä¸ª å¼•ç”¨è®¡æ•°ï¼ˆretain countï¼‰ã€‚\nå¼ºå¼•ç”¨ï¼ˆstrongï¼‰+1ï¼ˆretainï¼‰ï¼Œé‡Šæ”¾ -1ï¼ˆreleaseï¼‰ã€‚\nå¼•ç”¨è®¡æ•°ä¸º 0 æ—¶ï¼Œè°ƒç”¨ dealloc é‡Šæ”¾å¯¹è±¡ã€‚\nARC åªç®¡ç†å¯¹è±¡å†…å­˜ï¼Œä¸ç®¡ç† malloc&#x2F;free çš„éå¯¹è±¡å†…å­˜ã€‚\n\n\näºŒã€Weak çš„å®ç°åŸç†__weak ä¸å¢åŠ å¼•ç”¨è®¡æ•°ï¼Œç”¨äºé¿å…å¾ªç¯å¼•ç”¨ï¼Œè‡ªåŠ¨åœ¨å¯¹è±¡é”€æ¯æ—¶ç½®ä¸º nilã€‚\nweak_table_t å…¨å±€ç»“æ„\nå­˜å‚¨æ‰€æœ‰ weak å¼•ç”¨å¯¹è±¡ä¸å¯¹åº”æŒ‡é’ˆåœ°å€ã€‚\næ¯ä¸ªå¯¹è±¡è®°å½•åœ¨ä¸€ä¸ª weak_entry_t ä¸­ï¼š\n\nstruct weak_entry_t &#123;    DisguisedPtr&lt;objc_object&gt; referent;    weak_referrer_t *referrers;&#125;;\n\nobjc_storeWeak(id *location, id obj)\næ¸…é™¤æ—§å€¼\nè®¾ç½®æ–°å€¼ï¼Œå¹¶æ³¨å†Œåˆ° weak_table_t\n\nå¯¹è±¡é”€æ¯æ—¶ï¼š\nè°ƒç”¨ objc_clearWeakRefsï¼Œå°†æ‰€æœ‰ weak æŒ‡é’ˆç½® nil\n\n\nä¸‰ã€å¾ªç¯å¼•ç”¨åŠå¤„ç†æ–¹å¼å¾ªç¯å¼•ç”¨å®šä¹‰\nå½“ä¸¤ä¸ªå¯¹è±¡äº’ç›¸å¼ºå¼•ç”¨ï¼Œå¼•ç”¨è®¡æ•°æ°¸è¿œä¸ä¸º 0ï¼Œå¯¼è‡´å†…å­˜æ³„æ¼ã€‚\n\nè§£å†³æ–¹æ³•\nä½¿ç”¨ __weak æˆ– __unsafe_unretained\nåœ¨ block ä¸­ä½¿ç”¨ [weak self] æˆ– [unowned self]\ndelegate å¸¸ä½¿ç”¨ weak\n\n\nå››ã€åº•å±‚å®ç°ï¼šå¼•ç”¨è®¡æ•°å­˜å‚¨ä¸æ“ä½œisa_t ç»“æ„ï¼ˆ64 ä½ç³»ç»Ÿï¼‰union isa_t &#123;    uintptr_t bits;    struct &#123;        uintptr_t nonpointer        : 1;        uintptr_t has_assoc         : 1;        uintptr_t has_cxx_dtor      : 1;        uintptr_t shiftcls          : 44;        uintptr_t magic             : 6;        uintptr_t weakly_referenced : 1;        uintptr_t deallocating      : 1;        uintptr_t has_sidetable_rc  : 1;        uintptr_t extra_rc          : 8;    &#125;;&#125;;\n\nextra_rc\nå¼•ç”¨è®¡æ•°å¿«é€Ÿè·¯å¾„ï¼Œæœ€å¤§ 255ã€‚\nè¶…è¿‡åï¼Œå¼•ç”¨è®¡æ•°ä¿¡æ¯å­˜å…¥ SideTableã€‚\n\nSideTable ç»“æ„struct SideTable &#123;    spinlock_t slock;    RefcountMap refcnts;    weak_table_t weak_table;&#125;;\n\n\näº”ã€objc_retain å’Œ objc_release åº•å±‚é€»è¾‘objc_retain(id obj)id objc_retain(id obj) &#123;    if (obj == nil) return nil;    if (obj-&gt;isa.tryRetain()) return obj;    return retainSlow(obj);&#125;\n\nobjc_release(id obj)void objc_release(id obj) &#123;    if (obj == nil) return;    if (obj-&gt;isa.tryRelease()) return;    releaseSlow(obj);&#125;\n\n\nå…­ã€__weak ä¸ __unsafe_unretained å¯¹æ¯”\n\n\nç‰¹æ€§\n__weak\n__unsafe_unretained\n\n\n\næ˜¯å¦å¢åŠ å¼•ç”¨è®¡æ•°\nå¦\nå¦\n\n\nå¯¹è±¡é‡Šæ”¾åæŒ‡é’ˆ\nè‡ªåŠ¨ nil\næ‚¬å‚æŒ‡é’ˆ\n\n\nå®‰å…¨æ€§\né«˜\nä½\n\n\næ€§èƒ½\nç¨ä½\né«˜\n\n\n\nä¸ƒã€è°ƒè¯•ä¸ä¼˜åŒ–å»ºè®®è°ƒè¯•å·¥å…·\n[object retainCount]\npo [obj retainCount] (LLDB)\nè®¾ç½®ç¯å¢ƒå˜é‡ï¼š\n\nexport OBJC_PRINT_RETAIN_RELEASE=YES\n\nä¼˜åŒ–å»ºè®®\nweak æœ‰æ€§èƒ½å¼€é”€ï¼Œé¢‘ç¹ä½¿ç”¨éœ€è°¨æ…ã€‚\nblock æ•è· self æ—¶å»ºè®®ä½¿ç”¨ [weak self]ã€‚\n\n\nå…«ã€æ€»ç»“æ¶æ„å›¾ç¤ºï¼ˆæ–‡å­—ç‰ˆï¼‰â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ ARC ç¼–è¯‘å™¨æ’å…¥ â”‚â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜       â†“â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ isa_t çš„ extra_rc â”‚  &lt;â”€â”€â”€&lt;255 å¿«è·¯å¾„â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜       â†“â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ SideTable å­˜å‚¨å¼•ç”¨è®¡æ•° â”‚â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜       â†“â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ weak_table_t â”‚ â† weakå¼•ç”¨ç®¡ç†â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n","categories":["åŸºç¡€"]},{"title":"Day13-å†…å­˜æ³„æ¼æ’æŸ¥ã€åƒµå°¸å¯¹è±¡ä¸ MRC å›é¡¾","url":"/2025/05/13/Day13-%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F%E6%8E%92%E6%9F%A5%E3%80%81%E5%83%B5%E5%B0%B8%E5%AF%B9%E8%B1%A1%E4%B8%8E-MRC-%E5%9B%9E%E9%A1%BE/","content":"ä¸€ã€iOSå†…å­˜æ³„æ¼æ’æŸ¥1. å¸¸è§å†…å­˜æ³„æ¼åœºæ™¯\nå¾ªç¯å¼•ç”¨ï¼šå¯¹è±¡ä¹‹é—´ç›¸äº’å¼ºå¼•ç”¨ï¼ˆå¦‚çˆ¶å­å¯¹è±¡ã€Blockæ•è·selfæœªä½¿ç”¨weakä¿®é¥°ï¼‰ï¼Œå¯¼è‡´æ— æ³•é‡Šæ”¾516ã€‚\næœªé‡Šæ”¾Core Foundationå¯¹è±¡ï¼šä½¿ç”¨CFæ¡†æ¶ï¼ˆå¦‚CFArrayRefã€CGImageRefï¼‰æ—¶æœªè°ƒç”¨CFRelease17ã€‚\nNSTimer&#x2F;CADisplayLinkå¼ºå¼•ç”¨ï¼šæœªåœ¨é€‚å½“æ—¶æœºè°ƒç”¨invalidateï¼Œå¯¼è‡´æŒæœ‰è€…æ— æ³•é‡Šæ”¾516ã€‚\nå¤§å¯¹è±¡æœªé‡Šæ”¾ï¼šå¦‚ç¼“å­˜å›¾ç‰‡ã€è§†é¢‘èµ„æºæœªåŠæ—¶æ¸…ç†416ã€‚\nARCä¸‹çš„éšå¼æ³„æ¼ï¼šæŒ‡é’ˆæå‰ç½®nilï¼Œå¯¼è‡´å †å¯¹è±¡æœªè¢«é‡Šæ”¾ï¼ˆå¦‚Person *p = [Person new]; p = nil;ï¼‰3ã€‚\n\n2. æ’æŸ¥å·¥å…·ä¸æ–¹æ³•\né™æ€åˆ†æï¼ˆAnalyzeï¼‰ï¼šé€šè¿‡Xcodeçš„Product -&gt; Analyzeæ£€æµ‹ä»£ç é€»è¾‘é”™è¯¯ï¼ˆå¦‚è®¿é—®æœªåˆå§‹åŒ–æŒ‡é’ˆã€æœªé‡Šæ”¾è·¯å¾„ï¼‰1113ã€‚\nåŠ¨æ€åˆ†æï¼ˆInstrumentsï¼‰ï¼š\nLeaksï¼šæ£€æµ‹æœªé‡Šæ”¾çš„å†…å­˜æ³„æ¼ï¼Œç»“åˆCall Treeå®šä½ä»£ç ä½ç½®61215ã€‚\nAllocationsï¼šç›‘æ§å†…å­˜åˆ†é…è¶‹åŠ¿ï¼Œè¯†åˆ«å¼‚å¸¸å¢é•¿åŒºåŸŸ17ã€‚\n\n\nDebug Memory Graphï¼šå¯è§†åŒ–å¯¹è±¡å¼•ç”¨å…³ç³»ï¼Œå¿«é€Ÿå‘ç°å¾ªç¯å¼•ç”¨613ã€‚\nç¬¬ä¸‰æ–¹å·¥å…·ï¼šå¦‚è…¾è®¯çš„MLeaksFinderï¼Œè‡ªåŠ¨åŒ–æ£€æµ‹é¡µé¢æ³„æ¼6914ã€‚\n\n\näºŒã€åƒµå°¸å¯¹è±¡ï¼ˆZombie Objectsï¼‰1. å®šä¹‰ä¸æˆå› \nåƒµå°¸å¯¹è±¡ï¼šå·²è¢«é‡Šæ”¾ï¼ˆdeallocï¼‰ä½†ä»åœ¨è¢«è®¿é—®çš„å¯¹è±¡ï¼Œè®¿é—®æ—¶ä¼šå¯¼è‡´EXC_BAD_ACCESSå´©æºƒ818ã€‚\nå¸¸è§åœºæ™¯ï¼š\nè¿‡åº¦é‡Šæ”¾ï¼šå¯¹åŒä¸€å¯¹è±¡å¤šæ¬¡è°ƒç”¨releaseï¼ˆMRCä¸‹ï¼‰8ã€‚\né‡æŒ‡é’ˆï¼šæŒ‡é’ˆæŒ‡å‘å·²é‡Šæ”¾å¯¹è±¡åæœªç½®nilï¼ˆå¦‚MRCä¸‹æ‚¬å‚æŒ‡é’ˆï¼‰818ã€‚\n\n\n\n2. æ£€æµ‹ä¸è§£å†³\nå¯ç”¨Zombie Instrumentï¼šåœ¨Instrumentsä¸­é€‰æ‹©Zombiesæ¨¡å¼ï¼Œæ•è·è®¿é—®åƒµå°¸å¯¹è±¡çš„è¡Œä¸º817ã€‚\nARCä¸‹çš„é˜²æŠ¤ï¼šé€šè¿‡weakä¿®é¥°ç¬¦é¿å…é‡æŒ‡é’ˆï¼Œè‡ªåŠ¨ç½®nil58ã€‚\nMRCä¸‹çš„è§„èŒƒï¼šéµå¾ªretain&#x2F;releaseé…å¯¹åŸåˆ™ï¼Œé‡Šæ”¾åæŒ‡é’ˆç½®nil38ã€‚\n\n\nä¸‰ã€MRCï¼ˆManual Reference Countingï¼‰å›é¡¾1. æ ¸å¿ƒè§„åˆ™\næ‰‹åŠ¨ç®¡ç†å¼•ç”¨è®¡æ•°ï¼šé€šè¿‡retainå¢åŠ è®¡æ•°ï¼Œreleaseå‡å°‘è®¡æ•°ï¼Œautoreleaseå»¶è¿Ÿé‡Šæ”¾17ã€‚\næ‰€æœ‰æƒåŸåˆ™ï¼šè°åˆ›å»ºï¼ˆalloc&#x2F;new&#x2F;copyï¼‰ã€è°é‡Šæ”¾ï¼›å…¶ä»–æƒ…å†µéœ€æ˜¾å¼retain79ã€‚\nSetteræ–¹æ³•è§„èŒƒï¼š- (void)setObject:(id)newObject &#123;    [_object release];      // é‡Šæ”¾æ—§å€¼    _object = [newObject retain]; // ä¿ç•™æ–°å€¼&#125;\néœ€æ³¨æ„æ—§å€¼å¯èƒ½å·²è¢«é‡Šæ”¾çš„é£é™©9ã€‚\n\n2. å¸¸è§é—®é¢˜ä¸é™·é˜±\nä¸å¹³è¡¡çš„retain&#x2F;releaseï¼šå¯¼è‡´å†…å­˜æ³„æ¼æˆ–è¿‡åº¦é‡Šæ”¾17ã€‚\nå¾ªç¯å¼•ç”¨ï¼šéœ€æ‰‹åŠ¨æ‰“ç ´å¼ºå¼•ç”¨é“¾ï¼ˆå¦‚ä½¿ç”¨assignæ›¿ä»£retainï¼‰516ã€‚\nAutorelease Poolç®¡ç†ï¼šå¤§é‡ä¸´æ—¶å¯¹è±¡éœ€æ‰‹åŠ¨æ§åˆ¶é‡Šæ”¾æ—¶æœºï¼Œé¿å…å†…å­˜å³°å€¼9ã€‚\n\n3. ARCçš„ä¼˜åŠ¿\nè‡ªåŠ¨åŒ–ï¼šç¼–è¯‘å™¨è‡ªåŠ¨æ’å…¥retain&#x2F;releaseä»£ç ï¼Œå‡å°‘äººä¸ºé”™è¯¯17ã€‚\nå®‰å…¨æ€§ï¼šé€šè¿‡weakå’Œstrongä¿®é¥°ç¬¦ç®¡ç†æ‰€æœ‰æƒï¼Œé¿å…åƒµå°¸å¯¹è±¡57ã€‚\n\n\nå››ã€æ€»ç»“ä¸å»ºè®®\nä¼˜å…ˆä½¿ç”¨ARCï¼šå‡å°‘æ‰‹åŠ¨ç®¡ç†é£é™©ï¼Œä½†éœ€æ³¨æ„ä¸Core Foundationäº¤äº’æ—¶çš„æ¡¥æ¥ï¼ˆ__bridgeã€CFReleaseï¼‰17ã€‚\nè§„èŒƒä»£ç ä¹ æƒ¯ï¼š\né¿å…å¾ªç¯å¼•ç”¨ï¼Œä½¿ç”¨weak&#x2F;unownedä¿®é¥°Blockæ•è·å¯¹è±¡5ã€‚\nåŠæ—¶é‡Šæ”¾éOCå¯¹è±¡ï¼ˆå¦‚Cè¯­è¨€mallocåˆ†é…çš„å†…å­˜ï¼‰17ã€‚\n\n\nç»“åˆå·¥å…·æ’æŸ¥ï¼šå®šæœŸä½¿ç”¨é™æ€åˆ†æã€åŠ¨æ€æ£€æµ‹å’Œå†…å­˜å›¾è°±ï¼Œå®šä½å¤æ‚æ³„æ¼é—®é¢˜61317ã€‚\n\né€šè¿‡ä¸Šè¿°æ–¹æ³•ï¼Œå¼€å‘è€…å¯æœ‰æ•ˆé™ä½å†…å­˜æ³„æ¼é£é™©ï¼Œæå‡åº”ç”¨ç¨³å®šæ€§ã€‚\n","categories":["åŸºç¡€"]},{"title":"Day12-äºŒå‰æ ‘çš„æœ€å¤§æ·±åº¦","url":"/2025/05/12/Day12-%E4%BA%8C%E5%8F%89%E6%A0%91%E7%9A%84%E6%9C%80%E5%A4%A7%E6%B7%B1%E5%BA%A6/","content":"ğŸ”— LeetCode 104 - Maximum Depth of Binary Tree\nğŸ“Œ é¢˜ç›®æè¿°ç»™å®šä¸€ä¸ªäºŒå‰æ ‘ï¼Œæ‰¾å‡ºå…¶æœ€å¤§æ·±åº¦ã€‚\n\næœ€å¤§æ·±åº¦æ˜¯ä»æ ¹èŠ‚ç‚¹åˆ°æœ€è¿œå¶å­èŠ‚ç‚¹çš„æœ€é•¿è·¯å¾„ä¸Šçš„èŠ‚ç‚¹æ•°ã€‚\n\nç¤ºä¾‹ï¼š\nè¾“å…¥ï¼š[3,9,20,null,null,15,7]è¾“å‡ºï¼š3è§£é‡Šï¼šæœ€å¤§è·¯å¾„æ˜¯ 3 -&gt; 20 -&gt; 7\n\n\n\nğŸ’¡ è§£é¢˜æ€è·¯æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ é€’å½’ æˆ– BFS å±‚åºéå† æ¥è§£å†³ï¼š\n\né€’å½’æ³•ï¼šæœ€å¤§æ·±åº¦ &#x3D; 1 + max(å·¦å­æ ‘æ·±åº¦, å³å­æ ‘æ·±åº¦)\nå±‚åºéå†ï¼šæ¯éå†ä¸€å±‚ï¼Œæ·±åº¦åŠ ä¸€\næ—¶é—´å¤æ‚åº¦ï¼šO(n)\nç©ºé—´å¤æ‚åº¦ï¼šO(h)ï¼Œh ä¸ºæ ‘çš„é«˜åº¦ï¼ˆé€’å½’æ ˆï¼‰\n\n\nâœ… JavaScript å®ç°ï¼ˆé€’å½’ï¼‰var maxDepth = function(root) &#123;    if (root === null) return 0;    return 1 + Math.max(maxDepth(root.left), maxDepth(root.right));&#125;;\n\n\nâœ… JavaScript å®ç°ï¼ˆBFSï¼‰var maxDepth = function(root) &#123;    if (!root) return 0;    let queue = [root];    let depth = 0;    while (queue.length &gt; 0) &#123;        let size = queue.length;        for (let i = 0; i &lt; size; i++) &#123;            let node = queue.shift();            if (node.left) queue.push(node.left);            if (node.right) queue.push(node.right);        &#125;        depth++;    &#125;    return depth;&#125;;\n\n\nğŸ§  æ€è€ƒæ‹“å±•\nå¦‚æœè¦æ±‚â€œæœ€å°æ·±åº¦â€å‘¢ï¼Ÿï¼ˆLeetCode 111ï¼‰\nå¦‚ä½•æ‰¾å‡ºæœ€é•¿è·¯å¾„ä¸Šçš„å…·ä½“èŠ‚ç‚¹ï¼Ÿ\nå¯å¦ä½¿ç”¨ DFS çš„éé€’å½’å†™æ³•ï¼Ÿ\n\n","categories":["ç®—æ³•"]},{"title":"Day14-ç§»åŠ¨é›¶","url":"/2025/05/14/Day14-%E7%A7%BB%E5%8A%A8%E9%9B%B6/","content":"ğŸ”— LeetCode 283 - Move Zeroes\nğŸ“Œ é¢˜ç›®æè¿°ç»™å®šä¸€ä¸ªæ•°ç»„ numsï¼Œç¼–å†™ä¸€ä¸ªå‡½æ•°å°†æ‰€æœ‰ 0 ç§»åŠ¨åˆ°æ•°ç»„çš„æœ«å°¾ï¼ŒåŒæ—¶ä¿æŒéé›¶å…ƒç´ çš„ç›¸å¯¹é¡ºåºä¸å˜ã€‚\nç¤ºä¾‹ï¼š\nè¾“å…¥: [0,1,0,3,12]è¾“å‡º: [1,3,12,0,0]\n\n\nğŸ’¡ è§£é¢˜æ€è·¯\nç”¨ä¸€ä¸ªæŒ‡é’ˆ lastNonZeroIndex æ¥è®°å½•ä¸‹ä¸€ä¸ªåº”è¯¥æ”¾éé›¶å…ƒç´ çš„ä½ç½®ï¼›\néå†ä¸€éæ•°ç»„ï¼Œé‡åˆ°éé›¶å°±æ”¾åˆ°è¯¥ä½ç½®ï¼›\néå†ç»“æŸåï¼Œä»è¯¥ä½ç½®å¼€å§‹è¡¥é›¶ã€‚\n\n\nâœ… JavaScript å®ç°var moveZeroes = function(nums) &#123;    let lastNonZeroIndex = 0;    for (let i = 0; i &lt; nums.length; i++) &#123;        if (nums[i] !== 0) &#123;            nums[lastNonZeroIndex++] = nums[i];        &#125;    &#125;    for (let i = lastNonZeroIndex; i &lt; nums.length; i++) &#123;        nums[i] = 0;    &#125;&#125;;\n\n\nğŸ§  æ€è€ƒæ‹“å±•\nå¦‚æœä¸èƒ½ä¿®æ”¹åŸæ•°ç»„å‘¢ï¼Ÿæ€ä¹ˆåšï¼Ÿ\nå¦‚ä½•æœ€å°‘æ“ä½œæ¬¡æ•°å®Œæˆç§»åŠ¨ï¼Ÿ\næ˜¯å¦å¯ä»¥åŒæŒ‡é’ˆä¼˜åŒ–ç‰ˆæœ¬ï¼Ÿ\n\n","categories":["ç®—æ³•"]},{"title":"Day13-ç›¸äº¤é“¾è¡¨","url":"/2025/05/13/Day13-%E7%9B%B8%E4%BA%A4%E9%93%BE%E8%A1%A8/","content":"ğŸ”— LeetCode 160 - Intersection of Two Linked Lists\nğŸ“Œ é¢˜ç›®æè¿°ç»™ä½ ä¸¤ä¸ªå•é“¾è¡¨çš„å¤´èŠ‚ç‚¹ headA å’Œ headBï¼Œè¯·ä½ æ‰¾å‡ºå¹¶è¿”å›ä¸¤ä¸ªå•é“¾è¡¨ç›¸äº¤çš„èµ·å§‹èŠ‚ç‚¹ã€‚å¦‚æœä¸¤ä¸ªé“¾è¡¨ä¸å­˜åœ¨ç›¸äº¤èŠ‚ç‚¹ï¼Œè¿”å› nullã€‚\nç¤ºä¾‹ï¼š\nA:       a1 â†’ a2â†˜c1 â†’ c2 â†’ c3â†—B: b1 â†’ b2 â†’ b3è¾“å‡ºï¼šc1\n\n\nğŸ’¡ è§£é¢˜æ€è·¯æˆ‘ä»¬å¯ä»¥ä½¿ç”¨â€œåŒæŒ‡é’ˆæ³•â€ï¼š\n\nåˆ†åˆ«ä»ä¸¤ä¸ªé“¾è¡¨çš„å¤´å¼€å§‹éå†\nå½“æŒ‡é’ˆ A åˆ°å°¾éƒ¨æ—¶ï¼Œè½¬åˆ° B é“¾è¡¨å¤´ï¼›æŒ‡é’ˆ B åˆ°å°¾éƒ¨æ—¶ï¼Œè½¬åˆ° A é“¾è¡¨å¤´\nå¦‚æœæœ‰äº¤ç‚¹ï¼Œæœ€ç»ˆä¸¤ä¸ªæŒ‡é’ˆä¼šåœ¨äº¤ç‚¹ç›¸é‡\nå¦åˆ™ï¼Œéƒ½ä¼šå˜ä¸º nullï¼Œè¡¨ç¤ºæ²¡æœ‰ç›¸äº¤\n\næ ¸å¿ƒæ€æƒ³ï¼šä¸¤ä¸ªæŒ‡é’ˆèµ°è¿‡çš„è·¯ç¨‹ä¸€æ ·ï¼Œæœ€ç»ˆä¼šåœ¨äº¤ç‚¹é‡åˆæˆ–åŒæ—¶ä¸º null\n\nâœ… JavaScript å®ç°var getIntersectionNode = function(headA, headB) &#123;    if (!headA || !headB) return null;    let pA = headA, pB = headB;    while (pA !== pB) &#123;        pA = pA === null ? headB : pA.next;        pB = pB === null ? headA : pB.next;    &#125;    return pA;&#125;;\n\n\nğŸ§  æ€è€ƒæ‹“å±•\nå¦‚æœä¸å…è®¸ä¿®æ”¹åŸé“¾è¡¨ç»“æ„ï¼Œè¿˜èƒ½æ€ä¹ˆåšï¼Ÿ\nç©ºé—´å¤æ‚åº¦å¯ä»¥ä¸º O(1) å—ï¼Ÿ\nå¦‚æœé“¾è¡¨æœ‰ç¯ï¼Œè¿˜èƒ½æ‰¾åˆ°ç›¸äº¤èŠ‚ç‚¹å—ï¼Ÿï¼ˆç»“åˆ LeetCode 142ï¼‰\n\n","categories":["ç®—æ³•"]},{"title":"Day14-RunLoop&å¤šçº¿ç¨‹&å†…å­˜ç®¡ç†","url":"/2025/05/14/Day14-RunLoop-%E5%A4%9A%E7%BA%BF%E7%A8%8B-%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/","content":"ä¸€ã€æ ¸å¿ƒæ¦‚å¿µ1. RunLoop\nRunLoop æ˜¯çº¿ç¨‹çš„äº‹ä»¶å¤„ç†å¾ªç¯ï¼Œæ˜¯ NSRunLoop å’Œ CFRunLoopRef çš„å°è£…ã€‚\né»˜è®¤åªåœ¨ä¸»çº¿ç¨‹è‡ªåŠ¨å¯åŠ¨ã€‚\nç®¡ç†äº‹ä»¶æºï¼ˆTimerã€Input Sourceã€Observerï¼‰ã€‚\nä¿æŒçº¿ç¨‹æ´»è·ƒã€å»¶è¿Ÿæ‰§è¡Œä»»åŠ¡ã€ç›‘å¬è¾“å…¥ç­‰éƒ½ä¾èµ– RunLoopã€‚\n\n2. å¤šçº¿ç¨‹\niOS æ”¯æŒå¤šçº¿ç¨‹æ–¹å¼æœ‰ï¼š\nNSThread\nGCDï¼ˆä¸»æµï¼‰\nNSOperationQueue\n\n\næ¯æ¡çº¿ç¨‹éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„ RunLoopï¼Œä½†é»˜è®¤åªæœ‰ä¸»çº¿ç¨‹çš„ RunLoop è‡ªåŠ¨è¿è¡Œã€‚\n\n3. å†…å­˜ç®¡ç†ï¼ˆä»¥ ARC ä¸ºåŸºç¡€ï¼‰\nä½¿ç”¨ retain/release ç®¡ç†å¯¹è±¡ç”Ÿå‘½å‘¨æœŸã€‚\nstrong/weak/unowned æ§åˆ¶å¼•ç”¨å…³ç³»ã€‚\nå¤šçº¿ç¨‹åœºæ™¯ä¸­æ³¨æ„å¼•ç”¨å¾ªç¯ã€é‡æŒ‡é’ˆã€çº¿ç¨‹åŒæ­¥é—®é¢˜ã€‚\n\n\näºŒã€ä¸‰è€…ä¹‹é—´çš„è”ç³»RunLoop ä¸ å¤šçº¿ç¨‹\nå­çº¿ç¨‹è‹¥éœ€å¤„ç† Timerã€äº‹ä»¶ç›‘å¬ï¼Œå¿…é¡»æ‰‹åŠ¨å¼€å¯ RunLoopã€‚\nå­çº¿ç¨‹é»˜è®¤ RunLoop ä¸å¯åŠ¨ï¼Œä»»åŠ¡æ‰§è¡Œå®Œå°±é€€å‡ºã€‚\nç¤ºä¾‹ï¼š- (void)startBackgroundThread &#123;    NSThread *thread = [[NSThread alloc] initWithBlock:^&#123;        NSLog(@&quot;Start thread&quot;);        [[NSRunLoop currentRunLoop] addPort:[NSPort port] forMode:NSDefaultRunLoopMode];        [[NSRunLoop currentRunLoop] run];    &#125;];    [thread start];&#125;\n\nå¤šçº¿ç¨‹ ä¸ å†…å­˜ç®¡ç†\nARC è´Ÿè´£çº¿ç¨‹å®‰å…¨åœ°ç®¡ç†å¼•ç”¨è®¡æ•°ã€‚\nGCD çš„ Block é»˜è®¤å¼ºå¼•ç”¨æ•è·å¤–éƒ¨å˜é‡ï¼Œæ³¨æ„å†…å­˜æ³„æ¼ã€‚\nå¤šçº¿ç¨‹ä¸­è®¿é—®å…±äº«èµ„æºè¦å°å¿ƒå¹¶å‘è¯»å†™å¸¦æ¥çš„å†…å­˜è®¿é—®å¼‚å¸¸ã€‚\n\nRunLoop ä¸ å†…å­˜ç®¡ç†\nRunLoop ä¼šæŒæœ‰å®ƒæ³¨å†Œçš„äº‹ä»¶æºï¼ˆTimerã€Port ç­‰ï¼‰ã€‚\nè‹¥ Timer target å¯¹è±¡è¢«å¼ºå¼•ç”¨ï¼Œå®¹æ˜“é€ æˆå¾ªç¯å¼•ç”¨ï¼š// é”™è¯¯ç¤ºä¾‹self.timer = [NSTimer scheduledTimerWithTimeInterval:1.0 target:self selector:@selector(fire) userInfo:nil repeats:YES];\n\n\nä¸‰ã€å…¸å‹åœºæ™¯è§£æ\n\n\nåœºæ™¯\næ¶‰åŠç‚¹\næ³¨æ„äº‹é¡¹\n\n\n\nå­çº¿ç¨‹ä¿æŒæ´»è·ƒ\nRunLoop + å¤šçº¿ç¨‹\næ·»åŠ  Port &#x2F; Timer åæ‰‹åŠ¨å¯åŠ¨ RunLoop\n\n\nå®šæ—¶å™¨å¯¼è‡´å†…å­˜æ³„æ¼\nRunLoop + å†…å­˜ç®¡ç†\nä½¿ç”¨ weak selfï¼Œæˆ–ä¸­ä»‹å¯¹è±¡è§£è€¦\n\n\nå¼‚æ­¥ä»»åŠ¡ä¸­å›è°ƒ UI\nå¤šçº¿ç¨‹ + RunLoop\nå›åˆ°ä¸»çº¿ç¨‹ï¼Œä¸»çº¿ç¨‹çš„ RunLoop é©±åŠ¨ UI åˆ·æ–°\n\n\nGCD æ­»é”\nå¤šçº¿ç¨‹\ndispatch_sync åµŒå¥—è°ƒç”¨ä¸»é˜Ÿåˆ—å®¹æ˜“æ­»é”\n\n\nRunLoop çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†\nRunLoop + å†…å­˜ç®¡ç†\næ³¨æ„å¼ºå¼•ç”¨é˜»æ­¢çº¿ç¨‹é€€å‡º\n\n\n\nå››ã€é¢è¯•é—®é¢˜ä¸¾ä¾‹Q1: å­çº¿ç¨‹ä¸­ Timer ä¸æ‰§è¡Œï¼Œä¸ºä»€ä¹ˆï¼Ÿ\nA: å­çº¿ç¨‹é»˜è®¤ RunLoop æ²¡æœ‰å¯åŠ¨ï¼ŒTimer ä¾èµ– RunLoop æ‰§è¡Œã€‚\n\nQ2: NSTimer ä¸ºä»€ä¹ˆå¯èƒ½å¼•èµ·å†…å­˜æ³„æ¼ï¼Ÿå¦‚ä½•é¿å…ï¼Ÿ\nA: å› ä¸º NSTimer å¼ºå¼•ç”¨ targetï¼Œtarget åˆå¼ºå¼•ç”¨ timerã€‚ä½¿ç”¨ weak æˆ–ä¸­é—´å¯¹è±¡ï¼ˆå¦‚ NSProxyï¼‰è§£å†³å¾ªç¯å¼•ç”¨ã€‚\n\nQ3: GCD çš„å¼‚æ­¥ä»»åŠ¡ä¸­ä¸ºä½• UI æ›´æ–°å¤±è´¥ï¼Ÿ\nA: UI æ›´æ–°å¿…é¡»åœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œå¼‚æ­¥ä»»åŠ¡é»˜è®¤ä¸åœ¨ä¸»çº¿ç¨‹ï¼Œéœ€è¦ä½¿ç”¨ dispatch_async(dispatch_get_main_queue(), ^&#123; &#125;)ã€‚\n\nQ4: RunLoop å¦‚ä½•ä¿æŒçº¿ç¨‹å¸¸é©»ï¼Ÿ\nA: ä½¿ç”¨ [[NSRunLoop currentRunLoop] run]ï¼Œæˆ–è€…æ·»åŠ äº‹ä»¶æºå¦‚ Port æˆ– Timer ä¿æŒ RunLoop æ´»è·ƒã€‚\n\n\näº”ã€æ€»ç»“å›¾ç¤ºçº¿ç¨‹ï¼ˆThreadï¼‰   â””â”€â”€ RunLoopï¼ˆæ¯ä¸ªçº¿ç¨‹ä¸€ä¸ªï¼‰        â”œâ”€â”€ Timerï¼ˆå¼•ç”¨ targetï¼Œéœ€é¿å…å¾ªç¯å¼•ç”¨ï¼‰        â”œâ”€â”€ Input Sourceï¼ˆäº‹ä»¶ã€Portï¼‰        â””â”€â”€ Observerï¼ˆç›‘å¬çŠ¶æ€ï¼‰å¤šçº¿ç¨‹ â†” RunLoopï¼ˆä»»åŠ¡è°ƒåº¦ã€å¸¸é©»çº¿ç¨‹ï¼‰  å¤šçº¿ç¨‹ â†” å†…å­˜ç®¡ç†ï¼ˆåŒæ­¥è®¿é—®ã€Block æ•è·ï¼‰  RunLoop â†” å†…å­˜ç®¡ç†ï¼ˆTimer target å¾ªç¯å¼•ç”¨ï¼‰\n","categories":["åŸºç¡€"]},{"title":"Day15-ç¯å½¢é“¾è¡¨ II","url":"/2025/05/15/Day15-%E7%8E%AF%E5%BD%A2%E9%93%BE%E8%A1%A8-II/","content":"ğŸ”— LeetCode 142 - ç¯å½¢é“¾è¡¨ II\nğŸ“Œ é¢˜ç›®æè¿°ç»™å®šä¸€ä¸ªé“¾è¡¨çš„å¤´èŠ‚ç‚¹ headï¼Œè¿”å›é“¾è¡¨å¼€å§‹å…¥ç¯çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ã€‚å¦‚æœé“¾è¡¨æ— ç¯ï¼Œåˆ™è¿”å› nullã€‚\nä¸ºäº†è¡¨ç¤ºç»™å®šé“¾è¡¨ä¸­çš„ç¯ï¼Œæˆ‘ä»¬ä½¿ç”¨æ•´æ•° pos æ¥è¡¨ç¤ºé“¾è¡¨å°¾è¿æ¥åˆ°é“¾è¡¨ä¸­çš„ä½ç½®ï¼ˆç´¢å¼•ä» 0 å¼€å§‹ï¼‰ã€‚å¦‚æœ pos æ˜¯ -1ï¼Œåˆ™åœ¨è¯¥é“¾è¡¨ä¸­æ²¡æœ‰ç¯ã€‚æ³¨æ„ï¼Œpos ä»…ä»…æ˜¯ç”¨äºæ ‡è¯†ç¯çš„æƒ…å†µï¼Œå¹¶ä¸ä¼šä½œä¸ºå‚æ•°ä¼ é€’åˆ°å‡½æ•°ä¸­ã€‚\nç¤ºä¾‹ï¼š\nè¾“å…¥ï¼šhead = [3,2,0,-4], pos = 1è¾“å‡ºï¼šè¿”å›ç´¢å¼•ä¸º 1 çš„é“¾è¡¨èŠ‚ç‚¹è§£é‡Šï¼šé“¾è¡¨ä¸­æœ‰ä¸€ä¸ªç¯ï¼Œå…¶å°¾éƒ¨è¿æ¥åˆ°ç¬¬äºŒä¸ªèŠ‚ç‚¹ã€‚\n\n\nğŸ’¡ è§£é¢˜æ€è·¯æœ¬é¢˜æ˜¯ç»å…¸çš„â€œå¿«æ…¢æŒ‡é’ˆâ€é—®é¢˜ã€‚\n\nåˆ¤æ–­æ˜¯å¦æœ‰ç¯ï¼š\n\nä½¿ç”¨ä¸¤ä¸ªæŒ‡é’ˆï¼Œslow æ¯æ¬¡ç§»åŠ¨ä¸€æ­¥ï¼Œfast æ¯æ¬¡ç§»åŠ¨ä¸¤æ­¥ã€‚\nå¦‚æœ fast å’Œ slow ç›¸é‡ï¼Œè¯´æ˜é“¾è¡¨ä¸­å­˜åœ¨ç¯ã€‚\n\n\næ‰¾åˆ°å…¥ç¯ç‚¹ï¼š\n\nå½“ fast å’Œ slow ç›¸é‡æ—¶ï¼Œå°†å…¶ä¸­ä¸€ä¸ªæŒ‡é’ˆç§»åˆ°é“¾è¡¨å¤´éƒ¨ï¼Œå¦ä¸€ä¸ªæŒ‡é’ˆä¿æŒåœ¨ç›¸é‡ç‚¹ã€‚\nä¸¤ä¸ªæŒ‡é’ˆæ¯æ¬¡éƒ½ç§»åŠ¨ä¸€æ­¥ï¼Œæœ€ç»ˆç›¸é‡çš„èŠ‚ç‚¹å³ä¸ºå…¥ç¯ç‚¹ã€‚\n\n\n\n\nâœ… JavaScript å®ç°var detectCycle = function(head) &#123;    let slow = head;    let fast = head;    while (fast &amp;&amp; fast.next) &#123;        slow = slow.next;        fast = fast.next.next;        if (slow === fast) &#123;            let ptr = head;            while (ptr !== slow) &#123;                ptr = ptr.next;                slow = slow.next;            &#125;            return ptr;        &#125;    &#125;    return null;&#125;;\n\n\nğŸŸ£ Swift å®ç°class Solution &#123;    func detectCycle(_ head: ListNode?) -&gt; ListNode? &#123;        var slow = head        var fast = head        while let nextFast = fast?.next?.next, let nextSlow = slow?.next &#123;            slow = nextSlow            fast = nextFast            if slow === fast &#123;                var ptr = head                while ptr !== slow &#123;                    ptr = ptr?.next                    slow = slow?.next                &#125;                return ptr            &#125;        &#125;        return nil    &#125;&#125;\n\n\nğŸ§  æ€è€ƒæ‹“å±•\nå¦‚æœé“¾è¡¨ä¸­å­˜åœ¨å¤šä¸ªç¯ï¼Œç®—æ³•æ˜¯å¦ä»ç„¶é€‚ç”¨ï¼Ÿ\nå¦‚ä½•åœ¨ä¸ä¿®æ”¹é“¾è¡¨ç»“æ„çš„æƒ…å†µä¸‹æ£€æµ‹ç¯ï¼Ÿ\nèƒ½å¦åœ¨ O(1) ç©ºé—´å¤æ‚åº¦ä¸‹è§£å†³æ­¤é—®é¢˜ï¼Ÿ\n\n","categories":["ç®—æ³•"]},{"title":"Day15-NSURLSession æ–­ç‚¹ç»­ä¼  + ç½‘ç»œå°è£…","url":"/2025/05/15/Day15-NSURLSession-%E6%96%AD%E7%82%B9%E7%BB%AD%E4%BC%A0-%E7%BD%91%E7%BB%9C%E5%B0%81%E8%A3%85/","content":"ä¸€ã€NSURLSession ä¸‹è½½æœºåˆ¶åŸç†ç±»å‹å›é¡¾ï¼š\nNSURLSessionDataTask: ç”¨äºè¯·æ±‚å’Œå“åº”å°æ•°æ®ã€‚\nNSURLSessionDownloadTask: ç”¨äºä¸‹è½½å¤§æ–‡ä»¶ï¼Œæ”¯æŒæ–­ç‚¹ç»­ä¼ ã€‚\nNSURLSessionUploadTask: ç”¨äºä¸Šä¼ æ•°æ®ã€‚\n\nå¯¹äºæ–­ç‚¹ç»­ä¼ ï¼ŒNSURLSessionDownloadTask æ˜¯å”¯ä¸€æ”¯æŒæ­¤åŠŸèƒ½çš„ç±»å‹ã€‚\n\näºŒã€æ–­ç‚¹ç»­ä¼ æœºåˆ¶è¯¦è§£1. å¦‚ä½•ä¸­æ–­ä»»åŠ¡ç”Ÿæˆ Resume Data[downloadTask cancelByProducingResumeData:^(NSData * _Nullable resumeData) &#123;    // å°† resumeData å†™å…¥æœ¬åœ°    [resumeData writeToFile:@&quot;xxx.resume&quot; atomically:YES];&#125;];\n\nResume Data ç”Ÿæˆæ¡ä»¶ï¼š\n\nä»»åŠ¡å¿…é¡»æ˜¯ downloadTaskã€‚\nå¿…é¡»ä½¿ç”¨ cancelByProducingResumeDataã€‚\nSession é…ç½®å¿…é¡»æ˜¯ defaultSessionConfigurationï¼Œä¸æ˜¯ backgroundã€‚\nç½‘ç»œä¸­æ–­å¯¼è‡´å–æ¶ˆå¹¶ä¸ä¼šè‡ªåŠ¨ç”Ÿæˆ resumeDataã€‚\n\n2. Resume Data æœ¬è´¨æ˜¯ä»€ä¹ˆï¼Ÿ\nresumeData å®é™…æ˜¯ä¸€ä¸ªå¸¦æœ‰ HTTP Range è¯·æ±‚å¤´çš„äºŒè¿›åˆ¶ plist æ•°æ®ï¼Œå†…å®¹åŒ…å«ï¼š\nè¯·æ±‚ URL\nä¸Šæ¬¡ä¸‹è½½çš„ Range\nå·²ä¸‹è½½çš„æ–‡ä»¶è·¯å¾„\nè¯·æ±‚ Header\nä¸´æ—¶æ–‡ä»¶ä¿¡æ¯ç­‰\n\n\n\nä½ å¯ä»¥ç”¨å¦‚ä¸‹ä»£ç è§£æ resumeDataï¼ˆè°ƒè¯•ç”¨ï¼‰ï¼š\nNSError *error = nil;NSDictionary *resumeDict = [NSPropertyListSerialization propertyListWithData:resumeData options:0 format:nil error:&amp;error];NSLog(@&quot;Resume Info: %@&quot;, resumeDict);\n\n\nä¸‰ã€Resume Data çš„é—®é¢˜ä¸å…¼å®¹æ€§iOS 10-13 å¸¸è§é—®é¢˜ï¼š\niOS 10-11 resumeData ä¼šâ€œæŸåâ€ï¼ŒApple Bugã€‚\niOS 13 å Resume Data æ›´åŠ ä¸¥æ ¼ï¼šURLã€Header ä¸€ç‚¹ç‚¹æ”¹åŠ¨å°±ä¸èƒ½ç”¨ã€‚\nresumeData ä¸èƒ½è·¨æœºå™¨æˆ–è·¨è¿›ç¨‹æ¢å¤ã€‚\n\næ ¡éªŒ Resume Data å¯ç”¨æ€§ï¼ˆæ¨èå°è£…æ–¹æ³•ä¸­åŠ åˆ¤æ–­ï¼‰ï¼š- (BOOL)isValidResumeData:(NSData *)data &#123;    if (data.length == 0) return NO;    NSDictionary *dict = [NSPropertyListSerialization propertyListWithData:data options:0 format:nil error:nil];    return dict[@&quot;NSURLSessionResumeInfoTempFileName&quot;] != nil;&#125;\n\n\nå››ã€ç½‘ç»œå°è£…æ¶æ„è®¾è®¡ï¼ˆDownloadManagerï¼‰1. è®¾è®¡ç›®æ ‡\næ”¯æŒå¤šä»»åŠ¡åŒæ—¶ä¸‹è½½\næ”¯æŒä»»åŠ¡æš‚åœã€æ¢å¤ã€å–æ¶ˆ\nä¸‹è½½è¿›åº¦å¯è§‚å¯Ÿ\nç¨³å®šä¿å­˜ resumeData\næ”¯æŒåå°ä¸‹è½½å¯é€‰ï¼ˆéæ–­ç‚¹ç»­ä¼ ï¼‰\n\n2. æ•°æ®ç»“æ„è®¾è®¡@property (nonatomic, strong) NSMutableDictionary&lt;NSString *, NSURLSessionDownloadTask *&gt; *downloadTasks;@property (nonatomic, strong) NSMutableDictionary&lt;NSString *, NSData *&gt; *resumeDataDict;@property (nonatomic, strong) NSMutableDictionary&lt;NSString *, NSNumber *&gt; *progressDict;@property (nonatomic, strong) NSURLSession *session;\n\n3. æ–¹æ³•å®šä¹‰- (void)startDownloadWithURL:(NSURL *)url identifier:(NSString *)identifier;- (void)pauseDownloadWithIdentifier:(NSString *)identifier;- (void)resumeDownloadWithIdentifier:(NSString *)identifier;- (void)cancelDownloadWithIdentifier:(NSString *)identifier;\n\n4. DownloadManager.m å®ç°è¦ç‚¹åˆ›å»ºä¸‹è½½ä»»åŠ¡- (void)startDownloadWithURL:(NSURL *)url identifier:(NSString *)identifier &#123;    if (self.downloadTasks[identifier]) return;    NSURLSessionDownloadTask *task = [self.session downloadTaskWithURL:url];    self.downloadTasks[identifier] = task;    [task resume];&#125;\n\næš‚åœä»»åŠ¡- (void)pauseDownloadWithIdentifier:(NSString *)identifier &#123;    NSURLSessionDownloadTask *task = self.downloadTasks[identifier];    [task cancelByProducingResumeData:^(NSData * _Nullable resumeData) &#123;        if (resumeData) &#123;            self.resumeDataDict[identifier] = resumeData;            [resumeData writeToFile:[self resumeDataPathForIdentifier:identifier] atomically:YES];        &#125;        [self.downloadTasks removeObjectForKey:identifier];    &#125;];&#125;\n\næ¢å¤ä»»åŠ¡- (void)resumeDownloadWithIdentifier:(NSString *)identifier &#123;    NSData *resumeData = self.resumeDataDict[identifier];    if (!resumeData) &#123;        resumeData = [NSData dataWithContentsOfFile:[self resumeDataPathForIdentifier:identifier]];    &#125;    NSURLSessionDownloadTask *task = nil;    if ([self isValidResumeData:resumeData]) &#123;        task = [self.session downloadTaskWithResumeData:resumeData];    &#125; else &#123;        // fallbackï¼šé‡æ–°ä¸‹è½½        NSURL *url = [self downloadURLForIdentifier:identifier];        task = [self.session downloadTaskWithURL:url];    &#125;    self.downloadTasks[identifier] = task;    [task resume];&#125;\n\nä»£ç†æ–¹æ³•å¤„ç†ä¸‹è½½å®Œæˆ&#x2F;è¿›åº¦- (void)URLSession:(NSURLSession *)session downloadTask:(NSURLSessionDownloadTask *)downloadTask              didWriteData:(int64_t)bytesWritten         totalBytesWritten:(int64_t)totalBytesWritten totalBytesExpectedToWrite:(int64_t)totalBytesExpectedToWrite &#123;    NSString *identifier = [self identifierForTask:downloadTask];    CGFloat progress = (CGFloat)totalBytesWritten / totalBytesExpectedToWrite;    self.progressDict[identifier] = @(progress);        // å›è°ƒé€šçŸ¥ UI&#125;\n\n- (void)URLSession:(NSURLSession *)session downloadTask:(NSURLSessionDownloadTask *)downloadTaskdidFinishDownloadingToURL:(NSURL *)location &#123;    NSString *identifier = [self identifierForTask:downloadTask];    NSURL *destinationURL = [self finalFilePathForIdentifier:identifier];    [[NSFileManager defaultManager] moveItemAtURL:location toURL:destinationURL error:nil];    [self.downloadTasks removeObjectForKey:identifier];    [self.resumeDataDict removeObjectForKey:identifier];&#125;\n\n\näº”ã€åå°ä¸‹è½½ä¸æ–­ç‚¹ç»­ä¼ çš„å†²çªåå°ä¸‹è½½ä½¿ç”¨ï¼š\nNSURLSessionConfiguration *config = [NSURLSessionConfiguration backgroundSessionConfigurationWithIdentifier:@&quot;bg.download&quot;];\n\né™åˆ¶ï¼š\n\nä¸æ”¯æŒ cancelByProducingResumeDataï¼Œå–æ¶ˆä»»åŠ¡ä¸ä¼šç”Ÿæˆ resumeDataã€‚\næš‚åœä»»åŠ¡åªèƒ½å–æ¶ˆï¼Œä¸èƒ½ resumeã€‚\né€‚åˆéæ–­ç‚¹ç»­ä¼ çš„è¢«åŠ¨æ–‡ä»¶ä¸‹è½½ï¼Œæ¯”å¦‚ OS æ›´æ–°ã€é‚®ä»¶é™„ä»¶ç­‰ã€‚\n\n\nå…­ã€è¿›é˜¶ä¼˜åŒ–å»ºè®®1. æ–‡ä»¶åˆ†ç‰‡å¤šçº¿ç¨‹ä¸‹è½½ï¼ˆé€‚åˆå¤§æ–‡ä»¶ï¼Œå¦‚è§†é¢‘ï¼‰\nå…ˆè·å–æ–‡ä»¶å¤§å°ï¼ˆHEAD è¯·æ±‚ï¼‰\nåˆ†æˆå¤šä¸ª Range ä»»åŠ¡å¹¶å‘ä¸‹è½½\nè‡ªè¡Œåˆå¹¶ç‰‡æ®µ\n\n2. æ·»åŠ  SHA&#x2F;MD5 æ ¡éªŒ\né˜²æ­¢ resume åçš„æ•°æ®ä¸ä¸€è‡´\nä¸‹è½½å®Œæˆæ ¡éªŒæ•°æ®ä¸€è‡´æ€§\n\n3. ä½¿ç”¨æ•°æ®åº“è®°å½•ä¸‹è½½ä»»åŠ¡çŠ¶æ€ï¼ˆå¯é€‰ï¼šSQLite&#x2F;FMDBï¼‰\nidentifierã€çŠ¶æ€ã€è¿›åº¦ã€è·¯å¾„\næ¢å¤ App åèƒ½è‡ªåŠ¨æ¢å¤ä»»åŠ¡\n\n\nä¸ƒã€å·¥å…·&#x2F;ç±»åº“æ¨è\nAFURLSessionManagerï¼šAFNetworking å†…å° NSURLSessionDownloadTask å°è£…\nAlamofireï¼šSwift ä¸­çš„å°è£…ï¼Œä½¿ç”¨ DownloadRequest æ”¯æŒæ–­ç‚¹\nZLDownloadManagerï¼šé«˜çº§æ–­ç‚¹ç»­ä¼ ç®¡ç†å™¨ï¼ˆOCï¼‰\n\n","categories":["åŸºç¡€"]},{"title":"Day16-AFNetworkingåº•å±‚åŸç†","url":"/2025/05/16/Day16-AFNetworking%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/","content":"AFNetworking æ˜¯åŸºäº Apple æä¾›çš„ NSURLSession å’Œ NSURLConnection å°è£…çš„ç½‘ç»œåº“ï¼ˆAFNetworking 3.0 ä»¥åå®Œå…¨åŸºäº NSURLSessionï¼‰ï¼Œå®ƒå¯¹ç½‘ç»œè¯·æ±‚ã€JSON&#x2F;XML è§£æã€æ–‡ä»¶ä¸Šä¼ ä¸‹è½½ã€ç½‘ç»œç›‘æµ‹ç­‰åŠŸèƒ½åšäº†å°è£…ï¼Œä½¿ iOS å¼€å‘è€…èƒ½å¤Ÿæ›´æ–¹ä¾¿åœ°å¤„ç†ç½‘ç»œé€šä¿¡ã€‚\nä¸€ã€AFNetworking æ¶æ„æ€»è§ˆAFNetworking æ ¸å¿ƒç»„ä»¶åŒ…æ‹¬ï¼š\n\nAFURLSessionManagerï¼šå¯¹ NSURLSession çš„å°è£…ï¼Œå¤„ç†è¯·æ±‚ä»»åŠ¡å’Œå›è°ƒ\nAFHTTPSessionManagerï¼šå¯¹ AFURLSessionManager è¿›ä¸€æ­¥å°è£…ï¼Œä¸“æ³¨äº HTTP è¯·æ±‚\nAFNetworkReachabilityManagerï¼šç½‘ç»œçŠ¶æ€ç›‘æµ‹\nAFURLRequestSerializationï¼šè¯·æ±‚åºåˆ—åŒ–ï¼ˆå¦‚è®¾ç½®è¯·æ±‚å¤´ã€å‚æ•°ç¼–ç ï¼‰\nAFURLResponseSerializationï¼šå“åº”ååºåˆ—åŒ–ï¼ˆå¦‚ JSON&#x2F;XML çš„è§£æï¼‰\n\näºŒã€AFURLSessionManagerï¼ˆæ ¸å¿ƒç±»ï¼‰1. NSURLSession çš„å°è£…AFNetworking çš„è¯·æ±‚æ˜¯åŸºäº NSURLSession å®ç°çš„ï¼Œå†…éƒ¨é€šè¿‡ä»¥ä¸‹æ–¹å¼å¤„ç†ï¼š\n\nåˆ›å»º NSURLSession å¯¹è±¡ï¼Œå¹¶è®¾ç½® delegateQueue\nå®ç°äº† NSURLSessionDataDelegateã€NSURLSessionTaskDelegate ç­‰ä»£ç†æ–¹æ³•\nå°†ä»£ç†æ–¹æ³•ä¸­çš„å›è°ƒç»Ÿä¸€åˆ° block ä¸­ï¼Œä¾¿äºä½¿ç”¨è€…è°ƒç”¨\n\n2. ä»»åŠ¡å›è°ƒå¤„ç†æœºåˆ¶AFNetworking é€šè¿‡ç»´æŠ¤ä¸€ä¸ª NSMutableDictionary&lt;NSNumber *, AFURLSessionManagerTaskDelegate *&gt; æ¥ç®¡ç†æ¯ä¸€ä¸ª NSURLSessionTask çš„ delegateï¼Œä¿è¯æ¯ä¸ªä»»åŠ¡çš„å›è°ƒè¢«æ­£ç¡®åˆ†å‘ã€‚\n@property (readwrite, nonatomic, strong) NSMutableDictionary *mutableTaskDelegatesKeyedByTaskIdentifier;\n\nå½“ä¸€ä¸ªä»»åŠ¡å¼€å§‹æ—¶ï¼ŒAF ä¼šï¼š\n\nåˆ›å»ºå¯¹åº”çš„ delegateï¼ˆAFURLSessionManagerTaskDelegateï¼‰\nä¿å­˜åˆ°ä¸Šé¢çš„å­—å…¸ä¸­\nå½“ä»£ç†æ–¹æ³•å›è°ƒæ—¶ï¼Œé€šè¿‡ taskIdentifier æŸ¥æ‰¾å¯¹åº” delegate å¤„ç†\n\nä¸‰ã€AFHTTPSessionManagerï¼ˆHTTP è¯·æ±‚å°è£…ï¼‰ç»§æ‰¿è‡ª AFURLSessionManagerï¼Œå¹¶è¿›ä¸€æ­¥å°è£…äº† HTTP è¯·æ±‚æ–¹æ³•ï¼š\n\næä¾›äº†å¸¸è§çš„ GETã€POSTã€PUTã€DELETE ç­‰æ–¹æ³•\nè‡ªåŠ¨å°†è¯·æ±‚å‚æ•°åºåˆ—åŒ–ï¼ˆä½¿ç”¨ AFHTTPRequestSerializerï¼‰\nè‡ªåŠ¨è§£æå“åº”æ•°æ®ï¼ˆä½¿ç”¨ AFJSONResponseSerializerã€AFXMLParserResponseSerializer ç­‰ï¼‰\n\nç¤ºä¾‹ï¼š\n[self.manager GET:@&quot;url&quot; parameters:nil headers:nil progress:nil success:^(NSURLSessionDataTask *task, id responseObject) &#123;    // å¤„ç†æˆåŠŸ&#125; failure:^(NSURLSessionDataTask *task, NSError *error) &#123;    // å¤„ç†å¤±è´¥&#125;];\n\nå››ã€è¯·æ±‚åºåˆ—åŒ–å™¨ï¼ˆAFURLRequestSerializationï¼‰ä¸»è¦è´Ÿè´£ï¼š\n\nè®¾ç½®è¯·æ±‚å¤´ï¼ˆå¦‚ Content-Typeã€Authorization ç­‰ï¼‰\nå‚æ•°ç¼–ç ï¼ˆquery string ç¼–ç ã€JSON ç¼–ç ç­‰ï¼‰\næ„å»º multipart&#x2F;form-data è¯·æ±‚ä½“ï¼ˆæ–‡ä»¶ä¸Šä¼ ï¼‰\n\nå…¶æ ¸å¿ƒç±»æœ‰ï¼š\n\nAFHTTPRequestSerializer\nAFJSONRequestSerializer\nAFPropertyListRequestSerializer\n\näº”ã€å“åº”åºåˆ—åŒ–å™¨ï¼ˆAFURLResponseSerializationï¼‰ä¸»è¦è´Ÿè´£å°†è¿”å›çš„åŸå§‹ NSData è½¬æ¢ä¸ºå¯ç”¨çš„å¯¹è±¡ï¼Œæ¯”å¦‚ï¼š\n\nJSON â†’ NSDictionary &#x2F; NSArray\nXML â†’ NSXMLParser\nImage â†’ UIImage\n\nå…¶æ ¸å¿ƒç±»æœ‰ï¼š\n\nAFJSONResponseSerializer\nAFXMLParserResponseSerializer\nAFImageResponseSerializer\n\né€šè¿‡è®¾ç½® AFURLSessionManager.responseSerializer æ¥å†³å®šå¦‚ä½•è§£æå“åº”æ•°æ®ã€‚\nå…­ã€ç½‘ç»œçŠ¶æ€ç›‘æ§ï¼ˆAFNetworkReachabilityManagerï¼‰åº•å±‚åŸºäº SystemConfiguration.framework ä¸­çš„ SCNetworkReachability å®ç°ï¼š\n\nå¯ä»¥ç›‘æ§ WiFiã€èœ‚çªç½‘ç»œçš„å˜åŒ–\né€šè¿‡ block å›è°ƒå½¢å¼å‘ŠçŸ¥å¤–éƒ¨çŠ¶æ€å˜åŒ–\n\n[[AFNetworkReachabilityManager sharedManager] setReachabilityStatusChangeBlock:^(AFNetworkReachabilityStatus status) &#123;    // ç½‘ç»œçŠ¶æ€å‘ç”Ÿå˜åŒ–&#125;];\n\nä¸ƒã€çº¿ç¨‹å®‰å…¨è®¾è®¡AFNetworking ä½¿ç”¨ dispatch_queue_t å’Œ NSLock ä¿è¯çº¿ç¨‹å®‰å…¨ï¼š\n\nå¯¹å­—å…¸ mutableTaskDelegatesKeyedByTaskIdentifier çš„è®¿é—®é€šè¿‡é”ä¿æŠ¤\nä½¿ç”¨ completionQueue &#x2F; completionGroup æ§åˆ¶å›è°ƒåœ¨å“ªä¸ªçº¿ç¨‹æ‰§è¡Œ\n\nå…«ã€AFNetworking ä¸æ–­ç‚¹ç»­ä¼ AFNetworking æœ¬èº«ä¸ç›´æ¥å°è£…æ–­ç‚¹ç»­ä¼ é€»è¾‘ï¼Œä½†å®ƒæ”¯æŒé€šè¿‡ NSURLSessionDownloadTask å®ç°æ–­ç‚¹ç»­ä¼ ï¼š\n\nåˆ©ç”¨ resumeData ä¿å­˜ä¸­æ–­çš„æ•°æ®\né€šè¿‡ downloadTaskWithResumeData: æ¢å¤ä¸‹è½½ä»»åŠ¡\n\nä½ å¯ä»¥è‡ªå·±å°è£…é€»è¾‘ï¼Œæ¯”å¦‚ç›‘å¬ä¸‹è½½å¤±è´¥æ—¶ resumeDataï¼Œä¿å­˜åç»­å†æ¢å¤ã€‚\næ€»ç»“\n\n\næ¨¡å—\nè¯´æ˜\n\n\n\nAFURLSessionManager\nå¯¹ NSURLSession çš„å°è£…ï¼Œç»Ÿä¸€ä»»åŠ¡ç®¡ç†å’Œå›è°ƒ\n\n\nAFHTTPSessionManager\næä¾› HTTP è¯·æ±‚æ–¹æ³•çš„å°è£…\n\n\nè¯·æ±‚åºåˆ—åŒ–\nè®¾ç½®è¯·æ±‚å¤´ã€å‚æ•°ç¼–ç ç­‰ï¼ˆAFHTTPRequestSerializerï¼‰\n\n\nå“åº”åºåˆ—åŒ–\nå°† NSData è½¬ä¸ºå¯¹è±¡ï¼ˆå¦‚ JSON&#x2F;XMLï¼‰\n\n\nç½‘ç»œç›‘æ§\nåŸºäº SCNetworkReachability ç›‘æµ‹ç½‘ç»œçŠ¶æ€\n\n\nå¹¶å‘å¤„ç†\nä½¿ç”¨é”ã€é˜Ÿåˆ—ä¿è¯çº¿ç¨‹å®‰å…¨\n\n\n","categories":["åŸºç¡€"]},{"title":"Day16-æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²","url":"/2025/05/16/Day16-%E6%97%A0%E9%87%8D%E5%A4%8D%E5%AD%97%E7%AC%A6%E7%9A%84%E6%9C%80%E9%95%BF%E5%AD%90%E4%B8%B2/","content":"ğŸ”— LeetCode 3 - Longest Substring Without Repeating Characters\nğŸ“Œ é¢˜ç›®æè¿°ç»™å®šä¸€ä¸ªå­—ç¬¦ä¸² sï¼Œè¯·ä½ æ‰¾å‡ºå…¶ä¸­ä¸å«æœ‰é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²çš„é•¿åº¦ã€‚\nç¤ºä¾‹ï¼š\nè¾“å…¥: s = &quot;abcabcbb&quot;è¾“å‡º: 3è§£é‡Š: å› ä¸ºæ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²æ˜¯ &quot;abc&quot;ï¼Œæ‰€ä»¥å…¶é•¿åº¦ä¸º 3ã€‚\n\n\nğŸ’¡ è§£é¢˜æ€è·¯ä½¿ç”¨ æ»‘åŠ¨çª—å£ æ–¹æ³•ï¼š\n\nä½¿ç”¨ä¸€ä¸ª Set è®°å½•å½“å‰çª—å£å†…çš„å­—ç¬¦ï¼›\nå®šä¹‰ä¸¤ä¸ªæŒ‡é’ˆ left å’Œ rightï¼Œåˆå§‹éƒ½ä¸º 0ï¼›\nå¦‚æœ s[right] ä¸åœ¨ Set ä¸­ï¼ŒåŠ å…¥ set å¹¶æ›´æ–°æœ€å¤§é•¿åº¦ï¼›\nå¦‚æœå­˜åœ¨é‡å¤å­—ç¬¦ï¼Œç§»åŠ¨ left æŒ‡é’ˆå¹¶ä» Set ä¸­ç§»é™¤å­—ç¬¦ï¼Œç›´åˆ°ä¸å†é‡å¤ï¼›\né‡å¤æ­¤è¿‡ç¨‹ç›´åˆ°éå†å®Œæ•´ä¸ªå­—ç¬¦ä¸²ã€‚\n\næ—¶é—´å¤æ‚åº¦ï¼šO(n)ç©ºé—´å¤æ‚åº¦ï¼šO(n)\n\nâœ… JavaScript å®ç°var lengthOfLongestSubstring = function(s) &#123;    let set = new Set();    let left = 0, maxLen = 0;    for (let right = 0; right &lt; s.length; right++) &#123;        while (set.has(s[right])) &#123;            set.delete(s[left]);            left++;        &#125;        set.add(s[right]);        maxLen = Math.max(maxLen, right - left + 1);    &#125;    return maxLen;&#125;;\n\n\nâœ… Swift å®ç°func lengthOfLongestSubstring(_ s: String) -&gt; Int &#123;    var set = Set&lt;Character&gt;()    var left = s.startIndex    var maxLength = 0    var right = left    while right &lt; s.endIndex &#123;        if !set.contains(s[right]) &#123;            set.insert(s[right])            maxLength = max(maxLength, s.distance(from: left, to: right) + 1)            right = s.index(after: right)        &#125; else &#123;            set.remove(s[left])            left = s.index(after: left)        &#125;    &#125;    return maxLength&#125;\n\n\nğŸ§  æ€è€ƒæ‹“å±•\nå¦‚ä½•åœ¨å‡ºç°ä¸­æ–‡å­—ç¬¦ï¼ˆUnicode å¤šå­—èŠ‚ï¼‰æ—¶ä¿æŒç®—æ³•æœ‰æ•ˆï¼Ÿ\nå¦‚æœè¦æ±‚è¾“å‡ºæœ€é•¿å­ä¸²æœ¬èº«ï¼Œè€Œä¸æ˜¯é•¿åº¦ï¼Œåº”è¯¥å¦‚ä½•ä¿®æ”¹ä»£ç ï¼Ÿ\nå¦‚æœå¯¹æ€§èƒ½æœ‰æè‡´è¦æ±‚ï¼Œæœ‰å“ªäº›æ–¹å¼èƒ½å‡å°‘ç©ºé—´å ç”¨ï¼Ÿ\n\n","categories":["ç®—æ³•"]},{"title":"Day17-æœ€å¤§å­æ•°ç»„å’Œ","url":"/2025/05/17/Day17-%E6%9C%80%E5%A4%A7%E5%AD%90%E6%95%B0%E7%BB%84%E5%92%8C/","content":"ğŸ”— LeetCode 53 - Maximum Subarray\nğŸ“Œ é¢˜ç›®æè¿°ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ numsï¼Œè¯·ä½ æ‰¾å‡ºä¸€ä¸ªå…·æœ‰æœ€å¤§å’Œçš„ è¿ç»­å­æ•°ç»„ï¼Œå¹¶è¿”å›å…¶æœ€å¤§å’Œã€‚\n\nğŸ” ç¤ºä¾‹è¾“å…¥ï¼šnums = [-2,1,-3,4,-1,2,1,-5,4]è¾“å‡ºï¼š6è§£é‡Šï¼šè¿ç»­å­æ•°ç»„ [4,-1,2,1] çš„å’Œæœ€å¤§ï¼Œä¸º 6ã€‚\n\n\nğŸ’¡ è§£é¢˜æ€è·¯ï¼šåŠ¨æ€è§„åˆ’ï¼ˆKadaneâ€™s Algorithmï¼‰\ndp[i] è¡¨ç¤ºä»¥ nums[i] ç»“å°¾çš„æœ€å¤§å­æ•°ç»„å’Œ\nè½¬ç§»å…¬å¼ï¼šdp[i] = max(nums[i], dp[i-1] + nums[i])\nå¯ä¼˜åŒ–ä¸º O(1) ç©ºé—´ï¼Œä»…ç”¨ä¸¤ä¸ªå˜é‡\n\n\nâœ… JavaScript å®ç°var maxSubArray = function(nums) &#123;    let maxSum = nums[0];    let currSum = nums[0];    for (let i = 1; i &lt; nums.length; i++) &#123;        currSum = Math.max(nums[i], currSum + nums[i]);        maxSum = Math.max(maxSum, currSum);    &#125;    return maxSum;&#125;;\n\n\n\nâœ… Swift å®ç°func maxSubArray(_ nums: [Int]) -&gt; Int &#123;    var currSum = nums[0]    var maxSum = nums[0]    for i in 1..&lt;nums.count &#123;        currSum = max(nums[i], currSum + nums[i])        maxSum = max(maxSum, currSum)    &#125;    return maxSum&#125;\n\n\n\nğŸ§  æ€è€ƒæ‹“å±•\nå¦‚ä½•è¿”å›æœ€å¤§å­æ•°ç»„çš„ä¸‹æ ‡èŒƒå›´ï¼Ÿ\nå¦‚æœæ•°ç»„æ˜¯ç¯å½¢ï¼ˆå¤´å°¾å¯ä»¥ç›¸è¿ï¼‰ï¼Œå¦‚ä½•æ±‚æœ€å¤§å’Œï¼Ÿ\nåˆ†æ²»æ³•å¦‚ä½•å®ç°ï¼Ÿï¼ˆO(nlogn)ï¼‰\n\n","categories":["ç®—æ³•"]},{"title":"Day17-ç¼“å­˜ç­–ç•¥ + URLProtocol æ‹¦æˆª","url":"/2025/05/17/Day17-%E7%BC%93%E5%AD%98%E7%AD%96%E7%95%A5-URLProtocol-%E6%8B%A6%E6%88%AA/","content":"ä¸€ã€iOS ç¼“å­˜ç­–ç•¥ï¼ˆNSURLRequest.CachePolicyï¼‰ç¼“å­˜ç­–ç•¥å†³å®šäº† è¯·æ±‚æ˜¯å¦ä½¿ç”¨ç¼“å­˜ï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨ç¼“å­˜ã€‚å®ƒåœ¨ NSURLRequest åˆå§‹åŒ–æ—¶è®¾ç½®ï¼Œå¯¹ NSURLSession å’Œ NSURLConnection éƒ½ç”Ÿæ•ˆã€‚\nå¸¸è§ç­–ç•¥è¯´æ˜ï¼š\n\n\nç­–ç•¥\næè¿°\n\n\n\n.useProtocolCachePolicy\né»˜è®¤ç­–ç•¥ï¼Œéµå¾ª HTTP åè®®å¤´ï¼ˆå¦‚ Cache-Controlã€Expiresï¼‰å†³å®šæ˜¯å¦ä½¿ç”¨ç¼“å­˜ã€‚\n\n\n.reloadIgnoringLocalCacheData\nå¿½ç•¥æœ¬åœ°ç¼“å­˜ï¼Œæ€»æ˜¯ä»æœåŠ¡å™¨åŠ è½½æ•°æ®ã€‚\n\n\n.returnCacheDataElseLoad\nå¦‚æœæœ‰ç¼“å­˜ä½¿ç”¨ç¼“å­˜ï¼›å¦åˆ™ä»ç½‘ç»œåŠ è½½ã€‚\n\n\n.returnCacheDataDontLoad\nåªä½¿ç”¨ç¼“å­˜ï¼Œæ²¡æœ‰ç¼“å­˜åˆ™è¯·æ±‚å¤±è´¥ï¼ˆç”¨äºç¦»çº¿æ¨¡å¼ï¼‰ã€‚\n\n\n.reloadRevalidatingCacheData\næœ¬åœ°æœ‰ç¼“å­˜ä¼šå°è¯•è·ŸæœåŠ¡å™¨ç¡®è®¤å…¶æœ‰æ•ˆæ€§ï¼ˆç”¨ ETagã€Last-Modified ç­‰å¤´ï¼‰ã€‚\n\n\n\näºŒã€URLProtocol æ‹¦æˆªæœºåˆ¶ï¼ˆURLProtocol å­ç±»ï¼‰URLProtocol æ˜¯ NSURL åŠ è½½ç³»ç»Ÿçš„ä½å±‚é’©å­ï¼Œå…è®¸ä½ æ‹¦æˆªå¹¶å¤„ç†ç³»ç»Ÿæ‰€æœ‰é€šè¿‡ NSURL ç³»åˆ—å‘å‡ºçš„è¯·æ±‚ï¼ˆåŒ…æ‹¬ NSURLSessionï¼Œå¦‚æœé…ç½®æ­£ç¡®ï¼‰ã€‚\nä¸»è¦ç”¨é€”ï¼š\nè¯·æ±‚&#x2F;å“åº”æ•°æ® mockï¼ˆå¦‚å•å…ƒæµ‹è¯•ï¼‰\næ—¥å¿—åŸ‹ç‚¹ã€ç›‘æ§ç½‘ç»œè¯·æ±‚\nè‡ªå®šä¹‰ç¼“å­˜ç­–ç•¥ï¼ˆå¦‚å†™å…¥&#x2F;è¯»å–ç£ç›˜ç¼“å­˜ï¼‰\næ‹¦æˆªè¯·æ±‚æ·»åŠ ç»Ÿä¸€ Headerã€Token\n\nåŸºæœ¬ä½¿ç”¨æ­¥éª¤ï¼š\nè‡ªå®šä¹‰ç±»ç»§æ‰¿ URLProtocol\nå®ç°å¿…è¦æ–¹æ³•ï¼š\n\n+ (BOOL)canInitWithRequest:(NSURLRequest *)request;+ (NSURLRequest *)canonicalRequestForRequest:(NSURLRequest *)request;- (void)startLoading;- (void)stopLoading;\n\n\næ³¨å†Œåè®®ç±»ï¼š\n\n[NSURLProtocol registerClass:[MyCustomProtocol class]];\n\n\nNSURLSession ç‰¹åˆ«æ³¨æ„ï¼šä½¿ç”¨è‡ªå®šä¹‰é…ç½®æ³¨å†Œ URLProtocol\n\nNSURLSessionConfiguration *config = [NSURLSessionConfiguration defaultSessionConfiguration];config.protocolClasses = @[MyCustomProtocol.class];NSURLSession *session = [NSURLSession sessionWithConfiguration:config];\n\n\nä¸‰ã€URLProtocol ä¸ç¼“å­˜ç­–ç•¥ç»“åˆå®è·µ@implementation MyCustomProtocol+ (BOOL)canInitWithRequest:(NSURLRequest *)request &#123;    if ([NSURLProtocol propertyForKey:@&quot;HandledKey&quot; inRequest:request]) return NO;    return YES;&#125;+ (NSURLRequest *)canonicalRequestForRequest:(NSURLRequest *)request &#123;    return request;&#125;- (void)startLoading &#123;    NSURLRequest *request = self.request;    // ç¤ºä¾‹ï¼šä¼˜å…ˆæŸ¥æ‰¾æœ¬åœ°ç£ç›˜ç¼“å­˜    NSData *cachedData = [self readCacheForRequest:request];    if (cachedData) &#123;        NSURLResponse *response = [[NSURLResponse alloc] initWithURL:request.URL                                                            MIMEType:@&quot;application/json&quot;                                               expectedContentLength:cachedData.length                                                    textEncodingName:nil];        [self.client URLProtocol:self didReceiveResponse:response cacheStoragePolicy:NSURLCacheStorageNotAllowed];        [self.client URLProtocol:self didLoadData:cachedData];        [self.client URLProtocolDidFinishLoading:self];        return;    &#125;    // æ²¡æœ‰ç¼“å­˜ï¼Œç»§ç»­è¯·æ±‚ç½‘ç»œ    NSMutableURLRequest *newRequest = [request mutableCopy];    [NSURLProtocol setProperty:@YES forKey:@&quot;HandledKey&quot; inRequest:newRequest];    NSURLSessionConfiguration *config = [NSURLSessionConfiguration defaultSessionConfiguration];    NSURLSession *session = [NSURLSession sessionWithConfiguration:config];    NSURLSessionDataTask *task = [session dataTaskWithRequest:newRequest                                            completionHandler:^(NSData *data, NSURLResponse *response, NSError *error) &#123;        if (data) &#123;            [self saveCache:data forRequest:request];            [self.client URLProtocol:self didReceiveResponse:response cacheStoragePolicy:NSURLCacheStorageAllowed];            [self.client URLProtocol:self didLoadData:data];        &#125;        if (error) &#123;            [self.client URLProtocol:self didFailWithError:error];        &#125; else &#123;            [self.client URLProtocolDidFinishLoading:self];        &#125;    &#125;];    [task resume];&#125;- (void)stopLoading &#123;    // æ¸…ç†ä»»åŠ¡æˆ–æ“ä½œ&#125;@end\n\n\nå››ã€è¡¥å……å»ºè®®\nä½¿ç”¨ setProperty:forKey: é˜²æ­¢è¯·æ±‚é€’å½’å¤„ç†ã€‚\nå¯å®ç°â€œå…ˆç¼“å­˜å†åˆ·æ–°â€ç­–ç•¥ï¼šå…ˆè¿”å›ç¼“å­˜å†å¼‚æ­¥æ›´æ–°ã€‚\nå¯æ‰©å±•æ”¯æŒç£ç›˜ç¼“å­˜è·¯å¾„ã€ç¼“å­˜æœ‰æ•ˆæœŸç­‰åŠŸèƒ½ã€‚\n\n\n","categories":["åŸºç¡€"]},{"title":"Day18-ç»„åˆæ€»å’Œ","url":"/2025/05/18/Day18-%E7%BB%84%E5%90%88%E6%80%BB%E5%92%8C/","content":"ğŸ”— LeetCode 39 - Combination Sum\nğŸ“Œ é¢˜ç›®æè¿°ç»™ä½ ä¸€ä¸ª æ— é‡å¤å…ƒç´  çš„æ•´æ•°æ•°ç»„ candidates å’Œä¸€ä¸ªç›®æ ‡æ•´æ•° targetï¼Œæ‰¾å‡º candidates ä¸­å¯ä»¥ä½¿æ•°å­—å’Œä¸º target çš„æ‰€æœ‰ä¸åŒç»„åˆã€‚\nä½ å¯ä»¥æ— é™æ¬¡ä½¿ç”¨ candidates ä¸­çš„æ•°å­—ã€‚\n\nğŸ” ç¤ºä¾‹è¾“å…¥: candidates = [2,3,6,7], target = 7è¾“å‡º: [[2,2,3],[7]]è§£é‡Š: 2 å’Œ 3 å¯ä»¥é‡å¤ä½¿ç”¨ã€‚\n\n\nğŸ’¡ è§£é¢˜æ€è·¯é‡‡ç”¨ å›æº¯ç®—æ³•ï¼ˆBacktrackingï¼‰ï¼š\n\næ¯æ¬¡ä»å½“å‰ä½ç½®å¼€å§‹å°è¯•åŠ å…¥å…ƒç´ ï¼Œç»§ç»­é€’å½’\nè‹¥æ€»å’Œè¶…è¿‡ targetï¼Œå‰ªæè¿”å›\nè‹¥ç­‰äº targetï¼Œè®°å½•è·¯å¾„\n\n\nâœ… JavaScript å®ç°var combinationSum = function(candidates, target) &#123;    const res = [];    const dfs = (start, path, sum) =&gt; &#123;        if (sum === target) &#123;            res.push([...path]);            return;        &#125;        if (sum &gt; target) return;        for (let i = start; i &lt; candidates.length; i++) &#123;            path.push(candidates[i]);            dfs(i, path, sum + candidates[i]); // å¯ä»¥é‡å¤é€‰            path.pop();        &#125;    &#125;;    dfs(0, [], 0);    return res;&#125;;\n\n\nâœ… Swift å®ç°func combinationSum(_ candidates: [Int], _ target: Int) -&gt; [[Int]] &#123;    var res = [[Int]]()    func dfs(_ start: Int, _ path: [Int], _ sum: Int) &#123;        if sum == target &#123;            res.append(path)            return        &#125;        if sum &gt; target &#123;            return        &#125;        for i in start..&lt;candidates.count &#123;            dfs(i, path + [candidates[i]], sum + candidates[i])        &#125;    &#125;    dfs(0, [], 0)    return res&#125;\n\n\nğŸ§  æ€è€ƒæ‹“å±•\nå¦‚ä½•åŠ é€Ÿæœç´¢ï¼Ÿå°è¯•å°† candidates æ’åº + å‰ªæä¼˜åŒ–\nå¦‚æœæ¯ä¸ªæ•°æœ€å¤šåªèƒ½é€‰ä¸€æ¬¡ï¼Œåº”è¯¥å¦‚ä½•ä¿®æ”¹é€»è¾‘ï¼Ÿï¼ˆæç¤ºï¼šLeetCode 40ï¼‰\nå¦‚ä½•æ”¹ä¸ºåŠ¨æ€è§„åˆ’è§£æ³•ï¼Ÿ\n\n","categories":["ç®—æ³•"]},{"title":"Day19-å²›å±¿æ•°é‡","url":"/2025/05/19/Day19-%E5%B2%9B%E5%B1%BF%E6%95%B0%E9%87%8F/","content":"ğŸ”— LeetCode 200 - Number of Islands\nğŸ“Œ é¢˜ç›®æè¿°ç»™ä½ ä¸€ä¸ªç”± â€˜1â€™ï¼ˆé™†åœ°ï¼‰å’Œ â€˜0â€™ï¼ˆæ°´ï¼‰ç»„æˆçš„äºŒç»´ç½‘æ ¼ gridï¼Œè¯·ä½ è®¡ç®—ç½‘æ ¼ä¸­å²›å±¿çš„æ•°é‡ã€‚\nå²›å±¿æ€»æ˜¯è¢«æ°´åŒ…å›´ï¼Œå¹¶ä¸”æ¯åº§å²›å±¿åªèƒ½ç”±æ°´å¹³æ–¹å‘æˆ–å‚ç›´æ–¹å‘ç›¸é‚»çš„é™†åœ°è¿æ¥è€Œæˆã€‚\n\nğŸ” ç¤ºä¾‹è¾“å…¥: grid = [  [&quot;1&quot;,&quot;1&quot;,&quot;0&quot;,&quot;0&quot;,&quot;0&quot;],  [&quot;1&quot;,&quot;1&quot;,&quot;0&quot;,&quot;0&quot;,&quot;0&quot;],  [&quot;0&quot;,&quot;0&quot;,&quot;1&quot;,&quot;0&quot;,&quot;0&quot;],  [&quot;0&quot;,&quot;0&quot;,&quot;0&quot;,&quot;1&quot;,&quot;1&quot;]]è¾“å‡º: 3\n\n\n\nğŸ’¡ è§£é¢˜æ€è·¯ç»å…¸çš„ æ·±åº¦ä¼˜å…ˆæœç´¢ï¼ˆDFSï¼‰ é—®é¢˜ï¼š\n\nä»æ¯ä¸ªæœªè®¿é—®çš„ â€˜1â€™ å‡ºå‘è¿›è¡Œ DFSï¼Œå°†è¿é€šçš„æ‰€æœ‰ â€˜1â€™ æ ‡è®°ä¸º â€˜0â€™ï¼›\næ¯æ¬¡éå†å®Œæ•´ä¸ªå²›å±¿ï¼Œå²›å±¿æ•°é‡åŠ  1ï¼›\næˆ–å¯ä½¿ç”¨ BFSã€å¹¶æŸ¥é›†è¿›è¡Œæ‹“å±•è§£æ³•ã€‚\n\næ—¶é—´å¤æ‚åº¦ï¼šO(m Ã— n)ç©ºé—´å¤æ‚åº¦ï¼šO(m Ã— n)\n\nâœ… JavaScript å®ç°var numIslands = function(grid) &#123;    let count = 0;    const rows = grid.length, cols = grid[0].length;    const dfs = (i, j) =&gt; &#123;        if (i &lt; 0 || i &gt;= rows || j &lt; 0 || j &gt;= cols || grid[i][j] === &#x27;0&#x27;) return;        grid[i][j] = &#x27;0&#x27;;        dfs(i + 1, j);        dfs(i - 1, j);        dfs(i, j + 1);        dfs(i, j - 1);    &#125;;    for (let i = 0; i &lt; rows; i++) &#123;        for (let j = 0; j &lt; cols; j++) &#123;            if (grid[i][j] === &#x27;1&#x27;) &#123;                dfs(i, j);                count++;            &#125;        &#125;    &#125;    return count;&#125;;\n\n\nâœ… Swift å®ç°func numIslands(_ grid: [[Character]]) -&gt; Int &#123;    var grid = grid    let rows = grid.count    let cols = grid[0].count    var count = 0    func dfs(_ i: Int, _ j: Int) &#123;        if i &lt; 0 || i &gt;= rows || j &lt; 0 || j &gt;= cols || grid[i][j] == &quot;0&quot; &#123;            return        &#125;        grid[i][j] = &quot;0&quot;        dfs(i + 1, j)        dfs(i - 1, j)        dfs(i, j + 1)        dfs(i, j - 1)    &#125;    for i in 0..&lt;rows &#123;        for j in 0..&lt;cols &#123;            if grid[i][j] == &quot;1&quot; &#123;                dfs(i, j)                count += 1            &#125;        &#125;    &#125;    return count&#125;\n\nğŸ§  æ€è€ƒæ‹“å±•\nå¦‚ä½•ä½¿ç”¨ BFS å®ç°ï¼Ÿ\nå¦‚ä½•ä½¿ç”¨å¹¶æŸ¥é›†ï¼ˆUnion-Findï¼‰æ¥è§£å†³ï¼Ÿ\nå¦‚æœè¦æ±‚æ ‡å‡ºæ¯ä¸ªå²›å±¿çš„åæ ‡é›†ï¼Œè¯¥å¦‚ä½•ä¿®æ”¹ç®—æ³•ï¼Ÿ\n\n","categories":["ç®—æ³•"]},{"title":"Day2-View å¸ƒå±€æµç¨‹","url":"/2025/04/24/Day2-View-%E5%B8%83%E5%B1%80%E6%B5%81%E7%A8%8B/","content":"View å¸ƒå±€æµç¨‹è¯¦è§£ä¸€ã€å¸ƒå±€æµç¨‹æ€»è§ˆiOS çš„è§†å›¾å¸ƒå±€æµç¨‹ç”± UIKit ç®¡ç†ï¼Œæ ¸å¿ƒéµå¾ªã€Œä»çˆ¶åˆ°å­ã€ä»å¤–å‘å†…ã€çš„é€’å½’æ›´æ–°æ–¹å¼ã€‚æ¶‰åŠçš„å…³é”®æ–¹æ³•æœ‰ï¼š\n\nlayoutSubviewsï¼šçœŸæ­£è¿›è¡Œå­è§†å›¾ä½ç½®å¸ƒå±€çš„åœ°æ–¹\nsetNeedsLayoutï¼šæ ‡è®°è§†å›¾ä¸ºéœ€è¦é‡æ–°å¸ƒå±€\nlayoutIfNeededï¼šç«‹å³å¼ºåˆ¶å¸ƒå±€\n\nå¸ƒå±€æµç¨‹å¦‚ä¸‹ï¼šå±æ€§å˜åŒ–ï¼ˆå¦‚ frameï¼‰æˆ–æ‰‹åŠ¨è§¦å‘â†“è°ƒç”¨ setNeedsLayoutï¼ˆæ ‡è®°éœ€è¦å¸ƒå±€ï¼‰â†“ä¸‹ä¸€ä¸ª runloop æ‰§è¡Œ layoutIfNeededâ†“ç³»ç»Ÿé€’å½’è°ƒç”¨ layoutSubviews è¿›è¡Œå¸ƒå±€\n\näºŒã€å…³é”®æ–¹æ³•è¯¦è§£1. setNeedsLayout\nä½œç”¨ï¼šæ ‡è®°å½“å‰è§†å›¾ä¸ºâ€œéœ€è¦é‡æ–°å¸ƒå±€â€\nè°ƒç”¨æ—¶æœºï¼šå½“è§†å›¾çŠ¶æ€æˆ–ä¾èµ–æ•°æ®å˜åŒ–æ—¶\næ³¨æ„ï¼šä¸ä¼šç«‹å³æ‰§è¡Œ layoutSubviewsï¼Œè€Œæ˜¯åœ¨ä¸‹ä¸€ä¸ª runloop è¿›è¡Œå¸ƒå±€\n\n[self.view setNeedsLayout];\n\n2. layoutIfNeeded\nä½œç”¨ï¼šç«‹å³æ‰§è¡Œå¸ƒå±€æµç¨‹ï¼ˆå¦‚æœå·²æ ‡è®°ï¼‰\nå¸¸ç”¨åœºæ™¯ï¼šåŠ¨ç”»ä¸­å¼ºåˆ¶æ›´æ–° layoutï¼Œç¡®ä¿è§†å›¾çŠ¶æ€æ­£ç¡®  [self.view layoutIfNeeded];\n\n3. layoutSubviews\nä½œç”¨ï¼šå¸ƒå±€å­è§†å›¾ï¼Œå­ç±»é€šè¿‡é‡å†™æ­¤æ–¹æ³•æ¥è‡ªå®šä¹‰å¸ƒå±€é€»è¾‘\nè°ƒç”¨æ–¹å¼ï¼šç³»ç»Ÿè‡ªåŠ¨è°ƒç”¨ï¼Œæˆ–é€šè¿‡ layoutIfNeeded é—´æ¥è§¦å‘  - (void)layoutSubviews &#123;    [super layoutSubviews];    self.label.frame = CGRectMake(10, 10, 100, 40);&#125;\n\nä¸‰ã€å¸ƒå±€è§¦å‘æ—¶æœºå¸ƒå±€æµç¨‹ä¼šåœ¨ä»¥ä¸‹æƒ…å†µä¸‹è‡ªåŠ¨è§¦å‘ï¼š\n\nè§†å›¾åˆå§‹åŒ–å®Œæˆåé¦–æ¬¡æ·»åŠ åˆ°è§†å›¾å±‚çº§ä¸­\nframe &#x2F; bounds &#x2F; center å±æ€§æ”¹å˜\nè°ƒç”¨ setNeedsLayout + layoutIfNeeded\nå±å¹•æ—‹è½¬ã€è®¾å¤‡æ–¹å‘å˜åŒ–\nAuto Layout çº¦æŸå˜åŒ–\n\nå››ã€Auto Layout å‚ä¸å¸ƒå±€æµç¨‹å½“ä½¿ç”¨ Auto Layoutï¼ˆè‡ªåŠ¨å¸ƒå±€ï¼‰æ—¶ï¼š\n\nä¸æ¨èåœ¨ layoutSubviews ä¸­è®¾ç½® frame\næ›´æ–°çº¦æŸåº”åœ¨ updateConstraints æ–¹æ³•ä¸­å®Œæˆ\nupdateConstraints â†’ layoutSubviews â†’ drawRect æ˜¯å®Œæ•´çš„è°ƒç”¨é“¾  - (void)updateConstraints &#123;    // æ›´æ–°çº¦æŸ    [super updateConstraints];&#125;\n\näº”ã€UIView ä¸ CALayer çš„å…³ç³»\næ¯ä¸ª UIView éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„ CALayer\nUIView.frame å®é™…ä¸Šæ˜¯æ“ä½œ CALayer.frame\nå¸ƒå±€æœ¬è´¨ä¸Šæ˜¯åœ¨æ›´æ–°å›¾å±‚çš„å±æ€§  NSLog(@&quot;%@&quot;, NSStringFromCGRect(self.view.layer.frame));\n\nå…­ã€æ–‡å­—ç‰ˆå¸ƒå±€æµç¨‹å›¾[è§†å›¾å±æ€§å˜æ›´]      â†“[setNeedsLayout] â†’ æ ‡è®°å¸ƒå±€      â†“[ä¸‹ä¸€ä¸ª runloop]      â†“[layoutIfNeeded] â†’ åˆ¤æ–­å¹¶è§¦å‘å¸ƒå±€      â†“[layoutSubviews] â†’ æ›´æ–°å­è§†å›¾ frame\n\nä¸ƒã€é¢è¯•é«˜é¢‘é—®é¢˜æ•´ç†Q1ï¼šlayoutSubviews å’Œ drawRect æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ\nlayoutSubviewsï¼šç”¨äºæ›´æ–°å­è§†å›¾çš„å¸ƒå±€\ndrawRectï¼šç”¨äºè‡ªå®šä¹‰è§†å›¾ç»˜å›¾ï¼ˆå¦‚ Core Graphicsï¼‰\n\nQ2ï¼šå¦‚ä½•ç«‹å³è§¦å‘å¸ƒå±€ï¼Ÿ[self.view setNeedsLayout];[self.view layoutIfNeeded];\n\nQ3ï¼šä»€ä¹ˆæ—¶å€™ä¼šè°ƒç”¨ layoutSubviewsï¼Ÿ\næ·»åŠ åˆ°çˆ¶è§†å›¾å\nframe æ”¹å˜\nsetNeedsLayout + layoutIfNeeded\nAuto Layout è§¦å‘\n\nQ4ï¼šå¦‚ä½•åœ¨åŠ¨ç”»ä¸­ç¡®ä¿å¸ƒå±€ç”Ÿæ•ˆï¼Ÿ[UIView animateWithDuration:0.3 animations:^&#123;    // ä¿®æ”¹å¸ƒå±€å‰ç½®æ¡ä»¶    [self.view layoutIfNeeded]; // å¼ºåˆ¶ç«‹å³å¸ƒå±€&#125;];\n\nå…«ã€å‚è€ƒèµ„æ–™\nApple Developer æ–‡æ¡£ï¼šUIView Class Reference\nå®˜æ–¹æŒ‡å—ï¼šView Programming Guide for iOS\n\n","categories":["åŸºç¡€"]},{"title":"Day19-ç¦»çº¿ç¼“å­˜æ¶æ„å›¾ + å®é™…åœºæ™¯æ€»ç»“","url":"/2025/05/19/Day19-%E7%A6%BB%E7%BA%BF%E7%BC%93%E5%AD%98%E6%9E%B6%E6%9E%84%E5%9B%BE-%E5%AE%9E%E9%99%85%E5%9C%BA%E6%99%AF%E6%80%BB%E7%BB%93/","content":"ä¸€ã€iOS ç¦»çº¿ç¼“å­˜æ¶æ„å›¾ï¼ˆé€»è¾‘å±‚çº§ï¼‰â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚         ç”¨æˆ·æ“ä½œå±‚         â”‚â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚ ViewController / ViewModel â”‚â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚     è¯·æ±‚æ•°æ®æ¥å£ï¼ˆManagerï¼‰ â”‚â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚       ç¦»çº¿ç¼“å­˜åè°ƒæ¨¡å—     â”‚ â—„â”€ æ§åˆ¶æ•°æ®æ¥æºé€»è¾‘â”‚  (CacheMediator/CacheLogic)â”‚â”œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚ ç½‘ç»œæ¨¡å— â”‚ æœ¬åœ°ç¼“å­˜æ¨¡å— â”‚ æ•°æ®åŒæ­¥æ¨¡å— â”‚â”‚ (NSURLSession/AFNç­‰) â”‚ (SQLite/Realm/File) â”‚ (ç‰ˆæœ¬/æ—¶é—´æˆ³/æ ¡éªŒ) â”‚â”œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚      æ•°æ®å­˜å‚¨å±‚ï¼ˆDataLayerï¼‰ â”‚â”‚   æœ¬åœ°æ•°æ®åº“ / æ–‡ä»¶ç³»ç»Ÿç­‰    â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\n\näºŒã€æ ¸å¿ƒæ¨¡å—è¯´æ˜1. ç½‘ç»œæ¨¡å—\nä½¿ç”¨ NSURLSession &#x2F; AFNetworking &#x2F; Alamofire å‘èµ·è¯·æ±‚ã€‚\næ”¯æŒæ–­ç‚¹ç»­ä¼ ã€etagã€Last-Modified ç­‰ç¼“å­˜ç­–ç•¥ã€‚\n\n2. ç¼“å­˜åè°ƒæ¨¡å—ï¼ˆCacheMediatorï¼‰\nåˆ¤å®šæ˜¯å¦å‘½ä¸­æœ¬åœ°ç¼“å­˜ï¼Œæ˜¯å¦éœ€è¦åˆ·æ–°ã€‚\nè´Ÿè´£ç¼“å­˜ç­–ç•¥ï¼ˆå¦‚ï¼šç¼“å­˜æœ‰æ•ˆæœŸã€æœ¬åœ°ä¼˜å…ˆã€å¼±ç½‘å…œåº•ã€é¢„åŠ è½½ï¼‰ã€‚\n\n3. æœ¬åœ°ç¼“å­˜æ¨¡å—\næ•°æ®ç»“æ„ï¼š\nJSONï¼šä¿å­˜åˆ°æ•°æ®åº“ï¼ˆSQLite&#x2F;Realm&#x2F;CoreDataï¼‰\nå›¾ç‰‡ã€éŸ³è§†é¢‘ï¼šæ–‡ä»¶ç³»ç»Ÿï¼ˆDiskï¼‰\n\n\nå…ƒä¿¡æ¯åŒæ­¥ï¼šç¼“å­˜æ—¶é—´ã€etagã€urlã€æ•°æ®ç‰ˆæœ¬ã€‚\n\n4. æ•°æ®åŒæ­¥æ¨¡å—\nåˆ¤æ–­ç¼“å­˜æ˜¯å¦è¿‡æœŸã€æ˜¯å¦éœ€æ›´æ–°ã€‚\nåå°æ›´æ–°æœºåˆ¶ï¼ˆApp å¯åŠ¨ã€è¿›å…¥åå°ã€æ‹‰å–åˆ·æ–°ï¼‰ã€‚\n\n\nä¸‰ã€å…¸å‹ä½¿ç”¨åœºæ™¯æ€»ç»“\n\n\nåœºæ™¯\nç¦»çº¿ç¼“å­˜è®¾è®¡æ–¹æ¡ˆ\n\n\n\næ–°é—»èµ„è®¯App\né¦–é¡µæ•°æ®åˆ—è¡¨ JSON ç¼“å­˜ï¼Œå›¾ç‰‡é¢„åŠ è½½ï¼›å¼±ç½‘ä¸‹ä¼˜å…ˆè¯»æœ¬åœ°ã€‚\n\n\nè§†é¢‘æ’­æ”¾å™¨\næ’­æ”¾å™¨æ”¯æŒ m3u8 &#x2F; mp4 æ–‡ä»¶é¢„ç¼“å­˜ï¼Œæ”¯æŒæ–­ç‚¹ç»­ä¼ ã€‚\n\n\nç”µå•†åº”ç”¨\nå•†å“åˆ—è¡¨ç¼“å­˜ã€è¯¦æƒ…é¡µç¼“å­˜ï¼Œæ”¯æŒæ•°æ®ç‰ˆæœ¬æ§åˆ¶ã€‚\n\n\nèŠå¤©&#x2F;IMåº”ç”¨\næ¶ˆæ¯æœ¬åœ°æ•°æ®åº“æŒä¹…åŒ–ï¼ˆä¾‹å¦‚ SQLiteï¼‰ï¼Œæ–­ç½‘æ—¶ä»å¯æŸ¥çœ‹ã€‚\n\n\nåœ°å›¾&#x2F;å¯¼èˆªç±»\nåœ°å›¾ç“¦ç‰‡ç¦»çº¿ä¸‹è½½ï¼Œè·¯å¾„è§„åˆ’ç¼“å­˜ï¼›GPSä¸ä¾èµ–ç½‘ç»œã€‚\n\n\nè¡¨å•æäº¤ç±»ï¼ˆé—®å·&#x2F;CRMï¼‰\næ•°æ®è‰ç¨¿ä¿å­˜åˆ°æœ¬åœ°ï¼Œç½‘ç»œæ¢å¤åè‡ªåŠ¨åŒæ­¥ã€‚\n\n\n\nå››ã€æœ€ä½³å®è·µä¸æ³¨æ„äº‹é¡¹\n\n\nå®è·µå»ºè®®\nè¯´æ˜\n\n\n\næ•°æ®ç‰ˆæœ¬æ§åˆ¶\nä½¿ç”¨ç‰ˆæœ¬å·æˆ–æ—¶é—´æˆ³åˆ¤æ–­ç¼“å­˜æ˜¯å¦è¿‡æœŸ\n\n\nå¤šçº§ç¼“å­˜ç­–ç•¥ï¼ˆMemory + Diskï¼‰\næé«˜è®¿é—®é€Ÿåº¦å¹¶èŠ‚çœç½‘ç»œèµ„æº\n\n\nå¼‚å¸¸å¤„ç†å…œåº•ï¼ˆå¦‚ç½‘ç»œå¤±è´¥ï¼‰\næœ¬åœ°ç¼“å­˜å…œåº•ï¼Œä¿è¯ App ä¸å´©æºƒã€å¯ç”¨\n\n\nç¼“å­˜æ¸…ç†ç­–ç•¥\nLRUã€å®šæœŸæ¸…ç†ã€ä¸å¸¸è®¿é—®æ·˜æ±°\n\n\nåŠ å¯†ä¸éšç§\nå¯¹æœ¬åœ°ç¼“å­˜å†…å®¹åŠ å¯†ï¼Œé¿å…éšç§æ³„éœ²\n\n\n","categories":["åŸºç¡€"]},{"title":"Day18-æ•°æ®æŒä¹…åŒ–æ–¹æ¡ˆ","url":"/2025/05/18/Day18-%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85%E5%8C%96%E6%96%B9%E6%A1%88/","content":"iOS çš„æ•°æ®æŒä¹…åŒ–æ˜¯æŒ‡å°†åº”ç”¨è¿è¡Œè¿‡ç¨‹ä¸­äº§ç”Ÿçš„æ•°æ®ä¿å­˜åˆ°è®¾å¤‡çš„æœ¬åœ°å­˜å‚¨ä¸­ï¼Œä»¥ä¾¿ä¸‹æ¬¡å¯åŠ¨æˆ–åœ¨éœ€è¦æ—¶è¯»å–ã€‚æ ¹æ®æ•°æ®çš„ç»“æ„å¤æ‚åº¦ã€è¯»å†™é¢‘ç‡ã€å®‰å…¨æ€§è¦æ±‚ç­‰ä¸åŒåœºæ™¯ï¼ŒiOS æä¾›äº†å¤šç§æŒä¹…åŒ–æ–¹æ¡ˆï¼š\n\nå¸¸è§çš„æ•°æ®æŒä¹…åŒ–æ–¹å¼1. NSUserDefaults &#x2F; UserDefaults\né€‚ç”¨åœºæ™¯ï¼šè½»é‡çº§æ•°æ®ï¼Œå¦‚è®¾ç½®é¡¹ã€ç™»å½•çŠ¶æ€ã€é¦–é€‰é¡¹ã€‚\nå­˜å‚¨ç±»å‹ï¼šåŸºæœ¬ç±»å‹ï¼ˆStringã€Boolã€Intã€Floatã€Doubleï¼‰ã€æ•°ç»„ã€å­—å…¸ã€Dataã€‚\nå­˜å‚¨ä½ç½®ï¼šLibrary/Preferences ç›®å½•ä¸‹çš„ plist æ–‡ä»¶ã€‚\nä¼˜ç‚¹ï¼šç®€å•æ˜“ç”¨ï¼Œè‡ªåŠ¨æŒä¹…åŒ–ã€‚\nç¼ºç‚¹ï¼šä¸é€‚åˆå­˜å‚¨å¤§é‡æˆ–ç»“æ„å¤æ‚çš„æ•°æ®ã€‚\n\nUserDefaults.standard.set(true, forKey: &quot;hasLaunchedBefore&quot;)let launched = UserDefaults.standard.bool(forKey: &quot;hasLaunchedBefore&quot;)\n\n\n2. Keychain\né€‚ç”¨åœºæ™¯ï¼šå­˜å‚¨æ•æ„Ÿä¿¡æ¯ï¼Œå¦‚å¯†ç ã€tokenã€‚\nå®‰å…¨æ€§é«˜ï¼šç³»ç»Ÿçº§åˆ«çš„åŠ å¯†å­˜å‚¨ï¼Œæ”¯æŒ Touch ID &#x2F; Face IDã€‚\nç¼ºç‚¹ï¼šAPI è¾ƒå¤æ‚ï¼Œå¯é€šè¿‡ç¬¬ä¸‰æ–¹åº“ç®€åŒ–å¦‚ KeychainAccessã€SAMKeychainã€‚\n\nlet keychain = Keychain(service: &quot;com.example.app&quot;)try? keychain.set(&quot;secret-token&quot;, key: &quot;authToken&quot;)let token = try? keychain.get(&quot;authToken&quot;)\n\n\n3. File System\né€‚ç”¨åœºæ™¯ï¼šéŸ³è§†é¢‘ã€å›¾ç‰‡ã€æ–‡æœ¬æ–‡ä»¶ã€è‡ªå®šä¹‰æ•°æ®æ¨¡å‹çš„äºŒè¿›åˆ¶å½¢å¼ã€‚\nå¸¸ç”¨ APIï¼šFileManager\næ–‡ä»¶ä½ç½®ï¼š\nDocumentsï¼šç”¨æˆ·ç”Ÿæˆå†…å®¹ï¼ŒiCloud ä¼šå¤‡ä»½\nCachesï¼šç¼“å­˜æ•°æ®ï¼Œç³»ç»Ÿå¯èƒ½æ¸…ç†\ntmpï¼šä¸´æ—¶æ•°æ®ï¼Œéšæ—¶ä¼šè¢«åˆ é™¤\n\n\n\nlet fileURL = FileManager.default.urls(for: .documentDirectory, in: .userDomainMask)[0].appendingPathComponent(&quot;myData.txt&quot;)try? &quot;Hello&quot;.write(to: fileURL, atomically: true, encoding: .utf8)\n\n\n4. Core Data\né€‚ç”¨åœºæ™¯ï¼šç»“æ„åŒ–å¤æ‚æ•°æ®çš„æœ¬åœ°æ•°æ®åº“å­˜å‚¨ã€‚\nä¼˜ç‚¹ï¼š\nApple å®˜æ–¹æ”¯æŒçš„å¯¹è±¡å›¾ç®¡ç†æ¡†æ¶\næ”¯æŒæ•°æ®æ¨¡å‹ã€å…³ç³»å‹å»ºæ¨¡ã€æŸ¥è¯¢ä¼˜åŒ–ã€æ‡’åŠ è½½ç­‰\nå¯ç»“åˆ iCloud ä½¿ç”¨\n\n\nç¼ºç‚¹ï¼šå­¦ä¹ æ›²çº¿è¾ƒé™¡ï¼Œä¸é€‚åˆç®€å•æ•°æ®\n\nlet entity = NSEntityDescription.insertNewObject(forEntityName: &quot;Person&quot;, into: context)entity.setValue(&quot;Tom&quot;, forKey: &quot;name&quot;)try? context.save()\n\n\n5. SQLite\né€‚ç”¨åœºæ™¯ï¼šå¯¹æ•°æ®åº“ç»“æ„å®Œå…¨æ§åˆ¶ï¼›æ•°æ®é‡å¤§ã€ç»“æ„æ¸…æ™°ã€‚\nä¼˜ç‚¹ï¼šçµæ´»ã€é«˜æ€§èƒ½ã€å¹¿æ³›åº”ç”¨\nç¼ºç‚¹ï¼šåŸç”Ÿ C æ¥å£å¤æ‚ï¼Œæ¨èä½¿ç”¨å°è£…åº“ï¼Œå¦‚ï¼š\nFMDBï¼ˆObjective-C å°è£…ï¼‰\nGRDB.swiftï¼ˆSwift å°è£…ï¼‰\n\n\n\nimport SQLite3// ç•¥ï¼šæ‰“å¼€æ•°æ®åº“ã€å‡†å¤‡è¯­å¥ã€æ‰§è¡Œè¯­å¥ç­‰\n\n\n6. Realm\né€‚ç”¨åœºæ™¯ï¼šæ›¿ä»£ Core Data æˆ– SQLiteï¼Œç®€å•æ˜“ç”¨ã€æ€§èƒ½ä¼˜ã€‚\nä¼˜ç‚¹ï¼š\nä¸éœ€è¦ schema migration å†™ SQL\nè·¨å¹³å°\nå“åº”å¼æ•°æ®ç›‘å¬æ”¯æŒ\n\n\nç¼ºç‚¹ï¼šæ˜¯ç¬¬ä¸‰æ–¹åº“ï¼Œéœ€é›†æˆç»´æŠ¤\n\nclass Dog: Object &#123;    @Persisted var name = &quot;&quot;    @Persisted var age = 0&#125;let dog = Dog()dog.name = &quot;Rex&quot;try! realm.write &#123;    realm.add(dog)&#125;\n\n\n7. Codable + File System\né€‚ç”¨åœºæ™¯ï¼šä¸­ç­‰å¤æ‚çš„æ•°æ®æ¨¡å‹ï¼Œè‡ªå®šä¹‰ç»“æ„åºåˆ—åŒ–ä¸º JSON&#x2F;Plist&#x2F;Binaryã€‚\nä¼˜ç‚¹ï¼šè½»é‡ã€çµæ´»ã€‚\né…åˆæ–¹å¼ï¼š\nJSONEncoder/Decoder\nPropertyListEncoder/Decoder\n\n\n\nstruct User: Codable &#123;    let name: String    let age: Int&#125;let user = User(name: &quot;Alice&quot;, age: 25)let data = try JSONEncoder().encode(user)try data.write(to: fileURL)\n\n\næ€»ç»“å¯¹æ¯”\n\n\næ–¹æ¡ˆ\nä¼˜ç‚¹\nç¼ºç‚¹\né€‚ç”¨åœºæ™¯\n\n\n\nUserDefaults\nç®€å•æ˜“ç”¨\nä¸é€‚åˆå¤æ‚&#x2F;å¤§é‡æ•°æ®\né…ç½®ã€è½»é‡çŠ¶æ€\n\n\nKeychain\né«˜å®‰å…¨æ€§\nAPIå¤æ‚\nå¯†ç ã€token\n\n\nFile System\nçµæ´»ã€æ”¯æŒä»»æ„æ•°æ®\næ‰‹åŠ¨ç®¡ç†è¯»å†™&#x2F;åºåˆ—åŒ–\næ–‡ä»¶ã€ç¼“å­˜ã€äºŒè¿›åˆ¶èµ„æº\n\n\nCore Data\nå¼ºå¤§å¯¹è±¡å…³ç³»ç®¡ç†\nå­¦ä¹ æˆæœ¬é«˜\nä¸­å¤§å‹ç»“æ„åŒ–æ•°æ®\n\n\nSQLite\nç²¾ç»†æ§åˆ¶ã€é«˜æ€§èƒ½\nCè¯­è¨€ç¹ç\næ•°æ®åº“å¼€å‘ã€æ€§èƒ½æ•æ„Ÿåœºæ™¯\n\n\nRealm\nç®€æ´é«˜æ•ˆ\nç¬¬ä¸‰æ–¹åº“ä¾èµ–\nå¿«é€Ÿå¼€å‘ç»“æ„åŒ–æ•°æ®å­˜å‚¨\n\n\nCodable + File\nçµæ´»æ˜“äºç»´æŠ¤\næ— æŸ¥è¯¢æœºåˆ¶\nè‡ªå®šä¹‰æ¨¡å‹ã€è½»é‡æ•°æ®åº“æ›¿ä»£å“\n\n\n","categories":["åŸºç¡€"]},{"title":"Day2-ç”¨æ ˆå®ç°é˜Ÿåˆ—","url":"/2025/04/24/Day2-%E7%94%A8%E6%A0%88%E5%AE%9E%E7%8E%B0%E9%98%9F%E5%88%97/","content":"ğŸ”— LeetCode 232 - Implement Queue using Stacks\nğŸ“Œ é¢˜ç›®æè¿°ï¼šä½¿ç”¨ä¸¤ä¸ªæ ˆ stackIn å’Œ stackOut å®ç°ä¸€ä¸ªé˜Ÿåˆ—ï¼Œæ”¯æŒä»¥ä¸‹æ“ä½œï¼š\n\npush(x)ï¼šå°†å…ƒç´  x æ¨åˆ°é˜Ÿåˆ—çš„æœ«å°¾\npop()ï¼šç§»é™¤é˜Ÿåˆ—å¼€å¤´çš„å…ƒç´ å¹¶è¿”å›\npeek()ï¼šè¿”å›é˜Ÿåˆ—å¼€å¤´çš„å…ƒç´ \nempty()ï¼šè¿”å›é˜Ÿåˆ—æ˜¯å¦ä¸ºç©º\n\nè¦æ±‚ï¼šåªèƒ½ä½¿ç”¨æ ˆçš„æ ‡å‡†æ“ä½œï¼ˆpush, pop, peek, emptyï¼‰\n\nğŸ’¡ è§£é¢˜æ€è·¯ï¼š\nå…¥é˜Ÿæ“ä½œï¼ˆpushï¼‰ç›´æ¥å¾€ stackIn ä¸­åŠ å…ƒç´ ï¼›\nå‡ºé˜Ÿæ“ä½œï¼ˆpop æˆ– peekï¼‰æ—¶ï¼Œå¦‚æœ stackOut ä¸ºç©ºï¼Œåˆ™å°† stackIn ä¸­çš„æ‰€æœ‰å…ƒç´ å€’åºè½¬ç§»åˆ° stackOutï¼›\nä¿è¯å…ˆè¿›å…ˆå‡ºï¼ˆFIFOï¼‰çš„é¡ºåºã€‚\n\n\nâœ… JavaScript å®ç°ï¼švar MyQueue = function () &#123;    this.stackIn = [];    this.stackOut = [];&#125;;MyQueue.prototype.push = function (x) &#123;    this.stackIn.push(x);&#125;;MyQueue.prototype.pop = function () &#123;    if (this.stackOut.length === 0) &#123;        while (this.stackIn.length) &#123;            this.stackOut.push(this.stackIn.pop());        &#125;    &#125;    return this.stackOut.pop();&#125;;MyQueue.prototype.peek = function () &#123;    if (this.stackOut.length === 0) &#123;        while (this.stackIn.length) &#123;            this.stackOut.push(this.stackIn.pop());        &#125;    &#125;    return this.stackOut[this.stackOut.length - 1];&#125;;MyQueue.prototype.empty = function () &#123;    return this.stackIn.length === 0 &amp;&amp; this.stackOut.length === 0;&#125;;\n\n\n\nğŸ§  æ€è€ƒæ‹“å±•ï¼š\nå¦‚æœåè¿‡æ¥æ˜¯â€œç”¨é˜Ÿåˆ—å®ç°æ ˆâ€åº”è¯¥æ€ä¹ˆåšï¼ŸğŸ‘‰ LeetCode 225\né˜Ÿåˆ—ç›¸å…³æ‹“å±•é¢˜ï¼šæ»‘åŠ¨çª—å£æœ€å¤§å€¼ã€æœ€å°æ ˆç­‰\n\n","categories":["ç®—æ³•"],"tags":["ç®—æ³•"]},{"title":"Day3-Block åˆ†ç±»ã€å˜é‡æ•è·ä¸ä½œç”¨åŸŸ","url":"/2025/04/25/Day3-Block-%E5%88%86%E7%B1%BB%E3%80%81%E5%8F%98%E9%87%8F%E6%8D%95%E8%8E%B7%E4%B8%8E%E4%BD%9C%E7%94%A8%E5%9F%9F/","content":"Block åˆ†ç±»ã€å˜é‡æ•è·ä¸ä½œç”¨åŸŸä¸€ã€Block çš„åˆ†ç±»Block åœ¨ Objective-C ä¸­ï¼Œæ ¹æ®å…¶å­˜å‚¨ä½ç½®å’Œç”Ÿå‘½å‘¨æœŸåˆ†ä¸ºä»¥ä¸‹ä¸‰ç±»ï¼š\n\n\n\nBlock ç±»å‹\nå­˜å‚¨ä½ç½®\nç‰¹ç‚¹è¯´æ˜\n\n\n\nGlobal Block\nå…¨å±€åŒº\nä¸æ•è·å¤–éƒ¨å˜é‡\n\n\nStack Block\næ ˆä¸Š\næ•è·å¤–éƒ¨å˜é‡ï¼Œéšæ ˆå¸§é”€æ¯\n\n\nHeap Block\nå †ä¸Š\næ•è·å¤–éƒ¨å˜é‡ï¼ŒBlock_copy åå­˜åœ¨å †ä¸Š\n\n\nç¤ºä¾‹ï¼švoid (^block1)(void) = ^&#123;    NSLog(@&quot;Hello&quot;);&#125;;// Global Blockint a = 10;void (^block2)(void) = ^&#123;    NSLog(@&quot;a = %d&quot;, a);&#125;;// Stack Blockvoid (^block3)(void) = [block2 copy];// Heap Block\n\n\näºŒã€å˜é‡æ•è·ï¼ˆCaptured Variablesï¼‰1. é»˜è®¤æ•è·ï¼ˆå€¼è¯­ä¹‰ï¼‰Block é»˜è®¤ä»¥å€¼æ–¹å¼æ‹·è´å±€éƒ¨å˜é‡ï¼Œä¸å¯ä¿®æ”¹ã€‚\nint a = 5;void (^block)(void) = ^&#123;    NSLog(@&quot;a is %d&quot;, a);&#125;;a = 6;block(); // è¾“å‡º a is 5\n\n2. __block ä¿®é¥°ï¼ˆå¼•ç”¨è¯­ä¹‰ï¼‰å…è®¸åœ¨ Block å†…éƒ¨ä¿®æ”¹å¤–éƒ¨å˜é‡ã€‚\n__block int a = 5;void (^block)(void) = ^&#123;    a = 10;&#125;;block();NSLog(@&quot;a is %d&quot;, a); // è¾“å‡º a is 10\n\n3. å¯¹è±¡æ•è·ï¼ˆæŒ‡é’ˆè¯­ä¹‰ï¼‰å¯¹è±¡å˜é‡ä»¥æŒ‡é’ˆå½¢å¼æ•è·ï¼Œä¼šè¢«å¼ºå¼•ç”¨ã€‚\nNSString *str = @&quot;Hello&quot;;void (^block)(void) = ^&#123;    NSLog(@&quot;%@&quot;, str);&#125;;// str è¢« retain\n\n\nä¸‰ã€ä½œç”¨åŸŸä¸å†…å­˜ç®¡ç†ç”Ÿå‘½å‘¨æœŸï¼š\nStack Block ç”Ÿå‘½å‘¨æœŸçŸ­ï¼Œè¶…å‡ºä½œç”¨åŸŸä¼šè¢«é”€æ¯ã€‚\néœ€è¦å¼‚æ­¥ä½¿ç”¨æ—¶ï¼Œå¿…é¡»å°† Block copy åˆ°å †ä¸Šï¼Œå˜ä¸º Heap Blockã€‚\nARC ä¸‹è‡ªåŠ¨è¿›è¡Œ copy æ“ä½œï¼›MRC éœ€æ‰‹åŠ¨è°ƒç”¨ Block_copyã€‚\n\nç¤ºä¾‹ï¼ˆARC å¼‚æ­¥å®‰å…¨ï¼‰ï¼šdispatch_async(dispatch_get_global_queue(0, 0), ^&#123;    NSLog(@&quot;Block executed&quot;);&#125;);// ARC è‡ªåŠ¨ copy åˆ°å †\n\n\nå››ã€Swift ä¸­çš„é—­åŒ…æ•è·Swift ä¸­é—­åŒ…é»˜è®¤å¼ºå¼•ç”¨æ•è·å¯¹è±¡ï¼š\nclass MyClass &#123;    var name = &quot;Test&quot;    func doSomething() &#123;        DispatchQueue.global().async &#123; [weak self] in            print(self?.name ?? &quot;nil&quot;)        &#125;    &#125;&#125;\n\nä½¿ç”¨ [weak self] &#x2F; [unowned self] å¯é¿å…å¾ªç¯å¼•ç”¨ã€‚\n\näº”ã€å°ç»“å¯¹æ¯”è¡¨\n\n\nåˆ†ç±»\næ˜¯å¦æ•è·å˜é‡\nå­˜å‚¨ä½ç½®\nç”Ÿå‘½å‘¨æœŸæ§åˆ¶\n\n\n\nGlobal Block\nå¦\nå…¨å±€åŒº\nç¨‹åºç”Ÿå‘½å‘¨æœŸå†…å¸¸é©»\n\n\nStack Block\næ˜¯\næ ˆä¸Š\néšæ ˆå¸§é”€æ¯\n\n\nHeap Block\næ˜¯\nå †ä¸Š\nBlock_copy åå­˜åœ¨äºå †ä¸­\n\n\n","categories":["åŸºç¡€"]},{"title":"Day3-æœ‰æ•ˆçš„æ‹¬å·","url":"/2025/04/25/Day3-%E6%9C%89%E6%95%88%E7%9A%84%E6%8B%AC%E5%8F%B7/","content":"ğŸ”— LeetCode 20 - Valid Parentheses\nğŸ“Œ é¢˜ç›®æè¿°ç»™å®šä¸€ä¸ªåªåŒ…æ‹¬ &#39;(&#39;, &#39;)&#39;, &#39;&#123;&#39;, &#39;&#125;&#39;, &#39;[&#39;, &#39;]&#39; çš„å­—ç¬¦ä¸² sï¼Œåˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦æ˜¯æœ‰æ•ˆçš„ã€‚\næœ‰æ•ˆå­—ç¬¦ä¸²éœ€æ»¡è¶³ï¼š\n\nå·¦æ‹¬å·å¿…é¡»ç”¨ç›¸åŒç±»å‹çš„å³æ‹¬å·é—­åˆã€‚\nå·¦æ‹¬å·å¿…é¡»ä»¥æ­£ç¡®çš„é¡ºåºé—­åˆã€‚\nç©ºå­—ç¬¦ä¸²ä¹Ÿä¸ºæœ‰æ•ˆå­—ç¬¦ä¸²ã€‚\n\n\nğŸ’¡ è§£é¢˜æ€è·¯\nä½¿ç”¨æ ˆç»“æ„æ¥å¤„ç†æ‹¬å·åŒ¹é…ï¼›\né‡åˆ°å·¦æ‹¬å·å°±å…¥æ ˆï¼Œé‡åˆ°å³æ‹¬å·æ—¶åˆ¤æ–­æ˜¯å¦å’Œæ ˆé¡¶é…å¯¹ï¼›\nè‹¥åŒ¹é…ï¼Œåˆ™å¼¹å‡ºæ ˆé¡¶ï¼›å¦åˆ™ç›´æ¥è¿”å› falseï¼›\næœ€åæ ˆä¸ºç©ºï¼Œåˆ™ä¸ºåˆæ³•å­—ç¬¦ä¸²ã€‚\n\n\nâœ… JavaScript å®ç°var isValid = function (s) &#123;    const stack = [];    const map = &#123;        &#x27;)&#x27;: &#x27;(&#x27;,        &#x27;&#125;&#x27;: &#x27;&#123;&#x27;,        &#x27;]&#x27;: &#x27;[&#x27;    &#125;;    for (let char of s) &#123;        if ([&#x27;(&#x27;, &#x27;&#123;&#x27;, &#x27;[&#x27;].includes(char)) &#123;            stack.push(char);        &#125; else &#123;            if (stack.pop() !== map[char]) &#123;                return false;            &#125;        &#125;    &#125;    return stack.length === 0;&#125;;\n\n\nğŸ§  æ€è€ƒæ‹“å±•\næ‹¬å·åŒ¹é…æ˜¯æ ˆç»“æ„ç»å…¸åº”ç”¨ï¼Œè¯·ç†è§£å…¶åº•å±‚æ€æƒ³ï¼›\nLeetCode æ‹“å±•é¢˜æ¨èï¼š\n22. Generate Parenthesesï¼ˆæ‹¬å·ç”Ÿæˆï¼‰\n32. Longest Valid Parenthesesï¼ˆæœ€é•¿æœ‰æ•ˆæ‹¬å·ï¼‰\n\n\n\n","categories":["ç®—æ³•"]},{"title":"Day4-Block å†…å­˜ç®¡ç† & å¾ªç¯å¼•ç”¨åˆ†æ","url":"/2025/04/27/Day4-Block-%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86-%E5%BE%AA%E7%8E%AF%E5%BC%95%E7%94%A8%E5%88%86%E6%9E%90/","content":"Block å†…å­˜ç®¡ç† &amp; å¾ªç¯å¼•ç”¨åˆ†æ1. Block çš„ç»“æ„ä½“æœ¬è´¨Block åœ¨åº•å±‚å…¶å®æ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼š\nstruct Block_literal &#123;    void *isa;                      // æŒ‡å‘ Block ç±»å¯¹è±¡    int flags;                      // æ ‡å¿—ä½ï¼ˆæ˜¯å¦æœ‰ copy/dispose ç­‰ï¼‰    int reserved;                   // ä¿ç•™å­—æ®µ    void (*invoke)(void *, ...);     // å‡½æ•°æŒ‡é’ˆï¼ŒBlock å®é™…æ‰§è¡Œé€»è¾‘    struct Block_descriptor *descriptor;  // Block æè¿°ä¿¡æ¯    // captured variables...&#125;;\n\n2. æ•è·å¤–éƒ¨å˜é‡æ—¶ï¼Œå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ\n\n\nå˜é‡ç±»å‹\næ•è·æ–¹å¼\nå†…å­˜ç®¡ç†è¡Œä¸º\n\n\n\nåŸºæœ¬æ•°æ®ç±»å‹ï¼ˆint&#x2F;floatï¼‰\nå€¼æ‹·è´\nä¸å½±å“å†…å­˜ç®¡ç†\n\n\nObjective-C å¯¹è±¡\nå¼ºå¼•ç”¨ï¼ˆretainï¼‰\néœ€è¦æ³¨æ„å¾ªç¯å¼•ç”¨\n\n\n__block ä¿®é¥°çš„å¯¹è±¡\næŒ‡é’ˆæ‹·è´ï¼Œä½†æœ¬èº«ä»å¯èƒ½å¼ºå¼•ç”¨\néœ€é…åˆ __weak __block\n\n\n3. Block çš„ copy å’Œ dispose å‡½æ•°Block å¦‚æœæ•è·äº†å¯¹è±¡ï¼Œåº•å±‚ä¼šè‡ªåŠ¨ç”Ÿæˆ copy å’Œ dispose å‡½æ•°ï¼š\n\ncopy ï¼š retain æ•è·çš„å¯¹è±¡\ndispose ï¼š release æ•è·çš„å¯¹è±¡\n\nç®€åŒ–ç¤ºä¾‹ï¼š\nvoid _Block_copy(void *dst, void *src) &#123;    objc_retain(capturedObj);&#125;void _Block_dispose(void *src) &#123;    objc_release(capturedObj);&#125;\n\n4. æ·±å±‚æ¬¡çš„å¾ªç¯å¼•ç”¨åˆ†æå¸¸è§å¯¼è‡´ Block å¾ªç¯å¼•ç”¨çš„åœºæ™¯ï¼š\n\nNSTimer &#x2F; CADisplayLink &#x2F; GCD\nå¼‚æ­¥ä»»åŠ¡ (dispatch_async)\né“¾å¼è°ƒç”¨\n\næ ‡å‡†é˜²å¾ªç¯å†™æ³•ï¼š\n__weak typeof(self) weakSelf = self;self.myBlock = ^&#123;    __strong typeof(weakSelf) strongSelf = weakSelf;    if (!strongSelf) return;    [strongSelf doSomething];&#125;;\n\n\n\nBlock é«˜é¢‘é¢è¯•é—®ç­”1. Block çš„ç±»å‹æœ‰å“ªäº›ï¼Ÿåˆ†åˆ«ä»€ä¹ˆæ—¶å€™å‡ºç°ï¼Ÿç­”ï¼š\n\nGlobal Blockï¼šä¸æ•è·å¤–éƒ¨å˜é‡ï¼Œå­˜å‚¨åœ¨å…¨å±€åŒºã€‚\nStack Blockï¼šæ•è·äº†å¤–éƒ¨å˜é‡ï¼Œå­˜å‚¨åœ¨æ ˆä¸Šã€‚\nMalloc Blockï¼šæ‹·è´è‡ª Stack Blockï¼Œå­˜å‚¨åœ¨å †ä¸Šã€‚\n\nARC ä¸‹åªå­˜åœ¨ Global Block å’Œ Malloc Blockã€‚\n\n2. Block åœ¨ ARC ä¸‹æ˜¯å¦‚ä½•å†…å­˜ç®¡ç†çš„ï¼Ÿç­”ï¼š\n\nARC ä¼šè‡ªåŠ¨å¯¹ Block æ‰§è¡Œ copy æ“ä½œï¼Œå°†å…¶ä»æ ˆæ‹·è´åˆ°å †ä¸Šã€‚\nä½¿ç”¨ __strong æŒ‡é’ˆæŒæœ‰ Block æ—¶ï¼Œé»˜è®¤æ˜¯å † Blockã€‚\n\n\n3. å¦‚ä½•åˆ¤æ–­ä¸€ä¸ª Block æ˜¯å¦é€ æˆäº†å¾ªç¯å¼•ç”¨ï¼Ÿç­”ï¼š\n\næ£€æŸ¥ Block å†…æ˜¯å¦ä½¿ç”¨äº† selfã€‚\næ£€æŸ¥ self æ˜¯å¦å¼ºå¼•ç”¨äº† Blockï¼ˆæ¯”å¦‚ Block æ˜¯ self çš„å±æ€§ï¼‰ã€‚\nä½¿ç”¨ Instruments çš„ Leaks å·¥å…·åˆ†æå†…å­˜æ³„æ¼ã€‚\n\n\n4. __block ä¿®é¥°ç¬¦åœ¨ ARC å’Œ MRC ä¸‹åˆ†åˆ«æ˜¯ä»€ä¹ˆè¡Œä¸ºï¼Ÿç­”ï¼š\n\nMRCï¼š__block å…è®¸ä¿®æ”¹å˜é‡ï¼Œä½†ä¸ä¼šè‡ªåŠ¨ç®¡ç†å¼•ç”¨è®¡æ•°ã€‚\nARCï¼š__block å…è®¸ä¿®æ”¹ï¼Œä½†å¹¶ä¸ä¼šå¼±åŒ–å¼•ç”¨å…³ç³»ï¼Œéœ€è¦è‡ªå·±å¤„ç†å¼±å¼•ç”¨ã€‚\n\n\n5. Block ä¸ºä»€ä¹ˆå®¹æ˜“å¼•èµ·å†…å­˜æ³„æ¼ï¼Ÿå…·ä½“æœ‰å“ªäº›åœºæ™¯ï¼Ÿç­”ï¼šå› ä¸º Block æ•è·å˜é‡æ˜¯å¼ºå¼•ç”¨ï¼Œç‰¹åˆ«æ˜¯å¯¹è±¡æŒ‡é’ˆï¼Œå¦‚ä¸‹åœºæ™¯å¸¸å‡ºé—®é¢˜ï¼š\n\nUIViewController çš„ Block å±æ€§å†…éƒ¨å¼•ç”¨äº† self\nNSTimerã€CADisplayLinkã€GCD ä¸­çš„ Block\n\nè§£å†³åŠæ³•ï¼š\n\nä½¿ç”¨ __weak\nå®šæ—¶å™¨ä½¿ç”¨ weakProxy\nGCD æ³¨æ„ç”Ÿå‘½å‘¨æœŸæ§åˆ¶\n\n\nå°ç»“ç†è§£ Block çš„å†…å­˜ç‰¹æ€§ã€å¼•ç”¨å…³ç³»å˜åŒ–ï¼ˆstack â†’ heapï¼‰ã€ä»¥åŠåœ¨ ARC ä¸‹çš„é»˜è®¤ copy æœºåˆ¶ï¼Œæ˜¯å½»åº•æŒæ¡ iOS å†…å­˜ç®¡ç†çš„å…³é”®ã€‚\n","categories":["åŸºç¡€"]},{"title":"Day4-æœ‰æ•ˆçš„å­—æ¯å¼‚ä½è¯","url":"/2025/04/27/Day4-%E6%9C%89%E6%95%88%E7%9A%84%E5%AD%97%E6%AF%8D%E5%BC%82%E4%BD%8D%E8%AF%8D/","content":"ğŸ”— LeetCode 242 - Valid Anagram\nğŸ“Œ é¢˜ç›®æè¿°ï¼šç»™å®šä¸¤ä¸ªå­—ç¬¦ä¸² s å’Œ tï¼Œç¼–å†™ä¸€ä¸ªå‡½æ•°æ¥åˆ¤æ–­ t æ˜¯å¦æ˜¯ s çš„å­—æ¯å¼‚ä½è¯ã€‚\nå­—æ¯å¼‚ä½è¯çš„å®šä¹‰ï¼šå¦‚æœä¸¤ä¸ªå­—ç¬¦ä¸²ä¸­çš„å­—æ¯å‡ºç°çš„é¢‘ç‡ç›¸åŒä¸”å­—ç¬¦å®Œå…¨ä¸€è‡´ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªå­—ç¬¦ä¸²æ˜¯å­—æ¯å¼‚ä½è¯ã€‚\n\nğŸ’¡ è§£é¢˜æ€è·¯ï¼šâ€¢\tå°†ä¸¤ä¸ªå­—ç¬¦ä¸² s å’Œ t çš„å­—æ¯å‡ºç°é¢‘æ¬¡ç»Ÿè®¡å‡ºæ¥ï¼Œè‹¥ä¸¤ä¸ªå­—ç¬¦ä¸²çš„å­—æ¯é¢‘æ¬¡å®Œå…¨ç›¸åŒï¼Œåˆ™å®ƒä»¬æ˜¯å­—æ¯å¼‚ä½è¯ã€‚\nâ€¢\té€šè¿‡ä½¿ç”¨å“ˆå¸Œè¡¨æˆ–æ•°ç»„å­˜å‚¨å­—æ¯çš„é¢‘ç‡ã€‚\n\n\nâœ… JavaScript å®ç°ï¼švar isAnagram = function (s, t) &#123;    if (s.length !== t.length) return false;        const count = new Array(26).fill(0);        for (let i = 0; i &lt; s.length; i++) &#123;        count[s.charCodeAt(i) - &#x27;a&#x27;.charCodeAt(0)]++;        count[t.charCodeAt(i) - &#x27;a&#x27;.charCodeAt(0)]--;    &#125;        for (let i = 0; i &lt; 26; i++) &#123;        if (count[i] !== 0) return false;    &#125;        return true;&#125;;\n\n\n\n\nğŸ§  æ€è€ƒæ‹“å±•ï¼šâ€¢\tå­—æ¯å¼‚ä½è¯é—®é¢˜çš„ä¼˜åŒ–ï¼šå¦‚ä½•å‡å°‘ä¸å¿…è¦çš„æ¯”è¾ƒï¼Œæå‡ç®—æ³•æ•ˆç‡ï¼Ÿ\nâ€¢\tå¯¹æ¯”å…¶ä»–å­—ç¬¦ä¸²ç›¸å…³çš„é¢˜ç›®ï¼Œæ¯”å¦‚ 387. First Unique Character in a Stringã€‚\n\n\n","categories":["ç®—æ³•"]},{"title":"Day5-Objective-C Runtime åŸºç¡€ç»“æ„","url":"/2025/04/28/Day5-Objective-C-Runtime-%E5%9F%BA%E7%A1%80%E7%BB%93%E6%9E%84/","content":"Objective-C Runtime åŸºç¡€ç»“æ„Objective-C è¿è¡Œæ—¶ç³»ç»Ÿï¼ˆRuntimeï¼‰æ˜¯ Objective-C è¯­è¨€çš„æ ¸å¿ƒéƒ¨åˆ†ï¼Œå®ƒåœ¨ç¨‹åºè¿è¡ŒæœŸé—´è´Ÿè´£ç®¡ç†ç±»ã€å¯¹è±¡ã€æ–¹æ³•è°ƒç”¨ç­‰è¡Œä¸ºã€‚\nä¸»è¦çš„ç»“æ„ä½“å’Œç»„ä»¶åŒ…æ‹¬ï¼š\n1. objc_classï¼ˆç±»ç»“æ„ä½“ï¼‰struct objc_class &#123;    Class isa;                // æŒ‡å‘å…ƒç±»    Class super_class;        // çˆ¶ç±»    const char *name;         // ç±»å    long version;             // ç‰ˆæœ¬ä¿¡æ¯    long info;                // ç±»ä¿¡æ¯æ ‡å¿—    long instance_size;       // ç±»å®ä¾‹çš„å¤§å°    struct objc_ivar_list *ivars;    // æˆå‘˜å˜é‡åˆ—è¡¨    struct objc_method_list **methodLists; // æ–¹æ³•åˆ—è¡¨ï¼ˆæ•°ç»„ï¼‰    struct objc_cache *cache; // æ–¹æ³•ç¼“å­˜    struct objc_protocol_list *protocols; // åè®®åˆ—è¡¨&#125;;\n\næ³¨æ„ï¼šç°ä»£ Runtime ä¸­ï¼Œç»“æ„ä½“å·²ç»å˜åŒ–äº†ï¼Œä¸Šè¿°æ˜¯ç»å…¸ï¼ˆæ—©æœŸï¼‰çš„æè¿°ï¼Œæ–°çš„ç‰ˆæœ¬æ›´å¤æ‚ä¸”é«˜åº¦å°è£…ã€‚\n\n\n2. objc_objectï¼ˆå¯¹è±¡ç»“æ„ä½“ï¼‰struct objc_object &#123;    Class isa;  // æŒ‡å‘å¯¹è±¡æ‰€å±çš„ç±»&#125;;\n\næ¯ä¸€ä¸ªå¯¹è±¡åº•å±‚å…¶å®å°±æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œæœ€é‡è¦çš„æˆå‘˜å°±æ˜¯ isaã€‚\nisa æ—¢å¯ä»¥æŒ‡å‘ Classï¼Œä¹Ÿå¯ä»¥æŒ‡å‘ Meta-Classï¼ˆå…ƒç±»ï¼‰ã€‚\n\n\n3. objc_methodï¼ˆæ–¹æ³•ç»“æ„ä½“ï¼‰struct objc_method &#123;    SEL name;      // æ–¹æ³•é€‰æ‹©å™¨ï¼ˆSelectorï¼‰    char *types;   // æ–¹æ³•çš„å‚æ•°å’Œè¿”å›å€¼ç±»å‹ç¼–ç     IMP imp;       // æ–¹æ³•å®ç°çš„å‡½æ•°æŒ‡é’ˆ&#125;;\n\nSEL æ˜¯æ–¹æ³•åçš„å”¯ä¸€æ ‡è¯†ã€‚\nIMP æ˜¯å‡½æ•°æŒ‡é’ˆï¼Œæœ¬è´¨ä¸Šå°±æ˜¯ C å‡½æ•°çš„åœ°å€ã€‚\n\n\n4. objc_ivarï¼ˆæˆå‘˜å˜é‡ç»“æ„ä½“ï¼‰struct objc_ivar &#123;    char *name;        // å˜é‡å    char *typeEncoding; // ç±»å‹ç¼–ç     int offset;         // å˜é‡åœ¨å¯¹è±¡å†…å­˜ä¸­çš„åç§»é‡&#125;;\n\næˆå‘˜å˜é‡çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬åå­—ã€ç±»å‹å’Œå†…å­˜ä½ç½®ã€‚\n\n\n5. objc_propertyï¼ˆå±æ€§ç»“æ„ä½“ï¼‰åœ¨ç°ä»£ Runtime é‡Œé¢ï¼Œå±æ€§ä¹Ÿæœ‰è‡ªå·±çš„ç»“æ„ï¼š\ntypedef struct &#123;    const char *name;            // å±æ€§å    const char *attributes;      // å±æ€§ä¿®é¥°åˆ—è¡¨ï¼ˆä¾‹å¦‚ï¼šT@&quot;NSString&quot;,C,N,V_nameï¼‰&#125; objc_property_t;\n\nå±æ€§å…¶å®æ˜¯æˆå‘˜å˜é‡ + ä¸€äº›ç‰¹å®šç‰¹æ€§ï¼ˆgetter&#x2F;setterè§„åˆ™ï¼‰ã€‚\n\n\nå°æ€»ç»“\n\n\nç»„ä»¶\nä½œç”¨\n\n\n\nobjc_object\næ‰€æœ‰å¯¹è±¡çš„åŸºç¡€\n\n\nobjc_class\nç±»å¯¹è±¡æè¿°ç»“æ„\n\n\nobjc_method\næ–¹æ³•çš„å®šä¹‰\n\n\nobjc_ivar\næˆå‘˜å˜é‡å®šä¹‰\n\n\nobjc_property\nå±æ€§å®šä¹‰\n\n\n\nè¿›é˜¶è¡¥å……åœ¨ ç°ä»£ Objective-C Runtimeï¼ˆå¦‚ iOS 14+ï¼‰ï¼Œè¿™äº›ç»“æ„ä½“å®é™…ä¸Šè¢«è¿›ä¸€æ­¥å°è£…ä¼˜åŒ–ï¼Œæ¯”å¦‚ï¼š\n\nç±»ä½¿ç”¨ objc_class å’Œ objc_data_bits_tï¼ˆè”åˆä½“ï¼‰åˆ†ç¦»äº†ç¼“å­˜ã€åªè¯»æ•°æ®ç­‰ã€‚\nmethodList ä¹Ÿä½¿ç”¨æ›´ç´§å‡‘çš„é“¾è¡¨å­˜å‚¨ã€‚\nisa æŒ‡é’ˆé€šè¿‡ isa æŒ‡é’ˆä¼˜åŒ–ï¼ˆISAæŒ‡é’ˆæ‰“åŒ…ï¼‰ åŒ…å«äº†æ›´å¤šä¿¡æ¯ï¼Œæ¯”å¦‚å¼•ç”¨è®¡æ•°ã€æ˜¯å¦æœ‰C++ææ„å‡½æ•°ç­‰ã€‚\n\n\nç°ä»£ Objective-C Runtime çš„ä¼˜åŒ–\n\nobjc_class å’Œ objc_data_bits_t çš„åˆ†ç¦»\n\næ—©æœŸï¼ˆä¼ ç»Ÿï¼‰çš„ç»“æ„ï¼š\nåœ¨æ—©æœŸçš„ Objective-C Runtime ä¸­ï¼Œç±»å¯¹è±¡ï¼ˆobjc_classï¼‰åŒ…å«äº†æ‰€æœ‰å…³äºç±»çš„æè¿°ä¿¡æ¯ï¼ŒåŒ…æ‹¬ï¼š\n\nisa æŒ‡é’ˆï¼ˆæŒ‡å‘å…ƒç±»ï¼‰\nsuper_classï¼ˆçˆ¶ç±»æŒ‡é’ˆï¼‰\næˆå‘˜å˜é‡ã€æ–¹æ³•åˆ—è¡¨ã€å±æ€§ç­‰\n\nè¿™ç§ç»“æ„è™½ç„¶ç®€å•ï¼Œä½†éšç€ iOS è®¾å¤‡æ€§èƒ½çš„æé«˜ï¼Œè¿è¡Œæ—¶ç³»ç»Ÿä¹Ÿéœ€è¦å¯¹è¿™äº›æ•°æ®ç»“æ„è¿›è¡Œä¼˜åŒ–ã€‚\nç°ä»£ä¼˜åŒ–ï¼š\nåœ¨ iOS 14 åŠä¹‹åçš„ç‰ˆæœ¬ä¸­ï¼ŒObjective-C Runtime é€šè¿‡ åˆ†ç¦» ç±»çš„å„ä¸ªç»„æˆéƒ¨åˆ†ï¼Œæé«˜äº†æ€§èƒ½å’Œå†…å­˜æ•ˆç‡ã€‚\nobjc_class ç°åœ¨ä¸»è¦åŒ…å« å…ƒç±»çš„å¼•ç”¨ï¼Œè€Œå…¶å®ƒæ•°æ®ï¼ˆå¦‚æ–¹æ³•åˆ—è¡¨ã€å±æ€§ã€æˆå‘˜å˜é‡ç­‰ï¼‰è¢«ç§»åˆ°äº† objc_data_bits_t ç»“æ„ä¸­ã€‚è¿™ç§æ–¹å¼çš„å¥½å¤„æ˜¯ï¼š\n\nç¼“å­˜å‹å¥½ï¼šç±»çš„å…ƒæ•°æ®å¯ä»¥è¢«å­˜å‚¨åœ¨å†…å­˜çš„ç´§å‡‘åŒºåŸŸï¼Œæé«˜äº†ç¼“å­˜å‘½ä¸­ç‡ã€‚\nåˆ†ç¦»å­˜å‚¨ï¼šç±»æ•°æ®å’Œæ–¹æ³•æ•°æ®åˆ†å¼€å­˜å‚¨ï¼Œé¿å…äº†å†—ä½™çš„å†…å­˜å ç”¨ã€‚\nå¢å¼ºçš„çµæ´»æ€§ï¼šå¯ä»¥åœ¨ä¸åŒçš„ç¡¬ä»¶æ¶æ„ä¸‹å¯¹è¿™äº›æ•°æ®è¿›è¡Œä¸åŒçš„å¸ƒå±€ï¼Œä»¥ä¾¿æ›´å¥½åœ°é€‚é…ä¸åŒçš„å†…å­˜å’Œå¤„ç†å™¨ç‰¹æ€§ã€‚\n\nä¾‹å­ï¼š\nobjc_class ç»“æ„å˜å¾—éå¸¸ç®€æ´ï¼š\nstruct objc_class &#123;    Class isa;                // æŒ‡å‘å…ƒç±»    Class super_class;        // çˆ¶ç±»    const char *name;         // ç±»å    ...    objc_data_bits_t data;    // ç±»çš„å…¶å®ƒå…ƒæ•°æ®ï¼Œå¦‚æ–¹æ³•ã€å±æ€§ã€ç¼“å­˜ç­‰&#125;;\n\nè€Œ objc_data_bits_t åˆ™åŒ…å«äº†å®é™…çš„æ•°æ®éƒ¨åˆ†ï¼š\nunion objc_data_bits_t &#123;    struct &#123;        method_list_t *methodList;   // æ–¹æ³•åˆ—è¡¨        ivar_list_t *ivarList;       // æˆå‘˜å˜é‡åˆ—è¡¨        property_list_t *propertyList; // å±æ€§åˆ—è¡¨        cache_t cache;               // æ–¹æ³•ç¼“å­˜    &#125;;    uintptr_t raw; // åŸå§‹å†…å­˜è¡¨ç¤º&#125;;\n\n\n\n\nmethodList å­˜å‚¨çš„ä¼˜åŒ–\n\næ—©æœŸå­˜å‚¨ï¼š\nä¼ ç»Ÿçš„ methodList æ˜¯åŸºäºé“¾è¡¨ï¼ˆLinked Listï¼‰å­˜å‚¨çš„ã€‚è¿™ç§æ–¹å¼è™½ç„¶ç®€å•ï¼Œä½†æŸ¥æ‰¾æ–¹æ³•æ—¶æ•ˆç‡è¾ƒä½ï¼Œå°¤å…¶æ˜¯åœ¨ç±»å±‚çº§å¾ˆæ·±æˆ–è€…æ–¹æ³•å¾ˆå¤šçš„æƒ…å†µä¸‹ã€‚\nç°ä»£ä¼˜åŒ–ï¼š\nåœ¨ç°ä»£çš„ Runtime ç³»ç»Ÿä¸­ï¼ŒmethodList ä¸å†æ˜¯å•çº¯çš„é“¾è¡¨ã€‚å®ƒç°åœ¨é‡‡ç”¨äº†ä¸€ç§ ç´§å‡‘çš„é“¾è¡¨ç»“æ„ï¼Œå¹¶ä¸”ç»“åˆäº† å“ˆå¸Œè¡¨ï¼ˆHash Tableï¼‰ æˆ–è€… äºŒå‰æœç´¢æ ‘ï¼ˆBinary Search Treeï¼‰ï¼Œå¤§å¤§æé«˜äº†æ–¹æ³•æŸ¥æ‰¾çš„æ•ˆç‡ã€‚\n\nå“ˆå¸Œè¡¨ï¼šé€šè¿‡å“ˆå¸Œå€¼æ¥å­˜å‚¨æ–¹æ³•ï¼ŒæŸ¥æ‰¾æ“ä½œæ—¶é—´å¤æ‚åº¦ä¸º O(1)ã€‚\näºŒå‰æœç´¢æ ‘ï¼šå¦‚æœæ–¹æ³•åˆ—è¡¨è¾ƒå¤§ï¼Œå¯èƒ½ä½¿ç”¨æ ‘ç»“æ„æ¥æé«˜æŸ¥æ‰¾æ€§èƒ½ï¼ˆç‰¹åˆ«æ˜¯æ–¹æ³•åæ’åºåï¼‰ã€‚\n\nè¿™ç§ä¼˜åŒ–ä½¿å¾—å¯¹äºé¢‘ç¹è°ƒç”¨çš„æ–¹æ³•ï¼Œèƒ½å¤Ÿä»¥æ›´é«˜çš„æ•ˆç‡è¿›è¡ŒæŸ¥æ‰¾ã€‚\nä¼˜åŒ–çš„å¥½å¤„ï¼š\n\næ–¹æ³•æŸ¥æ‰¾é€Ÿåº¦æ›´å¿«ã€‚\né™ä½äº†å†…å­˜å ç”¨ï¼Œå°¤å…¶åœ¨æ–¹æ³•å¾ˆå¤šçš„ç±»ä¸­è¡¨ç°å°¤ä¸ºçªå‡ºã€‚\n\n\nisa æŒ‡é’ˆä¼˜åŒ–ï¼ˆISAæŒ‡é’ˆæ‰“åŒ…ï¼‰\n\næ—©æœŸ isa æŒ‡é’ˆï¼š\næ—©æœŸçš„ isa æŒ‡é’ˆå®é™…ä¸Šæ˜¯ä¸€ä¸ªå•çº¯çš„æŒ‡é’ˆï¼Œå®ƒæŒ‡å‘å½“å‰å¯¹è±¡æ‰€å±çš„ç±»ã€‚å½“æˆ‘ä»¬éœ€è¦åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡çš„ç±»å‹æ—¶ï¼Œå¿…é¡»é€šè¿‡è¿™ä¸ªæŒ‡é’ˆè¿›è¡ŒæŸ¥æ‰¾ã€‚è¿™ä¸ªè¿‡ç¨‹è™½ç„¶æœ‰æ•ˆï¼Œä½†éšç€å†…å­˜å’Œå¤„ç†å™¨æ¶æ„çš„å˜åŒ–ï¼Œå…¶æ•ˆç‡å¹¶æ²¡æœ‰å¾—åˆ°æœ€ä¼˜çš„åˆ©ç”¨ã€‚\nç°ä»£ä¼˜åŒ–ï¼š\niOS 14 åŠä¹‹åçš„ç‰ˆæœ¬å¼•å…¥äº† ISA æŒ‡é’ˆæ‰“åŒ…ï¼ˆISA pointer packingï¼‰ çš„æ¦‚å¿µï¼Œä½¿å¾— isa æŒ‡é’ˆå˜å¾—æ›´åŠ é«˜æ•ˆã€‚å…·ä½“æ¥è¯´ï¼š\n\nå‹ç¼©æŒ‡é’ˆï¼šisa ä¸ä»…ä»…æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œå®ƒåŒ…å«äº†æ›´å¤šçš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬ï¼š\nå¼•ç”¨è®¡æ•°ï¼šå¯ä»¥é€šè¿‡ isa å­—æ®µç›´æ¥è·å–å¯¹è±¡çš„å¼•ç”¨è®¡æ•°ï¼ˆè€Œä¸éœ€è¦é¢å¤–çš„å­—æ®µï¼‰ã€‚\nC++ ææ„å‡½æ•°æ”¯æŒï¼šå¯¹äº C++ å¯¹è±¡ï¼Œisa å¯ä»¥åŒ…å«ä¸€ä¸ªæ ‡è®°ï¼Œè¡¨æ˜è¯¥å¯¹è±¡æ˜¯å¦æœ‰ C++ ææ„å‡½æ•°éœ€è¦è°ƒç”¨ã€‚\næŒ‡é’ˆå‹ç¼©ï¼šé’ˆå¯¹ 64 ä½è®¾å¤‡ï¼ŒæŒ‡é’ˆå·²ç»è¢«å‹ç¼©ï¼ŒèŠ‚çœäº†å†…å­˜ç©ºé—´ã€‚\næŒ‡é’ˆå¸ƒå±€ï¼šé€šè¿‡ä¼˜åŒ–æŒ‡é’ˆçš„å¸ƒå±€ï¼Œå¯ä»¥å‡å°‘å†…å­˜è®¿é—®çš„å»¶è¿Ÿã€‚ä¾‹å¦‚ï¼Œå°†å¸¸ç”¨çš„æ ‡è®°å’Œä¿¡æ¯æ”¾åœ¨ isa ä¸­ï¼Œå‡å°‘äº†ç¼“å­˜ç¼ºå¤±çš„æ¦‚ç‡ã€‚\n\nç»“æ„å˜åŒ–ï¼š\nstruct objc_object &#123;    Class isa;   // å‹ç¼©åçš„ isa æŒ‡é’ˆï¼ŒåŒ…å«æ›´å¤šä¿¡æ¯&#125;;\n\nè¿™ç§ä¼˜åŒ–ä½¿å¾—ï¼š\tâ€¢\tå†…å­˜ä½¿ç”¨ï¼šå‡å°‘äº†å†…å­˜å ç”¨ã€‚\tâ€¢\tæ•ˆç‡æå‡ï¼šè®¿é—®å¯¹è±¡æ‰€å±ç±»æ—¶çš„æ•ˆç‡å¤§å¹…æé«˜ã€‚\n\næ€»ç»“\nåœ¨ç°ä»£ Objective-C Runtime ä¸­ï¼Œç»“æ„ä½“çš„ä¼˜åŒ–å’ŒæŒ‡é’ˆçš„æ‰“åŒ…å¤§å¤§æå‡äº†ç³»ç»Ÿçš„æ€§èƒ½ï¼Œå°¤å…¶æ˜¯åœ¨å†…å­˜å ç”¨å’Œæ–¹æ³•æŸ¥æ‰¾é€Ÿåº¦ä¸Šã€‚é‡ç‚¹ä¼˜åŒ–å¦‚ä¸‹ï¼š\tâ€¢\tobjc_class å’Œ objc_data_bits_t çš„åˆ†ç¦»ï¼šæé«˜äº†å†…å­˜å¸ƒå±€çš„ç´§å‡‘æ€§å’Œæ•ˆç‡ã€‚\tâ€¢\tmethodList çš„ä¼˜åŒ–ï¼šç»“åˆå“ˆå¸Œè¡¨å’ŒäºŒå‰æœç´¢æ ‘ï¼Œæé«˜äº†æ–¹æ³•æŸ¥æ‰¾çš„æ•ˆç‡ã€‚\tâ€¢\tisa æŒ‡é’ˆä¼˜åŒ–ï¼šé€šè¿‡æŒ‡é’ˆæ‰“åŒ…ï¼Œå‡å°‘äº†å†…å­˜å ç”¨ï¼Œå¹¶åŠ é€Ÿäº†å¯¹è±¡çš„ç±»å‹æŸ¥æ‰¾å’Œå¼•ç”¨è®¡æ•°ç®¡ç†ã€‚\nè¿™äº›æ”¹è¿›çš„æ ¸å¿ƒç›®çš„æ˜¯ï¼šæå‡æ€§èƒ½ã€å‡å°‘å†…å­˜å ç”¨ï¼Œç‰¹åˆ«æ˜¯åœ¨ iOS è®¾å¤‡ä¸Šï¼Œç¡®ä¿è¿è¡Œæ—¶ç³»ç»Ÿèƒ½å¤Ÿåœ¨æœ‰é™çš„ç¡¬ä»¶èµ„æºä¸Šé«˜æ•ˆè¿è¡Œã€‚\n\n","categories":["åŸºç¡€"]},{"title":"Day5-ä¸¤æ•°ä¹‹å’Œ II - è¾“å…¥æœ‰åºæ•°ç»„","url":"/2025/04/28/Day5-%E4%B8%A4%E6%95%B0%E4%B9%8B%E5%92%8C-II-%E8%BE%93%E5%85%A5%E6%9C%89%E5%BA%8F%E6%95%B0%E7%BB%84/","content":"ğŸ”— LeetCode 167 - Two Sum II - Input Array Is Sorted\nğŸ“Œ é¢˜ç›®æè¿°ç»™å®šä¸€ä¸ªå·²æŒ‰å‡åºæ’åˆ—çš„æ•´æ•°æ•°ç»„ numbers å’Œä¸€ä¸ªç›®æ ‡å€¼ targetï¼Œè¯·ä½ åœ¨æ•°ç»„ä¸­æ‰¾å‡ºä¸¤ä¸ªæ•°ï¼Œä½¿å¾—å®ƒä»¬çš„å’Œä¸ºç›®æ ‡å€¼ targetï¼Œå¹¶è¿”å›è¿™ä¸¤ä¸ªæ•°çš„ä¸‹æ ‡ã€‚\næ³¨æ„ï¼š  \n\nè¿”å›çš„ç­”æ¡ˆæ˜¯ä¸€ä¸ª 1 ç´¢å¼•çš„æ•°ç»„ã€‚\nå‡è®¾æ¯ä¸ªè¾“å…¥åªå¯¹åº”ä¸€ä¸ªç­”æ¡ˆï¼Œä¸”ä½ ä¸å¯ä»¥é‡å¤ä½¿ç”¨æ•°ç»„ä¸­çš„å…ƒç´ ã€‚\n\n\nğŸ’¡ è§£é¢˜æ€è·¯\nç”±äºæ•°ç»„å·²æ’åºï¼Œå¯ä»¥ä½¿ç”¨åŒæŒ‡é’ˆæ³•ï¼š\n\nåˆå§‹åŒ–ä¸¤ä¸ªæŒ‡é’ˆï¼Œä¸€ä¸ªæŒ‡å‘æ•°ç»„çš„å¼€å¤´ï¼Œä¸€ä¸ªæŒ‡å‘æ•°ç»„çš„æœ«å°¾ã€‚\nå¦‚æœä¸¤æŒ‡é’ˆæŒ‡å‘çš„å…ƒç´ ä¹‹å’Œç­‰äºç›®æ ‡å€¼ï¼Œè¿”å›è¿™ä¸¤ä¸ªæŒ‡é’ˆçš„ä¸‹æ ‡ï¼›\nå¦‚æœå’Œå°äºç›®æ ‡å€¼ï¼Œè¯´æ˜éœ€è¦å¢å¤§å’Œï¼Œå·¦æŒ‡é’ˆå³ç§»ï¼›\nå¦‚æœå’Œå¤§äºç›®æ ‡å€¼ï¼Œè¯´æ˜éœ€è¦å‡å°å’Œï¼Œå³æŒ‡é’ˆå·¦ç§»ã€‚\n\n\nè¿™ç§æ–¹æ³•æ—¶é—´å¤æ‚åº¦æ˜¯ O(n)ï¼Œæ•ˆç‡è¾ƒé«˜ã€‚\n\n\n\nâœ… JavaScript å®ç°var twoSum = function (numbers, target) &#123;    let left = 0;    let right = numbers.length - 1;        while (left &lt; right) &#123;        const sum = numbers[left] + numbers[right];        if (sum === target) &#123;            return [left + 1, right + 1];  // æ³¨æ„è¿”å›çš„ä¸‹æ ‡æ˜¯ä» 1 å¼€å§‹çš„        &#125; else if (sum &lt; target) &#123;            left++;        &#125; else &#123;            right--;        &#125;    &#125;&#125;;\n\n\nğŸ§  æ€è€ƒæ‹“å±•\nå¦‚æœæ•°ç»„ä¸æ˜¯æœ‰åºçš„ï¼Œå¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜ï¼Ÿ\næœ¬é¢˜å’Œ LeetCode 1. Two Sum çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿå®ƒæ˜¯å¦‚ä½•åˆ©ç”¨æ’åºä¼˜åŒ–è§£æ³•çš„ï¼Ÿ\n\n\n","categories":["ç®—æ³•"]},{"title":"Day6-Runtime å®æˆ˜æŠ€å·§","url":"/2025/04/29/Day6-Runtime-%E5%AE%9E%E6%88%98%E6%8A%80%E5%B7%A7/","content":"ä¸€ã€å®šä¹‰Runtime æ˜¯ä»€ä¹ˆï¼Ÿ\n\nObjective-C çš„ Runtime å®é™…ä¸Šæ˜¯ C è¯­è¨€çš„ä¸€å¥—å‡½æ•°å’Œç±»åº“ï¼Œç”¨äºæ”¯æŒ Objective-C ç¼–ç¨‹è¯­è¨€çš„åŠ¨æ€æ€§ï¼ŒåŒ…æ‹¬ç±»çš„åˆ›å»ºã€æ–¹æ³•è°ƒç”¨ã€å±æ€§è®¿é—®ç­‰ã€‚\n\n\näºŒã€Runtime å®æˆ˜æŠ€å·§1.Method Swizzlingï¼ˆæ–¹æ³•äº¤æ¢ï¼‰1. ä»€ä¹ˆæ˜¯ Method Swizzlingï¼Ÿ\nå®šä¹‰ï¼šåœ¨ç¨‹åºè¿è¡Œæ—¶ï¼Œäº¤æ¢ä¸¤ä¸ªæ–¹æ³•å®ç°çš„è¿‡ç¨‹ã€‚\næœ¬è´¨ï¼šä¿®æ”¹æ–¹æ³•å¯¹åº”çš„ IMPï¼ˆæŒ‡å‘å‡½æ•°å®ç°çš„æŒ‡é’ˆï¼‰ã€‚\nå¸¸ç”¨åœºæ™¯ï¼š\nç»™ç³»ç»Ÿæ–¹æ³•åŠ åŠŸèƒ½\næ›¿æ¢ç³»ç»Ÿæ–¹æ³•è¡Œä¸º\nAOP\n\n\n\n2. å¦‚ä½•å®ç° Swizzlingï¼Ÿå¸¸ç”¨ APIï¼š\nMethod class_getInstanceMethod(Class cls, SEL name);void method_exchangeImplementations(Method m1, Method m2);\n\nä»£ç ç¤ºä¾‹ï¼š\n@implementation UIViewController (Swizzling)+ (void)load &#123;    static dispatch_once_t onceToken;    dispatch_once(&amp;onceToken, ^&#123;        Method originalMethod = class_getInstanceMethod(self, @selector(viewWillAppear:));        Method swizzledMethod = class_getInstanceMethod(self, @selector(my_viewWillAppear:));        method_exchangeImplementations(originalMethod, swizzledMethod);    &#125;);&#125;- (void)my_viewWillAppear:(BOOL)animated &#123;    NSLog(@&quot;é¡µé¢å°†è¦å‡ºç°ï¼š%@&quot;, self);    [self my_viewWillAppear:animated];&#125;@end\n\n3. æ³¨æ„äº‹é¡¹\n+load å’Œ dispatch_once ä¿è¯åªæ‰§è¡Œä¸€æ¬¡ã€‚\nç¡®ä¿æ–¹æ³•å­˜åœ¨ï¼Œé¿å…å¼•èµ·ç¨‹åºå´©æºƒã€‚\næ³¨æ„ç»§æ‰¿å…³ç³»å’Œå­ç±»è¦†ç›–é—®é¢˜ã€‚\n\n\n2.æ¶ˆæ¯è½¬å‘æœºåˆ¶1. ä»€ä¹ˆæ˜¯æ¶ˆæ¯è½¬å‘ï¼Ÿ\nå½“å¯¹è±¡æ”¶åˆ°æ— æ³•å“åº”çš„æ¶ˆæ¯ï¼Œæœ‰ä¸‰æ¬¡æœºä¼šå¤„ç†ï¼š\nåŠ¨æ€æ–¹æ³•è§£æï¼ˆresolveInstanceMethod:ï¼‰\nå¤‡ç”¨æ¥æ”¶è€…ï¼ˆforwardingTargetForSelector:ï¼‰\nå®Œæ•´æ¶ˆæ¯è½¬å‘ï¼ˆforwardInvocation:ï¼‰\n\n\n\n2. è¯¦ç»†æµç¨‹ï¼ˆï¼‘ï¼‰åŠ¨æ€æ–¹æ³•è§£æ+ (BOOL)resolveInstanceMethod:(SEL)sel\nç¤ºä¾‹ï¼š\n+ (BOOL)resolveInstanceMethod:(SEL)sel &#123;    if (sel == @selector(run)) &#123;        class_addMethod(self, sel, (IMP)runFunction, &quot;v@:&quot;);        return YES;    &#125;    return [super resolveInstanceMethod:sel];&#125;\n\nï¼ˆï¼’ï¼‰å¿«é€Ÿè½¬å‘- (id)forwardingTargetForSelector:(SEL)aSelector\nç¤ºä¾‹ï¼š\n- (id)forwardingTargetForSelector:(SEL)aSelector &#123;    if (aSelector == @selector(run)) &#123;        return self.delegate;    &#125;    return [super forwardingTargetForSelector:aSelector];&#125;\n\nï¼ˆï¼“ï¼‰å®Œæ•´æ¶ˆæ¯è½¬å‘- (NSMethodSignature *)methodSignatureForSelector:(SEL)aSelector- (void)forwardInvocation:(NSInvocation *)anInvocation\nç¤ºä¾‹ï¼š\n- (NSMethodSignature *)methodSignatureForSelector:(SEL)aSelector &#123;    if (aSelector == @selector(run)) &#123;        return [NSMethodSignature signatureWithObjCTypes:&quot;v@:&quot;];    &#125;    return [super methodSignatureForSelector:aSelector];&#125;- (void)forwardInvocation:(NSInvocation *)anInvocation &#123;    SEL sel = [anInvocation selector];    if ([self.delegate respondsToSelector:sel]) &#123;        [anInvocation invokeWithTarget:self.delegate];    &#125; else &#123;        [super forwardInvocation:anInvocation];    &#125;&#125;\n\n3. å…³è”å¯¹è±¡ (Associated Objects)å®šä¹‰ï¼šåœ¨ä¸æ”¹åŠ¨åŸç±»çš„åŸºç¡€ä¸Šï¼Œç»™åˆ†ç±»ã€æ‰©å±•ç±»å¢åŠ å®ä½“å±æ€§ã€‚\nå¸¸ç”¨ APIï¼š\n\nobjc_setAssociatedObject\nobjc_getAssociatedObject\n\nåº”ç”¨åœºæ™¯ï¼š\n\nUIButton å¢åŠ é˜²é‡å¤ç‚¹å‡»æ—¶é—´é—´éš”\n\n4. åŠ¨æ€ç”Ÿæˆç±»å’Œæ–¹æ³•å¸¸ç”¨ APIï¼š\n\nobjc_allocateClassPair\nclass_addMethod\n\nåº”ç”¨åœºæ™¯ï¼š\n\nKVO å†…éƒ¨åŸç†ï¼ˆåˆ›å»ºå­ç±»ï¼‰\nORMæ¡†æ¶è‡ªåŠ¨ç”Ÿæˆå¯¹åº”å±æ€§\n\n5. å®Œå…¨è‡ªåŠ¨ NSCoding å®Œæˆæ€è·¯ï¼šé€šè¿‡ Runtime éå† ivarï¼Œè‡ªåŠ¨ encode&#x2F;decodeï¼Œæ— éœ€æ‰‹å†™ä»£ç ã€‚\nåº”ç”¨åœºæ™¯ï¼š\n\nModel æŒä¹…åŒ–\nç®€åŒ–ç”¨æˆ·æ•°æ®å¤„ç†\n\n6. å®ç°å®‰å…¨é˜²æŠ¤ï¼ˆé˜² Crashï¼‰æ€è·¯ï¼šæ›´æ¢ NSArray, NSDictionary, NSString ç­‰ç±»çš„æ–¹æ³•ï¼Œé˜²æ­¢è·¯å¾„é”™è¯¯ã€ç´¢å¼•è¶Šç•Œç­‰ crashã€‚\nåº”ç”¨åœºæ™¯ï¼š\n\nå®‰å…¨æ€§æ¡†æ¶ SafeKit\né¡¹ç›®å®‰å…¨çº§åˆ«æå‡\n\n7. æ•°æ®æ¨¡å‹å®ä½“åŒ–ï¼ˆå®Œå…¨è‡ªåŠ¨åŒ–ç­‰ï¼‰æ€è·¯ï¼šé€šè¿‡ property åˆ—è¡¨ï¼Œæ ¹æ® key-value å°† JSON è½¬ä¸º Modelï¼Œæˆ–åè½¬ã€‚\nåº”ç”¨åœºæ™¯ï¼š\n\nYYModel\nMJExtension\n\n8. æ–¹æ³•æ›¿æ¢ IMPåº”ç”¨ï¼š\n\nhook ç³»ç»Ÿæ–¹æ³•ï¼Œå¹¶åŠ è‡ªå·±é€»è¾‘\næ§åˆ¶æ–¹æ³•æ‰§è¡Œæµç¨‹\n\nç¤ºä¾‹ï¼š\n\nåœ¨ App è¿›å…¥å‰åå°æ—¶ï¼Œç»Ÿä¸€ç®¡ç†å°è£…\n\n9. é«˜çº§æ¶ˆæ¯è½¬å‘ (NSProxy)åº”ç”¨ï¼š\n\nå¼±ä»£ç†ï¼ˆé¿å…å¾ªç¯å¼•ç”¨ã€Timer æ³„æ¼ï¼‰\nå¤šä»£ç†åŒæ­¥åˆ†å‘\næ€§èƒ½å¼ºåŒ–\n\n\nä¸‰ã€å®æˆ˜æ¡ˆä¾‹æ¡ˆä¾‹1ï¼šé˜²æ­¢ UIButton é‡å¤ç‚¹å‡»èƒŒæ™¯\n\nUIButton è¿ç»­ç‚¹å‡»å®¹æ˜“é€ æˆæ¥å£é‡å¤è¯·æ±‚ã€‚\næƒ³ç»™æ‰€æœ‰ UIButton åŠ é˜²æŠ–ï¼Œä¸æ”¹åŠ¨ç°æœ‰ä¸šåŠ¡ä»£ç ã€‚\n\n\næ€è·¯\nç”¨ Method Swizzlingï¼Œæ›¿æ¢ sendAction:to:forEvent: æ–¹æ³•ï¼Œåœ¨é‡Œé¢åŠ èŠ‚æµé€»è¾‘ã€‚\n\nä»£ç ç¤ºä¾‹\nUIButton+AntiRepeat.h\n#import &lt;UIKit/UIKit.h&gt;@interface UIButton (AntiRepeat)@property (nonatomic, assign) NSTimeInterval eventInterval; // ç‚¹å‡»é—´éš”@property (nonatomic, assign) NSTimeInterval lastEventTime; // ä¸Šæ¬¡ç‚¹å‡»æ—¶é—´@end\nUIButton+AntiRepeat.m\n#import &quot;UIButton+AntiRepeat.h&quot;#import &lt;objc/runtime.h&gt;@implementation UIButton (AntiRepeat)+ (void)load &#123;    static dispatch_once_t onceToken;    dispatch_once(&amp;onceToken, ^&#123;        Method original = class_getInstanceMethod(self, @selector(sendAction:to:forEvent:));        Method swizzled = class_getInstanceMethod(self, @selector(my_sendAction:to:forEvent:));        method_exchangeImplementations(original, swizzled);    &#125;);&#125;// å…³è”å¯¹è±¡ eventInterval- (NSTimeInterval)eventInterval &#123;    return [objc_getAssociatedObject(self, _cmd) doubleValue];&#125;- (void)setEventInterval:(NSTimeInterval)eventInterval &#123;    objc_setAssociatedObject(self, @selector(eventInterval), @(eventInterval), OBJC_ASSOCIATION_RETAIN_NONATOMIC);&#125;// å…³è”å¯¹è±¡ lastEventTime- (NSTimeInterval)lastEventTime &#123;    return [objc_getAssociatedObject(self, _cmd) doubleValue];&#125;- (void)setLastEventTime:(NSTimeInterval)lastEventTime &#123;    objc_setAssociatedObject(self, @selector(lastEventTime), @(lastEventTime), OBJC_ASSOCIATION_RETAIN_NONATOMIC);&#125;// æ–°çš„æ–¹æ³•- (void)my_sendAction:(SEL)action to:(id)target forEvent:(UIEvent *)event &#123;    if (NSDate.date.timeIntervalSince1970 - self.lastEventTime &lt; self.eventInterval) &#123;        return; // ç‚¹å‡»é—´éš”å¤ªçŸ­ï¼Œå¿½ç•¥    &#125;    self.lastEventTime = NSDate.date.timeIntervalSince1970;    [self my_sendAction:action to:target forEvent:event];&#125;@end\n\n\n\nä½¿ç”¨\nUIButton *btn = [UIButton buttonWithType:UIButtonTypeSystem];btn.eventInterval = 1.0; // è®¾ç½® 1 ç§’å†…ä¸èƒ½é‡å¤ç‚¹å‡»\n\nè®²è§£è¦ç‚¹\n\nsendAction:to:forEvent: æ˜¯ UIButton å¤„ç†ç‚¹å‡»äº‹ä»¶çš„å…¥å£ã€‚\né€šè¿‡ Swizzlingï¼Œåœ¨ä¸æ”¹ä¸šåŠ¡ä»£ç çš„æƒ…å†µä¸‹ç»Ÿä¸€åŠ äº†é˜²æŠ–ã€‚\nä½¿ç”¨ objc_setAssociatedObject ç»™åˆ†ç±»åŠ¨æ€æ·»åŠ å±æ€§ï¼Œè®°å½•æœ€åä¸€æ¬¡ç‚¹å‡»æ—¶é—´ã€‚\n\næ¡ˆä¾‹2ï¼šç”¨ NSProxy å®ç°å¼±ä»£ç†ï¼ˆé˜²æ­¢ Timer å¾ªç¯å¼•ç”¨ï¼‰\nNSProxy ä½œä¸ºä¸­ä»‹\nå¼±æŒ target\n\nèƒŒæ™¯\n\nNSTimer é»˜è®¤å¼ºå¼•ç”¨ targetï¼Œå®¹æ˜“é€ æˆå†…å­˜æ³„æ¼ï¼ˆå¾ªç¯å¼•ç”¨ï¼‰ã€‚\n\n\næ€è·¯\nä½¿ç”¨ NSProxy ä¸­è½¬ï¼Œè®© Timer å¼±å¼•ç”¨çœŸæ­£çš„ targetã€‚\n\nä»£ç ç¤ºä¾‹\nTimerWeakProxy.h\n#import &lt;Foundation/Foundation.h&gt;@interface TimerWeakProxy : NSProxy+ (instancetype)proxyWithTarget:(id)target;@end\nTimerWeakProxy.m\n#import &quot;TimerWeakProxy.h&quot;@interface TimerWeakProxy ()@property (nonatomic, weak) id target;@end@implementation TimerWeakProxy+ (instancetype)proxyWithTarget:(id)target &#123;    TimerWeakProxy *proxy = [TimerWeakProxy alloc];    proxy.target = target;    return proxy;&#125;- (id)forwardingTargetForSelector:(SEL)selector &#123;    return self.target;&#125;- (void)forwardInvocation:(NSInvocation *)invocation &#123;    [invocation invokeWithTarget:self.target];&#125;- (NSMethodSignature *)methodSignatureForSelector:(SEL)sel &#123;    return [self.target methodSignatureForSelector:sel];&#125;@end\n\n\nä½¿ç”¨\nself.timer = [NSTimer scheduledTimerWithTimeInterval:1.0                                              target:[TimerWeakProxy proxyWithTarget:self]                                            selector:@selector(timerAction)                                            userInfo:nil                                             repeats:YES];\n\n\nè®²è§£è¦ç‚¹\n\nTimerWeakProxy æŒæœ‰ target çš„å¼±å¼•ç”¨ï¼Œé˜²æ­¢å¾ªç¯å¼•ç”¨ã€‚\nforwardingTargetForSelector: æä¾›å¿«é€Ÿæ¶ˆæ¯è½¬å‘ï¼Œæé«˜æ€§èƒ½ã€‚\n\næ¡ˆä¾‹3ï¼šè‡ªåŠ¨ JSON -&gt; Model æ˜ å°„\nåˆ©ç”¨ property åˆ—è¡¨éå†\né«˜æ•ˆæ–¹ä¾¿ï¼Œæ€§èƒ½å¥½\n\næ¡ˆä¾‹4ï¼šå®‰å…¨é˜²æŠ¤å¥—ä»¶\nNSArrayã€NSDictionary è¿›è¡Œæ–¹æ³•æ›¿æ¢ï¼Œé˜²æ­¢é”™è¯¯æ“ä½œ\n\n\nå››ã€å®Œæ•´æ€ç»´å›¾\n\n\næŠ€æœ¯\nä½œç”¨\nå…·ä½“åœºæ™¯\n\n\n\nMethod Swizzling\nä¿®æ”¹ç³»ç»Ÿæ–¹æ³•\nAOP æ‰“ç‚¹\n\n\næ¶ˆæ¯è½¬å‘\nåŠ¨æ€å¤„ç†æœªçŸ¥æ–¹æ³•\nå¼±ä»£ç†\n\n\nAssociated Object\næ‰©å±•åˆ†ç±»å±æ€§\nUIButton é˜²é‡ç‚¹\n\n\nè‡ªåŠ¨ NSCoding\nè‡ªåŠ¨åŒ–å­˜å‚¨è¿è´¯\nModel æŒä¹…åŒ–\n\n\nNSProxy\né«˜çº§è½¬å‘\nTimer å¼±ä»£ç†\n\n\n\näº”ã€å¸¸è€ƒé—®é¢˜\nè¯´è¯´ä½ å¯¹ Runtime çš„ç†è§£ï¼Ÿ\n\n\nRuntime æ˜¯ OC çš„è¿è¡Œæ—¶ç³»ç»Ÿï¼Œå…è®¸ç¨‹åºåœ¨è¿è¡Œæ—¶è¿›è¡Œå¯¹è±¡æ“ä½œï¼ˆå¦‚æ¶ˆæ¯å‘é€ã€æ–¹æ³•äº¤æ¢ã€ç±»åˆ›å»ºç­‰ï¼‰ã€‚\nåŠ¨æ€æ€§æ˜¯ Objective-C æœ€é‡è¦çš„ç‰¹æ€§ä¹‹ä¸€ï¼ŒåŸºäº Runtime å®ç°ã€‚\n\n\n\nä»€ä¹ˆæ˜¯ Method Swizzlingï¼Ÿä½¿ç”¨æ—¶æ³¨æ„ä»€ä¹ˆï¼Ÿ\n\n\nå®šä¹‰ï¼šäº¤æ¢ä¸¤ä¸ªæ–¹æ³•çš„å®ç°ã€‚\næ³¨æ„ï¼š\nä½¿ç”¨ dispatch_once ä¿è¯åªäº¤æ¢ä¸€æ¬¡ã€‚\nç¡®è®¤æ–¹æ³•å­˜åœ¨å†äº¤æ¢ï¼Œé¿å…å´©æºƒã€‚\nç»´æŠ¤å¥½è°ƒç”¨é“¾ï¼Œé˜²æ­¢æ­»å¾ªç¯ã€‚\né¿å…è¿‡åº¦ä½¿ç”¨ï¼Œç ´åå°è£…æ€§ã€‚\n\n\n\nMethod Swizzling å¸¸ç”¨åœ¨å“ªäº›åœºæ™¯ï¼Ÿ\n\n\nç»Ÿä¸€åŠ æ—¥å¿—æ‰“ç‚¹ï¼ˆæ¯”å¦‚ UIViewController ç”Ÿå‘½å‘¨æœŸï¼‰\næ›¿æ¢ç³»ç»Ÿæ–¹æ³•åŠŸèƒ½ï¼ˆå¦‚ç»Ÿè®¡ç‚¹å‡»äº‹ä»¶ï¼‰\nAOP ç¼–ç¨‹å®è·µ\næ¡†æ¶å†…éƒ¨å¢å¼ºï¼ˆå¦‚ AFNetworking çš„æŸäº› hookï¼‰\n\n\n\næ¶ˆæ¯å‘é€æµç¨‹æ˜¯æ€æ ·çš„ï¼Ÿ\n\n\nè°ƒç”¨æ–¹æ³• -&gt; è½¬æˆ objc_msgSend å‘é€æ¶ˆæ¯ã€‚\nå¦‚æœæ‰¾ä¸åˆ°æ–¹æ³•ï¼š\nåŠ¨æ€æ–¹æ³•è§£æï¼ˆresolveInstanceMethod:ï¼‰\nå¿«é€Ÿè½¬å‘ï¼ˆforwardingTargetForSelector:ï¼‰\nå®Œæ•´æ¶ˆæ¯è½¬å‘ï¼ˆforwardInvocation:ï¼‰\næœ€åæŠ›å‡º unrecognized selector sent to instance å¼‚å¸¸ã€‚\n\n\n\n\n\næ¶ˆæ¯è½¬å‘å’Œä»£ç†æ¨¡å¼æœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ\n\n\nä»£ç†ï¼ˆdelegateï¼‰æœ¬è´¨å°±æ˜¯æ¶ˆæ¯è½¬å‘çš„ä¸€ç§åº”ç”¨ã€‚\nå¯ä»¥é€šè¿‡ forwardingTargetForSelector: æŠŠä¸æ”¯æŒçš„æ–¹æ³•äº¤ç»™ä»£ç†å¯¹è±¡æ‰§è¡Œã€‚\nå¤æ‚ä»£ç†æ¨¡å¼ï¼ˆå¦‚ NSProxy å¤šä»£ç†ï¼‰å°±æ˜¯ç”¨å®Œæ•´æ¶ˆæ¯è½¬å‘å®ç°çš„ã€‚\n\n\n\nSwizzling å’Œ Hook çš„åŒºåˆ«ï¼Ÿ\n\n\nSwizzlingï¼šæŒ‡â€œæ–¹æ³•äº¤æ¢â€ï¼Œä¸»è¦æ”¹å˜å¯¹è±¡çš„æ–¹æ³•å®ç°ã€‚\nHookï¼šæ›´å¹¿ä¹‰ï¼ŒæŒ‡æ‹¦æˆªå¹¶ä¿®æ”¹ç¨‹åºæ‰§è¡Œè¿‡ç¨‹ï¼Œå¯ä»¥æ˜¯æ–¹æ³•å±‚é¢ã€å‡½æ•°å±‚é¢ï¼ˆFishhookï¼‰ã€ç”šè‡³æ˜¯æ±‡ç¼–æŒ‡ä»¤å±‚é¢ã€‚\n\n\n\nä¸ºä»€ä¹ˆ +load æ–¹æ³•é€‚åˆåš Swizzlingï¼Ÿ\n\n\n+load æ˜¯åœ¨ç±»ï¼ˆæˆ–åˆ†ç±»ï¼‰è¢«åŠ è½½åˆ°å†…å­˜æ—¶ç«‹å³è°ƒç”¨çš„ï¼Œä¼˜å…ˆäº main()ã€‚\nä¿è¯åœ¨å¯¹è±¡ä½¿ç”¨å‰å°±å®Œæˆæ–¹æ³•äº¤æ¢ã€‚\n\nè¡¥å……ï¼šå¦‚æœæƒ³æ›´çµæ´»æ§åˆ¶ï¼ŒæŸäº›æ¡†æ¶ï¼ˆå¦‚ Aspectsï¼‰ä¼šåœ¨ +initialize åš Swizzlingï¼Œä½†è¦æ³¨æ„ initialize åªä¼šåœ¨ç¬¬ä¸€æ¬¡å‘é€æ¶ˆæ¯å‰è°ƒç”¨ã€‚\n\n\nä½¿ç”¨ Runtime æœ‰å“ªäº›é£é™©ï¼Ÿ\n\n\næ–¹æ³•äº¤æ¢è¿‡å¤šï¼Œå®¹æ˜“å¯¼è‡´éš¾ä»¥ç»´æŠ¤å’Œè°ƒè¯•ã€‚\næ¶ˆæ¯è½¬å‘é“¾è¿‡é•¿ï¼Œå¯èƒ½å¯¼è‡´æ€§èƒ½ä¸‹é™ã€‚\nåŠ¨æ€æ·»åŠ æ–¹æ³•æ—¶å‚æ•°ç±»å‹ç­¾åä¸æ­£ç¡®ï¼Œå¯èƒ½å¯¼è‡´è¿è¡Œæ—¶å´©æºƒã€‚\næ— æ³•è¢«ç¼–è¯‘å™¨é™æ€æ£€æŸ¥ï¼Œå‡ºé”™æ—¶å¾ˆéš¾å®šä½ã€‚\n\n\n\nNSProxy æ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆéœ€è¦å®ƒï¼Ÿ\n\n\nNSProxy æ˜¯ä¸€ä¸ªè½»é‡çº§çš„åŸºç±»ï¼Œä¸“é—¨ç”¨äºå®ç°æ¶ˆæ¯è½¬å‘ã€‚\nå…¸å‹åœºæ™¯ï¼š\nè¿œç¨‹æ–¹æ³•è°ƒç”¨ï¼ˆRPCï¼‰\nå¤šä»£ç†ç®¡ç†ï¼ˆå¦‚ YYTextKeyboardManagerï¼‰\nç›¸æ¯” NSObjectï¼ŒNSProxy æ²¡æœ‰å®ä¾‹å˜é‡ï¼Œç›´æ¥èµ°å®Œæ•´æ¶ˆæ¯è½¬å‘æµç¨‹ã€‚\n\n\n","categories":["åŸºç¡€"]},{"title":"Day6-åˆ é™¤æœ‰åºæ•°ç»„ä¸­çš„é‡å¤é¡¹","url":"/2025/04/29/Day6-%E5%88%A0%E9%99%A4%E6%9C%89%E5%BA%8F%E6%95%B0%E7%BB%84%E4%B8%AD%E7%9A%84%E9%87%8D%E5%A4%8D%E9%A1%B9/","content":"ğŸ”— LeetCode 26 - Remove Duplicates from Sorted Array\nğŸ“Œ é¢˜ç›®æè¿°ç»™ä½ ä¸€ä¸ª å‡åºæ’åˆ— çš„æ•°ç»„ numsï¼Œè¯·ä½ åŸåœ°åˆ é™¤é‡å¤å‡ºç°çš„å…ƒç´ ï¼Œä½¿æ¯ä¸ªå…ƒç´ åªå‡ºç°ä¸€æ¬¡ï¼Œè¿”å›åˆ é™¤åæ•°ç»„çš„æ–°é•¿åº¦ã€‚ä¸è¦ä½¿ç”¨é¢å¤–çš„æ•°ç»„ç©ºé—´ï¼Œä½ å¿…é¡»åœ¨ O(1) é¢å¤–ç©ºé—´çš„æ¡ä»¶ä¸‹åŸåœ°ä¿®æ”¹è¾“å…¥æ•°ç»„ã€‚\nç¤ºä¾‹ï¼š\nè¾“å…¥: nums = [1,1,2]è¾“å‡º: 2, nums = [1,2,_]\n\n\nğŸ’¡ è§£é¢˜æ€è·¯\nä½¿ç”¨ åŒæŒ‡é’ˆï¼š\n\nslow æŒ‡é’ˆè¡¨ç¤ºå½“å‰å¤„ç†çš„å”¯ä¸€å…ƒç´ ä¸‹æ ‡ï¼›\nfast æŒ‡é’ˆéå†æ•°ç»„ï¼Œå½“é‡åˆ°ä¸€ä¸ªä¸ nums[slow] ä¸åŒçš„å…ƒç´ æ—¶ï¼Œå°†å…¶èµ‹å€¼ç»™ nums[slow + 1]ï¼Œç„¶å slow å‰è¿›ä¸€æ­¥ã€‚\n\n\néå†ç»“æŸåï¼Œslow + 1 å°±æ˜¯æ–°æ•°ç»„çš„é•¿åº¦ã€‚\n\næ—¶é—´å¤æ‚åº¦ï¼šO(n)\n\nç©ºé—´å¤æ‚åº¦ï¼šO(1)\n\n\n\nâœ… JavaScript å®ç°var removeDuplicates = function(nums) &#123;    if (nums.length === 0) return 0;        let slow = 0;        for (let fast = 1; fast &lt; nums.length; fast++) &#123;        if (nums[fast] !== nums[slow]) &#123;            slow++;            nums[slow] = nums[fast];        &#125;    &#125;        return slow + 1;&#125;;\n\n\nğŸ§  æ€è€ƒæ‹“å±•\nå¦‚æœè¦æ±‚æ¯ä¸ªå…ƒç´ æœ€å¤šå‡ºç°ä¸¤æ¬¡æ€ä¹ˆåŠï¼Ÿï¼ˆå‚è€ƒ LeetCode 80ï¼‰\nè¿™é“é¢˜ä¸ºä»€ä¹ˆå¿…é¡»æ˜¯åŸåœ°ä¿®æ”¹ï¼Ÿæœ‰ä»€ä¹ˆå®é™…åº”ç”¨åœºæ™¯ï¼Ÿ\n\n\n","categories":["ç®—æ³•"]},{"title":"Day7-Runtime&Block","url":"/2025/04/30/Day7-Runtime&Block/","content":"RuntimeiOS Runtimeï¼Œé€šå¸¸ç§°ä¸ºObjective-C Runtimeï¼Œæ˜¯iOSå¼€å‘ä¸­ä¸€ä¸ªè‡³å…³é‡è¦çš„ç»„ä»¶ã€‚å®ƒæ˜¯ä¸€å¥—åº•å±‚çš„Cè¯­è¨€APIï¼Œä¸ºObjective-Cçš„åŠ¨æ€ç‰¹æ€§æä¾›äº†å¼ºå¤§çš„æ”¯æŒã€‚æœ¬æ–‡å°†å¯¹iOS Runtimeè¿›è¡Œæ·±å…¥çš„è§£æï¼Œä»åŸºæœ¬æ¦‚å¿µåˆ°ä¸»è¦åŠŸèƒ½ï¼Œå†åˆ°å®é™…åº”ç”¨å’Œæ³¨æ„äº‹é¡¹ï¼Œå…¨æ–¹ä½åœ°å±•ç¤ºè¿™ä¸€æŠ€æœ¯çš„é­…åŠ›ã€‚\nä¸€ã€RuntimeåŸºæœ¬æ¦‚å¿µRuntimeï¼Œå³è¿è¡Œæ—¶ï¼ŒæŒ‡çš„æ˜¯ç¨‹åºåœ¨è¿è¡Œè¿‡ç¨‹ä¸­è¿›è¡Œçš„ä¸€ç³»åˆ—æ“ä½œã€‚åœ¨Objective-Cä¸­ï¼ŒRuntimeç³»ç»Ÿå…è®¸æˆ‘ä»¬åœ¨ç¨‹åºè¿è¡Œæ—¶åŠ¨æ€åœ°æ“ä½œç±»å’Œå¯¹è±¡ï¼Œæ‰§è¡Œè¯¸å¦‚æ£€æŸ¥å’Œæ”¹å˜å¯¹è±¡ã€äº¤æ¢æ–¹æ³•å®ç°ã€åŠ¨æ€æ·»åŠ æ–¹æ³•æˆ–å±æ€§ç­‰æ“ä½œã€‚è¿™ç§åŠ¨æ€æ€§ä¸ºå¼€å‘è€…å¸¦æ¥äº†æå¤§çš„çµæ´»æ€§ã€‚\nObjective-Cä½œä¸ºä¸€é—¨åŠ¨æ€è¯­è¨€ï¼Œä¸Cè¯­è¨€ç­‰é™æ€è¯­è¨€åœ¨ç¼–è¯‘å’Œè¿è¡Œæ—¶æœ‰ç€æ˜¾è‘—çš„åŒºåˆ«ã€‚é™æ€è¯­è¨€åœ¨ç¼–è¯‘é˜¶æ®µå°±ç¡®å®šäº†æ‰€æœ‰çš„æ–¹æ³•è°ƒç”¨å’Œå¯¹è±¡ç±»å‹ï¼Œè€ŒåŠ¨æ€è¯­è¨€åˆ™åœ¨è¿è¡Œæ—¶æ‰ç¡®å®šè¿™äº›æ“ä½œã€‚Objective-Cé€šè¿‡Runtimeç³»ç»Ÿå®ç°äº†è¿™ä¸€åŠ¨æ€æ€§ï¼Œä½¿å¾—æˆ‘ä»¬å¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°åˆ›å»ºç±»å’Œå¯¹è±¡ã€è¿›è¡Œæ¶ˆæ¯ä¼ é€’å’Œè½¬å‘ã€‚\näºŒã€Runtimeæ•°æ®ç»“æ„åœ¨æ·±å…¥Runtimeçš„åŠŸèƒ½ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆäº†è§£å…¶åº•å±‚çš„æ•°æ®ç»“æ„ã€‚iOS Runtimeçš„æ ¸å¿ƒæ•°æ®ç»“æ„åŒ…æ‹¬objc_classã€objc_objectç­‰ã€‚\n\nobjc_objectï¼šè¿™æ˜¯æ‰€æœ‰Objective-Cå¯¹è±¡çš„åŸºç±»ç»“æ„ä½“ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªisaæŒ‡é’ˆï¼ŒæŒ‡å‘è¯¥å¯¹è±¡æ‰€å±çš„ç±»ã€‚\n\nobjc_classï¼šè¿™æ˜¯ç±»çš„ç»“æ„ä½“ï¼Œå®ƒç»§æ‰¿è‡ªobjc_objectã€‚objc_classä¸­åŒ…å«äº†ç±»çš„å„ç§ä¿¡æ¯ï¼Œå¦‚çˆ¶ç±»æŒ‡é’ˆã€æ–¹æ³•åˆ—è¡¨ã€æ–¹æ³•ç¼“å­˜ã€å±æ€§åˆ—è¡¨ã€åè®®åˆ—è¡¨ç­‰ã€‚\n\nisaï¼šæŒ‡å‘è¯¥ç±»çš„å…ƒç±»ï¼ˆmeta-classï¼‰ï¼Œå…ƒç±»ä¸­å­˜å‚¨äº†ç±»çš„ç±»æ–¹æ³•ã€‚\nsuper_classï¼šæŒ‡å‘è¯¥ç±»çš„çˆ¶ç±»ã€‚\nnameï¼šç±»çš„åç§°ã€‚\nversionï¼šç±»çš„ç‰ˆæœ¬ä¿¡æ¯ã€‚\ninfoï¼šç±»çš„è¯¦ç»†ä¿¡æ¯ã€‚\ninstance_sizeï¼šè¯¥ç±»å®ä¾‹å¯¹è±¡çš„å¤§å°ã€‚\nmethodListsï¼šæŒ‡å‘è¯¥ç±»çš„å®ä¾‹æ–¹æ³•åˆ—è¡¨çš„æŒ‡é’ˆçš„æŒ‡é’ˆï¼Œå¯ä»¥åŠ¨æ€ä¿®æ”¹ã€‚\ncacheï¼šæ–¹æ³•ç¼“å­˜ï¼Œç”¨äºå­˜å‚¨è¢«é¢‘ç¹è°ƒç”¨çš„æ–¹æ³•ï¼Œä»¥æé«˜æŸ¥æ‰¾æ•ˆç‡ã€‚\nprotocolsï¼šæŒ‡å‘è¯¥ç±»çš„åè®®åˆ—è¡¨ã€‚\n\n\n\nä¸‰ã€Runtimeä¸»è¦åŠŸèƒ½iOS Runtimeæä¾›äº†è®¸å¤šå¼ºå¤§çš„åŠŸèƒ½ï¼Œè¿™äº›åŠŸèƒ½ä½¿å¾—Objective-Cæˆä¸ºä¸€é—¨æå…·åŠ¨æ€æ€§çš„ç¼–ç¨‹è¯­è¨€ã€‚\n\nåŠ¨æ€æ·»åŠ ç±»å’Œæ–¹æ³•ï¼š\nRuntimeå…è®¸æˆ‘ä»¬åœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°åˆ›å»ºæ–°çš„ç±»ï¼Œå¹¶å‘å·²æœ‰çš„ç±»ä¸­æ·»åŠ æ–°çš„æ–¹æ³•æˆ–å®ä¾‹å˜é‡ã€‚è¿™ç§åŠ¨æ€æ€§ä½¿å¾—æˆ‘ä»¬å¯ä»¥åœ¨ä¸ä¿®æ”¹åŸæœ‰ä»£ç çš„æƒ…å†µä¸‹ï¼Œä¸ºç±»æ·»åŠ æ–°çš„åŠŸèƒ½ã€‚ä¾‹å¦‚ï¼Œé€šè¿‡objc_allocateClassPairå’Œobjc_registerClassPairå‡½æ•°å¯ä»¥åŠ¨æ€åˆ›å»ºå’Œæ³¨å†Œä¸€ä¸ªæ–°çš„ç±»ï¼›é€šè¿‡class_addMethodå‡½æ•°å¯ä»¥å‘å·²æœ‰çš„ç±»ä¸­æ·»åŠ æ–°çš„æ–¹æ³•ã€‚\n\næ¶ˆæ¯ä¼ é€’å’Œæ¶ˆæ¯è½¬å‘ï¼š\nObjective-Cä¸­çš„æ–¹æ³•è°ƒç”¨å®é™…ä¸Šæ˜¯ä¸€ç§æ¶ˆæ¯ä¼ é€’æœºåˆ¶ã€‚å½“æˆ‘ä»¬å‘ä¸€ä¸ªå¯¹è±¡å‘é€æ¶ˆæ¯æ—¶ï¼ŒRuntimeç³»ç»Ÿä¼šæ ¹æ®æ¶ˆæ¯çš„åç§°ï¼ˆå³é€‰æ‹©å™¨SELï¼‰åœ¨å¯¹è±¡çš„ç±»åŠå…¶çˆ¶ç±»ä¸­æŸ¥æ‰¾å¯¹åº”çš„æ–¹æ³•å®ç°ã€‚å¦‚æœæ‰¾åˆ°äº†åŒ¹é…çš„æ–¹æ³•ï¼Œå°±è°ƒç”¨è¯¥æ–¹æ³•ï¼›å¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œåˆ™è¿›å…¥æ¶ˆæ¯è½¬å‘æœºåˆ¶ã€‚æ¶ˆæ¯è½¬å‘æœºåˆ¶å…è®¸æˆ‘ä»¬åœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°å¤„ç†æœªå®ç°çš„æ–¹æ³•è°ƒç”¨ï¼Œè€Œä¸æ˜¯ç›´æ¥å´©æºƒã€‚ä¾‹å¦‚ï¼Œé€šè¿‡å®ç°forwardingTargetForSelector:æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥å°†æœªå®ç°çš„æ¶ˆæ¯è½¬å‘ç»™å…¶ä»–å¯¹è±¡æ¥å¤„ç†ã€‚\n\nå…³è”å¯¹è±¡ï¼š\nRuntimeå…è®¸æˆ‘ä»¬ç»™ç°æœ‰çš„ç±»åŠ¨æ€åœ°å…³è”æ–°çš„å±æ€§ã€‚è¿™ç§å…³è”å±æ€§ä¸ä¼šæ”¹å˜åŸæœ‰ç±»çš„ç»“æ„ï¼Œä¹Ÿä¸ä¼šå½±å“å…¶ä»–ç±»çš„ä½¿ç”¨ã€‚è¿™åœ¨æŸäº›æƒ…å†µä¸‹å¯ä»¥é¿å…å­ç±»åŒ–ï¼Œä»è€Œç®€åŒ–ä»£ç ç»“æ„ã€‚ä¾‹å¦‚ï¼Œé€šè¿‡objc_setAssociatedObjectå’Œobjc_getAssociatedObjectå‡½æ•°å¯ä»¥ä¸ºå¯¹è±¡å…³è”å’Œè·å–æ–°çš„å±æ€§ã€‚\n\nè·å–ç±»ä¿¡æ¯ï¼š\nRuntimeæä¾›äº†ä¸€ç³»åˆ—å‡½æ•°æ¥è·å–ç±»çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç±»åã€çˆ¶ç±»ã€å®ä¾‹å˜é‡ã€æ–¹æ³•åˆ—è¡¨ã€åè®®åˆ—è¡¨ç­‰ã€‚è¿™äº›ä¿¡æ¯å¯¹äºè°ƒè¯•å’Œåå°„ç­‰é«˜çº§æ“ä½œéå¸¸æœ‰ç”¨ã€‚ä¾‹å¦‚ï¼Œé€šè¿‡class_getNameå‡½æ•°å¯ä»¥è·å–ç±»çš„åç§°ï¼›é€šè¿‡class_copyMethodListå‡½æ•°å¯ä»¥è·å–ç±»çš„æ–¹æ³•åˆ—è¡¨ã€‚\n\næ–¹æ³•äº¤æ¢ï¼š\nRuntimeå…è®¸æˆ‘ä»¬åœ¨è¿è¡Œæ—¶äº¤æ¢ä¸¤ä¸ªæ–¹æ³•çš„å®ç°ã€‚è¿™ç§åŠŸèƒ½åœ¨æŸäº›æƒ…å†µä¸‹å¯ä»¥ç”¨æ¥å®ç°æ–¹æ³•çš„æ›¿æ¢æˆ–è°ƒè¯•ã€‚ä¾‹å¦‚ï¼Œé€šè¿‡method_exchangeImplementationså‡½æ•°å¯ä»¥äº¤æ¢ä¸¤ä¸ªæ–¹æ³•çš„å®ç°ã€‚\n\n\nå››ã€Runtimeå®é™…åº”ç”¨iOS Runtimeåœ¨å¼€å‘ä¸­æœ‰ç€å¹¿æ³›çš„åº”ç”¨ï¼Œä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„ç”¨ä¾‹å’Œç¤ºä¾‹ï¼š\n\nç»™ç³»ç»Ÿç±»æ·»åŠ å±æ€§æˆ–æ–¹æ³•ï¼š\né€šè¿‡Runtimeï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºç³»ç»Ÿç±»ï¼ˆå¦‚NSStringã€UIButtonç­‰ï¼‰æ·»åŠ æ–°çš„å±æ€§æˆ–æ–¹æ³•ã€‚è¿™ç§æ“ä½œé€šå¸¸ç”¨äºæ‰©å±•ç³»ç»Ÿç±»çš„åŠŸèƒ½ï¼Œè€Œæ— éœ€åˆ›å»ºå­ç±»ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºNSStringç±»æ·»åŠ ä¸€ä¸ªè®¡ç®—å­—ç¬¦ä¸²å“ˆå¸Œå€¼çš„æ–¹æ³•ã€‚\n\næ–¹æ³•äº¤æ¢ï¼š\næ–¹æ³•äº¤æ¢æ˜¯Runtimeçš„ä¸€ä¸ªå¼ºå¤§åŠŸèƒ½ï¼Œå®ƒå…è®¸æˆ‘ä»¬åœ¨è¿è¡Œæ—¶äº¤æ¢ä¸¤ä¸ªæ–¹æ³•çš„å®ç°ã€‚è¿™ç§æ“ä½œé€šå¸¸ç”¨äºè°ƒè¯•æˆ–å®ç°æŸäº›ç‰¹å®šçš„åŠŸèƒ½ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡äº¤æ¢UIViewControllerçš„viewDidLoadå’ŒviewWillAppear:æ–¹æ³•çš„å®ç°æ¥è§‚å¯Ÿè¿™ä¸¤ä¸ªæ–¹æ³•åœ¨ä¸åŒæ—¶æœºä¸‹çš„è¡Œä¸ºã€‚\n\nKVOï¼ˆKey-Value Observingï¼‰å’ŒKVCï¼ˆKey-Value Codingï¼‰ï¼š\nKVOå’ŒKVCæ˜¯Objective-Cä¸­çš„ä¸¤ç§é«˜çº§ç‰¹æ€§ï¼Œå®ƒä»¬åˆ†åˆ«ç”¨äºè§‚å¯Ÿå¯¹è±¡å±æ€§çš„å˜åŒ–å’Œé€šè¿‡é”®å€¼å¯¹æ¥è®¿é—®å¯¹è±¡çš„å±æ€§ã€‚è¿™ä¸¤ç§ç‰¹æ€§éƒ½ä¾èµ–äºRuntimeç³»ç»Ÿæ¥å®ç°ã€‚ä¾‹å¦‚ï¼ŒKVOé€šè¿‡Runtimeåœ¨å¯¹è±¡çš„å±æ€§è¢«ä¿®æ”¹æ—¶è§¦å‘ç›¸åº”çš„é€šçŸ¥ï¼›KVCåˆ™é€šè¿‡Runtimeåœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°è®¿é—®å’Œä¿®æ”¹å¯¹è±¡çš„å±æ€§ã€‚\n\nå­—å…¸è½¬æ¨¡å‹ï¼š\nåœ¨iOSå¼€å‘ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦å°†JSONå­—å…¸è½¬æ¢ä¸ºæ¨¡å‹å¯¹è±¡ã€‚é€šè¿‡Runtimeï¼Œæˆ‘ä»¬å¯ä»¥å®ç°ä¸€ä¸ªé€šç”¨çš„å­—å…¸è½¬æ¨¡å‹çš„å·¥å…·ç±»ï¼Œè¯¥å·¥å…·ç±»å¯ä»¥è‡ªåŠ¨åœ°å°†JSONå­—å…¸ä¸­çš„é”®å€¼å¯¹æ˜ å°„åˆ°æ¨¡å‹å¯¹è±¡çš„å±æ€§ä¸Šã€‚è¿™ç§æ“ä½œå¤§å¤§æé«˜äº†ä»£ç çš„å¯é‡ç”¨æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚\n\næ¶ˆæ¯è½¬å‘æœºåˆ¶ï¼š\nå½“å¯¹è±¡æ¥æ”¶åˆ°ä¸€ä¸ªæœªå®ç°çš„æ¶ˆæ¯æ—¶ï¼Œå¯ä»¥é€šè¿‡æ¶ˆæ¯è½¬å‘æœºåˆ¶æ¥åŠ¨æ€åœ°å¤„ç†è¿™ä¸ªæ¶ˆæ¯ã€‚è¿™ç§æœºåˆ¶å…è®¸æˆ‘ä»¬åœ¨ä¸æ”¹å˜åŸæœ‰ä»£ç çš„æƒ…å†µä¸‹ï¼Œä¸ºå¯¹è±¡æ·»åŠ æ–°çš„åŠŸèƒ½æˆ–å¤„ç†é”™è¯¯æƒ…å†µã€‚ä¾‹å¦‚ï¼Œå½“å¯¹è±¡æ¥æ”¶åˆ°ä¸€ä¸ªæœªå®ç°çš„æ–¹æ³•è°ƒç”¨æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å®ç°forwardingTargetForSelector:æˆ–forwardInvocation:æ–¹æ³•æ¥å¤„ç†è¿™ä¸ªæ¶ˆæ¯ã€‚\n\n\näº”ã€æ³¨æ„äº‹é¡¹è™½ç„¶iOS Runtimeæä¾›äº†è®¸å¤šå¼ºå¤§çš„åŠŸèƒ½ï¼Œä½†åœ¨ä½¿ç”¨æ—¶ä¹Ÿéœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š\n\nç¨³å®šæ€§ï¼š\nåŠ¨æ€åœ°ä¿®æ”¹ç±»çš„ç»“æ„å’Œè¡Œä¸ºå¯èƒ½ä¼šç ´åä»£ç çš„ç¨³å®šæ€§ã€‚å› æ­¤ï¼Œåœ¨ä½¿ç”¨RuntimeåŠŸèƒ½æ—¶éœ€è¦è°¨æ…è€ƒè™‘å…¶å¯¹ç³»ç»Ÿç¨³å®šæ€§çš„å½±å“ã€‚\n\nå¯ç»´æŠ¤æ€§ï¼š\nè¿‡åº¦ä½¿ç”¨RuntimeåŠŸèƒ½å¯èƒ½ä¼šé™ä½ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚å› æ­¤ï¼Œåœ¨å¼€å‘è¿‡ç¨‹ä¸­éœ€è¦æƒè¡¡åˆ©å¼Šï¼Œåˆç†åœ°ä½¿ç”¨RuntimeåŠŸèƒ½ã€‚\n\næ€§èƒ½ï¼š\nè™½ç„¶Runtimeç³»ç»Ÿæä¾›äº†è®¸å¤šé«˜æ•ˆçš„æ•°æ®ç»“æ„å’Œç®—æ³•æ¥ä¼˜åŒ–æ€§èƒ½ï¼Œä½†åœ¨æŸäº›æƒ…å†µä¸‹ï¼ˆå¦‚é¢‘ç¹åœ°åŠ¨æ€æ·»åŠ æˆ–åˆ é™¤æ–¹æ³•ï¼‰ï¼Œä»ç„¶å¯èƒ½ä¼šå¯¹æ€§èƒ½äº§ç”Ÿä¸€å®šçš„å½±å“ã€‚å› æ­¤ï¼Œåœ¨ä½¿ç”¨RuntimeåŠŸèƒ½æ—¶éœ€è¦å…³æ³¨å…¶å¯¹æ€§èƒ½çš„å½±å“ã€‚\n\n\nå…­ã€æ€»ç»“iOS Runtimeæ˜¯Objective-Cè¯­è¨€åŠ¨æ€ç‰¹æ€§çš„åŸºçŸ³ï¼Œå®ƒæä¾›äº†ä¸€ç³»åˆ—å¼ºå¤§çš„åŠŸèƒ½æ¥æ”¯æŒåŠ¨æ€æ€§å’Œçµæ´»æ€§ã€‚é€šè¿‡æ·±å…¥äº†è§£Runtimeçš„åŸºæœ¬æ¦‚å¿µã€æ•°æ®ç»“æ„ã€ä¸»è¦åŠŸèƒ½å’Œå®é™…åº”ç”¨ï¼Œæˆ‘ä»¬å¯ä»¥æ›´å¥½åœ°åˆ©ç”¨è¿™ä¸€æŠ€æœ¯æ¥å¼€å‘é«˜æ•ˆã€çµæ´»å’Œå¯ç»´æŠ¤çš„iOSåº”ç”¨ç¨‹åºã€‚åŒæ—¶ï¼Œä¹Ÿéœ€è¦æ³¨æ„åœ¨ä½¿ç”¨RuntimeåŠŸèƒ½æ—¶ä¿æŒä»£ç çš„ç¨³å®šæ€§å’Œå¯è¯»æ€§ã€‚\nBlockBlockæ˜¯è‹¹æœå…¬å¸åœ¨OSX10.6å’ŒiOS4.0ä¸­å¼•å…¥çš„ä¸€é¡¹åŠŸèƒ½ï¼Œå®ƒæå¤§åœ°ä¸°å¯Œäº†Cè¯­è¨€çš„ç‰¹æ€§ï¼Œå¹¶æä¾›äº†ç±»ä¼¼å…¶ä»–è¯­è¨€ä¸­é—­åŒ…ï¼ˆclosureï¼‰çš„åŠŸèƒ½ã€‚Blockæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªå¸¦æœ‰è‡ªåŠ¨å˜é‡ï¼ˆå±€éƒ¨å˜é‡ï¼‰çš„åŒ¿åå‡½æ•°ï¼Œå…¶åº•å±‚å®ç°åŒ…å«isaæŒ‡é’ˆï¼Œå› æ­¤ä¹Ÿå¯ä»¥è¢«çœ‹ä½œæ˜¯å—å¯¹è±¡ã€‚æœ¬æ–‡å°†æ·±å…¥è§£æiOSä¸­çš„Blockï¼ŒåŒ…æ‹¬å…¶æ¦‚å¿µã€å£°æ˜ä¸å®šä¹‰ã€æ•è·å˜é‡çš„æœºåˆ¶ã€å†…å­˜ç®¡ç†ä»¥åŠä½¿ç”¨åœºæ™¯ç­‰æ–¹é¢ã€‚\nä¸€ã€Blockçš„åŸºç¡€æ¦‚å¿µBlockåˆç§°ä¸ºå—æˆ–å—å¯¹è±¡ï¼Œæ˜¯è‹¹æœåœ¨æ”¹è¿›C&#x2F;OC&#x2F;C++&#x2F;OC++ç­‰è¯­è¨€çš„ç¼–è¯‘å¤„ç†æ—¶çš„é‡è¦æˆæœã€‚å®ƒçš„å‡ºç°æ—¨åœ¨æ›¿ä»£æŒ‡é’ˆå‡½æ•°ï¼Œä½¿å¾—ä»£ç æ›´åŠ ç®€æ´å’Œæ˜“ç”¨ã€‚Blockçš„è¯­æ³•ç»“æ„åŒ…æ‹¬è¿”å›ç±»å‹ã€å˜é‡åï¼ˆå¯çœç•¥ï¼‰ã€å‚æ•°åˆ—è¡¨ä»¥åŠå®ç°ä½“ï¼Œä½¿ç”¨è„±å­—ç¬¦â€œ^â€å’ŒèŠ±æ‹¬å·â€œ{}â€æ¥è¡¨ç¤ºã€‚\näºŒã€Blockçš„å£°æ˜ä¸å®šä¹‰Blockçš„å£°æ˜è¯­æ³•ç›¸å¯¹ç‹¬ç‰¹ï¼Œæ ¼å¼ä¸ºâ€œè¿”å›å€¼ç±»å‹(^blockå˜é‡å)(å‚æ•°åˆ—è¡¨)â€ã€‚ä¾‹å¦‚ï¼Œâ€œint(^personBlock)(NSString ,int)â€å£°æ˜äº†ä¸€ä¸ªåä¸ºpersonBlockçš„Blockå˜é‡ï¼Œå®ƒæ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼ˆä¸€ä¸ªNSStringç±»å‹å’Œä¸€ä¸ªintç±»å‹ï¼‰ï¼Œå¹¶è¿”å›ä¸€ä¸ªintç±»å‹çš„å€¼ã€‚\nBlockçš„å®šä¹‰åˆ™æ˜¯åœ¨å£°æ˜çš„åŸºç¡€ä¸Šï¼Œä½¿ç”¨â€œ&#x3D;â€ç¬¦å·å’Œâ€œ^â€ç¬¦å·æ¥å¼•å…¥å®ç°ä½“ã€‚ä¾‹å¦‚ï¼š\nNSString* (^personBlock)(NSString*,int) = ^(NSString* name, int age)&#123;    NSLog(@&quot;å¹´é¾„==%d&quot;, age);    return name;&#125;;\n\nè¿™æ®µä»£ç å®šä¹‰äº†ä¸€ä¸ªåä¸ºpersonBlockçš„Blockï¼Œå®ƒæ¥æ”¶ä¸€ä¸ªNSString*ç±»å‹çš„nameå’Œä¸€ä¸ªintç±»å‹çš„ageä½œä¸ºå‚æ•°ï¼Œæ‰“å°å¹´é¾„å¹¶è¿”å›nameã€‚\nä¸‰ã€Blockæ•è·å˜é‡çš„æœºåˆ¶Blockå¯ä»¥æ•è·å…¶å£°æ˜èŒƒå›´å†…çš„æ‰€æœ‰å˜é‡ï¼Œä½†æ•è·çš„è‡ªåŠ¨å˜é‡é»˜è®¤æ˜¯ä¸å¯ä¿®æ”¹çš„ã€‚å¦‚æœéœ€è¦ä¿®æ”¹ï¼Œåˆ™éœ€è¦åœ¨å˜é‡å‰åŠ ä¸Š__blockä¿®é¥°ç¬¦ã€‚__blockä¿®é¥°ç¬¦å‘Šè¯‰ç¼–è¯‘å™¨ï¼Œè¯¥å˜é‡å¯èƒ½ä¼šåœ¨Blockä¸­è¢«ä¿®æ”¹ï¼Œå› æ­¤éœ€è¦åœ¨Blockçš„å®ç°ä½“ä¸­ä¿ç•™ä¸€ä¸ªæŒ‡å‘è¯¥å˜é‡çš„æŒ‡é’ˆã€‚\næ­¤å¤–ï¼ŒBlockæ€»èƒ½ä¿®æ”¹å®ä¾‹å˜é‡ã€é™æ€å˜é‡ã€å…¨å±€å˜é‡å’Œå…¨å±€é™æ€å˜é‡ï¼Œæ— éœ€åŠ __blockä¿®é¥°ç¬¦ã€‚\nå››ã€Blockçš„å†…å­˜ç®¡ç†åœ¨iOSä¸­ï¼ŒBlockçš„å†…å­˜ç®¡ç†æ˜¯ä¸€ä¸ªé‡è¦çš„è€ƒè™‘å› ç´ ã€‚Blockæœ‰ä¸‰ç§å­˜å‚¨ä½ç½®ï¼šæ ˆï¼ˆ_NSConcreteStackBlockï¼‰ã€å †ï¼ˆ_NSConcreteMallocBlockï¼‰å’Œå…¨å±€ï¼ˆ_NSConcreteGlobalBlockï¼‰ã€‚\n\næ ˆä¸Šçš„Blockï¼šå½“Blockåœ¨æ–¹æ³•å†…éƒ¨å£°æ˜ä¸”æ²¡æœ‰å¼•ç”¨å¤–éƒ¨å˜é‡æ—¶ï¼Œå®ƒé€šå¸¸è¢«åˆ†é…åœ¨æ ˆä¸Šã€‚æ ˆä¸Šçš„Blockåœ¨æ–¹æ³•è¿”å›æ—¶ä¼šè¢«é”€æ¯ã€‚\nå †ä¸Šçš„Blockï¼šå½“Blockå¼•ç”¨å¤–éƒ¨å˜é‡æˆ–ä½œä¸ºå±æ€§å­˜å‚¨æ—¶ï¼Œå®ƒä¼šè¢«å¤åˆ¶åˆ°å †ä¸Šã€‚å †ä¸Šçš„Blockåœ¨å¼•ç”¨è®¡æ•°ä¸º0æ—¶æ‰ä¼šè¢«é”€æ¯ã€‚\nå…¨å±€çš„Blockï¼šä¸è®¿é—®ä»»ä½•å¤–éƒ¨å˜é‡çš„Blockå¯ä»¥è¢«è§†ä¸ºå…¨å±€Blockï¼Œå®ƒä»¬é€šå¸¸è¢«åˆ†é…åœ¨å…¨å±€æ•°æ®åŒºã€‚\n\nåœ¨ARCï¼ˆè‡ªåŠ¨å¼•ç”¨è®¡æ•°ï¼‰ç¯å¢ƒä¸‹ï¼Œç³»ç»Ÿé€šå¸¸ä¼šè‡ªåŠ¨å°†Blockä»æ ˆå¤åˆ¶åˆ°å †ä¸Šï¼Œä»¥é¿å…æ ˆä¸Šçš„Blockè¢«é”€æ¯ã€‚ç„¶è€Œï¼Œåœ¨MRCï¼ˆæ‰‹åŠ¨å¼•ç”¨è®¡æ•°ï¼‰ç¯å¢ƒä¸‹ï¼Œå¼€å‘è€…éœ€è¦æ‰‹åŠ¨ç®¡ç†Blockçš„å†…å­˜ã€‚\näº”ã€Blockçš„ä½¿ç”¨åœºæ™¯Blockåœ¨iOSå¼€å‘ä¸­æœ‰å¹¿æ³›çš„åº”ç”¨åœºæ™¯ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºï¼š\n\nä½œä¸ºå‚æ•°ä¼ é€’ï¼šBlockå¯ä»¥ä½œä¸ºå‡½æ•°çš„å‚æ•°ä¼ é€’ï¼Œè¿™ä½¿å¾—å‡½æ•°èƒ½å¤Ÿæ¥æ”¶ä¸€æ®µä»£ç ä½œä¸ºå‚æ•°ï¼Œå¹¶åœ¨éœ€è¦æ—¶æ‰§è¡Œè¿™æ®µä»£ç ã€‚è¿™ç§ç‰¹æ€§ä½¿å¾—Blockåœ¨å›è°ƒå‡½æ•°ã€åŠ¨ç”»å¤„ç†ç­‰æ–¹é¢éå¸¸æœ‰ç”¨ã€‚\né—­åŒ…ï¼šBlockçš„é—­åŒ…ç‰¹æ€§ä½¿å¾—å®ƒèƒ½å¤Ÿæ•è·å¹¶ä¿ç•™å…¶å£°æ˜èŒƒå›´å†…çš„å˜é‡ï¼Œå³ä½¿è¿™äº›å˜é‡åœ¨Blockå¤–éƒ¨å·²ç»è¢«é”€æ¯ã€‚è¿™ä½¿å¾—Blockèƒ½å¤Ÿåœ¨å¼‚æ­¥æ“ä½œã€å®šæ—¶å™¨å›è°ƒç­‰åœºæ™¯ä¸­ä¿æŒå¯¹å¤–éƒ¨å˜é‡çš„è®¿é—®ã€‚\né€‚é…å™¨æ¨¡å¼ï¼šBlockå¯ä»¥ç”¨ä½œé€‚é…å™¨æ¨¡å¼ä¸­çš„â€œè½¬æ¢å‡½æ•°â€ï¼Œå°†ä¸€ç§æ¥å£è½¬æ¢ä¸ºå¦ä¸€ç§æ¥å£ã€‚è¿™åœ¨å¤„ç†ä¸åŒæ•°æ®æºæˆ–ä¸åŒæ ¼å¼çš„æ•°æ®æ—¶éå¸¸æœ‰ç”¨ã€‚\nè§£å†³å¾ªç¯å¼•ç”¨ï¼šåœ¨ä½¿ç”¨Blockæ—¶ï¼Œéœ€è¦æ³¨æ„å¾ªç¯å¼•ç”¨çš„é—®é¢˜ã€‚ç‰¹åˆ«æ˜¯å½“Blockä½œä¸ºå¯¹è±¡çš„å±æ€§å­˜å‚¨æ—¶ï¼Œå¦‚æœå¯¹è±¡ä¹ŸæŒæœ‰Blockçš„å¼•ç”¨ï¼Œå°±ä¼šå½¢æˆå¾ªç¯å¼•ç”¨ã€‚ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œå¯ä»¥ä½¿ç”¨__weakå…³é”®å­—æ¥å£°æ˜å¯¹å¯¹è±¡çš„å¼±å¼•ç”¨ï¼Œä»è€Œåœ¨Blockä¸­é¿å…å¾ªç¯å¼•ç”¨ã€‚\n\nå…­ã€Blockä½¿ç”¨æ³¨æ„ç‚¹åŠå¸¸è§é—®é¢˜\nBlockä½œä¸ºç±»å˜é‡å±æ€§æ—¶ç”¨copyä¿®é¥°ï¼š\n\nåŸå› ï¼šBlockä½œä¸ºç±»å±æ€§æ—¶ï¼Œç”¨copyä¿®é¥°ç¬¦å¯ä»¥å°†Blockä»æ ˆæ‹·è´åˆ°å †ä¸­ï¼Œé˜²æ­¢Blockåœ¨æ–¹æ³•è¿”å›åè¢«é”€æ¯ã€‚\næ³¨æ„ï¼šèµ‹å€¼ç»™ä¸€ä¸ªweakå˜é‡æ—¶ï¼ŒBlockä¸ä¼šè¢«copyåˆ°å †ä¸Šã€‚\n\n\nä¸èƒ½ä¿®æ”¹å¤–éƒ¨è‡ªåŠ¨å˜é‡é—®é¢˜ï¼š\n\nè§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨__blockä¿®é¥°ç¬¦æ¥ä¿®é¥°éœ€è¦ä¿®æ”¹çš„å¤–éƒ¨è‡ªåŠ¨å˜é‡ã€‚\n\n\nå¾ªç¯å¼•ç”¨é—®é¢˜ï¼š\n\nè§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨__weakå…³é”®å­—æ¥å£°æ˜å¯¹å¯¹è±¡çš„å¼±å¼•ç”¨ï¼Œä»è€Œé¿å…å¾ªç¯å¼•ç”¨ã€‚åœ¨éœ€è¦è®¿é—®selfå±æ€§æ—¶ï¼Œå¯ä»¥åœ¨Blockå†…éƒ¨ä½¿ç”¨[weak self]å’Œ[strong self]çš„æŠ€å·§æ¥ç¡®ä¿selfåœ¨Blockæ‰§è¡ŒæœŸé—´ä¸ä¼šè¢«é‡Šæ”¾ã€‚\n\n\n\nä¸ƒã€æ€»ç»“Blockæ˜¯iOSå¼€å‘ä¸­ä¸€é¡¹éå¸¸å¼ºå¤§çš„åŠŸèƒ½ï¼Œå®ƒæä¾›äº†ç®€æ´ä¸”æ˜“ç”¨çš„æ¥å£æ¥å°è£…ä»£ç å—ï¼Œå¹¶å…è®¸æ•è·å’Œä¿ç•™å¤–éƒ¨å˜é‡ã€‚ç„¶è€Œï¼Œåœ¨ä½¿ç”¨Blockæ—¶ï¼Œä¹Ÿéœ€è¦æ³¨æ„å…¶å†…å­˜ç®¡ç†å’Œå¾ªç¯å¼•ç”¨ç­‰é—®é¢˜ã€‚é€šè¿‡æ·±å…¥ç†è§£Blockçš„åº•å±‚å®ç°å’Œä½¿ç”¨åœºæ™¯ï¼Œå¼€å‘è€…å¯ä»¥æ›´åŠ é«˜æ•ˆåœ°åˆ©ç”¨è¿™ä¸€åŠŸèƒ½æ¥ç¼–å†™å‡ºæ›´åŠ ä¼˜é›…å’Œå¥å£®çš„ä»£ç ã€‚\n","categories":["åŸºç¡€"]},{"title":"Day7-åˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨","url":"/2025/04/30/Day7-%E5%90%88%E5%B9%B6%E4%B8%A4%E4%B8%AA%E6%9C%89%E5%BA%8F%E9%93%BE%E8%A1%A8/","content":"ğŸ”— LeetCode 21 - Merge Two Sorted Lists\nğŸ“Œ é¢˜ç›®æè¿°å°†ä¸¤ä¸ªå‡åºé“¾è¡¨åˆå¹¶ä¸ºä¸€ä¸ªæ–°çš„ å‡åº é“¾è¡¨å¹¶è¿”å›ã€‚æ–°é“¾è¡¨æ˜¯é€šè¿‡æ‹¼æ¥ç»™å®šçš„ä¸¤ä¸ªé“¾è¡¨çš„æ‰€æœ‰èŠ‚ç‚¹ç»„æˆçš„ã€‚\nç¤ºä¾‹ï¼š\nè¾“å…¥: l1 = [1,2,4], l2 = [1,3,4]è¾“å‡º: [1,1,2,3,4,4]\n\n\nğŸ’¡ è§£é¢˜æ€è·¯\nä½¿ç”¨ é€’å½’ æˆ– è¿­ä»£ æ–¹æ³•é€æ­¥å°†ä¸¤ä¸ªé“¾è¡¨ä¸­è¾ƒå°çš„èŠ‚ç‚¹è¿æ¥èµ·æ¥ï¼›\n\né€’å½’å†™æ³•ç®€æ´ä¼˜é›…ï¼Œä½†è¿­ä»£å†™æ³•æ›´å®¹æ˜“æ§åˆ¶ç©ºé—´å¤æ‚åº¦ã€‚\n\næ—¶é—´å¤æ‚åº¦ï¼šO(n + m)ï¼Œå…¶ä¸­ n å’Œ m åˆ†åˆ«æ˜¯ä¸¤ä¸ªé“¾è¡¨çš„é•¿åº¦ï¼›\n\nç©ºé—´å¤æ‚åº¦ï¼š\n\né€’å½’ï¼šO(n + m)ï¼Œå› ä¸ºé€’å½’æ ˆï¼›\nè¿­ä»£ï¼šO(1)\n\n\n\n\nâœ… JavaScript å®ç°ï¼ˆè¿­ä»£ï¼‰var mergeTwoLists = function(l1, l2) &#123;    let dummy = new ListNode(-1);    let current = dummy;    while (l1 !== null &amp;&amp; l2 !== null) &#123;        if (l1.val &lt;= l2.val) &#123;            current.next = l1;            l1 = l1.next;        &#125; else &#123;            current.next = l2;            l2 = l2.next;        &#125;        current = current.next;    &#125;    current.next = l1 !== null ? l1 : l2;    return dummy.next;&#125;;\n\n\nâœ… JavaScript å®ç°ï¼ˆé€’å½’ï¼‰var mergeTwoLists = function(l1, l2) &#123;    if (l1 === null) return l2;    if (l2 === null) return l1;    if (l1.val &lt;= l2.val) &#123;        l1.next = mergeTwoLists(l1.next, l2);        return l1;    &#125; else &#123;        l2.next = mergeTwoLists(l1, l2.next);        return l2;    &#125;&#125;;\n\n\nğŸ§  æ€è€ƒæ‹“å±•\nå¦‚ä½•åœ¨ä¸åˆ›å»ºæ–°é“¾è¡¨èŠ‚ç‚¹çš„æƒ…å†µä¸‹åˆå¹¶ï¼Ÿ\nå¦‚æœé“¾è¡¨ä¸æ˜¯å‡åºè€Œæ˜¯æ— åºï¼Œå¦‚ä½•åˆå¹¶åæ’åºï¼Ÿ\n\n\n","categories":["ç®—æ³•"]},{"title":"Day8-RunLoop æ„æˆä¸çº¿ç¨‹ä¿æ´»","url":"/2025/05/06/Day8-RunLoop-%E6%9E%84%E6%88%90%E4%B8%8E%E7%BA%BF%E7%A8%8B%E4%BF%9D%E6%B4%BB/","content":"ä¸€ã€RunLoop çš„æ„æˆRunLoop æ˜¯åŸºäº CFRunLoopRefï¼ˆCore Foundation å±‚ï¼‰æ„å»ºçš„ï¼ŒNSRunLoop æ˜¯å…¶ Foundation å±‚çš„å°è£…ã€‚æ ¸å¿ƒç»„æˆå¦‚ä¸‹ï¼š\n1. RunLoop å¯¹è±¡\næ¯æ¡çº¿ç¨‹éƒ½æœ‰å”¯ä¸€çš„ä¸€ä¸ª RunLoop å¯¹è±¡ï¼ˆä¸»çº¿ç¨‹é»˜è®¤åˆ›å»ºï¼Œå­çº¿ç¨‹éœ€æ‰‹åŠ¨åˆ›å»ºï¼‰ã€‚\n\n2. RunLoopMode\nRunLoop åœ¨ä»»ä¸€æ—¶åˆ»åªèƒ½è¿è¡Œåœ¨ä¸€ç§æ¨¡å¼ä¸‹ã€‚\nå¸¸è§æ¨¡å¼ï¼š\nNSDefaultRunLoopMode\nUITrackingRunLoopMode\nNSRunLoopCommonModes\n\n\n\n3. Sourceï¼ˆäº‹ä»¶æºï¼‰\nSource0ï¼šéåŸºäº Port çš„ï¼Œå¦‚ performSelector:onThread:\nSource1ï¼šåŸºäº Port çš„ï¼Œå¦‚ GCD ä¸»çº¿ç¨‹é€šä¿¡\n\n4. Timer\nNSTimer å’Œ CADisplayLink éƒ½ä¾èµ– RunLoop\n\n5. Observerï¼ˆè§‚å¯Ÿè€…ï¼‰\nç›‘å¬ RunLoop çŠ¶æ€å˜åŒ–ï¼Œå¦‚å°†è¦è¿›å…¥ã€å³å°†å¤„ç†äº‹ä»¶ã€å³å°†ä¼‘çœ ç­‰\n\n6. Port\nçº¿ç¨‹é€šä¿¡è½½ä½“ï¼Œé…åˆ Source1 ä½¿ç”¨\n\n\näºŒã€RunLoop ä¸çº¿ç¨‹ä¿æ´»1. å­çº¿ç¨‹é»˜è®¤è¡Œä¸ºä»»åŠ¡æ‰§è¡Œå®Œå³é€€å‡ºï¼Œå› ä¸ºæ²¡æœ‰ RunLoopã€‚\n2. çº¿ç¨‹ä¿æ´»æ–¹å¼- (void)startThread &#123;    NSThread *thread = [[NSThread alloc] initWithBlock:^&#123;        [[NSRunLoop currentRunLoop] addPort:[NSPort port] forMode:NSDefaultRunLoopMode];        [[NSRunLoop currentRunLoop] run];    &#125;];    [thread start];&#125;\n\n3. æ³¨æ„äº‹é¡¹\nrun ä¼šé˜»å¡çº¿ç¨‹ã€‚\nRunLoop éœ€è¦è‡³å°‘ä¸€ä¸ª Input Source å¦åˆ™ä¼šç«‹åˆ»é€€å‡ºã€‚\n\n\nä¸‰ã€RunLoop çš„å®é™…åº”ç”¨ï¼ˆå«ç¤ºä¾‹ï¼‰1. ä¿æŒçº¿ç¨‹ä¸é€€å‡ºåå°æ—¥å¿—æ”¶é›†&#x2F;è§£ç ä»»åŠ¡ä¸­ä½¿ç”¨ RunLoop ä¿æ´»çº¿ç¨‹ã€‚\n2. äº‹ä»¶å“åº”æœºåˆ¶å¦‚ Touchã€Button ç‚¹å‡»ï¼Œé€šè¿‡ Source1 åˆ†å‘ç»™ä¸»çº¿ç¨‹ RunLoopã€‚\n3. å®šæ—¶å™¨NSTimer&#x2F;CADisplayLink ä¾èµ– RunLoop è§¦å‘ã€‚\n4. GCD ä¸»é˜Ÿåˆ—å›è°ƒå»¶è¿Ÿä¸»çº¿ç¨‹å¡é¡¿æ—¶å»¶è¿Ÿæ‰§è¡Œï¼ŒåŸå› æ˜¯ GCD å›è°ƒä¾èµ– Source1ã€‚\n5. UI æ»šåŠ¨ä¸äº‹ä»¶éš”ç¦»æ»šåŠ¨ UIScrollView æ—¶åˆ‡æ¢ Modeï¼Œæš‚åœå®šæ—¶å™¨è§¦å‘ã€‚\n6. AutoreleasePool ç®¡ç†RunLoop æ¯æ¬¡å¾ªç¯è‡ªåŠ¨åˆ›å»º&#x2F;é‡Šæ”¾ poolï¼Œé˜²æ­¢æ³„éœ²ã€‚\n7. çº¿ç¨‹é—´é€šä¿¡åŸºäº Port çš„æ¶ˆæ¯ä¼ é€’ï¼Œç»“åˆ Source1 å®ç°ã€‚\n\nå››ã€RunLoop å®ç°åŸç†RunLoop æœ¬è´¨æ˜¯ä¸€ä¸ªåŸºäºäº‹ä»¶å¾ªç¯çš„ç»“æ„ï¼š\nwhile (!stop) &#123;    __CFRunLoopDoObservers(kCFRunLoopEntry);    __CFRunLoopDoTimers();    __CFRunLoopDoSources0();    mach_msg(); // ç­‰å¾…æ¶ˆæ¯å”¤é†’    __CFRunLoopDoSources1();    __CFRunLoopDoObservers(kCFRunLoopExit);&#125;\n\næ ¸å¿ƒæœºåˆ¶ï¼š\n\n\næ¨¡å—\nè¯´æ˜\n\n\n\nmach_port\nåº•å±‚é€šä¿¡æœºåˆ¶\n\n\nSource0\nè‡ªå®šä¹‰äº‹ä»¶\n\n\nSource1\nç³»ç»Ÿäº‹ä»¶ï¼ˆå¦‚ GCDï¼‰\n\n\nTimer\nå®šæ—¶ä»»åŠ¡\n\n\nObserver\nçŠ¶æ€ç›‘å¬\n\n\nMode\näº‹ä»¶éš”ç¦»ä¸åˆ‡æ¢æ¨¡å¼\n\n\nMode ä¸ Input Source å…³ç³»ç»“æ„ï¼šRunLoop â”œâ”€â”€ ModeA â”‚    â”œâ”€â”€ Source0 â”‚    â”œâ”€â”€ Source1 â”‚    â”œâ”€â”€ Timer â”‚    â””â”€â”€ Observer â””â”€â”€ ModeB      â”œâ”€â”€ Source0      â””â”€â”€ ...\n\n\näº”ã€æ€»ç»“\n\n\nåˆ†ç±»\nåº”ç”¨\n\n\n\nUIäº¤äº’\näº‹ä»¶å“åº”ã€è§¦æ‘¸åˆ†å‘ã€ä¸»é˜Ÿåˆ— GCD\n\n\nå¤šçº¿ç¨‹\nçº¿ç¨‹ä¿æ´»ã€çº¿ç¨‹é€šä¿¡\n\n\næ€§èƒ½ä¼˜åŒ–\næ»šåŠ¨æ—¶æš‚åœåŠ¨ç”»\n\n\nå†…å­˜ç®¡ç†\nè‡ªåŠ¨é‡Šæ”¾æ± ç®¡ç†\n\n\nåŠ¨ç”»å¤„ç†\nCADisplayLink åˆ·æ–°å¸§ç‡\n\n\n","categories":["åŸºç¡€"]},{"title":"Day9-RunLoop å¡é¡¿ä¼˜åŒ–ä¸ç›‘æ§å®ç°","url":"/2025/05/07/Day9-RunLoop-%E5%8D%A1%E9%A1%BF%E4%BC%98%E5%8C%96%E4%B8%8E%E7%9B%91%E6%8E%A7%E5%AE%9E%E7%8E%B0/","content":"iOS RunLoop å¡é¡¿ä¼˜åŒ–æŒ‡å—ä¸€ã€ç†è§£ RunLoop å¡é¡¿çš„æœ¬è´¨1. RunLoop åŸºæœ¬æœºåˆ¶RunLoop æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªäº‹ä»¶å¾ªç¯æœºåˆ¶ï¼Œä¸»è¦ç”¨äºçº¿ç¨‹çš„ä»»åŠ¡è°ƒåº¦ã€‚åœ¨ä¸»çº¿ç¨‹ä¸­ï¼ŒRunLoop è´Ÿè´£å¤„ç†ï¼š\n\nè§¦æ‘¸äº‹ä»¶\nå®šæ—¶å™¨äº‹ä»¶ï¼ˆNSTimerã€CADisplayLinkï¼‰\nUI æ¸²æŸ“\nGCD ä¸»é˜Ÿåˆ—ä»»åŠ¡\nç³»ç»Ÿäº‹ä»¶ï¼ˆæ¯”å¦‚é”®ç›˜å¼¹å‡ºï¼‰\n\n2. å¡é¡¿ç°è±¡åŸå› ä¸»çº¿ç¨‹å¡é¡¿çš„æœ¬è´¨æ˜¯ RunLoop é•¿æ—¶é—´æ²¡æœ‰è¿”å›åˆ°ç©ºé—²çŠ¶æ€ï¼Œå¸¸è§åŸå› ï¼š\n\nåŒæ­¥è€—æ—¶ä»»åŠ¡é˜»å¡ä¸»çº¿ç¨‹ï¼ˆå¦‚æ–‡ä»¶ IOã€ç½‘ç»œè¯·æ±‚ã€å¤æ‚è®¡ç®—ï¼‰\nUI æ¸²æŸ“è¿‡æ…¢ï¼ˆå¤§é‡ç»˜åˆ¶ã€å›¾ç‰‡è§£ç ï¼‰\né«˜é¢‘æ¬¡å®šæ—¶å™¨ä»»åŠ¡\næ­»é”æˆ–çº¿ç¨‹æŠ¢å èµ„æº\n\näºŒã€RunLoop å¡é¡¿ç›‘æ§1. ä½¿ç”¨ RunLoop Observer æ£€æµ‹å¡é¡¿CFRunLoopObserverRef observer = CFRunLoopObserverCreateWithHandler(NULL, kCFRunLoopAllActivities, YES, 0, ^(CFRunLoopObserverRef observer, CFRunLoopActivity activity) &#123;    // è®°å½•è¿›å…¥å’Œé€€å‡ºæ—¶é—´ï¼Œåˆ¤æ–­è€—æ—¶&#125;);CFRunLoopAddObserver(CFRunLoopGetMain(), observer, kCFRunLoopCommonModes);\n\n2. å¸¸ç”¨å·¥å…·\nFPS ç›‘æ§å·¥å…·\nTime Profilerï¼ˆå®šä½å¡é¡¿è°ƒç”¨æ ˆï¼‰\nInstruments çš„ Core Animationï¼ˆæ£€æµ‹ UI ç»˜åˆ¶ï¼‰\nè‡ªè¡Œå®ç°å¡é¡¿ç›‘æ§ï¼ˆå¯è®¾å®šé˜ˆå€¼ï¼Œå¦‚è¶…è¿‡ 200msï¼‰\n\nä¸‰ã€RunLoop å¡é¡¿ä¼˜åŒ–ç­–ç•¥1. å‡å°‘ä¸»çº¿ç¨‹å‹åŠ›\nè€—æ—¶æ“ä½œå¼‚æ­¥å¤„ç†ï¼šå¦‚ç½‘ç»œã€æ•°æ®åº“ã€å‹ç¼©ã€è§£ç \nä½¿ç”¨ GCD æˆ– NSOperation å°†ä»»åŠ¡æ”¾åœ¨å­çº¿ç¨‹\n\nDispatchQueue.global().async &#123;    // è€—æ—¶æ“ä½œ    DispatchQueue.main.async &#123;        // å›ä¸»çº¿ç¨‹æ›´æ–° UI    &#125;&#125;\n\n2. å»¶è¿Ÿæˆ–åˆ†æ‰¹æ‰§è¡Œä»»åŠ¡\nä½¿ç”¨ RunLoop idle æ—¶æœºå¤„ç†ä»»åŠ¡\nåˆ©ç”¨ CADisplayLink æ‹†åˆ†ä»»åŠ¡ï¼ˆå…¸å‹å¦‚ tableView cell å¼‚æ­¥ç»˜åˆ¶ï¼‰\n\nCADisplayLink *link = [CADisplayLink displayLinkWithTarget:self selector:@selector(step)];[link addToRunLoop:[NSRunLoop mainRunLoop] forMode:NSRunLoopCommonModes];\n\n3. å›¾åƒåŠ è½½ä¼˜åŒ–\nå›¾ç‰‡è§£ç ã€å‹ç¼©å¤„ç†æ”¾åˆ°å­çº¿ç¨‹\nä½¿ç”¨å¼‚æ­¥å›¾ç‰‡åŠ è½½æ¡†æ¶ï¼ˆå¦‚ SDWebImageã€Kingfisherï¼‰\n\n4. ä¼˜åŒ– UI ç»˜åˆ¶\nå‡å°‘ä¸å¿…è¦çš„è§†å›¾å±‚çº§\nåˆç†ä½¿ç”¨ rasterization, shouldRasterizeï¼Œé¿å…é¢‘ç¹é‡ç»˜\nå°½é‡ä½¿ç”¨ CALayer åšåŠ¨ç”»æˆ–ç»˜åˆ¶\n\n5. ä¼˜åŒ–å®šæ—¶å™¨\né¿å…ä½¿ç”¨è¿‡å¤šé«˜é¢‘ç‡çš„ NSTimer\nç”¨ CADisplayLink æˆ– DispatchSourceTimer ç²¾ç¡®æ§åˆ¶\næ³¨æ„é‡Šæ”¾å®šæ—¶å™¨ï¼Œé˜²æ­¢å¾ªç¯å¼•ç”¨æˆ–å†…å­˜æ³„æ¼\n\nå››ã€è¿›é˜¶å»ºè®®ä½¿ç”¨ RunLoop æ¨¡å‹å®ç°ä»»åŠ¡è°ƒåº¦ï¼ˆå¦‚ YYKit çš„ AsyncLayerï¼‰æ ¸å¿ƒæ€æƒ³ï¼š\n\nä¸»çº¿ç¨‹æ¯å¸§ç©ºé—²é˜¶æ®µå¤„ç†å°‘é‡ä»»åŠ¡ï¼ˆæ¯å¸§åˆ†æ‰¹ï¼‰\né¿å…é˜»å¡ä¸»çº¿ç¨‹\n\nåˆ©ç”¨ä¿¡å·é‡&#x2F; watchdog æ£€æµ‹ä¸¥é‡å¡é¡¿å¯ç”¨ dispatch_semaphore é…åˆå­çº¿ç¨‹æ£€æµ‹ä¸»çº¿ç¨‹é•¿æ—¶é—´ä¸å“åº”ï¼Œè¿›è¡Œå¡é¡¿ä¸ŠæŠ¥ã€‚\näº”ã€æ€»ç»“\n\n\nä¼˜åŒ–æ‰‹æ®µ\næ˜¯å¦æ¨è\nåœºæ™¯è¯´æ˜\n\n\n\nè€—æ—¶ä»»åŠ¡å¼‚æ­¥åŒ–\nâœ…\nç½‘ç»œã€å›¾ç‰‡ã€è®¡ç®—ç­‰\n\n\nUI ç»˜åˆ¶ä¼˜åŒ–\nâœ…\nå¤šå›¾é¡µé¢ã€å¤æ‚è§†å›¾\n\n\nRunLoop ç©ºé—²ä»»åŠ¡è°ƒåº¦\nâœ…\næ‰¹é‡ä»»åŠ¡ï¼Œé™ä½ç¬æ—¶å‹åŠ›\n\n\nå¡é¡¿ç›‘æ§å·¥å…·æ¥å…¥\nâœ…\næå‰å‘ç°é—®é¢˜\n\n\nè‡ªå®šä¹‰ RunLoop è°ƒåº¦\nâœ…\né«˜é˜¶ä¼˜åŒ–ï¼Œå¦‚ä»»åŠ¡ä¼˜å…ˆçº§\n\n\n\niOS ä¸»çº¿ç¨‹å¡é¡¿ç›‘æ§å®ç°æ–¹æ¡ˆğŸ”§ æ–¹æ¡ˆæ ¸å¿ƒæ€è·¯\nåˆ©ç”¨ CFRunLoopObserver ç›‘å¬ RunLoop å„é˜¶æ®µï¼›\nåœ¨å­çº¿ç¨‹ä¸­å¼€å¯å®šæ—¶å™¨ï¼Œæ£€æŸ¥ä¸»çº¿ç¨‹æ˜¯å¦é•¿æ—¶é—´åœç•™åœ¨æŸä¸ªé˜¶æ®µï¼›\nè¶…è¿‡é˜ˆå€¼ï¼ˆå¦‚ 200msï¼‰å³åˆ¤å®šä¸ºå¡é¡¿ï¼Œå¹¶è®°å½•å †æ ˆã€‚\n\nâœ… ç¤ºä¾‹ä»£ç ï¼ˆObjective-Cï¼‰@interface MainThreadMonitor : NSObject@end@implementation MainThreadMonitor &#123;    CFRunLoopObserverRef observer;    dispatch_semaphore_t semaphore;    CFRunLoopActivity activity;    BOOL isMonitoring;&#125;- (instancetype)init &#123;    if (self = [super init]) &#123;        semaphore = dispatch_semaphore_create(0);    &#125;    return self;&#125;- (void)startMonitoring &#123;    if (isMonitoring) return;    isMonitoring = YES;    // 1. è®¾ç½® RunLoop è§‚å¯Ÿè€…    CFRunLoopObserverContext context = &#123;0, (__bridge void *)self, NULL, NULL, NULL&#125;;    observer = CFRunLoopObserverCreate(NULL, kCFRunLoopAllActivities, YES, 0, &amp;runLoopCallback, &amp;context);    CFRunLoopAddObserver(CFRunLoopGetMain(), observer, kCFRunLoopCommonModes);        // 2. åœ¨å­çº¿ç¨‹ä¸­æ£€æµ‹ä¸»çº¿ç¨‹å¡é¡¿    dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_HIGH, 0), ^&#123;        while (self-&gt;isMonitoring) &#123;            long result = dispatch_semaphore_wait(self-&gt;semaphore, dispatch_time(DISPATCH_TIME_NOW, 200 * NSEC_PER_MSEC));            if (result != 0) &#123;                if (self-&gt;activity == kCFRunLoopBeforeSources || self-&gt;activity == kCFRunLoopAfterWaiting) &#123;                    NSLog(@&quot;âš ï¸ å‘ç°å¡é¡¿&quot;);                    [self logMainThreadStack];                &#125;            &#125;        &#125;    &#125;);&#125;// RunLoop å›è°ƒstatic void runLoopCallback(CFRunLoopObserverRef observer, CFRunLoopActivity act, void *info) &#123;    MainThreadMonitor *monitor = (__bridge MainThreadMonitor *)info;    monitor-&gt;activity = act;    dispatch_semaphore_signal(monitor-&gt;semaphore);&#125;// æ‰“å°ä¸»çº¿ç¨‹å †æ ˆ- (void)logMainThreadStack &#123;    thread_act_t thread = mach_thread_self();    NSString *stack = [self getStackForThread:mach_thread_self()];    NSLog(@&quot;å¡é¡¿å †æ ˆï¼š%@&quot;, stack);&#125;// è·å–å †æ ˆï¼ˆå¯ç”¨ PLCrashReporter æˆ–è‡ªå·±è§£æï¼‰- (NSString *)getStackForThread:(thread_t)thread &#123;    void *callstack[128];    int frames = backtrace(callstack, 128);    char **strs = backtrace_symbols(callstack, frames);    NSMutableString *stack = [NSMutableString string];    for (int i = 0; i &lt; frames; i++) &#123;        [stack appendFormat:@&quot;%s&quot;, strs[i]];    &#125;    free(strs);    return stack;&#125;- (void)stopMonitoring &#123;    if (!isMonitoring) return;    isMonitoring = NO;    if (observer) &#123;        CFRunLoopRemoveObserver(CFRunLoopGetMain(), observer, kCFRunLoopCommonModes);        CFRelease(observer);        observer = NULL;    &#125;&#125;@end\n\nğŸ“Œ ä½¿ç”¨æ–¹å¼MainThreadMonitor *monitor = [[MainThreadMonitor alloc] init];[monitor startMonitoring];\n\nğŸš€ è¡¥å……ä¼˜åŒ–å»ºè®®\nä¸Šä¼ å¡é¡¿ä¿¡æ¯ åˆ°æœåŠ¡ç«¯åˆ†æï¼ˆåŒ…æ‹¬æ—¶é—´æˆ³ã€å †æ ˆã€è®¾å¤‡ä¿¡æ¯ç­‰ï¼‰ï¼›\nä½¿ç”¨ PLCrashReporter æ•è·å®Œæ•´å †æ ˆï¼›\né¿å…è¯¯æŠ¥ï¼ˆå¯è®¾å®š N æ¬¡è¿ç»­å¡é¡¿åæ‰è§¦å‘ä¸ŠæŠ¥ï¼‰ï¼›\næ·»åŠ  FPS ç›‘æ§ä½œä¸ºè¾…åŠ©å‚è€ƒã€‚\n\niOS å®Œæ•´å †æ ˆæ•è·å®ç°åŸç†ğŸ” æ ˆå¸§æ•è·çš„åŸç†æ¦‚è¿°1. æ ˆå¸§ç»“æ„ï¼ˆä»¥ x86_64 ä¸ºä¾‹ï¼‰æ¯æ¬¡å‡½æ•°è°ƒç”¨æ—¶ï¼Œç³»ç»Ÿä¼šåœ¨æ ˆä¸­ä¿å­˜ï¼š\n\nè¿”å›åœ°å€ï¼ˆreturn addressï¼‰\nä¸Šä¸€ä¸ªå‡½æ•°çš„æ ˆå¸§æŒ‡é’ˆï¼ˆframe pointerï¼‰\nå‡½æ•°å‚æ•°å’Œå±€éƒ¨å˜é‡\n\nå› æ­¤ï¼Œé€šè¿‡ å½“å‰å¸§çš„ frame pointerï¼ˆrbpï¼‰ï¼Œå¯ä»¥å›æº¯å‰ä¸€ä¸ªå‡½æ•°çš„å¸§ï¼Œå½¢æˆè°ƒç”¨é“¾ã€‚\nå½“å‰æ ˆå¸§ï¼š| return address || previous RBP   |  &lt;---- å½“å‰ RBP æŒ‡å‘è¿™é‡Œ| arguments      || local vars     |\n\nä¸æ–­éå† RBPï¼Œå°±å¯ä»¥å¾—åˆ°ä¸€è¿ä¸²çš„è°ƒç”¨è·¯å¾„ã€‚\n\n2. backtrace() ä¸ backtrace_symbols()è‹¹æœç³»ç»Ÿæä¾›äº† glibc çš„æ¥å£ï¼Œèƒ½è·å–å½“å‰çº¿ç¨‹çš„è°ƒç”¨æ ˆä¿¡æ¯ï¼š\nvoid *callstack[128];int frames = backtrace(callstack, 128);  // è·å¾— return address æ•°ç»„char **strs = backtrace_symbols(callstack, frames); // è½¬ä¸ºç¬¦å·åŒ–å­—ç¬¦ä¸²\n\n\nbacktrace()ï¼šè¿”å›æŒ‡é’ˆæ•°ç»„ï¼Œæ¯ä¸ªæŒ‡é’ˆæ˜¯ä¸€ä¸ªè¿”å›åœ°å€ï¼ˆPC å€¼ï¼‰\nbacktrace_symbols()ï¼šå°†åœ°å€è§£æä¸ºå‡½æ•°åï¼ˆå¸¦ç¬¦å·ä¿¡æ¯ï¼‰\n\n\nâœ… é€‚ç”¨äºå½“å‰çº¿ç¨‹âŒ æ— æ³•æ•è·å…¶ä»–çº¿ç¨‹çš„å †æ ˆ\n\n\nğŸ§  æ•è·å…¶ä»–çº¿ç¨‹å †æ ˆçš„é«˜çº§åšæ³•1. ä½¿ç”¨ Mach çº¿ç¨‹ API è·å–ä¸Šä¸‹æ–‡macOS å’Œ iOS çš„çº¿ç¨‹ç”± Mach çº¿ç¨‹é©±åŠ¨ï¼Œå¯ä½¿ç”¨å¦‚ä¸‹æ–¹å¼è·å–ä»»æ„çº¿ç¨‹çš„çŠ¶æ€ï¼š\nthread_act_t thread = mach_thread_self(); // æˆ–ä¸»çº¿ç¨‹ mach_port_ARM_THREAD_STATE64 state;mach_msg_type_number_t count = _ARM_THREAD_STATE64_COUNT;thread_get_state(thread, ARM_THREAD_STATE64, (thread_state_t)&amp;state, &amp;count);\n\n\nå¯æ‹¿åˆ°å¯„å­˜å™¨ä¿¡æ¯ï¼ˆå¦‚ pc, lr, fpï¼‰\nä» fpï¼ˆframe pointerï¼‰å¼€å§‹ï¼Œæ‰‹åŠ¨è§£æå†…å­˜è·å–è°ƒç”¨é“¾\n\n2. ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“å°è£…ï¼ˆæ¨èï¼‰\nPLCrashReporter\nKSCrash\n\nå®ƒä»¬åœ¨å´©æºƒæˆ–å¡é¡¿æ—¶ï¼š\n\næŒ‚èµ·çº¿ç¨‹\nè¯»å–çº¿ç¨‹ä¸Šä¸‹æ–‡å¯„å­˜å™¨ï¼ˆå¦‚ pcã€spã€fpï¼‰\næ‰‹åŠ¨å›æº¯è°ƒç”¨æ ˆ\nè¿›è¡Œç¬¦å·åŒ–è¾“å‡º\n\n\nâš ï¸ æ³¨æ„äº‹é¡¹\næ‰‹åŠ¨è¯»å–çº¿ç¨‹å¯„å­˜å™¨æœ‰é£é™©ï¼ˆéœ€æŒ‚èµ·çº¿ç¨‹ï¼Œé˜²æ­¢æ ˆå˜åŒ–ï¼‰\nå¯¹äºä¼˜åŒ–æˆ–å†…è”å‡½æ•°ï¼Œå¯èƒ½æ— æ³•è·å–å®Œæ•´ä¿¡æ¯\nç³»ç»Ÿå‡½æ•°ç¬¦å·åŒ–ä¾èµ– dSYM æˆ–ç¬¦å·è¡¨\n\n\nâœ… å„æ–¹æ¡ˆå¯¹æ¯”\n\n\næ–¹æ³•\nä¼˜åŠ¿\nå±€é™\n\n\n\nbacktrace\nç®€å•æ˜“ç”¨ï¼Œå½“å‰çº¿ç¨‹è°ƒç”¨æ ˆ\nä»…å½“å‰çº¿ç¨‹ï¼Œä¿¡æ¯ä¸å®Œæ•´\n\n\nMach API + å¯„å­˜å™¨è§£æ\nå¯æ•è·ä»»æ„çº¿ç¨‹å †æ ˆ\nå®ç°å¤æ‚ï¼Œéœ€æŒ‚èµ·çº¿ç¨‹\n\n\nPLCrashReporter\nç¨³å®šå°è£…ï¼Œæ”¯æŒå´©æºƒ&#x2F;å¡é¡¿&#x2F;ç¬¦å·åŒ–\nå¢åŠ ä¾èµ–åŒ…ï¼Œå¤§å°ç•¥å¤§\n\n\n\nğŸ“Œ æ¨èå®è·µ\nå¼‚å¸¸æˆ–å¡é¡¿å‘ç”Ÿæ—¶æš‚åœä¸»çº¿ç¨‹ â†’ è·å–å¯„å­˜å™¨çŠ¶æ€ â†’ å›æº¯è°ƒç”¨é“¾\nä½¿ç”¨ç¬¬ä¸‰æ–¹åº“å¦‚ PLCrashReporter è¿›è¡Œå®‰å…¨å°è£…\næ­é…ç¬¦å·è¡¨ï¼ˆ.dSYMï¼‰è¿›è¡Œç¬¦å·åŒ–ï¼Œä»¥ä¾¿è¿œç¨‹åˆ†æ\n\n","categories":["åŸºç¡€"]},{"title":"Day8-éªŒè¯å›æ–‡ä¸²","url":"/2025/05/06/Day8-%E9%AA%8C%E8%AF%81%E5%9B%9E%E6%96%87%E4%B8%B2/","content":"ğŸ”— LeetCode 125 - Valid Palindrome\nğŸ“Œ é¢˜ç›®æè¿°ç»™å®šä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œåˆ¤æ–­å®ƒæ˜¯å¦æ˜¯å›æ–‡ï¼Œåªè€ƒè™‘å­—æ¯å’Œæ•°å­—å­—ç¬¦ï¼Œå¯ä»¥å¿½ç•¥å­—æ¯çš„å¤§å°å†™ã€‚\nç¤ºä¾‹ï¼š\nè¾“å…¥: &quot;A man, a plan, a canal: Panama&quot;è¾“å‡º: trueè¾“å…¥: &quot;race a car&quot;è¾“å‡º: false\n\n\nğŸ’¡ è§£é¢˜æ€è·¯\nä½¿ç”¨åŒæŒ‡é’ˆæ³•ï¼›\n\nä»å¤´å°¾ä¸¤ç«¯éå†ï¼Œåªä¿ç•™å­—æ¯å’Œæ•°å­—ï¼Œç»Ÿä¸€è½¬æˆå°å†™åæ¯”è¾ƒï¼›\n\nå¿½ç•¥å…¶ä»–ç¬¦å·ã€‚\n\næ—¶é—´å¤æ‚åº¦ï¼šO(n)\n\nç©ºé—´å¤æ‚åº¦ï¼šO(1)\n\n\n\nâœ… JavaScript å®ç°var isPalindrome = function(s) &#123;    let left = 0, right = s.length - 1;    while (left &lt; right) &#123;        while (left &lt; right &amp;&amp; !isAlphaNum(s[left])) left++;        while (left &lt; right &amp;&amp; !isAlphaNum(s[right])) right--;        if (s[left].toLowerCase() !== s[right].toLowerCase()) return false;        left++;        right--;    &#125;    return true;&#125;;function isAlphaNum(c) &#123;    return /^[a-zA-Z0-9]$/.test(c);&#125;\n\n\nğŸ§  æ€è€ƒæ‹“å±•\nå¦‚ä½•å¤„ç† Unicode å­—ç¬¦ï¼ˆå¦‚ä¸­æ–‡ã€Emojiï¼‰ï¼Ÿ\nå¦‚æœéœ€è¦è€ƒè™‘å›æ–‡å­ä¸²ï¼Œå¦‚ä½•ä¼˜åŒ–ï¼Ÿ\n\n\n","categories":["ç®—æ³•"]},{"title":"Day9-åªå‡ºç°ä¸€æ¬¡çš„æ•°å­—","url":"/2025/05/07/Day9-%E5%8F%AA%E5%87%BA%E7%8E%B0%E4%B8%80%E6%AC%A1%E7%9A%84%E6%95%B0%E5%AD%97/","content":"ğŸ”— LeetCode 136 - Single Number\nğŸ“Œ é¢˜ç›®æè¿°ç»™å®šä¸€ä¸ªéç©ºæ•´æ•°æ•°ç»„ numsï¼Œé™¤äº†æŸä¸ªå…ƒç´ åªå‡ºç°ä¸€æ¬¡ä»¥å¤–ï¼Œå…¶ä½™æ¯ä¸ªå…ƒç´ å‡å‡ºç°ä¸¤æ¬¡ã€‚æ‰¾å‡ºé‚£ä¸ªåªå‡ºç°äº†ä¸€æ¬¡çš„å…ƒç´ ã€‚\nä½ å¿…é¡»åœ¨çº¿æ€§æ—¶é—´å¤æ‚åº¦å†…å®Œæˆç®—æ³•ï¼Œå¹¶ä¸”ä¸èƒ½ä½¿ç”¨é¢å¤–ç©ºé—´ã€‚\nç¤ºä¾‹ï¼š\nè¾“å…¥: [4,1,2,1,2]è¾“å‡º: 4\n\n\nğŸ’¡ è§£é¢˜æ€è·¯\nå¼‚æˆ–è¿ç®—çš„å…³é”®ç‰¹æ€§ï¼š\na ^ a = 0\na ^ 0 = a\n\n\næ‰€ä»¥å°†æ‰€æœ‰æ•°å­—è¿›è¡Œå¼‚æˆ–æ“ä½œï¼Œæˆå¯¹çš„æ•°å­—ä¼šæŠµæ¶ˆä¸º 0ï¼Œå‰©ä¸‹çš„å°±æ˜¯é‚£ä¸ªåªå‡ºç°äº†ä¸€æ¬¡çš„æ•°å­—ã€‚\n\n\nâœ… JavaScript å®ç°var singleNumber = function(nums) &#123;    let result = 0;    for (let num of nums) &#123;        result ^= num;    &#125;    return result;&#125;;\n\n\nğŸŸ£ Swift å®ç°func singleNumber(_ nums: [Int]) -&gt; Int &#123;    var result = 0    for num in nums &#123;        result ^= num    &#125;    return result&#125;\n\n\nğŸ§  æ€è€ƒæ‹“å±•\nå¦‚æœä¸€ä¸ªå…ƒç´ å‡ºç°ä¸€æ¬¡ï¼Œå…¶ä½™å‡ºç°ä¸‰æ¬¡ï¼Œè¯¥æ€ä¹ˆåšï¼Ÿ\nå¦‚æœæœ‰ä¸¤ä¸ªåªå‡ºç°ä¸€æ¬¡çš„æ•°å­—ï¼Œå…¶ä½™éƒ½å‡ºç°ä¸¤æ¬¡å‘¢ï¼Ÿ\nå¦‚ä½•ç”¨ä½è¿ç®—ç»Ÿè®¡ä»»æ„æ¬¡æ•°çš„é‡å¤ï¼Ÿ\n\n","categories":["ç®—æ³•"]},{"title":"Mach-O","url":"/2025/05/16/MachO/","content":"Mach-O æ˜¯ macOS å’Œ iOS å¹³å°ä¸Šä½¿ç”¨çš„å¯æ‰§è¡Œæ–‡ä»¶æ ¼å¼ã€‚\nMach-O æ–‡ä»¶æ ¼å¼ç”¨äº macOS å’Œ iOS ä¸­çš„å¯æ‰§è¡Œæ–‡ä»¶ã€åŠ¨æ€åº“å’Œæ ¸å¿ƒè½¬å‚¨ç­‰ã€‚Mach-O æ–‡ä»¶åŒ…å«å¤šä¸ªéƒ¨åˆ†ï¼Œæ¯ä¸ªéƒ¨åˆ†éƒ½å…·æœ‰ç‰¹å®šçš„ç»“æ„å’ŒåŠŸèƒ½ã€‚\nMach-O æ–‡ä»¶å¤´Mach-O æ–‡ä»¶çš„å¼€å§‹éƒ¨åˆ†æ˜¯æ–‡ä»¶å¤´ï¼ˆMachHeaderï¼‰ï¼Œå®ƒåŒ…å«äº†æ–‡ä»¶çš„åŸºæœ¬ä¿¡æ¯ã€‚æ–‡ä»¶å¤´åˆ†ä¸ºä¸¤ç§ç±»å‹ï¼š32ä½ï¼ˆmach_headerï¼‰å’Œ 64ä½ï¼ˆmach_header_64ï¼‰ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ª 64 ä½ Mach-O æ–‡ä»¶å¤´çš„ç»“æ„ç¤ºä¾‹ï¼š\nstruct mach_header_64 &#123;    uint32_t    magic;      // æ–‡ä»¶çš„é­”æ•°ï¼Œæ ‡è¯† Mach-O æ–‡ä»¶æ ¼å¼    cpu_type_t  cputype;    // æ¶æ„ç±»å‹    cpu_subtype_t cpusubtype; // æ¶æ„å­ç±»å‹    uint32_t    filetype;   // æ–‡ä»¶ç±»å‹ï¼ˆä¾‹å¦‚ï¼Œå¯æ‰§è¡Œæ–‡ä»¶ã€åŠ¨æ€åº“ï¼‰    uint32_t    ncmds;      // å‘½ä»¤æ•°    uint32_t    sizeofcmds; // å‘½ä»¤æ€»å¤§å°    uint32_t    flags;      // æ ‡å¿—    uint32_t    reserved;   // ä¿ç•™å­—æ®µ&#125;;\n\nmagic: ç”¨äºè¯†åˆ«æ–‡ä»¶æ ¼å¼çš„æ ‡è¯†ç¬¦ï¼Œå¦‚ MH_MAGIC_64ã€‚\ncputype å’Œ cpusubtype: æè¿° CPU æ¶æ„ã€‚\nfiletype: æ–‡ä»¶ç±»å‹ï¼Œå¦‚ MH_EXECUTEï¼ˆå¯æ‰§è¡Œæ–‡ä»¶ï¼‰ã€‚\nncmds å’Œ sizeofcmds: æè¿°äº†æ–‡ä»¶ä¸­çš„åŠ è½½å‘½ä»¤æ•°é‡å’Œå¤§å°ã€‚\n\nä»¥ä¸‹ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ C è¯­è¨€è¯»å– Mach-O æ–‡ä»¶çš„å¤´éƒ¨ä¿¡æ¯ï¼š\n#include &lt;stdio.h&gt;#include &lt;stdlib.h&gt;#include &lt;mach-o/loader.h&gt;void printMachHeader(const char *filename) &#123;    FILE *file = fopen(filename, &quot;rb&quot;);    if (!file) &#123;        perror(&quot;fopen&quot;);        return;    &#125;    struct mach_header_64 header;    fread(&amp;header, sizeof(header), 1, file);    printf(&quot;Magic: 0x%x\\n&quot;, header.magic);    printf(&quot;CPU Type: 0x%x\\n&quot;, header.cputype);    printf(&quot;CPU Subtype: 0x%x\\n&quot;, header.cpusubtype);    printf(&quot;File Type: 0x%x\\n&quot;, header.filetype);    printf(&quot;Number of Commands: %u\\n&quot;, header.ncmds);    printf(&quot;Size of Commands: %u\\n&quot;, header.sizeofcmds);    printf(&quot;Flags: 0x%x\\n&quot;, header.flags);    fclose(file);&#125;int main() &#123;    printMachHeader(&quot;example.macho&quot;);    return 0;&#125;\nåŠ è½½å‘½ä»¤Mach-O æ–‡ä»¶çš„åŠ è½½å‘½ä»¤ï¼ˆload_commandï¼‰ç”¨äºæè¿°æ–‡ä»¶çš„å„ä¸ªéƒ¨åˆ†ï¼Œä¾‹å¦‚æ®µï¼ˆsegmentï¼‰å’ŒèŠ‚ï¼ˆsectionï¼‰ã€‚æ¯ä¸ªåŠ è½½å‘½ä»¤éƒ½æœ‰ä¸€ä¸ªç±»å‹å­—æ®µï¼ˆcmdï¼‰ï¼Œè¡¨ç¤ºå‘½ä»¤çš„å…·ä½“ç±»å‹ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ª segment_command_64 çš„ç»“æ„ç¤ºä¾‹ï¼š\nstruct segment_command_64 &#123;    uint32_t    cmd;        // å‘½ä»¤ç±»å‹ï¼ŒæŒ‡ç¤ºè¿™æ˜¯ä¸€ä¸ªæ®µå‘½ä»¤    uint32_t    cmdsize;    // å‘½ä»¤å¤§å°    char        segname[16];// æ®µåç§°    uint64_t    vmaddr;     // æ®µåœ¨å†…å­˜ä¸­çš„åœ°å€    uint64_t    vmsize;     // æ®µåœ¨å†…å­˜ä¸­çš„å¤§å°    uint64_t    fileoff;    // æ®µåœ¨æ–‡ä»¶ä¸­çš„åç§»    uint64_t    filesize;   // æ®µåœ¨æ–‡ä»¶ä¸­çš„å¤§å°    uint32_t    maxprot;    // æœ€å¤§ä¿æŠ¤å±æ€§    uint32_t    initprot;   // åˆå§‹åŒ–ä¿æŠ¤å±æ€§    uint32_t    nsects;     // æ®µä¸­èŠ‚çš„æ•°é‡    uint32_t    flags;      // æ®µæ ‡å¿—&#125;;\n\ncmd: åŠ è½½å‘½ä»¤çš„ç±»å‹ï¼Œä¾‹å¦‚ LC_SEGMENT_64ã€‚\nsegname: æ®µçš„åç§°ï¼Œå¦‚ __TEXT æˆ– __DATAã€‚\nvmaddr å’Œ vmsize: æè¿°æ®µåœ¨å†…å­˜ä¸­çš„ä½ç½®å’Œå¤§å°ã€‚\nfileoff å’Œ filesize: æè¿°æ®µåœ¨æ–‡ä»¶ä¸­çš„ä½ç½®å’Œå¤§å°ã€‚\n\nèŠ‚ï¼ˆSectionï¼‰æ¯ä¸ªæ®µå¯ä»¥åŒ…å«å¤šä¸ªèŠ‚ï¼ˆsectionï¼‰ã€‚èŠ‚æ˜¯ Mach-O æ–‡ä»¶ä¸­çš„åŸºæœ¬æ•°æ®å•ä½ï¼ŒåŒ…å«å®é™…çš„æ•°æ®æˆ–ä»£ç ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ª section_64 çš„ç»“æ„ç¤ºä¾‹ï¼š\nstruct section_64 &#123;    char        sectname[16]; // èŠ‚åç§°    char        segname[16];  // æ®µåç§°    uint32_t    addr;         // èŠ‚çš„åœ°å€    uint32_t    size;         // èŠ‚çš„å¤§å°    uint32_t    offset;       // èŠ‚åœ¨æ–‡ä»¶ä¸­çš„åç§»    uint32_t    align;        // å¯¹é½    uint32_t    reloff;       // é‡å®šä½ä¿¡æ¯çš„åç§»    uint32_t    nreloc;       // é‡å®šä½æ¡ç›®æ•°é‡    uint32_t    flags;        // èŠ‚æ ‡å¿—    uint32_t    reserved1;    // ä¿ç•™å­—æ®µ    uint32_t    reserved2;    // ä¿ç•™å­—æ®µ    uint32_t    reserved3;    // ä¿ç•™å­—æ®µ&#125;;\n\nsectname å’Œ segname: æè¿°èŠ‚å’Œæ®µçš„åç§°ã€‚\naddr å’Œ size: èŠ‚åœ¨å†…å­˜ä¸­çš„åœ°å€å’Œå¤§å°ã€‚\noffset: èŠ‚åœ¨æ–‡ä»¶ä¸­çš„åç§»ã€‚\nflags: æè¿°èŠ‚çš„å±æ€§ï¼Œå¦‚æ˜¯å¦å¯å†™ã€å¯æ‰§è¡Œç­‰ã€‚\n\nMach-O æ–‡ä»¶å¯èƒ½åŒ…å«é‡å®šä½ä¿¡æ¯ï¼Œç”¨äºåœ¨åŠ è½½æ—¶è°ƒæ•´ä»£ç æˆ–æ•°æ®çš„åœ°å€ã€‚é‡å®šä½ä¿¡æ¯å­˜å‚¨åœ¨ segment_command çš„ reloff å’Œ nreloc å­—æ®µä¸­ã€‚\nMachOView 3.0ç‰ˆæœ¬MachOView æ˜¯ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œç”¨äºè§£æå’Œå¯è§†åŒ– Mach-O æ–‡ä»¶ï¼Œè¿™æ˜¯ macOS å’Œ iOS ç³»ç»Ÿä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶æ ¼å¼ã€‚è¿™ä¸ªå·¥å…·å¯ä»¥å¸®åŠ©å¼€å‘è€…æŸ¥çœ‹å’Œåˆ†æ Mach-O æ–‡ä»¶çš„ç»“æ„å’Œå†…å®¹ã€‚\nMachOKitMachOKit æ˜¯ä¸€ä¸ªç”¨ Swift ç¼–å†™çš„å¼€æºé¡¹ç›®ï¼Œç”¨äºè§£æå’Œæ“ä½œ Mach-O æ–‡ä»¶æ ¼å¼ã€‚å®ƒèƒ½å¤Ÿåˆ©ç”¨ Swift çš„ç±»å‹å®‰å…¨å’Œå†…å­˜ç®¡ç†ç‰¹æ€§ã€‚ä¾‹å¦‚ï¼ŒSwift çš„ç±»å‹ç³»ç»Ÿå¯ä»¥ç”¨äºå®šä¹‰ Mach-O æ–‡ä»¶çš„å„ç§ç»“æ„ã€‚\nMachOKit è§£æ Mach-O æ–‡ä»¶å¤´éƒ¨ã€‚\nimport Foundationstruct MachOHeader &#123;    let magic: UInt32    let cputype: UInt32    let cpusubtype: UInt32    let filetype: UInt32    let ncmds: UInt32    let sizeofcmds: UInt32    let flags: UInt32&#125;func parseMachOHeader(data: Data) -&gt; MachOHeader? &#123;    guard data.count &gt;= 28 else &#123; return nil &#125;    let magic = data.withUnsafeBytes &#123; $0.load(as: UInt32.self) &#125;    let cputype = data.withUnsafeBytes &#123; $0.load(fromByteOffset: 4, as: UInt32.self) &#125;    let cpusubtype = data.withUnsafeBytes &#123; $0.load(fromByteOffset: 8, as: UInt32.self) &#125;    let filetype = data.withUnsafeBytes &#123; $0.load(fromByteOffset: 12, as: UInt32.self) &#125;    let ncmds = data.withUnsafeBytes &#123; $0.load(fromByteOffset: 16, as: UInt32.self) &#125;    let sizeofcmds = data.withUnsafeBytes &#123; $0.load(fromByteOffset: 20, as: UInt32.self) &#125;    let flags = data.withUnsafeBytes &#123; $0.load(fromByteOffset: 24, as: UInt32.self) &#125;        return MachOHeader(magic: magic, cputype: cputype, cpusubtype: cpusubtype, filetype: filetype, ncmds: ncmds, sizeofcmds: sizeofcmds, flags: flags)&#125;\nMachOKit ä½¿ç”¨ Swift çš„æ–‡ä»¶ç³»ç»Ÿ API æ¥è¯»å– Mach-O æ–‡ä»¶çš„äºŒè¿›åˆ¶æ•°æ®ã€‚è¿™åŒ…æ‹¬ä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®å¹¶å°†å…¶è§£ææˆ Mach-O æ ¼å¼çš„ç»“æ„ä½“ã€‚\nfunc readMachOFile(atPath path: String) -&gt; Data? &#123;    return FileManager.default.contents(atPath: path)&#125;\nä½¿ç”¨ Swift çš„ç»“æ„ä½“å’Œç±»æ¥æ˜ å°„ Mach-O æ–‡ä»¶çš„å„ç§æ•°æ®ç»“æ„ã€‚è¿™äº›æ•°æ®ç»“æ„åŒ…æ‹¬ Mach-O å¤´éƒ¨ã€åŠ è½½å‘½ä»¤ã€æ®µå’ŒèŠ‚ç­‰ã€‚\nstruct MachOLoadCommand &#123;    let cmd: UInt32    let cmdsize: UInt32&#125;func parseLoadCommand(data: Data, offset: Int) -&gt; MachOLoadCommand? &#123;    guard data.count &gt;= offset + 8 else &#123; return nil &#125;    let cmd = data.withUnsafeBytes &#123; $0.load(fromByteOffset: offset, as: UInt32.self) &#125;    let cmdsize = data.withUnsafeBytes &#123; $0.load(fromByteOffset: offset + 4, as: UInt32.self) &#125;        return MachOLoadCommand(cmd: cmd, cmdsize: cmdsize)&#125;\nMachOKit åˆ©ç”¨ Swift çš„ç±»å‹å®‰å…¨å’Œå†…å­˜ç®¡ç†ç‰¹æ€§ï¼Œç»“åˆå¯¹ Mach-O æ–‡ä»¶æ ¼å¼çš„æ·±å…¥ç†è§£ï¼Œæ¥å®ç°å¯¹ Mach-O æ–‡ä»¶çš„è§£æã€‚é€šè¿‡è¯»å–äºŒè¿›åˆ¶æ•°æ®ã€æ˜ å°„æ•°æ®ç»“æ„ã€å†…å­˜æ˜ å°„å’Œé”™è¯¯å¤„ç†ï¼Œå®ƒèƒ½å¤Ÿæœ‰æ•ˆåœ°è§£æ Mach-O æ–‡ä»¶å¹¶æä¾›ç›¸å…³ä¿¡æ¯ã€‚\n","categories":["æ€§èƒ½ä¼˜åŒ–"]},{"title":"RunLoop","url":"/2025/05/09/RunLoop/","content":"åŸºæœ¬æ¦‚å¿µåœ¨iOSå’ŒmacOSä¸­ï¼ŒRunLoopæ˜¯ä¸€ä¸ªå¾ªç¯æœºåˆ¶ï¼Œç”¨äºç®¡ç†çº¿ç¨‹ä¸­çš„äº‹ä»¶å¤„ç†ã€‚å½“ä¸€ä¸ªçº¿ç¨‹å¯åŠ¨åï¼Œç³»ç»Ÿä¼šä¸ºå…¶åˆ›å»ºä¸€ä¸ªRunLoopï¼Œå®ƒä¼šä¸æ–­åœ°è¿è¡Œã€æ£€æŸ¥å’Œå¤„ç†äº‹ä»¶ã€‚å¦‚æœæ²¡æœ‰äº‹ä»¶éœ€è¦å¤„ç†ï¼ŒRunLoopä¼šè®©çº¿ç¨‹è¿›å…¥ä¼‘çœ çŠ¶æ€ï¼Œä»è€ŒèŠ‚çœç³»ç»Ÿèµ„æºã€‚\nè·å–å½“å‰çº¿ç¨‹çš„RunLoop\nNSRunLoop *runLoop = [NSRunLoop currentRunLoop]; \nè¿™æ®µä»£ç è·å–äº†å½“å‰çº¿ç¨‹çš„RunLoopå®ä¾‹ã€‚å¯¹äºä¸»çº¿ç¨‹ï¼Œè¿™æ˜¯ç³»ç»Ÿè‡ªåŠ¨åˆ›å»ºçš„ï¼›å¯¹äºåå°çº¿ç¨‹ï¼Œé€šå¸¸éœ€è¦æ‰‹åŠ¨å¯åŠ¨RunLoopã€‚\nRunLoop çš„ä¸»è¦ä»»åŠ¡æ˜¯ï¼š\n\nå¤„ç†äº‹ä»¶å’Œæ¶ˆæ¯ï¼š å¤„ç†æ¥è‡ªå„ç§è¾“å…¥æºçš„äº‹ä»¶ï¼Œä¾‹å¦‚è§¦æ‘¸äº‹ä»¶ã€ç½‘ç»œäº‹ä»¶ç­‰ã€‚\nè°ƒåº¦å®šæ—¶ä»»åŠ¡ï¼š å¤„ç†å®šæ—¶å™¨è§¦å‘çš„ä»»åŠ¡ã€‚\nä¿æŒçº¿ç¨‹æ´»è·ƒï¼š ç¡®ä¿çº¿ç¨‹åœ¨æœ‰ä»»åŠ¡æ—¶ä¸ä¼šç©ºé—²è€Œå…³é—­ã€‚\n\nè¿è¡Œæ¨¡å¼RunLoopå¯ä»¥åœ¨å¤šç§æ¨¡å¼ä¸‹è¿è¡Œï¼Œæœ€å¸¸ç”¨çš„æ˜¯kCFRunLoopDefaultModeï¼ˆé»˜è®¤æ¨¡å¼ï¼‰å’ŒUITrackingRunLoopModeï¼ˆUIè·Ÿè¸ªæ¨¡å¼ï¼‰ã€‚RunLoopåœ¨ä¸åŒæ¨¡å¼ä¸‹å¤„ç†ä¸åŒç±»å‹çš„äº‹ä»¶ã€‚\nåœ¨ä¸åŒæ¨¡å¼ä¸‹æ·»åŠ Timer\nNSTimer *timer = [NSTimer timerWithTimeInterval:1.0 target:self selector:@selector(timerFired:) userInfo:nil repeats:YES];// å°†Timeræ·»åŠ åˆ°RunLoopçš„é»˜è®¤æ¨¡å¼ä¸­[[NSRunLoop currentRunLoop] addTimer:timer forMode:NSDefaultRunLoopMode];// å°†Timeræ·»åŠ åˆ°RunLoopçš„UIè·Ÿè¸ªæ¨¡å¼ä¸­[[NSRunLoop currentRunLoop] addTimer:timer forMode:UITrackingRunLoopMode];\nä¸Šé¢ä»£ç å±•ç¤ºäº†å¦‚ä½•åœ¨RunLoopçš„ä¸åŒæ¨¡å¼ä¸‹æ·»åŠ Timerã€‚è¿™æ„å‘³ç€Timeråœ¨è¿™ä¸¤ç§æ¨¡å¼ä¸‹éƒ½ä¼šè¢«æ‰§è¡Œã€‚\näº‹ä»¶æºRunLoopé€šè¿‡äº‹ä»¶æºï¼ˆSourceï¼‰æ¥è·å–å¹¶å¤„ç†äº‹ä»¶ã€‚äº‹ä»¶æºä¸»è¦åˆ†ä¸ºè¾“å…¥æºï¼ˆInput Sourceï¼‰å’Œå®šæ—¶æºï¼ˆTimer Sourceï¼‰ã€‚è¾“å…¥æºä¸»è¦ç”¨äºå¤„ç†å¼‚æ­¥äº‹ä»¶ï¼Œå¦‚ç”¨æˆ·è¾“å…¥ã€ç½‘ç»œè¯·æ±‚ç­‰ï¼›å®šæ—¶æºåˆ™ç”¨äºå¤„ç†å®šæ—¶äº‹ä»¶ï¼Œå¦‚NSTimerã€‚\nè‡ªå®šä¹‰RunLoopè¾“å…¥æº\nCFRunLoopSourceContext context = &#123;0, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, &amp;myRunLoopSourcePerformRoutine&#125;;CFRunLoopSourceRef runLoopSource = CFRunLoopSourceCreate(kCFAllocatorDefault, 0, &amp;context);CFRunLoopAddSource(CFRunLoopGetCurrent(), runLoopSource, kCFRunLoopDefaultMode);\nåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªè‡ªå®šä¹‰çš„RunLoopè¾“å…¥æºï¼Œå¹¶å°†å…¶æ·»åŠ åˆ°é»˜è®¤æ¨¡å¼çš„RunLoopä¸­ã€‚è‡ªå®šä¹‰çš„äº‹ä»¶æºå…è®¸æˆ‘ä»¬å¤„ç†è‡ªå®šä¹‰çš„äº‹ä»¶ã€‚\näº‹ä»¶å¤„ç†åœ¨RunLoopçš„æ¯ä¸€æ¬¡å¾ªç¯ä¸­ï¼Œéƒ½ä¼šå¤„ç†äº‹ä»¶é˜Ÿåˆ—ä¸­çš„äº‹ä»¶ã€‚RunLoopé€šè¿‡æ£€æŸ¥äº‹ä»¶æºæ¥å†³å®šæ˜¯å¦æœ‰éœ€è¦å¤„ç†çš„äº‹ä»¶ã€‚å¦‚æœæœ‰ï¼Œå®ƒä¼šè°ƒç”¨å¯¹åº”çš„å¤„ç†å‡½æ•°æ¥å¤„ç†è¯¥äº‹ä»¶ï¼›å¦‚æœæ²¡æœ‰ï¼Œåˆ™è¿›å…¥ä¼‘çœ çŠ¶æ€ã€‚\nå¤„ç†RunLoopäº‹ä»¶çš„ç¤ºä¾‹ä»£ç \nvoid myRunLoopSourcePerformRoutine(void *info) &#123;    // å¤„ç†è‡ªå®šä¹‰äº‹ä»¶çš„é€»è¾‘    NSLog(@&quot;RunLoopäº‹ä»¶å·²å¤„ç†&quot;);&#125;// è‡ªå®šä¹‰äº‹ä»¶æºä¸Šä¸‹æ–‡CFRunLoopSourceContext context = &#123;0, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, &amp;myRunLoopSourcePerformRoutine&#125;;CFRunLoopSourceRef runLoopSource = CFRunLoopSourceCreate(kCFAllocatorDefault, 0, &amp;context);// å°†äº‹ä»¶æºæ·»åŠ åˆ°RunLoopCFRunLoopAddSource(CFRunLoopGetCurrent(), runLoopSource, kCFRunLoopDefaultMode);\nåœ¨è¿™æ®µä»£ç ä¸­ï¼ŒmyRunLoopSourcePerformRoutineå‡½æ•°ç”¨äºå¤„ç†RunLoopäº‹ä»¶æºä¸­çš„äº‹ä»¶ã€‚å½“æœ‰äº‹ä»¶éœ€è¦å¤„ç†æ—¶ï¼ŒRunLoopä¼šè°ƒç”¨è¿™ä¸ªå‡½æ•°ã€‚\nçº¿ç¨‹ç®¡ç†ä¸­çš„åº”ç”¨åœ¨åå°çº¿ç¨‹ä¸­ï¼ŒRunLoopé€šå¸¸ä¸ä¼šè‡ªåŠ¨å¯åŠ¨ã€‚å¦‚æœæˆ‘ä»¬å¸Œæœ›ä¸€ä¸ªåå°çº¿ç¨‹æŒç»­è¿è¡Œï¼Œå¹¶ä¸”èƒ½å¤Ÿå“åº”äº‹ä»¶ï¼Œå°±éœ€è¦æ‰‹åŠ¨å¯åŠ¨RunLoopã€‚\nåœ¨åå°çº¿ç¨‹ä¸­å¯åŠ¨RunLoop\n- (void)startBackgroundTask &#123;    NSThread *backgroundThread = [[NSThread alloc] initWithTarget:self selector:@selector(runBackgroundRunLoop) object:nil];    [backgroundThread start];&#125;- (void)runBackgroundRunLoop &#123;    NSRunLoop *runLoop = [NSRunLoop currentRunLoop];    [runLoop addPort:[NSMachPort port] forMode:NSDefaultRunLoopMode];    [runLoop run];&#125;``ä¸Šé¢ä»£ç åˆ›å»ºäº†ä¸€ä¸ªåå°çº¿ç¨‹ï¼Œå¹¶åœ¨å…¶ä¸­å¯åŠ¨äº†RunLoopã€‚é€šè¿‡æ·»åŠ ä¸€ä¸ªNSMachPortå¯¹è±¡ï¼ŒRunLoopèƒ½å¤Ÿä¿æŒæ´»è·ƒï¼Œå¹¶å¤„ç†æ¥è‡ªå…¶ä»–çº¿ç¨‹çš„äº‹ä»¶ã€‚## å¸¸è§ä½¿ç”¨åœºæ™¯RunLoopåœ¨iOSå¼€å‘ä¸­æœ‰å¹¿æ³›çš„åº”ç”¨åœºæ™¯ï¼Œå¦‚å¤„ç†é•¿æ—¶é—´è¿è¡Œçš„ä»»åŠ¡ã€ç®¡ç†å®šæ—¶å™¨å’Œç½‘ç»œè¯·æ±‚ã€å®ç°å¤æ‚çš„UIå“åº”é€»è¾‘ç­‰ã€‚ä¾‹å¦‚ï¼Œåœ¨åå°ä¸‹è½½ä»»åŠ¡ä¸­ï¼ŒRunLoopå¯ä»¥å¸®åŠ©ä¿æŒçº¿ç¨‹çš„æ´»è·ƒï¼Œä»¥ç¡®ä¿ä¸‹è½½è¿‡ç¨‹ä¸ä¼šä¸­æ–­ã€‚åˆ›å»ºä¸€ä¸ª RunLoop å¹¶æ·»åŠ ä¸€ä¸ªå®šæ—¶å™¨æ¥ä¿æŒçº¿ç¨‹çš„æ´»åŠ¨çŠ¶æ€ï¼š```objc#import &lt;Foundation/Foundation.h&gt;void timerCallback(CFRunLoopTimerRef timer, void *info) &#123;    NSLog(@&quot;Timer fired!&quot;);&#125;int main(int argc, const char * argv[]) &#123;    @autoreleasepool &#123;        // åˆ›å»ºä¸€ä¸ªæ–°çš„ RunLoop        CFRunLoopRef runLoop = CFRunLoopGetCurrent(); // é€šè¿‡ `CFRunLoopGetCurrent()` è·å–å½“å‰çº¿ç¨‹çš„ `RunLoop` å®ä¾‹ã€‚                // åˆ›å»ºä¸€ä¸ªå®šæ—¶å™¨        CFRunLoopTimerContext context = &#123;0&#125;;        // ä½¿ç”¨ `CFRunLoopTimerCreate` åˆ›å»ºä¸€ä¸ªå®šæ—¶å™¨ï¼Œè®¾ç½®å®ƒåœ¨ 1 ç§’åè§¦å‘ï¼Œå¹¶æ¯ç§’é‡å¤è§¦å‘ä¸€æ¬¡ã€‚        CFRunLoopTimerRef timer = CFRunLoopTimerCreate(kCFAllocatorDefault,                                                         CFAbsoluteTimeGetCurrent() + 1.0,                                                         1.0,                                                         0,                                                         0,                                                         timerCallback,                                                         &amp;context);                // é€šè¿‡ `CFRunLoopAddTimer` å°†å®šæ—¶å™¨æ·»åŠ åˆ° `RunLoop` ä¸­ï¼Œä½¿å…¶èƒ½å¤Ÿåœ¨ RunLoop ä¸­è¿è¡Œã€‚        CFRunLoopAddTimer(runLoop, timer, kCFRunLoopCommonModes);                // ä½¿ç”¨ `CFRunLoopRun` å¯åŠ¨ `RunLoop`ã€‚è¿™å°†ä½¿çº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œç›´åˆ°äº‹ä»¶è§¦å‘ï¼ˆå¦‚å®šæ—¶å™¨è§¦å‘ï¼‰ã€‚        NSLog(@&quot;RunLoop started...&quot;);        CFRunLoopRun();                // åœ¨ RunLoop åœæ­¢åç§»é™¤å®šæ—¶å™¨å¹¶é‡Šæ”¾èµ„æºã€‚        CFRunLoopRemoveTimer(runLoop, timer, kCFRunLoopCommonModes);        CFRelease(timer);    &#125;    return 0;&#125;\nRunLoop æºç ç»“æ„RunLoop çš„ä¸»è¦ç»„ä»¶æœ‰è¾“å…¥æºï¼ˆInput Sourcesï¼‰ã€è¿è¡Œæ¨¡å¼ï¼ˆRunLoop Modesï¼‰å’Œä»»åŠ¡é˜Ÿåˆ—ï¼ˆTasks Queueï¼‰ã€‚\nè¾“å…¥æºåŒ…æ‹¬ç”¨äºå¤„ç†æ¥è‡ª Mach æ¶ˆæ¯çš„äº‹ä»¶çš„ç«¯å£ã€‚ç”¨äºå¤„ç†å®šæ—¶å™¨äº‹ä»¶çš„å®šæ—¶å™¨ã€‚RunLoop æ”¯æŒä¸åŒçš„è¿è¡Œæ¨¡å¼ï¼Œæ¯ä¸ªæ¨¡å¼å¯ä»¥å¤„ç†ä¸åŒçš„äº‹ä»¶ç±»å‹ã€‚ä¾‹å¦‚ï¼ŒNSDefaultRunLoopMode å’Œ UITrackingRunLoopModeã€‚ä»»åŠ¡é˜Ÿåˆ—å­˜å‚¨å¾…å¤„ç†çš„ä»»åŠ¡ï¼Œå¦‚å®šæ—¶å™¨ã€äº‹ä»¶ç­‰ã€‚\nRunLoop æºç å¯ä»¥åœ¨ iOS çš„åº•å±‚ç³»ç»Ÿåº“ä¸­æ‰¾åˆ°ã€‚RunLoop çš„å®ç°æ¶‰åŠå¤šä¸ªç»„ä»¶å’Œæ–‡ä»¶ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å…³é”®éƒ¨åˆ†çš„è§£æï¼š\nåœ¨ Core Foundation æ¡†æ¶ä¸­ï¼ŒCFRunLoop æ˜¯ RunLoop çš„æ ¸å¿ƒå®ç°ã€‚ä»¥ä¸‹æ˜¯ CFRunLoop çš„å®šä¹‰å’Œä¸»è¦åŠŸèƒ½ï¼š\n// CFRunLoop.htypedef struct __CFRunLoop * CFRunLoopRef;// CFRunLoop.cstruct __CFRunLoop &#123;    CFRuntimeBase _base;    CFMutableSetRef _modes;    CFRunLoopModeRef _currentMode;    CFMutableSetRef _sources0;    CFMutableSetRef _sources1;    CFMutableSetRef _observers;    CFMutableSetRef _timers;    // å…¶ä»–æˆå‘˜å˜é‡&#125;;\n\n_modesï¼š å­˜å‚¨ RunLoop çš„è¿è¡Œæ¨¡å¼ã€‚\n_currentModeï¼š å½“å‰çš„è¿è¡Œæ¨¡å¼ã€‚\n_sources0 å’Œ _sources1ï¼š å­˜å‚¨ä¸åŒç±»å‹çš„è¾“å…¥æºã€‚\n_observersï¼š å­˜å‚¨è§‚å¯Ÿè€…ï¼Œå¤„ç†ç‰¹å®šçš„äº‹ä»¶ã€‚\n_timersï¼š å­˜å‚¨å®šæ—¶å™¨ï¼Œå¤„ç†å®šæ—¶ä»»åŠ¡ã€‚\n\nä¸»è¦å‡½æ•°ï¼š\n\nCFRunLoopRunï¼š å¯åŠ¨ RunLoopï¼Œå¹¶è¿›å…¥ä¸»å¾ªç¯ã€‚\n\nvoid CFRunLoopRun(void) &#123;    // çœç•¥å…¶ä»–ä»£ç     while (!loopShouldExit) &#123;        // å¤„ç†äº‹ä»¶å’Œä»»åŠ¡        CFRunLoopMode mode = CFRunLoopCopyCurrentMode();        CFRunLoopPerformTasksForMode(mode);        // æ£€æŸ¥æ˜¯å¦éœ€è¦é€€å‡º    &#125;&#125;\n\nCFRunLoopPerformTasksForModeï¼š æ‰§è¡Œå½“å‰æ¨¡å¼ä¸‹çš„ä»»åŠ¡ã€‚\n\nvoid CFRunLoopPerformTasksForMode(CFRunLoopMode mode) &#123;    // å¤„ç†è¾“å…¥æº    CFRunLoopSourcePerformTasks(mode-&gt;_sources);    // å¤„ç†å®šæ—¶å™¨    CFRunLoopTimerPerformTasks(mode-&gt;_timers);    // å¤„ç†è§‚å¯Ÿè€…    CFRunLoopObserverPerformTasks(mode-&gt;_observers);&#125;\n","categories":["æ€§èƒ½ä¼˜åŒ–"],"tags":["æ€§èƒ½ä¼˜åŒ–","å¡é¡¿ç›‘æ§"]},{"title":"Hello World","url":"/2025/04/21/hello-world/","content":"Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub.\nQuick StartCreate a new post$ hexo new &quot;My New Post&quot;\n\nMore info: Writing\nRun server$ hexo server\n\nMore info: Server\nGenerate static files$ hexo generate\n\nMore info: Generating\nDeploy to remote sites$ hexo deploy\n\nMore info: Deployment\n"},{"title":"Swift è¯­æ³•","url":"/2025/05/07/Swift-%E8%AF%AD%E6%B3%95/","content":"è¯­æ³•åŸºç¡€å˜é‡å˜é‡æ˜¯å¯å˜çš„ï¼Œä½¿ç”¨ var ä¿®é¥°ï¼Œå¸¸é‡æ˜¯ä¸å¯å˜çš„ï¼Œä½¿ç”¨ let ä¿®é¥°ã€‚ç±»ã€ç»“æ„ä½“å’Œæšä¸¾é‡Œçš„å˜é‡æ˜¯å±æ€§ã€‚\nvar v1:String = &quot;hi&quot; // æ ‡æ³¨ç±»å‹var v2 = &quot;ç±»å‹æ¨å¯¼&quot;let l1 = &quot;æ ‡é¢˜&quot; // å¸¸é‡class a &#123;    let p1 = 3    var p2: Int &#123;        p1 * 3    &#125;&#125;\nå±æ€§æ²¡æœ‰ set å¯ä»¥çœç•¥ getï¼Œå¦‚æœæœ‰ set éœ€åŠ  getã€‚å˜é‡è®¾ç½®å‰é€šè¿‡ willSet è®¿é—®åˆ°ï¼Œå˜é‡è®¾ç½®åé€šè¿‡ didSet è®¿é—®ã€‚\næ‰“å°æ§åˆ¶å°æ‰“å°å€¼\nprint(&quot;hi&quot;)let i = 14print(i)print(&quot;9æœˆ\\(i)æ˜¯å°æŸ æª¬çš„ç”Ÿæ—¥&quot;)for i in 1...3&#123;    print(i)&#125;// output:// 1// 2// 3// ä½¿ç”¨terminatorä½¿å¾ªç¯æ‰“å°æ›´æ•´æ´for i in 1...3 &#123;    print(&quot;\\(i) &quot;, terminator: &quot;&quot;)&#125;// output:// 1 2 3\næ³¨é‡Š// å•è¡Œæ³¨é‡Š/*å¤šè¡Œæ³¨é‡Šç¬¬ä¸€è¡Œã€‚å¤šè¡Œæ³¨é‡Šç¬¬äºŒè¡Œã€‚*/ // MARK: ä¼šåœ¨ minimap ä¸Šå±•ç¤º// TODO: å¾…åš// FIXME: å¾…ä¿®å¤\n!?å¯é€‰å¯èƒ½ä¼šæ˜¯ nil çš„å˜é‡å°±æ˜¯å¯é€‰å˜é‡ã€‚å½“å˜é‡ä¸º nil é€šè¿‡??æ“ä½œç¬¦å¯ä»¥æä¾›ä¸€ä¸ªé»˜è®¤å€¼ã€‚\nvar o: Int? = nillet i = o ?? 0\nSE-0345 if let shorthand for shadowing an existing optional variable å¼•å…¥çš„æ–°è¯­æ³•ï¼Œç”¨äº unwrapping optinalã€‚\nlet s1: String? = &quot;hey&quot;let s2: String? = &quot;u&quot;if let s1 &#123;    print(s1)&#125;guard let s1, let s2 else &#123; return &#125;print(s1 + &quot; &quot; + s2)\né—­åŒ…é—­åŒ…ä¹Ÿå¯ä»¥å«åš lambdaï¼Œæ˜¯åŒ¿åå‡½æ•°ï¼Œå¯¹åº” OC çš„ blockã€‚\nlet a1 = [1,3,2].sorted(by: &#123; (l: Int, r: Int) -&gt; Bool in    return l &lt; r&#125;)// å¦‚æœé—­åŒ…æ˜¯å”¯ä¸€çš„å‚æ•°å¹¶åœ¨è¡¨è¾¾å¼æœ€åå¯ä»¥ä½¿ç”¨ç»“å°¾é—­åŒ…è¯­æ³•ï¼Œå†™æ³•ç®€åŒ–ä¸ºlet a2 = [1,3,2].sorted &#123; (l: Int, r: Int) -&gt; Bool in    return l &lt; r&#125;// å·²çŸ¥ç±»å‹å¯ä»¥çœç•¥let a3 = [1,3,2].sorted &#123; l, r in    return l &lt; r&#125;// é€šè¿‡ä½ç½®æ¥ä½¿ç”¨é—­åŒ…çš„å‚æ•°ï¼Œæœ€åç®€åŒ–å¦‚ä¸‹ï¼šlet a4 = [1,3,2].sorted &#123; $0 &lt; $1 &#125;\nå‡½æ•°ä¹Ÿæ˜¯é—­åŒ…çš„ä¸€ç§ï¼Œå‡½æ•°çš„å‚æ•°ä¹Ÿå¯ä»¥æ˜¯é—­åŒ…ã€‚@escaping è¡¨ç¤ºé€ƒé€¸é—­åŒ…ï¼Œé€ƒé€¸é—­åŒ…æ˜¯å¯ä»¥åœ¨å‡½æ•°è¿”å›ä¹‹åç»§ç»­è°ƒç”¨çš„ã€‚@autoclosure è¡¨ç¤ºè‡ªåŠ¨é—­åŒ…ï¼Œå¯ä»¥ç”¨æ¥çœç•¥èŠ±æ‹¬å·ã€‚\nSE-0326 æé«˜äº† Swift å¯¹é—­åŒ…ä½¿ç”¨å‚æ•°å’Œç±»å‹æ¨æ–­çš„èƒ½åŠ›ã€‚å¦‚ä¸‹ä»£ç ï¼š\nlet a = [1,2,3]let r = a.map &#123; i in    if i &gt;= 2 &#123;        return &quot;\\(i) å¤§äºç­‰äº2&quot;    &#125; else &#123;        return &quot;\\(i) å°äº2&quot;    &#125;&#125;print(r)\nå‡½æ•°å‡½æ•°å¯ä»¥ä½œä¸ºå¦ä¸€ä¸ªå‡½æ•°çš„å‚æ•°ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºå¦ä¸€ä¸ªå‡½æ•°çš„è¿”å›ã€‚å‡½æ•°æ˜¯ç‰¹æ®Šçš„é—­åŒ…ï¼Œåœ¨ç±»ã€ç»“æ„ä½“å’Œæšä¸¾ä¸­æ˜¯æ–¹æ³•ã€‚\n// ä¸ºå‚æ•°è®¾ç½®é»˜è®¤å€¼func f1(p: String = &quot;p&quot;) -&gt; String &#123;    &quot;p is \\(p)&quot;&#125;// å‡½æ•°ä½œä¸ºå‚æ•°func f2(fn: (String) -&gt; String, p: String) -&gt; String &#123;    return fn(p)&#125;print(f2(fn:f1, p: &quot;d&quot;)) // p is d// å‡½æ•°ä½œä¸ºè¿”å›å€¼func f3(p: String) -&gt; (String) -&gt; String &#123;    return f1&#125;print(f3(p: &quot;yes&quot;)(&quot;no&quot;)) // p is no\nå‡½æ•°å¯ä»¥è¿”å›å¤šä¸ªå€¼ï¼Œå‡½æ•°æ˜¯å¯ä»¥åµŒå¥—çš„ï¼Œä¹Ÿå°±æ˜¯å‡½æ•°é‡Œå†…å¯ä»¥å®šä¹‰å‡½æ•°ï¼Œå‡½æ•°å†…å®šä¹‰çš„å‡½æ•°å¯ä»¥è®¿é—®è‡ªå·±ä½œç”¨åŸŸå¤–å‡½æ•°å†…çš„å˜é‡ã€‚inout è¡¨ç¤ºçš„æ˜¯è¾“å…¥è¾“å‡ºå‚æ•°ï¼Œå‡½æ•°å¯ä»¥åœ¨å‡½æ•°å†…æ”¹å˜è¾“å…¥è¾“å‡ºå‚æ•°ã€‚defer æ ‡è¯†çš„ä»£ç å—ä¼šåœ¨å‡½æ•°è¿”å›ä¹‹å‰æ‰§è¡Œã€‚\nå‡½æ•°åœ¨ Swift 5.4 æ—¶å¼€å§‹æœ‰äº†ä½¿ç”¨å¤šä¸ªå˜é‡å‚æ•°çš„èƒ½åŠ›ï¼Œä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š\nfunc f4(s: String..., i: Int...) &#123;    print(s)    print(i)&#125;f4(s: &quot;one&quot;, &quot;two&quot;, &quot;three&quot;, i: 1, 2, 3)/// [&quot;one&quot;, &quot;two&quot;, &quot;three&quot;]/// [1, 2, 3]\nåµŒå¥—å‡½æ•°å¯ä»¥é‡è½½ï¼ŒåµŒå¥—å‡½æ•°å¯ä»¥åœ¨å£°æ˜å‡½æ•°ä¹‹å‰è°ƒç”¨ä»–ã€‚\nfunc f5() &#123;    nf5()    func nf5() &#123;        print(&quot;this is nested function&quot;)    &#125;&#125;f5() // this is nested function\nè®¿é—®æ§åˆ¶åœ¨ Xcode é‡Œçš„ target å°±æ˜¯æ¨¡å—ï¼Œä½¿ç”¨ import å¯å¯¼å…¥æ¨¡å—ã€‚æ¨¡å—å†…åŒ…å«æºæ–‡ä»¶ï¼Œæ¯ä¸ªæºæ–‡ä»¶é‡Œå¯ä»¥æœ‰å¤šä¸ªç±»ã€ç»“æ„ä½“ã€æšä¸¾å’Œå‡½æ•°ç­‰å¤šç§ç±»å‹ã€‚è®¿é—®çº§åˆ«å¯ä»¥é€šè¿‡ä¸€äº›å…³é”®å­—æè¿°ï¼Œåˆ†ä¸ºå¦‚ä¸‹å‡ ç§ï¼š\n\nopenï¼šåœ¨æ¨¡å—å¤–å¯ä»¥è°ƒç”¨å’Œç»§æ‰¿ã€‚\npublicï¼šåœ¨æ¨¡å—å¤–å¯è°ƒç”¨ä¸å¯ç»§æ‰¿ï¼Œopen åªé€‚ç”¨ç±»å’Œç±»æˆå‘˜ã€‚\ninternalï¼šé»˜è®¤çº§åˆ«ï¼Œæ¨¡å—å†…å¯è·¨æºæ–‡ä»¶è°ƒç”¨ï¼Œæ¨¡å—å¤–ä¸å¯è°ƒç”¨ã€‚\nfileprivateï¼šåªèƒ½åœ¨æºæ–‡ä»¶å†…è®¿é—®ã€‚\nprivateï¼šåªèƒ½åœ¨æ‰€åœ¨çš„ä½œç”¨åŸŸå†…è®¿é—®ã€‚\n\né‡å†™ç»§æ‰¿ç±»çš„æˆå‘˜ï¼Œå¯ä»¥è®¾ç½®æˆå‘˜æ¯”çˆ¶ç±»çš„è¿™ä¸ªæˆå‘˜æ›´é«˜çš„è®¿é—®çº§åˆ«ã€‚Setter çš„çº§åˆ«å¯ä»¥ä½äºå¯¹åº”çš„ Getter çš„çº§åˆ«ï¼Œæ¯”å¦‚è®¾ç½® Setter è®¿é—®çº§åˆ«ä¸º privateï¼Œå¯ä»¥åœ¨å±æ€§ä½¿ç”¨ private(set) æ¥ä¿®é¥°ã€‚\nRegexæ ‡å‡†åº“å¤šäº†ä¸ª Regex ç±»å‹ï¼ŒRegex è¯­æ³•ä¸ Perlã€Pythonã€Rubyã€Javaã€NSRegularExpression å’Œè®¸å¤šå…¶ä»–è¯­è¨€å…¼å®¹ã€‚å¯ä»¥ç”¨ let regex &#x3D; try! Regex(â€œa[bc]+â€) æˆ– let regex &#x3D; &#x2F;a[bc]+&#x2F; å†™æ³•æ¥ä½¿ç”¨ã€‚SE-0350 Regex Type and Overview å¼•å…¥ Regex ç±»å‹ã€‚SE-0351 Regex builder DSL ä½¿ç”¨ result builder æ¥æ„å»ºæ­£åˆ™è¡¨è¾¾å¼çš„ DSLã€‚SE-0354 Regex Literals ç®€åŒ–çš„æ­£åˆ™è¡¨è¾¾å¼ã€‚SE-0357 Regex-powered string processing algorithms ææ¡ˆé‡Œæœ‰åŸºäºæ­£åˆ™è¡¨è¾¾å¼çš„æ–°å­—ç¬¦ä¸²å¤„ç†ç®—æ³•ã€‚\nRegexBuilder æ–‡æ¡£\nsession Meet Swift Regex ã€Swift Regex: Beyond the basics\nRegex ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š\nlet s1 = &quot;I am not a good painter&quot;print(s1.ranges(of: /good/))do &#123;    let regGood = try Regex(&quot;[a-z]ood&quot;)    print(s1.replacing(regGood, with: &quot;bad&quot;))&#125; catch &#123;    print(error)&#125;print(s1.trimmingPrefix(/i am /.ignoresCase()))let reg1 = /(.+?) read (\\d+) books./let reg2 = /(?&lt;name&gt;.+?) read (?&lt;books&gt;\\d+) books./let s2 = &quot;Jack read 3 books.&quot;do &#123;    if let r1 = try reg1.wholeMatch(in: s2) &#123;        print(r1.1)        print(r1.2)    &#125;    if let r2 = try reg2.wholeMatch(in: s2) &#123;        print(&quot;name:&quot; + r2.name)        print(&quot;books:&quot; + r2.books)    &#125;&#125; catch &#123;    print(error)&#125;\nä½¿ç”¨ regex builders çš„å®˜æ–¹ç¤ºä¾‹ï¼š\n// Text to parse:// CREDIT  03/02/2022  Payroll from employer     $200.23// CREDIT  03/03/2022  Suspect A           $2,000,000.00// DEBIT   03/03/2022  Ted&#x27;s Pet Rock Sanctuary    $2,000,000.00// DEBIT   03/05/2022  Doug&#x27;s Dugout Dogs      $33.27import RegexBuilderlet fieldSeparator = /\\s&#123;2,&#125;|\\t/let transactionMatcher = Regex &#123;  /CREDIT|DEBIT/  fieldSeparator  One(.date(.numeric, locale: Locale(identifier: &quot;en_US&quot;), timeZone: .gmt)) // ğŸ‘ˆğŸ» we define which data locale/timezone we want to use  fieldSeparator  OneOrMore &#123;    NegativeLookahead &#123; fieldSeparator &#125; // ğŸ‘ˆğŸ» we stop as soon as we see one field separator    CharacterClass.any  &#125;  fieldSeparator  One(.localizedCurrency(code: &quot;USD&quot;).locale(Locale(identifier: &quot;en_US&quot;)))&#125;\nåœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­æ•è·æ•°æ®ï¼Œä½¿ç”¨ Captureï¼š\nlet fieldSeparator = /\\s&#123;2,&#125;|\\t/let transactionMatcher = Regex &#123;  Capture &#123; /CREDIT|DEBIT/ &#125; // ğŸ‘ˆğŸ»  fieldSeparator  Capture &#123; One(.date(.numeric, locale: Locale(identifier: &quot;en_US&quot;), timeZone: .gmt)) &#125; // ğŸ‘ˆğŸ»  fieldSeparator  Capture &#123; // ğŸ‘ˆğŸ»    OneOrMore &#123;      NegativeLookahead &#123; fieldSeparator &#125;      CharacterClass.any    &#125;  &#125;  fieldSeparator  Capture &#123; One(.localizedCurrency(code: &quot;USD&quot;).locale(Locale(identifier: &quot;en_US&quot;))) &#125; // ğŸ‘ˆğŸ»&#125;// transactionMatcher: Regex&lt;(Substring, Substring, Date, Substring, Decimal)&gt;\nåŸºç¡€ç±»å‹æ•°å­—æ•°å­—çš„ç±»å‹æœ‰ Intã€Float å’Œ Double\n// Intlet i1 = 100let i2 = 22print(i1 / i2) // å‘ä¸‹å–æ•´å¾— 4// Floatlet f1: Float = 100.0let f2: Float = 22.0print(f1 / f2) // 4.5454545let f3: Float16 = 5.0 // macOS è¿˜ä¸èƒ½ç”¨let f4: Float32 = 5.0let f5: Float64 = 5.0let f6: Float80 = 5.0print(f4, f5, f6) // 5.0 5.0 5.0// Doublelet d1: Double = 100.0let d2: Double = 22.0print(d1 / d2) // 4.545454545454546// å­—é¢é‡print(Int(0b10101)) // 0b å¼€å¤´æ˜¯äºŒè¿›åˆ¶ print(Int(0x00afff)) // 0x å¼€å¤´æ˜¯åå…­è¿›åˆ¶print(2.5e4) // 2.5x10^4 åè¿›åˆ¶ç”¨ eprint(0xAp2) // 10*2^2  åå…­è¿›åˆ¶ç”¨ pprint(2_000_000) // 2000000// isMultiple(of:) æ–¹æ³•æ£€æŸ¥ä¸€ä¸ªæ•°å­—æ˜¯å¦æ˜¯å¦ä¸€ä¸ªæ•°å­—çš„å€æ•°let i3 = 36print(i3.isMultiple(of: 9)) // true\nå¤„ç†æ•°å­—æœ‰ floorã€ceilã€roundã€‚floor æ˜¯å‘ä¸‹å–æ•´ï¼Œåªå–æ•´æ•°éƒ¨åˆ†ï¼›cell æ˜¯å‘ä¸Šå–æ•´ï¼Œåªè¦æœ‰ä¸ä¸ºé›¶çš„å°æ•°ï¼Œæ•´æ•°å°±åŠ 1;round æ˜¯å››èˆäº”å…¥ã€‚\nå¸ƒå°”æ•°å¸ƒå°”æ•°æœ‰ true å’Œ false ä¸¤ç§å€¼ï¼Œè¿˜æœ‰ä¸€ä¸ªèƒ½å¤Ÿåˆ‡æ¢è¿™ä¸¤ä¸ªå€¼çš„ toggle æ–¹æ³•ã€‚\nvar b = falseb.toggle() // trueb.toggle() // false\nå­—ç¬¦ä¸²let s1 = &quot;Hi! This is a string. Cool?&quot;/// è½¬ä¹‰ç¬¦ \\n è¡¨ç¤ºæ¢è¡Œã€‚/// å…¶å®ƒè½¬ä¹‰å­—ç¬¦æœ‰ \\0 ç©ºå­—ç¬¦)ã€\\t æ°´å¹³åˆ¶è¡¨ç¬¦ ã€\\n æ¢è¡Œç¬¦ã€\\r å›è½¦ç¬¦let s2 = &quot;Hi!\\nThis is a string. Cool?&quot;// å¤šè¡Œlet s3 = &quot;&quot;&quot;Hi!This is a string.Cool?&quot;&quot;&quot;// é•¿åº¦print(s3.count)print(s3.isEmpty)// æ‹¼æ¥print(s3 + &quot;\\nSure!&quot;)// å­—ç¬¦ä¸²ä¸­æ’å…¥å˜é‡let i = 1print(&quot;Today is good day, double \\(i)\\(i)!&quot;)/// éå†å­—ç¬¦ä¸²/// è¾“å‡ºï¼š/// o/// n/// efor c in &quot;one&quot; &#123;    print(c)&#125;// æŸ¥æ‰¾print(s3.lowercased().contains(&quot;cool&quot;)) // true// æ›¿æ¢let s4 = &quot;one is two&quot;let newS4 = s4.replacingOccurrences(of: &quot;two&quot;, with: &quot;one&quot;)print(newS4)// åˆ é™¤ç©ºæ ¼å’Œæ¢è¡Œlet s5 = &quot; Simple line. \\n\\n  &quot;print(s5.trimmingCharacters(in: .whitespacesAndNewlines))// åˆ‡å‰²æˆæ•°ç»„let s6 = &quot;one/two/three&quot;let a1 = s6.components(separatedBy: &quot;/&quot;) // ç»§æ‰¿è‡ª NSString çš„æ¥å£print(a1) // [&quot;one&quot;, &quot;two&quot;, &quot;three&quot;]let a2 = s6.split(separator: &quot;/&quot;)print(a2) // [&quot;one&quot;, &quot;two&quot;, &quot;three&quot;] å±äºåˆ‡ç‰‡ï¼Œæ€§èƒ½è¾ƒ components æ›´å¥½// åˆ¤æ–­æ˜¯å¦æ˜¯æŸç§ç±»å‹let c1: Character = &quot;ğŸ¤”&quot;print(c1.isASCII) // falseprint(c1.isSymbol) // trueprint(c1.isLetter) // falseprint(c1.isNumber) // falseprint(c1.isUppercase) // false// å­—ç¬¦ä¸²å’Œ Data äº’è½¬let data = Data(&quot;hi&quot;.utf8)let s7 = String(decoding: data, as: UTF8.self)print(s7) // hi// å­—ç¬¦ä¸²å¯ä»¥å½“ä½œé›†åˆæ¥ç”¨ã€‚let revered = s7.reversed()print(String(revered))\nUnicodeã€Character å’Œ SubString ç­‰å†…å®¹å‚è§å®˜æ–¹å­—ç¬¦ä¸²æ–‡æ¡£ï¼šStrings and Characters â€” The Swift Programming Language (Swift 5.1)\nå­—ç¬¦ä¸²å­—é¢ç¬¦å·å¯ä»¥å‚çœ‹ã€ŠString literals in Swiftã€‹ã€‚\nåŸå§‹å­—ç¬¦ä¸²\n// åŸå§‹å­—ç¬¦ä¸²åœ¨å­—ç¬¦ä¸²å‰åŠ ä¸Šä¸€ä¸ªæˆ–å¤šä¸ª#ç¬¦å·ã€‚é‡Œé¢çš„åŒå¼•å·å’Œè½¬ä¹‰ç¬¦å·å°†ä¸å†èµ·ä½œç”¨äº†ï¼Œå¦‚æœæƒ³è®©è½¬ä¹‰ç¬¦èµ·ä½œç”¨ï¼Œéœ€è¦åœ¨è½¬ä¹‰ç¬¦åé¢åŠ ä¸Š#ç¬¦å·ã€‚let s8 = #&quot;\\(s7)\\#(s7) &quot;one&quot; and &quot;two&quot;\\n. \\#nThe second line.&quot;#print(s8)/// \\(s7)hi &quot;one&quot; and &quot;two&quot;\\n./// The second line.// åŸå§‹å­—ç¬¦ä¸²åœ¨æ­£åˆ™ä½¿ç”¨æ•ˆæœæ›´ä½³ï¼Œåæ–œæ æ›´å°‘äº†ã€‚let s9 = &quot;\\\\\\\\[A-Z]+[A-Za-z]+\\\\.[a-z]+&quot;let s10 = #&quot;\\\\[A-Z]+[A-Za-z]+\\.[a-z]+&quot;#print(s9) // \\\\[A-Z]+[A-Za-z]+\\.[a-z]+print(s10) // \\\\[A-Z]+[A-Za-z]+\\.[a-z]+\nSwift5.7 String Index å¤§å‡çº§ String Index Overhaul\næšä¸¾Swiftçš„æšä¸¾æœ‰ç±»çš„ä¸€äº›ç‰¹æ€§ï¼Œæ¯”å¦‚è®¡ç®—å±æ€§ã€å®ä¾‹æ–¹æ³•ã€æ‰©å±•ã€éµå¾ªåè®®ç­‰ç­‰ã€‚\nenum E1:String, CaseIterable &#123;    case e1, e2 = &quot;12&quot;&#125;// å…³è”å€¼enum E2 &#123;    case e1([String])    case e2(Int)&#125;let e1 = E2.e1([&quot;one&quot;,&quot;two&quot;])let e2 = E2.e2(3)switch e1 &#123;case .e1(let array):    print(array)case .e2(let int):    print(int)&#125;print(e2)// åŸå§‹å€¼print(E1.e1.rawValue)// éµå¾ª CaseIterable åè®®å¯è¿­ä»£for ie in E1.allCases &#123;    print(&quot;show \\(ie)&quot;)&#125;// é€’å½’æšä¸¾enum RE &#123;    case v(String)    indirect case node(l:RE, r:RE)&#125;let lNode = RE.v(&quot;left&quot;)let rNode = RE.v(&quot;right&quot;)let pNode = RE.node(l: lNode, r: rNode)switch pNode &#123;case .v(let string):    print(string)case .node(let l, let r):    print(l,r)    switch l &#123;    case .v(let string):        print(string)    case .node(let l, let r):        print(l, r)    &#125;    switch r &#123;    case .v(let string):        print(string)    case .node(let l, let r):        print(l, r)    &#125;&#125;\n@unknown ç”¨æ¥åŒºåˆ†å›ºå®šçš„æšä¸¾å’Œå¯èƒ½æ”¹å˜çš„æšä¸¾çš„èƒ½åŠ›ã€‚@unknown ç”¨äºé˜²æ­¢æœªæ¥æ–°å¢æšä¸¾å±æ€§ä¼šè¿›è¡Œæé†’æç¤ºå®Œå–„æ¯ä¸ª case çš„å¤„ç†ã€‚\n// @unknownenum E3 &#123;    case e1, e2, e3&#125;func fe1(e: E3) &#123;    switch e &#123;    case .e1:        print(&quot;e1 ok&quot;)    case .e2:        print(&quot;e2 ok&quot;)    case .e3:        print(&quot;e3 ok&quot;)    @unknown default:        print(&quot;not ok&quot;)    &#125;&#125;\nç¬¦åˆ Comparable åè®®çš„æšä¸¾å¯ä»¥è¿›è¡Œæ¯”è¾ƒã€‚\n// Comparable æšä¸¾æ¯”è¾ƒenum E4: Comparable &#123;    case e1, e2    case e3(i: Int)    case e4&#125;let e3 = E4.e4let e4 = E4.e3(i: 3)let e5 = E4.e3(i: 2)let e6 = E4.e1print(e3 &gt; e4) // truelet a1 = [e3, e4, e5, e6]let a2 = a1.sorted()for i in a2 &#123;    print(i.self)&#125;/// e1/// e3(i: 2)/// e3(i: 3)/// e4\nå…ƒç»„å…ƒç»„é‡Œçš„å€¼ç±»å‹å¯ä»¥æ˜¯ä¸åŒçš„ã€‚å…ƒç»„å¯ä»¥çœ‹æˆæ˜¯åŒ¿åçš„ç»“æ„ä½“ã€‚\nlet t1 = (p1: 1, p2: &quot;two&quot;, p3: [1,2,3])print(t1.p1)print(t1.p3)// ç±»å‹æ¨å¯¼let t2 = (1, &quot;two&quot;, [1,2,3])// é€šè¿‡ä¸‹æ ‡è®¿é—®print(t2.1) // two// åˆ†è§£å…ƒç»„let (dp1, dp2, _) = t2print(dp1)print(dp2)\næ³›å‹å’Œåè®®æ³›å‹å¯ä»¥å‡å°‘é‡å¤ä»£ç ï¼Œæ˜¯ä¸€ç§æŠ½è±¡çš„è¡¨è¾¾æ–¹å¼ã€‚where å…³é”®å­—å¯ä»¥å¯¹æ³›å‹åšçº¦æŸã€‚\nfunc fn&lt;T&gt;(p: T) -&gt; [T] &#123;    var r = [T]()    r.append(p)    return r&#125;print(fn(p: &quot;one&quot;))// ç»“æ„ä½“struct S1&lt;T&gt; &#123;    var arr = [T]()    mutating func add(_ p: T) &#123;        arr.append(p)    &#125;&#125;var s1 = S1(arr: [&quot;zero&quot;])s1.add(&quot;one&quot;)s1.add(&quot;two&quot;)print(s1.arr) // [&quot;zero&quot;, &quot;one&quot;, &quot;two&quot;]\nå…³è”ç±»å‹\nprotocol pc &#123;    associatedtype T    mutating func add(_ p: T)&#125;struct S2: pc &#123;    typealias T = String // ç±»å‹æ¨å¯¼ï¼Œå¯çœç•¥    var strs = [String]()    mutating func add(_ p: String) &#123;        strs.append(p)    &#125;&#125;\næ³›å‹é€‚ç”¨äºåµŒå¥—ç±»å‹\nstruct S3&lt;T&gt; &#123;    struct S4 &#123;        var p: T    &#125;        var p1: T    var p2: S4&#125;let s2 = S3(p1: 1, p2: S3.S4(p: 3))let s3 = S3(p1: &quot;one&quot;, p2: S3.S4(p: &quot;three&quot;))print(s2,s3)\nsession Embrace Swift generics ã€Design protocol interfaces in Swift\nswift 5.6 å’Œä¹‹å‰ç¼–å†™æ³›å‹æ¥å£å¦‚ä¸‹ï¼š\nfunc feed&lt;A&gt;(_ animal: A) where A: Animal// ğŸ‘†ğŸ»ğŸ‘‡ğŸ» Equivalentsfunc feed&lt;A: Animal&gt;(_ animal: A)\nswift 5.7 å¯ä»¥è¿™æ ·å†™ï¼š\nfunc feed(_ animal: some Animal)\nsome å…³é”®å­—å¯ä»¥ç”¨äºå‚æ•°å’Œç»“æ„ç±»å‹ã€‚some ä¼šä¿è¯ç±»å‹å…³ç³»ï¼Œè€Œ any ä¼šæŒæœ‰ä»»æ„å…·ä½“ç±»å‹ï¼Œåˆ é™¤ç±»å‹å…³ç³»ã€‚\nSE-0347 Type inference from default expressions æ‰©å±• Swift æ³›å‹å‚æ•°ç±»å‹çš„é»˜è®¤å€¼èƒ½åŠ›ã€‚å¦‚ä¸‹ä»£ç ç¤ºä¾‹ï¼š\nfunc suffledArray&lt;T: Sequence&gt;(from options: T = 1...100) -&gt; [T.Element] &#123;    Array(options.shuffled())&#125;print(suffledArray())print(suffledArray(from: [&quot;one&quot;, &quot;two&quot;, &quot;three&quot;]))\nSE-0341 Opaque Parameter Declarations ä½¿ç”¨ some å‚æ•°ç®€åŒ–æ³›å‹å‚æ•°å£°æ˜ã€‚SE-0328 Structural opaque result types æ‰©å¤§ä¸é€æ˜ç»“æœè¿”å›ç±»å‹å¯ä»¥ä½¿ç”¨çš„èŒƒå›´ã€‚SE-0360 Opaque result types with limited availability å¯ç”¨æ€§æœ‰é™çš„ä¸é€æ˜ç»“æœç±»å‹ï¼Œæ¯”å¦‚ if #available(macOS 13.0, *) {} å°±å¯ä»¥æ ¹æ®ç³»ç»Ÿä¸åŒç‰ˆæœ¬è¿”å›ä¸åŒç±»å‹ï¼Œæ–°ç‰ˆæœ¬å‡ºç°æ–°ç±»å‹çš„ View å°±å¯ä»¥å’Œä»¥å‰çš„ View ç±»å‹åŒºåˆ«å¼€ã€‚\nSE-0309 Unlock existentials for all protocols æ”¹è¿›äº† existentials å’Œ æ³›å‹çš„äº¤äº’ã€‚è¿™æ ·å°±å¯ä»¥æ›´æ–¹ä¾¿çš„æ£€æŸ¥ Any ç±»å‹çš„ä¸¤ä¸ªå€¼æ˜¯å¦ç›¸ç­‰\nany å…³é”®å­—å……å½“çš„æ˜¯ç±»å‹æ“¦é™¤çš„åŠ©æ‰‹ï¼Œæ˜¯é€šè¿‡å‘ŠçŸ¥ç¼–è¯‘å™¨ä½ ä½¿ç”¨ existential ä½œä¸ºç±»å‹ï¼Œæ­¤è¯­æ³•å¯å…¼å®¹ä»¥å‰ç³»ç»Ÿã€‚\nSE-0346 Lightweight same-type requirements for primary associated types å¼•å…¥ä¸€ç§æ–°è¯­æ³•ï¼Œç”¨äºç¬¦åˆæ³›å‹å‚æ•°å¹¶é€šè¿‡ç›¸åŒç±»å‹è¦æ±‚çº¦æŸå…³è”ç±»å‹ã€‚SE-0358 Primary Associated Types in the Standard Library å¼•å…¥ä¸»è¦å…³è”ç±»å‹æ¦‚å¿µï¼Œå¹¶å°†å…¶å¸¦å…¥äº†æ ‡å‡†åº“ã€‚è¿™äº›å…³è”ç±»å‹å¾ˆåƒæ³›å‹ï¼Œå…è®¸å¼€å‘è€…å°†ç»™å®šå…³è”ç±»å‹çš„ç±»å‹æŒ‡å®šä¸ºé€šç”¨çº¦æŸã€‚\nSE-0353 Constrained Existential Types åŸºäº SE-0309 å’Œ SE-0346 ææ¡ˆï¼Œåœ¨ existential ç±»å‹çš„ä¸Šä¸‹æ–‡ä¸­é‡ç”¨è½»é‡å…³è”ç±»å‹çš„çº¦æŸã€‚\nSE-0352 Implicitly Opened Existentials å…è®¸ Swift åœ¨å¾ˆå¤šæƒ…å†µä¸‹ä½¿ç”¨åè®®è°ƒç”¨æ³›å‹å‡½æ•°ã€‚\nSwift è®ºå›ä¸Šä¸€ä¸ªå¯¹ any å’Œ some å…³é”®å­—è¯­æ³•ä½¿ç”¨åœºæ™¯çš„è®¨è®ºï¼ŒDo any and some help with â€œProtocol Oriented Testingâ€ at all? ã€‚\nä¸é€æ˜ç±»å‹ä¸é€æ˜ç±»å‹ä¼šéšè—ç±»å‹ï¼Œè®©ä½¿ç”¨è€…æ›´å…³æ³¨åŠŸèƒ½ã€‚ä¸é€æ˜ç±»å‹å’Œåè®®å¾ˆç±»ä¼¼ï¼Œä¸åŒçš„æ˜¯ä¸é€æ˜æ¯”åè®®é™å®šçš„è¦å¤šï¼Œåè®®èƒ½å¤Ÿå¯¹åº”æ›´å¤šç±»å‹ã€‚\nprotocol P &#123;    func f() -&gt; String&#125;struct S1: P &#123;    func f() -&gt; String &#123;        return &quot;one\\n&quot;    &#125;&#125;struct S2&lt;T: P&gt;: P &#123;    var p: T    func f() -&gt; String &#123;        return p.f() + &quot;two\\n&quot;    &#125;&#125;struct S3&lt;T1: P, T2: P&gt;: P &#123;    var p1: T1    var p2: T2    func f() -&gt; String &#123;        return p1.f() + p2.f() + &quot;three\\n&quot;    &#125;&#125;func someP() -&gt; some P &#123;    return S3(p1: S1(), p2: S2(p: S1()))&#125;let r = someP()print(r.f())\nå‡½æ•°è°ƒç”¨è€…å†³å®šè¿”å›ä»€ä¹ˆç±»å‹æ˜¯æ³›å‹ï¼Œå‡½æ•°è‡ªèº«å†³å®šè¿”å›ä»€ä¹ˆç±»å‹ä½¿ç”¨ä¸é€æ˜è¿”å›ç±»å‹ã€‚\nResultResult ç±»å‹ç”¨æ¥å¤„ç†é”™è¯¯ï¼Œç‰¹åˆ«é€‚ç”¨å¼‚æ­¥æ¥å£çš„é”™è¯¯å¤„ç†ã€‚\nextension URLSession &#123;    func dataTaskWithResult(        with url: URL,        handler: @escaping (Result&lt;Data, Error&gt;) -&gt; Void    ) -&gt; URLSessionDataTask &#123;        dataTask(with: url) &#123; data, _, err in            if let err = err &#123;                handler(.failure(err))            &#125; else &#123;                handler(.success(data ?? Data()))            &#125;        &#125;    &#125;&#125;let url = URL(string: &quot;https://ming1016.github.io/&quot;)!// ä»¥å‰ç½‘ç»œè¯·æ±‚let t1 = URLSession.shared.dataTask(with: url) &#123;    data, _, error in    if let err = error &#123;        print(err)    &#125; else if let data = data &#123;        print(String(decoding: data, as: UTF8.self))    &#125;&#125;t1.resume()// ä½¿ç”¨ Result ç½‘ç»œè¯·æ±‚let t2 = URLSession.shared.dataTaskWithResult(with: url) &#123; result in    switch result &#123;    case .success(let data):        print(String(decoding: data, as: UTF8.self))    case .failure(let err):        print(err)    &#125;&#125;t2.resume()\nç±»å‹è½¬æ¢ä½¿ç”¨ is å…³é”®å­—è¿›è¡Œç±»å‹åˆ¤æ–­ï¼Œ ä½¿ç”¨as å…³é”®å­—æ¥è½¬æ¢æˆå­ç±»ã€‚\nclass S0 &#123;&#125;class S1: S0 &#123;&#125;class S2: S0 &#123;&#125;var a = [S0]()a.append(S1())a.append(S2())for e in a &#123;    // ç±»å‹åˆ¤æ–­    if e is S1 &#123;        print(&quot;Type is S1&quot;)    &#125; else if e is S2 &#123;        print(&quot;Type is S2&quot;)    &#125;    // ä½¿ç”¨ as å…³é”®å­—è½¬æ¢æˆå­ç±»    if let s1 = e as? S1 &#123;        print(&quot;As S1 \\(s1)&quot;)    &#125; else if let s2 = e as? S2 &#123;        print(&quot;As S2 \\(s2)&quot;)    &#125;&#125;\nç±»å’Œç»“æ„ä½“ç±»ç±»å¯ä»¥å®šä¹‰å±æ€§ã€æ–¹æ³•ã€æ„é€ å™¨ã€ä¸‹æ ‡æ“ä½œã€‚ç±»ä½¿ç”¨æ‰©å±•æ¥æ‰©å±•åŠŸèƒ½ï¼Œéµå¾ªåè®®ã€‚ç±»è¿˜ä»¥ç»§æ‰¿ï¼Œè¿è¡Œæ—¶æ£€æŸ¥å®ä¾‹ç±»å‹ã€‚\nclass C &#123;    var p: String    init(_ p: String) &#123;        self.p = p    &#125;        // ä¸‹æ ‡æ“ä½œ    subscript(s: String) -&gt; String &#123;        get &#123;            return p + s        &#125;        set &#123;            p = s + newValue        &#125;    &#125;&#125;let c = C(&quot;hi&quot;)print(c.p)print(c[&quot; ming&quot;])c[&quot;k&quot;] = &quot;v&quot;print(c.p)\nç»“æ„ä½“ ç»“æ„ä½“æ˜¯å€¼ç±»å‹ï¼Œå¯ä»¥å®šä¹‰å±æ€§ã€æ–¹æ³•ã€æ„é€ å™¨ã€ä¸‹æ ‡æ“ä½œã€‚ç»“æ„ä½“ä½¿ç”¨æ‰©å±•æ¥æ‰©å±•åŠŸèƒ½ï¼Œéµå¾ªåè®®ã€‚\nstruct S &#123;    var p1: String = &quot;&quot;    var p2: Int&#125;extension S &#123;    func f() -&gt; String &#123;        return p1 + String(p2)    &#125;&#125;var s = S(p2: 1)s.p1 = &quot;1&quot;print(s.f()) // 11\nå±æ€§ç±»ã€ç»“æ„ä½“æˆ–æšä¸¾é‡Œçš„å˜é‡å¸¸é‡å°±æ˜¯ä»–ä»¬çš„å±æ€§ã€‚\nstruct S &#123;    static let sp = &quot;ç±»å‹å±æ€§&quot; // ç±»å‹å±æ€§é€šè¿‡ç±»å‹æœ¬èº«è®¿é—®ï¼Œéå®ä¾‹è®¿é—®    var p1: String = &quot;&quot;    var p2: Int = 1    // cp æ˜¯è®¡ç®—å±æ€§    var cp: Int &#123;        get &#123;            return p2 * 2        &#125;        set &#123;            p2 = newValue + 2        &#125;    &#125;    // åªæœ‰ getter çš„æ˜¯åªè¯»è®¡ç®—å±æ€§    var rcp: Int &#123;        p2 * 4    &#125;&#125;print(S.sp)print(S().cp) // 2var s = S()s.cp = 3print(s.p2) // 5print(S().rcp) // 4\nwillSet å’Œ didSet æ˜¯å±æ€§è§‚å¯Ÿå™¨ï¼Œå¯ä»¥åœ¨å±æ€§å€¼è®¾ç½®å‰åæ’å…¥è‡ªå·±çš„é€»è¾‘å¤„ç†ã€‚\né”®è·¯å¾„è¡¨è¾¾å¼ä½œä¸ºå‡½æ•°\nstruct S2 &#123;    let p1: String    let p2: Int&#125;let s2 = S2(p1: &quot;one&quot;, p2: 1)let s3 = S2(p1: &quot;two&quot;, p2: 2)let a1 = [s2, s3]let a2 = a1.map(\\.p1)print(a2) // [&quot;one&quot;, &quot;two&quot;]\næ–¹æ³•enum E: String &#123;    case one, two, three    func showRawValue() &#123;        print(rawValue)    &#125;&#125;let e = E.threee.showRawValue() // three// å¯å˜çš„å®ä¾‹æ–¹æ³•ï¼Œä½¿ç”¨ mutating æ ‡è®°struct S &#123;    var p: String    mutating func addFullStopForP() &#123;        p += &quot;.&quot;    &#125;&#125;var s = S(p: &quot;hi&quot;)s.addFullStopForP()print(s.p)// ç±»æ–¹æ³•class C &#123;    class func cf() &#123;        print(&quot;ç±»æ–¹æ³•&quot;)    &#125;&#125;\nstaticå’Œclasså…³é”®å­—ä¿®é¥°çš„æ–¹æ³•ç±»ä¼¼ OC çš„ç±»æ–¹æ³•ã€‚static å¯ä»¥ä¿®é¥°å­˜å‚¨å±æ€§ï¼Œè€Œ class ä¸èƒ½ï¼›class ä¿®é¥°çš„æ–¹æ³•å¯ä»¥ç»§æ‰¿ï¼Œè€Œ static ä¸èƒ½ã€‚åœ¨åè®®ä¸­éœ€ç”¨ static æ¥ä¿®é¥°ã€‚\né™æ€ä¸‹æ ‡æ–¹æ³•\n// é™æ€ä¸‹æ ‡struct S2 &#123;    static var sp = [String: Int]()        static subscript(_ s: String, d: Int = 10) -&gt; Int &#123;        get &#123;            return sp[s] ?? d        &#125;        set &#123;            sp[s] = newValue        &#125;    &#125;&#125;S2[&quot;key1&quot;] = 1S2[&quot;key2&quot;] = 2print(S2[&quot;key2&quot;]) // 2print(S2[&quot;key3&quot;]) // 10\nè‡ªå®šä¹‰ç±»å‹ä¸­å®ç°äº† callAsFunction() çš„è¯ï¼Œè¯¥ç±»å‹çš„å€¼å°±å¯ä»¥ç›´æ¥è°ƒç”¨ã€‚\n// callAsFunction()struct S3 &#123;    var p1: String        func callAsFunction() -&gt; String &#123;        return &quot;show \\(p1)&quot;    &#125;&#125;let s2 = S3(p1: &quot;hi&quot;)print(s2()) // show hi\nç»§æ‰¿ç±»èƒ½ç»§æ‰¿å¦ä¸€ä¸ªç±»ï¼Œç»§æ‰¿å®ƒçš„æ–¹æ³•ã€å±æ€§ç­‰ã€‚\n// ç±»ç»§æ‰¿class C1 &#123;    var p1: String    var cp1: String &#123;        get &#123;            return p1 + &quot; like ATM&quot;        &#125;        set &#123;            p1 = p1 + newValue        &#125;    &#125;    init(p1: String) &#123;        self.p1 = p1    &#125;    func sayHi() &#123;        print(&quot;Hi! \\(p1)&quot;)    &#125;&#125;class C2: C1 &#123;    var p2: String    init(p2: String) &#123;        self.p2 = p2        super.init(p1: p2 + &quot;&#x27;s father&quot;)    &#125;&#125;C2(p2: &quot;Lemon&quot;).sayHi() // Hi! Lemon&#x27;s father// é‡å†™çˆ¶ç±»æ–¹æ³•class C3: C2 &#123;    override func sayHi() &#123;        print(&quot;Hi! \\(p2)&quot;)    &#125;&#125;C3(p2: &quot;Lemon&quot;).sayHi() // Hi! Lemon// é‡å†™è®¡ç®—å±æ€§class C4: C1 &#123;    override var cp1: String &#123;        get &#123;            return p1 + &quot; like Out of the blade&quot;        &#125;        set &#123;            p1 = p1 + newValue        &#125;    &#125;&#125;print(C1(p1: &quot;Lemon&quot;).cp1) // Lemon like ATMprint(C4(p1: &quot;Lemon&quot;).cp1) // Lemon like Out of the blade\né€šè¿‡ final å…³é”®å­—å¯ä»¥é˜²æ­¢ç±»è¢«ç»§æ‰¿ï¼Œfinal è¿˜å¯ä»¥ç”¨äºå±æ€§å’Œæ–¹æ³•ã€‚ä½¿ç”¨ super å…³é”®å­—æŒ‡ä»£çˆ¶ç±»ã€‚\nå‡½æ•°å¼mapmap å¯ä»¥ä¾æ¬¡å¤„ç†æ•°ç»„ä¸­å…ƒç´ ï¼Œå¹¶è¿”å›ä¸€ä¸ªå¤„ç†åçš„æ–°æ•°ç»„ã€‚\nlet a1 = [&quot;a&quot;, &quot;b&quot;, &quot;c&quot;]let a2 = a1.map &#123;    &quot;\\($0)2&quot;&#125;print(a2) // [&quot;a2&quot;, &quot;b2&quot;, &quot;c2&quot;]\nä½¿ç”¨ compactMap å¯ä»¥è¿‡æ»¤ nil çš„å…ƒç´ ã€‚flatMap ä¼šå°†å¤šä¸ªæ•°ç»„åˆæˆä¸€ä¸ªæ•°ç»„è¿”å›ã€‚\nfilteræ ¹æ®æŒ‡å®šæ¡ä»¶è¿”å›\nlet a1 = [&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;call my name&quot;]let a2 = a1.filter &#123;    $0.prefix(1) == &quot;c&quot;&#125;print(a2) // [&quot;c&quot;, &quot;call my name&quot;]\nreducereduce å¯ä»¥å°†è¿­ä»£ä¸­è¿”å›çš„ç»“æœç”¨äºä¸‹ä¸ªè¿­ä»£ä¸­ï¼Œå¹¶ï¼Œè¿˜èƒ½è®©ä½ è®¾ä¸ªåˆå§‹å€¼ã€‚\nlet a1 = [&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;call my name.&quot;, &quot;get it?&quot;]let a2 = a1.reduce(&quot;Hey u,&quot;, &#123; partialResult, s in    // partialResult æ˜¯å‰é¢è¿”å›çš„å€¼ï¼Œs æ˜¯éå†åˆ°å½“å‰çš„å€¼    partialResult + &quot; \\(s)&quot;&#125;)print(a2) // Hey u, a b c call my name. get it?\nsortedæ’åº\n// ç±»å‹éµå¾ª Comparablelet a1 = [&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;call my name.&quot;, &quot;get it?&quot;]let a2 = a1.sorted()let a3 = a1.sorted(by: &gt;)let a4 = a1.sorted(by: &lt;)print(a2) // Hey u, a b c call my name. get it?print(a3) // [&quot;get it?&quot;, &quot;call my name.&quot;, &quot;c&quot;, &quot;b&quot;, &quot;a&quot;]print(a4) // [&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;call my name.&quot;, &quot;get it?&quot;]// ç±»å‹ä¸éµå¾ª Comparablestruct S &#123;    var s: String    var i: Int&#125;let a5 = [S(s: &quot;a&quot;, i: 0), S(s: &quot;b&quot;, i: 1), S(s: &quot;c&quot;, i: 2)]let a6 = a5    .sorted &#123; l, r in        l.i &gt; r.i    &#125;    .map &#123;        $0.i    &#125;print(a6) // [2, 1, 0]\næ§åˆ¶æµIf// iflet s = &quot;hi&quot;if s.isEmpty &#123;    print(&quot;String is Empty&quot;)&#125; else &#123;    print(&quot;String is \\(s)&quot;)&#125;// ä¸‰å…ƒæ¡ä»¶s.isEmpty ? print(&quot;String is Empty again&quot;) : print(&quot;String is \\(s) again&quot;)// if let-elsefunc f(s: String?) &#123;    if let s1 = s &#123;        print(&quot;s1 is \\(s1)&quot;)    &#125; else &#123;        print(&quot;s1 is nothing&quot;)    &#125;    // nil-coalescing    let s2 = s ?? &quot;nothing&quot;    print(&quot;s2 is \\(s2)&quot;)&#125;f(s: &quot;something&quot;)f(s: nil)// if case letenum E &#123;    case c1(String)    case c2([String])        func des() &#123;        switch self &#123;        case .c1(let string):            print(string)        case .c2(let array):            print(array)        &#125;    &#125;&#125;E.c1(&quot;enum c1&quot;).des()E.c2([&quot;one&quot;, &quot;two&quot;, &quot;three&quot;]).des()\nGuardæ›´å¥½åœ°å¤„ç†å¼‚å¸¸æƒ…å†µ\n// guardfunc f1(p: String) -&gt; String &#123;    guard p.isEmpty != true else &#123;        return &quot;Empty string.&quot;    &#125;    return &quot;String \\(p) is not empty.&quot;&#125;print(f1(p: &quot;&quot;)) // Empty string.print(f1(p: &quot;lemon&quot;)) // String lemon is not empty.// guard letfunc f2(p1: String?) -&gt; String &#123;    guard let p2 = p1 else &#123;        return &quot;Nil.&quot;    &#125;    return &quot;String \\(p2) is not nil.&quot;&#125;print(f2(p1: nil)) // Nil.print(f2(p1: &quot;lemon&quot;)) // String lemon is not nil.\néå†let a = [&quot;one&quot;, &quot;two&quot;, &quot;three&quot;]for str in a &#123;    print(str)&#125;a.forEach &#123; str in    print(str)&#125;// ä½¿ç”¨ä¸‹æ ‡èŒƒå›´for i in 0..&lt;10 &#123;    print(i)&#125;for i in 0...9 &#123;     print(i) &#125;// ä½¿ç”¨ enumeratedï¼Œi æ˜¯ä¸‹æ ‡ï¼Œstr æ˜¯å…ƒç´ for (i, str) in a.enumerated() &#123;    print(&quot;ç¬¬\\(i + 1)ä¸ªæ˜¯:\\(str)&quot;)&#125;// for in wherefor str in a where str.prefix(1) == &quot;t&quot; &#123;    print(str)&#125;// å­—å…¸ for inï¼Œéå†æ˜¯æ— åºçš„let dic = [    &quot;one&quot;: 1,    &quot;two&quot;: 2,    &quot;three&quot;: 3]for (k, v) in dic &#123;    print(&quot;key is \\(k), value is \\(v)&quot;)&#125;dic.forEach &#123; (k, v) in    print(&quot;key is \\(k), value is \\(v)&quot;)&#125;// stridefor i in stride(from: 10, through: 0, by: -2) &#123;    print(i)&#125;/* 10 8 6 4 2 0 */ // åœ¨å¾ªç¯ä¸­ä½¿ç”¨ continue å’Œ breakfor i in 0..&lt;10 &#123;    if i % 2 == 0 &#123;        continue    &#125;    print(i)&#125;// åœ¨å¾ªç¯ä¸­ä½¿ç”¨ wherefor i in 0..&lt;10 where i % 2 == 0 &#123;    print(i)&#125;\nWhile// whilevar i1 = 10while i1 &gt; 0 &#123;    print(&quot;positive even number \\(i1)&quot;)    i1 -= 2&#125;// repeat whilevar i2 = 10repeat &#123;    print(&quot;positive even number \\(i2)&quot;)    i2 -= 2&#125; while i2 &gt; 0\nä½¿ç”¨ break ç»“æŸéå†ï¼Œä½¿ç”¨ continue è·³è¿‡å½“å‰ä½œç”¨åŸŸï¼Œç»§ç»­ä¸‹ä¸ªå¾ªç¯\nSwitchfunc f1(pa: String, t:(String, Int)) &#123;    var p1 = 0    var p2 = 10    switch pa &#123;    case &quot;one&quot;:        p1 = 1    case &quot;two&quot;:        p1 = 2        fallthrough // ç»§ç»­åˆ°ä¸‹ä¸ª case ä¸­    default:        p2 = 0    &#125;    print(&quot;p1 is \\(p1)&quot;)    print(&quot;p2 is \\(p2)&quot;)        // å…ƒç»„    switch t &#123;    case (&quot;0&quot;, 0):        print(&quot;zero&quot;)    case (&quot;1&quot;, 1):        print(&quot;one&quot;)    default:        print(&quot;no&quot;)    &#125;&#125;f1(pa: &quot;two&quot;, t:(&quot;1&quot;, 1))/* p1 is 2 p2 is 0 one */// æšä¸¾enum E &#123;    case one, two, three, unknown(String)&#125;func f2(pa: E) &#123;    var p: String    switch pa &#123;    case .one:        p = &quot;1&quot;    case .two:        p = &quot;2&quot;    case .three:        p = &quot;3&quot;    case let .unknown(u) where Int(u) ?? 0 &gt; 0 : // æšä¸¾å…³è”å€¼ï¼Œä½¿ç”¨ where å¢åŠ æ¡ä»¶        p = u    case .unknown(_):        p = &quot;negative number&quot;    &#125;    print(p)&#125;f2(pa: E.one) // 1f2(pa: E.unknown(&quot;10&quot;)) // 10f2(pa: E.unknown(&quot;-10&quot;)) // negative number\né›†åˆæ•°ç»„æ•°ç»„æ˜¯æœ‰åºé›†åˆ\nvar a0: [Int] = [1, 10]a0.append(2)a0.remove(at: 0)print(a0) // [10, 2]let a1 = [&quot;one&quot;, &quot;two&quot;, &quot;three&quot;]let a2 = [&quot;three&quot;, &quot;four&quot;]// æ‰¾ä¸¤ä¸ªé›†åˆçš„ä¸åŒlet dif = a1.difference(from: a2) // swiftçš„ diffing ç®—æ³•åœ¨è¿™ http://www.xmailserver.org/diff2.pdf swiftå®ç°åœ¨  swift/stdlib/public/core/Diffing.swiftfor c in dif &#123;    switch c &#123;    case .remove(let o, let e, let a):        print(&quot;offset:\\(o), element:\\(e), associatedWith:\\(String(describing: a))&quot;)    case .insert(let o, let e, let a):        print(&quot;offset:\\(o), element:\\(e), associatedWith:\\(String(describing: a))&quot;)    &#125;&#125;/* remove offset:1, element:four, associatedWith:nil insert offset:0, element:one, associatedWith:nil insert offset:1, element:two, associatedWith:nil */let a3 = a2.applying(dif) ?? [] // å¯ä»¥ç”¨äºæ·»åŠ åˆ é™¤åŠ¨ç”»print(a3) // [&quot;one&quot;, &quot;two&quot;, &quot;three&quot;]\ndif æœ‰ç¬¬ä¸‰ä¸ª case å€¼ .insert(let offset, let element, let associatedWith) å¯ä»¥è·Ÿè¸ªæˆå¯¹çš„å˜åŒ–ï¼Œç”¨äºé«˜çº§åŠ¨ç”»ã€‚\nä»æ•°ç»„ä¸­éšæœºå–ä¸€ä¸ªå…ƒç´ \nprint(a0.randomElement() ?? 0)\næ•°ç»„æ’åº\n// æ’åºstruct S1 &#123;    let n: Int    var b = true&#125;let a4 = [    S1(n: 1),    S1(n: 10),    S1(n: 3),    S1(n: 2)]let a5 = a4.sorted &#123; i1, i2 in    i1.n &lt; i2.n&#125;for n in a5 &#123;    print(n)&#125;/// S1(n: 1)/// S1(n: 2)/// S1(n: 3)/// S1(n: 10)let a6 = [1,10,4,7,2]print(a6.sorted(by: &gt;)) // [10, 7, 4, 2, 1]\nå¯ä»¥åŠ åˆ°æ•°ç»„æ‰©å±•ä¸­ï¼Œé€šè¿‡æ‰©å±•çº¦æŸèƒ½å¤ŸæŒ‡å®šç‰¹å®šå…ƒç´ ç±»å‹çš„æ’åºï¼Œä»£ç å¦‚ä¸‹ï¼š\nextension Array where Element == Int &#123;    // å‡åº    func intSortedASC() -&gt; [Int] &#123;        return self.sorted(by: &lt;)    &#125;    // é™åº    func intSortedDESC() -&gt; [Int] &#123;        return self.sorted(by: &lt;)    &#125;&#125;print(a6.intSortedASC()) // ä½¿ç”¨æ‰©å±•å¢åŠ è‡ªå®šä¹‰æ’åºèƒ½åŠ›\nåœ¨æ•°ç»„ä¸­æ£€ç´¢æ»¡è¶³æ¡ä»¶çš„å…ƒç´ ï¼Œä»£ç å¦‚ä¸‹ï¼š\n// ç¬¬ä¸€ä¸ªæ»¡è¶³æ¡ä»¶äº†å°±è¿”å›let a7 = a4.first &#123;    $0.n == 10&#125;print(a7?.n ?? 0)// æ˜¯å¦éƒ½æ»¡è¶³äº†æ¡ä»¶print(a4.allSatisfy &#123; $0.n == 1 &#125;) // falseprint(a4.allSatisfy(\\.b)) // true// æ‰¾å‡ºæœ€å¤§çš„é‚£ä¸ªprint(a4.max(by: &#123; e1, e2 in    e1.n &lt; e2.n&#125;) ?? S1(n: 0))// S1(n: 10, b: true)// çœ‹çœ‹æ˜¯å¦åŒ…å«æŸä¸ªå…ƒç´ print(a4.contains(where: &#123;    $0.n == 7&#125;))// false\nä¸€äº›åˆ‡å‰²æ•°ç»„çš„æ–¹æ³•ã€‚\n// åˆ‡ç‰‡// å–å‰3ä¸ªï¼Œå¹¶ä¸æ˜¯ç›´æ¥å¤åˆ¶ï¼Œå¯¹äºå¤§çš„æ•°ç»„æœ‰æ€§èƒ½ä¼˜åŠ¿ã€‚print(a6[..&lt;3]) // [1, 10, 4] éœ€è¦åšè¶Šç•Œæ£€æŸ¥print(a6.prefix(30)) // [1, 10, 4, 7, 2] ä¸éœ€è¦åšè¶Šç•Œæ£€æŸ¥ï¼Œä¹Ÿæ˜¯åˆ‡ç‰‡ï¼Œæ€§èƒ½ä¸€æ ·// å»æ‰å‰3ä¸ªprint(a6.dropFirst(3)) // [7, 2]\nprefix(while:) å’Œ drop(while:) æ–¹æ³•ï¼Œé¡ºåºéå†æ‰§è¡Œé—­åŒ…é‡Œçš„é€»è¾‘åˆ¤æ–­ï¼Œæ»¡è¶³æ¡ä»¶å°±è¿”å›ï¼Œé‡åˆ°ä¸åŒ¹é…å°±ä¼šåœæ­¢éå†ã€‚prefix è¿”å›æ»¡è¶³æ¡ä»¶çš„å…ƒç´ é›†åˆï¼Œdrop è¿”å›åœæ­¢éå†ä¹‹åé‚£äº›å…ƒç´ é›†åˆã€‚\nlet a8 = [8, 9, 20, 1, 35, 3]let a9 = a8.prefix &#123;    $0 &lt; 30&#125;print(a9) // [8, 9, 20, 1]let a10 = a8.drop &#123;    $0 &lt; 30&#125;print(a10) // [35, 3]\næ¯” filter æ›´é«˜æ•ˆçš„åˆ é™¤å…ƒç´ çš„æ–¹æ³• removeAll\n// åˆ é™¤æ‰€æœ‰ä¸æ»¡è¶³æ¡ä»¶çš„å…ƒç´ var a11 = [1, 3, 5, 12, 25]a11.removeAll &#123; $0 &lt; 10 &#125;print(a11) // [12, 25]// åˆ›å»ºæœªåˆå§‹åŒ–çš„æ•°ç»„let a12 = (0...4).map &#123; _ in    Int.random(in: 0...5)&#125;print(a12) // [0, 3, 3, 2, 5] éšæœº\n#if ç”¨äºåç¼€è¡¨è¾¾å¼\n// #if ç”¨äºåç¼€è¡¨è¾¾å¼let a13 = a11#if os(iOS)    .count#else    .reduce(0, +)#endifprint(a13) //37\nSetsSet æ˜¯æ— åºé›†åˆï¼Œå…ƒç´ å”¯ä¸€\nlet s0: Set&lt;Int&gt; = [2, 4]let s1: Set = [2, 10, 6, 4, 8]let s2: Set = [7, 3, 5, 1, 9, 10]let s3 = s1.union(s2) // åˆé›†let s4 = s1.intersection(s2) // äº¤é›†let s5 = s1.subtracting(s2) // éäº¤é›†éƒ¨åˆ†let s6 = s1.symmetricDifference(s2) // éäº¤é›†çš„åˆé›†print(s3) // [4, 2, 1, 7, 3, 10, 8, 9, 6, 5]print(s4) // [10]print(s5) // [8, 4, 2, 6]print(s6) // [9, 1, 3, 4, 5, 2, 6, 8, 7]// s0 æ˜¯å¦è¢« s1 åŒ…å«print(s0.isSubset(of: s1)) // true// s1 æ˜¯å¦åŒ…å«äº† s0print(s1.isSuperset(of: s0)) // truelet s7: Set = [3, 5]// s0 å’Œ s7 æ˜¯å¦æœ‰äº¤é›†print(s0.isDisjoint(with: s7)) // true// å¯å˜ Setvar s8: Set = [&quot;one&quot;, &quot;two&quot;]s8.insert(&quot;three&quot;)s8.remove(&quot;one&quot;)print(s8) // [&quot;two&quot;, &quot;three&quot;]\nå­—å…¸å­—å…¸æ˜¯æ— åºé›†åˆï¼Œé”®å€¼å¯¹åº”ã€‚\nvar d1 = [    &quot;k1&quot;: &quot;v1&quot;,    &quot;k2&quot;: &quot;v2&quot;]d1[&quot;k3&quot;] = &quot;v3&quot;d1[&quot;k4&quot;] = nilprint(d1) // [&quot;k2&quot;: &quot;v2&quot;, &quot;k3&quot;: &quot;v3&quot;, &quot;k1&quot;: &quot;v1&quot;]for (k, v) in d1 &#123;    print(&quot;key is \\(k), value is \\(v)&quot;)&#125;/* key is k1, value is v1 key is k2, value is v2 key is k3, value is v3 */ if d1.isEmpty == false &#123;    print(d1.count) // 3&#125;// mapValueslet d2 = d1.mapValues &#123;    $0 + &quot;_new&quot;&#125;print(d2) // [&quot;k2&quot;: &quot;v2_new&quot;, &quot;k3&quot;: &quot;v3_new&quot;, &quot;k1&quot;: &quot;v1_new&quot;]// å¯¹å­—å…¸çš„å€¼æˆ–é”®è¿›è¡Œåˆ†ç»„let d3 = Dictionary(grouping: d1.values) &#123;    $0.count&#125;print(d3) // [2: [&quot;v1&quot;, &quot;v2&quot;, &quot;v3&quot;]]// ä»å­—å…¸ä¸­å–å€¼ï¼Œå¦‚æœé”®å¯¹åº”æ— å€¼ï¼Œåˆ™ä½¿ç”¨é€šè¿‡ default æŒ‡å®šçš„é»˜è®¤å€¼d1[&quot;k5&quot;, default: &quot;whatever&quot;] += &quot;.&quot;print(d1[&quot;k5&quot;] ?? &quot;&quot;) // whatever.let v1 = d1[&quot;k3&quot;, default: &quot;whatever&quot;]print(v1) // v3// compactMapValues() å¯¹å­—å…¸å€¼è¿›è¡Œè½¬æ¢å’Œè§£åŒ…ã€‚å¯ä»¥è§£å¯é€‰ç±»å‹ï¼Œå¹¶å»æ‰ nil å€¼let d4 = [    &quot;k1&quot;: 1,    &quot;k2&quot;: 2,    &quot;k3&quot;: nil]let d5 = d4.mapValues &#123; $0 &#125;let d6 = d4.compactMapValues&#123; $0 &#125;print(d5)// [&quot;k3&quot;: nil, &quot;k1&quot;: Optional(1), &quot;k2&quot;: Optional(2)]print(d6)// [&quot;k1&quot;: 1, &quot;k2&quot;: 2]\næ“ä½œç¬¦èµ‹å€¼let i1 = 1var i2 = i1i2 = 2print(i2) // 2i2 += 1print(i2) // 3i2 -= 2print(i2) // 1i2 *= 10print(i2) // 10i2 /= 2print(i2) // 5\nè®¡ç®—ç¬¦let i1 = 1let i2 = i1print((i1 + i2 - 1) * 10 / 2 % 3) // 2print(&quot;i&quot; + &quot;1&quot;) // i1// ä¸€å…ƒè¿ç®—ç¬¦print(-i1) // -1\næ¯”è¾ƒè¿ç®—ç¬¦éµå¾ª Equatable åè®®å¯ä»¥ä½¿ç”¨ &#x3D;&#x3D; å’Œ !&#x3D; æ¥åˆ¤æ–­æ˜¯å¦ç›¸ç­‰\nprint(1 &gt; 2) // falsestruct S: Equatable &#123;    var p1: String    var p2: Int&#125;let s1 = S(p1: &quot;one&quot;, p2: 1)let s2 = S(p1: &quot;two&quot;, p2: 2)let s3 = S(p1: &quot;one&quot;, p2: 2)let s4 = S(p1: &quot;one&quot;, p2: 1)print(s1 == s2) // falseprint(s1 == s3) // falseprint(s1 == s4) // true\nç±»éœ€è¦å®ç° &#x3D;&#x3D; å‡½æ•°\nclass C: Equatable &#123;    var p1: String    var p2: Int    init(p1: String, p2: Int) &#123;        self.p1 = p1        self.p2 = p2    &#125;        static func == (l: C, r: C) -&gt; Bool &#123;        return l.p1 == r.p1 &amp;&amp; l.p2 == r.p2    &#125;&#125;let c1 = C(p1: &quot;one&quot;, p2: 1)let c2 = C(p1: &quot;one&quot;, p2: 1)print(c1 == c2)// å…ƒç»„æ¯”è¾ƒ// ä¼šå…ˆæ¯”è¾ƒç¬¬ä¸€ä¸ªæ•°ï¼Œç¬¬ä¸€ä¸ªæ— æ³•æ¯”è¾ƒæ‰ä¼šæ¯”è¾ƒç¬¬äºŒä¸ªæ•°// å­—ç¬¦ä¸²æ¯”è¾ƒå’Œå­—æ¯å¤§å°è¿˜æœ‰é•¿åº¦æœ‰å…³ã€‚å…ˆæ¯”è¾ƒå­—æ¯å¤§å°ï¼Œåœ¨æ¯”è¾ƒé•¿åº¦(&quot;apple&quot;, 1) &lt; (&quot;apple&quot;, 2) // true(&quot;applf&quot;, 1) &lt; (&quot;apple&quot;, 2) // false(&quot;appl&quot;, 2) &lt; (&quot;apple&quot;, 1) // true(&quot;appm&quot;, 2) &lt; (&quot;apple&quot;, 1) // false\nä¸‰å…ƒç®€åŒ– if else å†™æ³•\n// if elsefunc f1(p: Int) &#123;    if p &gt; 0 &#123;        print(&quot;positive number&quot;)    &#125; else &#123;        print(&quot;negative number&quot;)    &#125;&#125;// ä¸‰å…ƒfunc f2(p: Int) &#123;    p &gt; 0 ? print(&quot;positive number&quot;) : print(&quot;negative number&quot;)&#125;f1(p: 1)f2(p: 1)\ncoalescingç®€åŒ– if let else å†™æ³•\n// if elsefunc f1(p: Int?) &#123;    if let i = p &#123;        print(&quot;p have value is \\(i)&quot;)    &#125; else &#123;        print(&quot;p is nil, use defalut value&quot;)    &#125;&#125;// ä½¿ç”¨ ??func f2(p: Int?) &#123;    let i = p ?? 0    print(&quot;p is \\(i)&quot;)&#125;\nèŒƒå›´ç®€åŒ–çš„å€¼èŒƒå›´è¡¨è¾¾æ–¹å¼ã€‚\n// å°é—­èŒƒå›´for i in 0...10 &#123;    print(i)&#125;// åŠå¼€èŒƒå›´for i in 0..&lt;10 &#123;    print(i)&#125;\n// å•ä¾§åŒºé—´let nums = [5,6,7,8]print(nums[2...]) // 7 8\né€»è¾‘let i1 = -1let i2 = 2if i1 != i2 &amp;&amp; (i1 &lt; 0 || i2 &lt; 0) &#123;    print(&quot;i1 and i2 not equal, and one of them is negative number.&quot;)&#125;\næ’ç­‰æ’ç­‰è¿”å›æ˜¯å¦å¼•ç”¨äº†ç›¸åŒå®ä¾‹ã€‚\nclass C &#123;    var p: String    init(p: String) &#123;        self.p = p    &#125;&#125;let c1 = C(p: &quot;one&quot;)let c2 = C(p: &quot;one&quot;)let c3 = c1print(c1 === c2) // falseprint(c1 === c3) // trueprint(c1 !== c2) // true\nè¿ç®—ç¬¦ä½è¿ç®—ç¬¦\nlet i1: UInt8 = 0b00001111let i2 = ~i1 // Bitwise NOT Operatorï¼ˆæŒ‰ä½å–åè¿ç®—ç¬¦ï¼‰ï¼Œå–ålet i3: UInt8 = 0b00111111let i4 = i1 &amp; i3 // Bitwise AND Operatorï¼ˆæŒ‰ä½ä¸è¿ç®—ç¬¦ï¼‰ï¼Œéƒ½ä¸º1æ‰æ˜¯1let i5 = i1 | i3 // Bitwise OR Operatorï¼ˆæŒ‰ä½æˆ–è¿ç®—ç¬¦ï¼‰ï¼Œæœ‰ä¸€ä¸ª1å°±æ˜¯1let i6 = i1 ^ i3 // Bitwise XOR Operatorï¼ˆæŒ‰ä½å¼‚æˆ–è¿ç®—ç¬¦ï¼‰ï¼Œä¸åŒä¸º1ï¼Œç›¸åŒä¸º0print(i1,i2,i3,i4,i5,i6)// &lt;&lt; æŒ‰ä½å·¦ç§»ï¼Œ&gt;&gt; æŒ‰ä½å³ç§»let i7 = i1 &lt;&lt; 1let i8 = i1 &gt;&gt; 2print(i7,i8)\næº¢å‡ºè¿ç®—ç¬¦ï¼Œæœ‰ &amp;+ã€&amp;- å’Œ &amp;*\nvar i1 = Int.maxprint(i1) // 9223372036854775807i1 = i1 &amp;+ 1print(i1) // -9223372036854775808i1 = i1 &amp;+ 10print(i1) // -9223372036854775798var i2 = UInt.maxi2 = i2 &amp;+ 1print(i2) // 0\nè¿ç®—ç¬¦å‡½æ•°åŒ…æ‹¬å‰ç¼€è¿ç®—ç¬¦ã€åç¼€è¿ç®—ç¬¦ã€å¤åˆèµ‹å€¼è¿ç®—ç¬¦ä»¥åŠç­‰ä»·è¿ç®—ç¬¦ã€‚å¦ï¼Œè¿˜å¯ä»¥è‡ªå®šä¹‰è¿ç®—ç¬¦ï¼Œæ–°çš„è¿ç®—ç¬¦è¦ç”¨ operator å…³é”®å­—è¿›è¡Œå®šä¹‰ï¼ŒåŒæ—¶è¦æŒ‡å®š prefixã€infix æˆ–è€… postfix ä¿®é¥°ç¬¦ã€‚\nSwiftè§„èŒƒå‚è€ƒï¼š\n\nSwift Style Guide\n\nå¤šç”¨é™æ€ç‰¹æ€§ã€‚swift åœ¨ç¼–è¯‘æœŸé—´æ‰€åšçš„ä¼˜åŒ–æ¯” OC è¦å¤šï¼Œè¿™æ˜¯ç”±äºä»–çš„é™æ€æ´¾å‘ã€æ³›å‹ç‰¹åŒ–ã€å†™æ—¶å¤åˆ¶è¿™äº›é™æ€ç‰¹æ€§å†³å®šçš„ã€‚å¦å¤–é€šè¿‡ final å’Œ private è¿™æ ·çš„è¡¨ç¤ºå¯å°†åŠ¨æ€ç‰¹æ€§è½¬åŒ–ä¸ºé™æ€æ–¹å¼ï¼Œç¼–è¯‘å¼€å¯ WMO å¯ä»¥è‡ªåŠ¨æ¨å¯¼å‡ºå“ªäº›åŠ¨æ€æ´¾å‘å¯è½¬åŒ–ä¸ºé™æ€æ´¾å‘ã€‚\nå¦‚ä½•é¿å…å´©æºƒï¼Ÿ\n\nå­—å…¸ï¼šç”¨ç»“æ„ä½“æ›¿ä»£\nAnyï¼šå¯ç”¨æ³›å‹æˆ–å…³è”å…³è”ç±»å‹æ›¿ä»£\nas? ï¼šå°‘ç”¨ AnyObjectï¼Œå¤šç”¨æ³›å‹æˆ–ä¸é€æ˜ç±»å‹\n!ï¼šè¦å°‘ç”¨\n\nå¥½çš„å®è·µï¼Ÿ\n\nå°‘ç”¨ç»§æ‰¿ï¼Œå¤šç”¨ protocol\nå¤šç”¨ extension å¯¹è‡ªå·±ä»£ç è¿›è¡Œç®¡ç†\n\nSwiftä¹¦å•\nã€ŠThinking in SwiftUIã€‹\nã€ŠSwift è¿›é˜¶ã€‹\nã€Šå‡½æ•°å¼Swiftã€‹\nã€Šæ·±å…¥è§£æMac OS X &amp; iOSæ“ä½œç³»ç»Ÿã€‹\nã€ŠLLVM Techniques, Tips, and Best Practices Clang and Middle-End Librariesã€‹\nã€ŠLearn LLVM 12ã€‹\nã€ŠCrafting Interpretersã€‹\nã€ŠTCP&#x2F;IP Illustratedã€‹\nã€Šæ¾æœ¬è¡Œå¼˜çš„ç¨‹åºä¸–ç•Œã€‹\nã€Šç°ä»£æ“ä½œç³»ç»Ÿã€‹\nã€Šæ·±å…¥ç†è§£è®¡ç®—æœºç³»ç»Ÿã€‹\nã€Šç¨‹åºå‘˜çš„è‡ªæˆ‘ä¿®å…»ã€‹\nã€ŠHead First è®¾è®¡æ¨¡å¼ã€‹\n\n"},{"title":"åŒ…ä½“ç§¯","url":"/2025/05/15/%E5%8C%85%E4%BD%93%E7%A7%AF/","content":"åŒ…ä½“ç§¯çš„å½±å“åŒ…ä½“ç§¯ä¼˜åŒ–çš„å¿…è¦æ€§\nä¸‹è½½è½¬åŒ–ç‡ä¸‹é™ï¼šæ¯å¢åŠ 6Mï¼Œåº”ç”¨ä¸‹è½½è½¬åŒ–ç‡ä¸‹é™1%ã€‚\nApp Storeé™åˆ¶ï¼šè¶…è¿‡200MBçš„åŒ…ï¼ŒiOS 13ä»¥ä¸‹ç”¨æˆ·æ— æ³•é€šè¿‡èœ‚çªæ•°æ®ä¸‹è½½ï¼ŒiOS 13åŠä»¥ä¸Šç”¨æˆ·éœ€æ‰‹åŠ¨è®¾ç½®ã€‚\nç£ç›˜å ç”¨ï¼šå¤§åŒ…ä½“ç§¯å ç”¨æ›´å¤šå­˜å‚¨ç©ºé—´ï¼Œå½±å“ä½å­˜å‚¨ç”¨æˆ·ã€‚\nç”¨æˆ·ä¸‹è½½æ„æ„¿ï¼šå¤§åŒ…ä½“ç§¯å‡å°‘ç”¨æˆ·ä¸‹è½½æ„æ„¿ï¼Œå°¤å…¶åœ¨èœ‚çªæ•°æ®ä½æ•°æ®æ¨¡å¼ä¸‹ã€‚\næ€§èƒ½å½±å“ï¼šåŒ…ä½“ç§¯å¤§å¢åŠ å¯åŠ¨æ—¶é—´å’ŒSIGKILLé£é™©ï¼Œé™ä½åŸºç¡€ä½“éªŒã€‚\n\næŠ€æœ¯æ–¹æ¡ˆ\nèµ„æºä¼˜åŒ–ï¼šä¼˜åŒ–å¤§å—èµ„æºã€æ— ç”¨é…ç½®æ–‡ä»¶å’Œé‡å¤èµ„æºã€‚\nå·¥ç¨‹æ¶æ„ä¼˜åŒ–ï¼šå»ºç«‹ä½“ç§¯æ£€æµ‹æµæ°´çº¿ï¼Œæ§åˆ¶ä½“ç§¯å¢é•¿ã€‚\nå›¾ç‰‡ä¼˜åŒ–ï¼šæ— ç”¨å›¾ç‰‡ä¼˜åŒ–ã€Asset Catalogä¼˜åŒ–ã€HEICå’ŒWebPå‹ç¼©ä¼˜åŒ–ã€TinyPngå‹ç¼©ã€‚\nç¼–è¯‘å™¨ä¼˜åŒ–ï¼šä½¿ç”¨LLVMç¼–è¯‘é€‰é¡¹ï¼Œè¿›è¡ŒOCã€C++ã€Swiftç­‰è¯­è¨€çš„ç¼–è¯‘ä¼˜åŒ–ã€‚\nä»£ç ä¼˜åŒ–ï¼šæ— ç”¨ç±»ã€æ–¹æ³•ã€æ¨¡å—ç˜¦èº«ï¼Œç²¾ç®€é‡å¤ä»£ç ï¼ŒABå®éªŒå›ºåŒ–ã€‚\n\nåŒ…ä½“ç§¯-ç³»ç»Ÿä¼˜åŒ–\nApp Thinningï¼šåˆ©ç”¨Appleæä¾›çš„App ThinningåŠŸèƒ½ï¼Œæ ¹æ®ç”¨æˆ·çš„è®¾å¤‡è‡ªåŠ¨ä¸‹è½½é€‚åˆè¯¥è®¾å¤‡çš„èµ„æºåŒ…ï¼Œæœ‰åŠ©äºå‡å°‘åˆè£…åŒ…çš„å¤§å°ã€‚\næŒ‰éœ€ä¸‹è½½èµ„æºï¼šä½¿ç”¨On-Demand Resourcesæ¥æŒ‰éœ€ä¸‹è½½èµ„æºï¼Œåªä¸‹è½½ç”¨æˆ·å®é™…éœ€è¦çš„éƒ¨åˆ†ï¼Œä»è€Œå‡å°åˆå§‹å®‰è£…åŒ…çš„å¤§å°ã€‚\n\nåŒ…çš„åˆ†æå®‰è£…åŒ…ç”Ÿæˆè¿‡ç¨‹ä¸æŒ‡æ ‡\nç”Ÿæˆè¿‡ç¨‹ï¼šipaåŒ…ä¸Šä¼ AppStoreåï¼ŒApp Thinningé’ˆå¯¹ä¸åŒè®¾å¤‡ç”Ÿæˆä¸åŒç¼–è¯‘äº§ç‰©ã€‚\nå®‰è£…åŒ…ä¸ä¸‹è½½åŒ…å¤§å°ï¼šå®‰è£…åŒ…å¤§å°æ˜¯ç”¨æˆ·å®‰è£…åå ç”¨çš„ç£ç›˜ç©ºé—´ï¼Œä¸‹è½½åŒ…å¤§å°æ˜¯ç”¨æˆ·ä¸‹è½½æ—¶çš„å‹ç¼©åŒ…å¤§å°ã€‚\nè¡¡é‡æ ‡å‡†ï¼šiOSç«¯é€šå¸¸å°†å®‰è£…åŒ…ä½“ç§¯ä½œä¸ºè¡¡é‡æ ‡å‡†ã€‚\n\niOSç«¯å®‰è£…åŒ…ç»„æˆéƒ¨åˆ†\nMach-Oæ–‡ä»¶ï¼šiOSç³»ç»Ÿä¸Šçš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚\nWatch APPï¼šå¸¦æœ‰å°ç»„ä»¶åŠŸèƒ½çš„WatchAppã€‚\nè‡ªå®šä¹‰åŠ¨æ€åº“ï¼šåŠ¨æ€åº“æ¨è¿Ÿåˆ°è¿è¡Œæ—¶åŠ è½½ï¼ŒèŠ‚çœä»£ç æ®µç©ºé—´ã€‚\nSwiftç³»ç»Ÿåº“ï¼šé«˜ç‰ˆæœ¬iOSç³»ç»Ÿè‡ªå¸¦ï¼Œä½ç‰ˆæœ¬éœ€iPAåŒ…ä¸­è‡ªå¸¦ã€‚\nAssetsèµ„æºï¼šAssets.caræ–‡ä»¶ï¼ŒåŒ…å«å›¾ç‰‡èµ„æºã€‚\næ ¹ç›®å½•ä¸‹å›¾ç‰‡èµ„æºï¼šç›´æ¥æ·»åŠ è¿›å·¥ç¨‹çš„å›¾ç‰‡æ–‡ä»¶ã€‚\nbundleèµ„æºï¼šç®¡ç†å›¾ç‰‡å’Œå…¶ä»–é…ç½®æ–‡ä»¶ã€‚\nå…¶ä»–é…ç½®æ–‡ä»¶ï¼šå¦‚plistã€jsã€cssã€jsonç­‰ã€‚\n\nMach-Oæ–‡ä»¶Mach-Oæ˜¯Mach Objectæ–‡ä»¶æ ¼å¼çš„ç¼©å†™ï¼Œç”¨äºè®°å½•MacåŠiOSç³»ç»Ÿä¸Šçš„å¯æ‰§è¡Œæ–‡ä»¶ã€ç›®æ ‡ä»£ç ã€åŠ¨æ€åº“å’Œå†…å­˜è½¬å‚¨ã€‚ä½¿ç”¨MachOViewå’Œotoolå‘½ä»¤æŸ¥çœ‹Mach-Oæ–‡ä»¶ä¿¡æ¯ï¼Œä»¥åŠé€šè¿‡fileå’Œlipoå‘½ä»¤æŸ¥çœ‹æ–‡ä»¶æ ¼å¼å’Œæ¶æ„ã€‚Mach-Oæ–‡ä»¶æœ‰Headerã€LoadCommandså’ŒDataéƒ¨åˆ†ï¼Œç‰¹åˆ«æ˜¯LoadCommandsä¸­çš„å…³é”®cmdç±»å‹å¦‚LCSEGMENT64ï¼ŒåŠå…¶æ®µ(__PAGEZEROã€__TEXTã€__DATAã€__LINKEDIT)ã€‚\nå¼€æºå·¥å…·5GUIs5GUIs æ˜¯ä¸€æ¬¾åŸºäº SwiftUI å¼€å‘çš„ macOS åº”ç”¨ç¨‹åºï¼Œå®ƒå…·å¤‡æ£€æµ‹å…¶ä»– macOS åº”ç”¨ç¨‹åºä¸­æ‰€ä½¿ç”¨çš„ GUIï¼ˆå›¾å½¢ç”¨æˆ·ç•Œé¢ï¼‰æŠ€æœ¯çš„èƒ½åŠ›ã€‚é€šè¿‡åˆ†æåº”ç”¨æ†ç»‘åŒ…å¹¶åˆ©ç”¨ LLVM çš„ objdump å·¥å…·ï¼Œ5GUIs èƒ½å¤Ÿè¯†åˆ«å‡ºå„ç§ç•Œé¢æŠ€æœ¯ï¼Œå¦‚ AppKitã€Apple çš„ Catalystï¼ˆåŸ Marzipan é¡¹ç›®ï¼‰ã€iOS å¼çš„ SwiftUIï¼Œä»¥åŠåŸºäº Electron å’Œ UIKit çš„åº”ç”¨ã€‚5GUIs ä¸ä»…èƒ½å¤Ÿè¯†åˆ«æŠ€æœ¯æ ˆï¼Œè¿˜èƒ½å±•ç¤ºä¸åŒ GUI é£æ ¼çš„åº”ç”¨çª—å£ï¼Œä¸ºç”¨æˆ·æä¾›ä¸€ä¸ªç›´è§‚çš„ç•Œé¢è®¾è®¡å±•ç¤ºå¹³å°ã€‚\nAPPAnalyzeAPPAnalyze æ˜¯ä¸€æ¬¾ç”¨äºåˆ†æiOS ipaåŒ…çš„è„šæœ¬å·¥å…·ï¼Œèƒ½å¤Ÿè‡ªåŠ¨æ‰«æå¹¶å‘ç°å¯ä¿®å¤çš„åŒ…ä½“ç§¯é—®é¢˜ï¼ŒåŒæ—¶ç”ŸæˆåŒ…ä½“ç§¯æ•°æ®ç”¨äºæŸ¥çœ‹ã€‚\næ•°æ®æŒ‡æ ‡é‡åŒ–ï¼š\n\nåŒ…ä½“ç§¯é—®é¢˜ï¼šæä¾›æ•°æ®åŒ–å¹³å°æŸ¥çœ‹æ¯ä¸ªç»„ä»¶çš„åŒ…ä½“ç§¯å¾…ä¿®å¤é—®é¢˜ã€‚\nåŒ…ä½“ç§¯å¤§å°ï¼šå±•ç¤ºæ€»å¤§å°ã€å•ä¸ªæ–‡ä»¶äºŒè¿›åˆ¶å¤§å°å’Œæ¯ä¸ªèµ„æºå¤§å°ï¼Œæ”¯æŒç»„ä»¶åŒ–ç²’åº¦çš„åŒ…ä½“ç§¯æ•°æ®å¯¹æ¯”ã€‚\n\næ‰«æè§„åˆ™ä¸ä¿®å¤æ–¹å¼ï¼š\n\næœªä½¿ç”¨çš„ç±»ï¼šå®šä¹‰ä½†æœªä½¿ç”¨çš„ObjCå’ŒSwiftç±»ï¼Œå»ºè®®ç§»é™¤ã€‚\næœªä½¿ç”¨çš„ObjCåè®®ï¼šå®šä¹‰ä½†æœªä½¿ç”¨çš„åè®®ï¼Œå»ºè®®ç§»é™¤ã€‚\nBundleå†…å¤šScaleå›¾ç‰‡ï¼šç§»é™¤Scaleæ›´ä½çš„å›¾ç‰‡ã€‚\nå¤§èµ„æºï¼šæ–‡ä»¶å¤§å°è¶…è¿‡20KBå³ä¸ºå¤§èµ„æºï¼Œå»ºè®®ç§»é™¤æˆ–åŠ¨æ€ä¸‹å‘ã€‚\né‡å¤çš„èµ„æºæ–‡ä»¶ï¼šç§»é™¤å¤šä½™çš„æ–‡ä»¶ã€‚\næœªä½¿ç”¨çš„å±æ€§ã€æ–¹æ³•ã€èµ„æºæ–‡ä»¶ç­‰å‡æœ‰è¯¦ç»†çš„æ‰«æè§„åˆ™å’Œä¿®å¤å»ºè®®ã€‚\n\nå®‰å…¨ä¸æ€§èƒ½ï¼š\n\nå®‰å…¨ï¼šåŠ¨æ€åå°„è°ƒç”¨ã€å±æ€§å†…å­˜ç”³æ˜é”™è¯¯ã€å†²çªçš„åˆ†ç±»æ–¹æ³•ç­‰é—®é¢˜åŠå…¶ä¿®å¤æ–¹å¼ã€‚\næ€§èƒ½ï¼šä½¿ç”¨åŠ¨æ€åº“ä¼šå¢åŠ å¯åŠ¨è€—æ—¶ï¼Œå»ºè®®ä½¿ç”¨é™æ€åº“ï¼›å‡å°‘+loadæ–¹æ³•çš„ä½¿ç”¨ä»¥é™ä½å¯åŠ¨è€—æ—¶ã€‚\n\nåŒ…ä½“ç§¯-èµ„æºä¼˜åŒ–æ–¹æ¡ˆ\nå›¾ç‰‡èµ„æºå‹ç¼©ï¼šä½¿ç”¨æ— æŸæˆ–æœ‰æŸå‹ç¼©å·¥å…·ï¼ˆå¦‚ImageOptimã€tinypngã€pngquantç­‰ï¼‰å¯¹å›¾ç‰‡èµ„æºè¿›è¡Œå‹ç¼©ï¼Œå°¤å…¶æ˜¯PNGå’ŒJPEGæ ¼å¼çš„å›¾ç‰‡ã€‚è€ƒè™‘å°†å›¾ç‰‡è½¬æ¢ä¸ºWebPæ ¼å¼ï¼Œå› ä¸ºWebPæ ¼å¼å…·æœ‰è¾ƒé«˜çš„å‹ç¼©ç‡ä¸”è‚‰çœ¼éš¾ä»¥å¯Ÿè§‰è´¨é‡æŸå¤±ã€‚\nèµ„æºæ¸…ç†ï¼šä½¿ç”¨å·¥å…·å¦‚LSUnusedResourcesæ¥æŸ¥æ‰¾å¹¶åˆ é™¤é¡¹ç›®ä¸­æœªè¢«å¼•ç”¨çš„å›¾ç‰‡ã€éŸ³é¢‘ã€è§†é¢‘ç­‰èµ„æºæ–‡ä»¶ã€‚æ‰‹åŠ¨æ£€æŸ¥é¡¹ç›®ä¸­æ˜¯å¦å­˜åœ¨å·²ç»ä¸å†ä½¿ç”¨ä½†æœªè¢«åˆ é™¤çš„èµ„æºï¼Œå¦‚æ—§ç‰ˆæœ¬çš„å¯åŠ¨å›¾ã€å›¾æ ‡ç­‰ã€‚\nåŠ¨æ€åŠ è½½èµ„æºï¼šå¯¹äºå¤§å‹èµ„æºæ–‡ä»¶ï¼ˆå¦‚è§†é¢‘ã€éŸ³é¢‘æ–‡ä»¶ï¼‰ï¼Œå¯ä»¥è€ƒè™‘åœ¨è¿è¡Œæ—¶ä»æœåŠ¡å™¨ä¸‹è½½ï¼Œè€Œä¸æ˜¯ç›´æ¥åŒ…å«åœ¨APPå®‰è£…åŒ…ä¸­ã€‚\nä½¿ç”¨Assets.xcassetsï¼šä½¿ç”¨Assets.xcassetsæ¥ç®¡ç†å›¾ç‰‡èµ„æºï¼Œå› ä¸ºXcodeä¼šå¯¹Assets.xcassetsä¸­çš„å›¾ç‰‡è¿›è¡Œè‡ªåŠ¨å‹ç¼©ï¼Œç”Ÿæˆæ›´å°çš„Assets.caræ–‡ä»¶ã€‚\n\næ— ç”¨å›¾ç‰‡ä¼˜åŒ–é€šè¿‡å·¥å…·è·å–æ‰€æœ‰å›¾ç‰‡èµ„æºåŠä»£ç ä¸­å¯èƒ½å¼•ç”¨å›¾ç‰‡çš„é™æ€å­—ç¬¦ä¸²ï¼Œå¯¹æ¯”æ‰¾å‡ºæœªå¼•ç”¨çš„å›¾ç‰‡å¹¶åˆ é™¤ã€‚å…·ä½“æ­¥éª¤ï¼š\n\nè·å–æ‰€æœ‰å›¾ç‰‡ï¼šä½¿ç”¨è„šæœ¬é€’å½’éå†å·¥ç¨‹ç›®å½•ï¼Œæ”¶é›†æ‰€æœ‰å›¾ç‰‡èµ„æºåŠå…¶æ‰€å±å…³ç³»ã€‚\nè·å–å¯èƒ½å¼•ç”¨å›¾ç‰‡çš„é™æ€å­—ç¬¦ä¸²ï¼šé’ˆå¯¹ä¸åŒæ–‡ä»¶æ ¼å¼ï¼ˆå¦‚Objective-Cã€Swiftã€HTMLç­‰ï¼‰ï¼Œä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…å¯èƒ½å¼•ç”¨å›¾ç‰‡çš„å­—ç¬¦ä¸²ã€‚\nè·å–æœªå¼•ç”¨å›¾ç‰‡ï¼šå¯¹æ¯”å›¾ç‰‡èµ„æºå’Œå¼•ç”¨å­—ç¬¦ä¸²é›†åˆï¼Œæ‰¾å‡ºæœªå¼•ç”¨çš„å›¾ç‰‡ã€‚\näºŒæ¬¡è¿‡æ»¤ï¼šé’ˆå¯¹å­—ç¬¦ä¸²æ‹¼æ¥çš„å¸¸è§caseï¼ˆå¦‚æš—é»‘æ¨¡å¼å›¾ç‰‡ã€å›¾ç‰‡åºåˆ—ç­‰ï¼‰è¿›è¡ŒäºŒæ¬¡è¿‡æ»¤ï¼Œæé«˜å‡†ç¡®åº¦ã€‚\n\nAsset Catalogå›¾ç‰‡ä¼˜åŒ–Asset Catalogæ˜¯Xcodeæä¾›çš„èµ„æºç®¡ç†å·¥å…·ï¼Œç”¨äºé›†ä¸­ç®¡ç†é¡¹ç›®ä¸­çš„å›¾ç‰‡ç­‰èµ„æºã€‚é€šè¿‡Xcodeè‡ªå¸¦å·¥å…·actoolç”ŸæˆAssets.caræ–‡ä»¶ï¼Œå¯ä½¿ç”¨assetutilå·¥å…·åˆ†ææ–‡ä»¶å†…å®¹ã€‚å¼€å‘è€…åœ¨å›¾ç‰‡æ”¾å…¥Asset Catalogå‰ä¸è¦åšæ— æŸå‹ç¼©ï¼Œå› ä¸ºactoolä¼šé‡æ–°è¿›è¡Œå‹ç¼©å¤„ç†ã€‚\nAsset Catalog çš„ä¼˜ç‚¹æœ‰ï¼š\n\nåŒ…ä½“ç§¯ç˜¦èº«ï¼šæ ¹æ®ä¸åŒè®¾å¤‡ä¸‹è½½åŒ¹é…çš„å›¾ç‰‡èµ„æºï¼Œå‡å°‘ä¸‹è½½åŒ…å¤§å°ã€‚\nç»Ÿä¸€çš„å›¾ç‰‡æ— æŸå‹ç¼©ï¼šé‡‡ç”¨Apple Deep Pixel Image CompressionæŠ€æœ¯ï¼Œæé«˜å‹ç¼©æ¯”ã€‚\nä¾¿åˆ©çš„èµ„æºç®¡ç†ï¼šå°†å›¾ç‰‡èµ„æºç»Ÿä¸€å‹ç¼©æˆAssets.caræ–‡ä»¶ï¼Œä¾¿äºç®¡ç†ã€‚\né«˜æ•ˆçš„I&#x2F;Oæ“ä½œï¼šå›¾ç‰‡åŠ è½½è€—æ—¶å‡å°‘ä¸¤ä¸ªæ•°é‡çº§ï¼Œæå‡åº”ç”¨æ€§èƒ½ã€‚\n\nå›¾ç‰‡å‹ç¼©å·¥å…·TinyPngå’Œpngquantï¼Œpngquantæ”¯æŒæ‰¹é‡å‹ç¼©å’Œè‡ªå®šä¹‰å‹ç¼©å“è´¨ã€‚\nHEICå›¾ç‰‡ç¼–ç ä¼˜åŒ–HEICå›¾ç‰‡ç¼–ç å…·æœ‰é«˜å‹ç¼©ç‡ã€èŠ‚çœå†…å­˜å’Œè§£ç æ•ˆç‡é«˜çš„ç‰¹ç‚¹ã€‚è‡ªiOS 11èµ·ï¼Œè‹¹æœå°†HEICè®¾ç½®ä¸ºå›¾ç‰‡å­˜å‚¨çš„é»˜è®¤æ ¼å¼ï¼Œé€‚ç”¨äºå¯¹å›¾ç‰‡è´¨é‡å’Œä½“ç§¯è¦æ±‚è¾ƒé«˜çš„åœºæ™¯ã€‚\nå¤§èµ„æºä¼˜åŒ–\nè·å–å¤§èµ„æºï¼šé€šè¿‡é€’å½’éå†ipaåŒ…è·å–ä½“ç§¯å¤§äº40Kçš„èµ„æºæ–‡ä»¶ã€‚\nä¼˜åŒ–æ–¹æ³•ï¼šåŒ…æ‹¬å¼‚æ­¥ä¸‹è½½å’Œèµ„æºå‹ç¼©ï¼Œä»¥é™ä½é¦–æ¬¡å¯åŠ¨åŠ è½½å‹åŠ›ã€‚\n\næ— ç”¨é…ç½®æ–‡ä»¶\nè·å–é…ç½®æ–‡ä»¶ï¼šä½¿ç”¨æ’é™¤æ³•ä»ipaåŒ…ä¸­è·å–é™¤ç‰¹å®šæ–‡ä»¶ï¼ˆå¦‚dylibã€asset.carã€å›¾ç‰‡ã€JS&amp;CSSï¼‰å¤–çš„é…ç½®æ–‡ä»¶ã€‚\nè·å–é™æ€å­—ç¬¦ä¸²å¸¸é‡ï¼šé€šè¿‡otoolå‘½ä»¤ä»mach-oæ–‡ä»¶çš„TEXTå­—æ®µé™æ€å­—ç¬¦ä¸²å¸¸é‡ä¸­è·å–å¼•ç”¨çš„é…ç½®æ–‡ä»¶ã€‚\næ— ç”¨æ–‡ä»¶æ’æŸ¥ï¼šå¯¹æ¯”è·å–çš„é…ç½®æ–‡ä»¶å’Œå¼•ç”¨çš„é…ç½®æ–‡ä»¶ï¼Œç¡®è®¤å¹¶åˆ é™¤æ— ç”¨æ–‡ä»¶ã€‚\nJS&amp;CSSæ–‡ä»¶æ’æŸ¥ï¼šé’ˆå¯¹JS&amp;CSSæ–‡ä»¶çš„ç‰¹æ®Šæ€§ï¼Œé‡‡ç”¨ç±»ä¼¼æ— ç”¨å›¾ç‰‡æ£€æµ‹çš„æ–¹æ³•è¿›è¡Œä¼˜åŒ–ã€‚\n\né‡å¤èµ„æºä¼˜åŒ–\nè·å–èµ„æºæ–‡ä»¶ï¼šä»ipaåŒ…ä¸­è·å–æ‰€æœ‰èµ„æºæ–‡ä»¶ã€‚\nåˆ¤æ–­é‡å¤èµ„æºï¼šé€šè¿‡MD5åˆ¤æ–­èµ„æºæ˜¯å¦é‡å¤ï¼Œå¹¶åˆ é™¤é‡å¤èµ„æºä»¥å‡å°åŒ…ä½“ç§¯ã€‚\n\nåŒ…ä½“ç§¯-ä»£ç ä¼˜åŒ–æ–¹æ¡ˆ\nç§»é™¤æœªä½¿ç”¨çš„ä»£ç ï¼šæŸ¥æ‰¾å¹¶åˆ é™¤æœªä½¿ç”¨çš„ç±»ã€æ–¹æ³•ã€å˜é‡ç­‰ã€‚å®¡æŸ¥ä¸šåŠ¡é€»è¾‘ï¼Œåˆ é™¤ä¸å†ä½¿ç”¨æˆ–å·²è¢«åºŸå¼ƒçš„ä»£ç æ¨¡å—ã€‚\né‡æ„ä»£ç ï¼šå¯¹é‡å¤çš„ä»£ç è¿›è¡Œé‡æ„ï¼Œä½¿ç”¨å‡½æ•°ã€ç±»ç­‰æ–¹æ³•æ¥å‡å°‘ä»£ç å†—ä½™ã€‚ä¼˜åŒ–æ•°æ®ç»“æ„ï¼Œå‡å°‘å†…å­˜å ç”¨å’ŒCPUæ¶ˆè€—ã€‚\nç¼–è¯‘ç­–ç•¥è°ƒæ•´ï¼šä¿®æ”¹ç¼–è¯‘ç­–ç•¥ï¼Œå¦‚å¯ç”¨LTOï¼ˆé“¾æ¥æ—¶ä¼˜åŒ–ï¼‰æ¥ä¼˜åŒ–è·¨æ¨¡å—è°ƒç”¨ä»£ç ã€‚å‰¥ç¦»ç¬¦å·è¡¨ï¼ˆStrip Linked Productï¼‰ï¼Œåˆ é™¤æœªå¼•ç”¨çš„C&#x2F;C++&#x2F;Swiftä»£ç ã€‚ç²¾ç®€ç¼–è¯‘äº§ç‰©ï¼Œåªä¿ç•™å¿…è¦çš„ç¬¦å·å’Œå¯¼å‡ºä¿¡æ¯ã€‚\nä»£ç ç»„ä»¶åŒ–ï¼šå°†å¸¸ç”¨ä»£ç æ–‡ä»¶æ‰“åŒ…æˆé™æ€åº“ï¼Œåˆ‡æ–­ä¸åŒä¸šåŠ¡ä»£ç ä¹‹é—´çš„ä¾èµ–ï¼Œå‡å°‘æ¯æ¬¡ç¼–è¯‘çš„ä»£ç é‡ã€‚\nå‡å°‘æ–‡ä»¶å¼•ç”¨ï¼šèƒ½ä½¿ç”¨@classå°±ä½¿ç”¨@classï¼Œå°½é‡å‡å°‘æ–‡ä»¶ä¹‹é—´çš„ç›´æ¥å¼•ç”¨å…³ç³»ã€‚\nå‡å°‘Storyboardå’ŒXIBæ–‡ä»¶çš„ä½¿ç”¨ï¼šå°½é‡ä½¿ç”¨ä»£ç å¸ƒå±€ï¼Œå‡å°‘Storyboardå’ŒXIBæ–‡ä»¶çš„ä½¿ç”¨ï¼Œè¿™äº›æ–‡ä»¶åœ¨ç¼–è¯‘æ—¶ä¼šå¢åŠ åŒ…ä½“ç§¯ã€‚\næ¸…ç†æœªä½¿ç”¨çš„èµ„æºï¼šæ¸…ç†é¡¹ç›®ä¸­æœªä½¿ç”¨çš„å›¾ç‰‡ã€éŸ³é¢‘ç­‰èµ„æºæ–‡ä»¶ï¼Œä»¥åŠæœªä½¿ç”¨çš„ç±»å’Œåˆå¹¶é‡å¤åŠŸèƒ½çš„ç±»ã€‚\næ¨¡å—åŒ–è®¾è®¡ï¼šå°†Appæ‹†åˆ†æˆå¤šä¸ªæ¨¡å—ï¼Œæ¯ä¸ªæ¨¡å—ç‹¬ç«‹ç¼–è¯‘å’Œæ‰“åŒ…ï¼Œå¯ä»¥æ ¹æ®éœ€è¦åŠ¨æ€åŠ è½½æˆ–æ›´æ–°æ¨¡å—ï¼Œå‡å°‘ä¸»åŒ…çš„ä½“ç§¯ã€‚\nä¾èµ–ç®¡ç†ï¼šåˆç†ä½¿ç”¨CocoaPodsã€Carthageç­‰ä¾èµ–ç®¡ç†å·¥å…·ï¼Œç®¡ç†é¡¹ç›®çš„ç¬¬ä¸‰æ–¹åº“ä¾èµ–ï¼Œé¿å…ä¸å¿…è¦çš„åº“è¢«åŒ…å«è¿›æœ€ç»ˆçš„åŒ…ä¸­ã€‚\n\nLink Mapæ–‡ä»¶è§£æ\nå®šä¹‰ä¸åŠŸèƒ½ï¼šLink Mapæ˜¯Mach-OäºŒè¿›åˆ¶æ–‡ä»¶çš„è¾…åŠ©æ–‡ä»¶ï¼Œæè¿°äº†å¯æ‰§è¡Œæ–‡ä»¶çš„å…¨è²Œï¼ŒåŒ…æ‹¬ç¼–è¯‘åçš„ç›®æ ‡æ–‡ä»¶ä¿¡æ¯åŠå…¶ä»£ç æ®µã€æ•°æ®æ®µå­˜å‚¨è¯¦æƒ…ã€‚\nç”Ÿæˆæ–¹æ³•ï¼šé€šè¿‡Xcodeçš„Build Settingsè®¾ç½®Write Link Map Fileä¸ºyesï¼Œå¹¶æŒ‡å®šå­˜å‚¨ä½ç½®ã€‚\næ–‡ä»¶ç»“æ„ï¼šåŒ…æ‹¬åŸºç¡€ä¿¡æ¯ï¼ˆå¦‚å¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„ã€CPUæ¶æ„ï¼‰ã€Objectæ–‡ä»¶åˆ—è¡¨ã€Sectionæ®µè¡¨ã€Symbolsæ¨¡å—ç­‰ã€‚\n\næ— ç”¨ç±»é™æ€æ£€æµ‹ï¼Œé€šè¿‡åˆ†æMach-Oæ–‡ä»¶ä¸­çš„__DATA __objc_classlistå’Œ__DATA __objc_classrefsæ®µï¼Œè·å–æœªä½¿ç”¨çš„ç±»ä¿¡æ¯ã€‚ä½†å­˜åœ¨æ— æ³•æ£€æµ‹åå°„è°ƒç”¨ç±»åŠæ–¹æ³•çš„ç¼ºç‚¹ã€‚\nåŠ¨æ€æ£€æµ‹çš„æ–¹æ³•ã€‚åœ¨Objective-Cï¼ˆOCï¼‰ä¸­ï¼Œæ¯ä¸ªç±»ç»“æ„ä½“å†…éƒ¨éƒ½å«æœ‰ä¸€ä¸ªåä¸ºisaçš„æŒ‡é’ˆï¼Œè¿™ä¸ªæŒ‡é’ˆéå¸¸å…³é”®ï¼Œå› ä¸ºå®ƒæŒ‡å‘äº†è¯¥ç±»å¯¹åº”çš„å…ƒç±»ï¼ˆmeta-classï¼‰ã€‚å…ƒç±»æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªç±»ï¼Œç”¨äºå­˜å‚¨ç±»æ–¹æ³•çš„å®ç°ç­‰ä¿¡æ¯ã€‚\né€šè¿‡å¯¹å…ƒç±»ï¼ˆmeta-classï¼‰çš„ç»“æ„ä½“è¿›è¡Œæ·±å…¥åˆ†æï¼Œæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°classrwtè¿™æ ·ä¸€ä¸ªç»“æ„ä½“ï¼Œå®ƒæ˜¯å…ƒç±»å†…éƒ¨ç»“æ„çš„ä¸€éƒ¨åˆ†ã€‚åœ¨classrwtä¸­ï¼Œå­˜åœ¨ä¸€ä¸ªflagæ ‡å¿—ä½ï¼Œè¿™ä¸ªæ ‡å¿—ä½ç”¨äºè®°å½•ç±»çš„å„ç§çŠ¶æ€ä¿¡æ¯ã€‚\né€šè¿‡æ£€æŸ¥è¿™ä¸ªflagæ ‡å¿—ä½ï¼Œæˆ‘ä»¬å¯ä»¥è¿›è¡Œä¸€ç³»åˆ—çš„è®¡ç®—æˆ–åˆ¤æ–­ï¼Œä»è€Œå¾—çŸ¥å½“å‰ç±»åœ¨è¿è¡Œæ—¶ï¼ˆruntimeï¼‰ç¯å¢ƒä¸­æ˜¯å¦å·²ç»è¢«åˆå§‹åŒ–è¿‡ã€‚è¿™ç§æœºåˆ¶æ˜¯Objective-Cè¿è¡Œæ—¶ç³»ç»Ÿçš„ä¸€ä¸ªé‡è¦ç‰¹æ€§ï¼Œå®ƒå…è®¸å¼€å‘è€…åœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°è·å–ç±»çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç±»çš„åˆå§‹åŒ–çŠ¶æ€ç­‰ã€‚\nä¹Ÿå°±æ˜¯é€šè¿‡isaæŒ‡é’ˆæ‰¾åˆ°å…ƒç±»ï¼Œå†åˆ†æå…ƒç±»ä¸­çš„classrwtç»“æ„ä½“ä¸­çš„flagæ ‡å¿—ä½ï¼Œæˆ‘ä»¬å¯ä»¥å¾—çŸ¥OCä¸­æŸä¸ªç±»æ˜¯å¦å·²è¢«åˆå§‹åŒ–ã€‚\n// class is initialized#define RW_INITIALIZED        (1&lt;&lt;29)struct objc_class : objc_object &#123;    bool isInitialized() &#123;    return getMeta()-&gt;data()-&gt;flags &amp; RW_INITIALIZED;    &#125;&#125;;\nåœ¨Objective-Cçš„è¿è¡Œæ—¶ï¼ˆruntimeï¼‰æœºåˆ¶ä¸­ï¼Œç±»çš„å†…éƒ¨ç»“æ„å’ŒçŠ¶æ€é€šå¸¸æ˜¯ç”±Objective-Cè¿è¡Œæ—¶åº“ç®¡ç†çš„ï¼Œè€Œä¸æ˜¯ç›´æ¥æš´éœ²ç»™å¼€å‘è€…åœ¨åº”ç”¨ç¨‹åºä»£ç ä¸­è°ƒç”¨çš„ã€‚ä¸è¿‡ï¼Œä½ å¯ä»¥é€šè¿‡Objective-Cçš„runtime APIæ¥é—´æ¥åœ°è·å–è¿™äº›ä¿¡æ¯ã€‚\nå…³äºç±»æ˜¯å¦å·²è¢«åˆå§‹åŒ–çš„é—®é¢˜ï¼Œé€šå¸¸ä¸æ˜¯ç›´æ¥é€šè¿‡objc_classç»“æ„ä½“ä¸­çš„æŸä¸ªå‡½æ•°æ¥åˆ¤æ–­çš„ï¼Œå› ä¸ºobjc_classç»“æ„ä½“ï¼ˆåŠå…¶å…ƒç±»ï¼‰çš„ç»†èŠ‚å’Œå…·ä½“å®ç°æ˜¯ç§æœ‰çš„ï¼Œå¹¶ä¸”ä¸æ¨èå¼€å‘è€…ç›´æ¥æ“ä½œã€‚ç„¶è€Œï¼ŒObjective-Cè¿è¡Œæ—¶ç¡®å®æä¾›äº†ä¸€äº›å·¥å…·å’ŒAPIæ¥æ£€æŸ¥ç±»çš„çŠ¶æ€å’Œè¡Œä¸ºã€‚\nä¸ºäº†æ£€æŸ¥ä¸€ä¸ªç±»æ˜¯å¦åœ¨å½“å‰åº”ç”¨ç¨‹åºçš„ç”Ÿå‘½å‘¨æœŸä¸­è¢«ä½¿ç”¨è¿‡ï¼ˆå³â€œè¢«åˆå§‹åŒ–è¿‡â€ï¼‰ï¼Œå¼€å‘è€…å¯èƒ½ä¼šé‡‡ç”¨ä¸€äº›é—´æ¥çš„æ–¹æ³•ï¼Œè€Œä¸æ˜¯ç›´æ¥æ“ä½œç±»ç»“æ„ä½“çš„å†…éƒ¨å‡½æ•°ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€åŒ–çš„è¯´æ˜ï¼š\nç”±äºä¸èƒ½ç›´æ¥è®¿é—®ç±»çš„å†…éƒ¨ç»“æ„ï¼Œå¼€å‘è€…å¯èƒ½ä¼šé€šè¿‡å…¶ä»–æ–¹å¼æ¥è·Ÿè¸ªç±»çš„ä½¿ç”¨æƒ…å†µã€‚ä¾‹å¦‚ï¼Œå¯ä»¥åœ¨ç±»çš„åˆå§‹åŒ–æ–¹æ³•ä¸­è®¾ç½®ä¸€ä¸ªé™æ€æ ‡å¿—ä½æˆ–è®¡æ•°å™¨ï¼Œä»¥è®°å½•ç±»æ˜¯å¦å·²è¢«åˆå§‹åŒ–æˆ–å®ä¾‹åŒ–çš„æ¬¡æ•°ã€‚è™½ç„¶ä¸èƒ½ç›´æ¥è°ƒç”¨objc_classç»“æ„ä½“ä¸­çš„å‡½æ•°ï¼Œä½†å¼€å‘è€…å¯ä»¥ä½¿ç”¨Objective-Cçš„runtime APIï¼ˆå¦‚objc_getClassã€class_getInstanceSizeç­‰ï¼‰æ¥è·å–ç±»çš„å…ƒä¿¡æ¯å’Œæ‰§è¡Œå…¶ä»–æ“ä½œã€‚ç„¶è€Œï¼Œå¯¹äºç›´æ¥æ£€æŸ¥ç±»æ˜¯å¦â€œè¢«åˆå§‹åŒ–è¿‡â€çš„éœ€æ±‚ï¼Œè¿™äº›APIå¯èƒ½å¹¶ä¸ç›´æ¥æä¾›æ‰€éœ€çš„åŠŸèƒ½ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œå¯èƒ½å¹¶ä¸éœ€è¦ç›´æ¥æ£€æŸ¥ç±»æ˜¯å¦â€œè¢«åˆå§‹åŒ–è¿‡â€ï¼Œè€Œæ˜¯å¯ä»¥é€šè¿‡æ£€æŸ¥è¯¥ç±»çš„å®ä¾‹æ˜¯å¦å­˜åœ¨ã€ç±»çš„æŸä¸ªç‰¹å®šæ–¹æ³•æ˜¯å¦è¢«è°ƒç”¨è¿‡ç­‰é—´æ¥æ–¹å¼æ¥åˆ¤æ–­ã€‚è‡ªå®šä¹‰ä¸ç³»ç»Ÿç±»ç›¸åŒçš„ç»“æ„ä½“å¹¶å®ç°isInitialized()å‡½æ•°å¯èƒ½æ˜¯ä¸€ç§æ¨¡æ‹Ÿæˆ–æŠ½è±¡çš„æ–¹å¼ã€‚ç„¶è€Œï¼Œåœ¨å®é™…Objective-Cå¼€å‘ä¸­ï¼Œè¿™æ ·çš„åšæ³•æ˜¯ä¸å¿…è¦çš„ï¼Œå› ä¸ºç›´æ¥æ“ä½œç±»çš„å†…éƒ¨ç»“æ„æ˜¯è¿åå°è£…åŸåˆ™ä¸”å®¹æ˜“å‡ºé”™çš„ã€‚ç›¸åï¼Œå¼€å‘è€…åº”è¯¥åˆ©ç”¨Objective-Cæä¾›çš„runtime APIå’Œå…¶ä»–è®¾è®¡æ¨¡å¼æ¥è¾¾æˆç›®æ ‡ã€‚æåˆ°é€šè¿‡èµ‹å€¼è½¬æ¢è·å–meta-classä¸­çš„æ•°æ®ï¼Œè¿™é€šå¸¸æŒ‡çš„æ˜¯åˆ©ç”¨Objective-Cçš„runtimeæœºåˆ¶æ¥æŸ¥è¯¢ç±»çš„å…ƒç±»ä¿¡æ¯ã€‚ç„¶è€Œï¼Œç›´æ¥â€œåˆ¤æ–­æŒ‡å®šç±»æ˜¯å¦åœ¨å½“å‰ç”Ÿå‘½å‘¨æœŸä¸­æ˜¯å¦è¢«åˆå§‹åŒ–è¿‡â€å¹¶ä¸æ˜¯é€šè¿‡ç®€å•åœ°æŸ¥è¯¢å…ƒç±»æ•°æ®å°±èƒ½å®ç°çš„ï¼Œå› ä¸ºè¿™éœ€è¦è·Ÿè¸ªç±»çš„å®ä¾‹åŒ–è¿‡ç¨‹ï¼Œè€Œä¸æ˜¯ä»…ä»…æŸ¥çœ‹å…ƒç±»çš„ç»“æ„ã€‚\nè·å–ç±»ç»“æ„ä½“é‡Œé¢çš„æ•°æ®\nstruct mock_objc_class : lazyFake_objc_object &#123;    mock_objc_class* metaClass() &#123;        #if __LP64__            return (mock_objc_class *)((long long)isa &amp; ISA_MASK);        #else            return (mock_objc_class *)((long long)isa);        #endif    &#125;    bool isInitialized() &#123;        return metaClass()-&gt;data()-&gt;flags &amp; RW_INITIALIZED;    &#125;&#125;;\næ‰€æœ‰ OC è‡ªå®šä¹‰ç±»\nDl_info info;dladdr(&amp;_mh_execute_header, &amp;info);classes = objc_copyClassNamesForImage(info.dli_fname, &amp;classCount);\næ˜¯å¦åˆå§‹åŒ–\nstruct mock_objc_class *objectClass = (__bridge struct mock_objc_class *)cls;BOOL isInitial = objectClass-&gt;isInitialized();\næœ€åé€šè¿‡æ— ç”¨ç±»å æ¯”æŒ‡æ ‡ï¼ˆæ— ç”¨ç±»æ•°é‡&#x2F;æ€»ç±»æ•°é‡*100%ï¼‰å¿«é€Ÿè¯†åˆ«ä¸å†è¢«ä½¿ç”¨çš„æ¨¡å—ã€‚å¯¹äºæ— ç”¨ç±»å æ¯”é«˜çš„æ¨¡å—ï¼Œè¿›è¡Œä¸‹çº¿æˆ–è¿ç§»å¤„ç†ï¼Œå‡å°‘ç»„ä»¶æ•°é‡ã€‚\næ— ç”¨æ–¹æ³•\nä¸šå†…å¸¸ç”¨æ–¹æ³•ï¼šç»“åˆMach-Oå’ŒLinkMapæ–‡ä»¶åˆ†æè·å–æ— ç”¨æ–¹æ³•ï¼Œä½†å‡†ç¡®ç‡ä½ã€‚\nä»£ç åˆ†æï¼šç”¨ Swift ç¼–å†™çš„å·¥ç¨‹ä»£ç é™æ€åˆ†æå‘½ä»¤è¡Œå·¥å…· smckã€ä½¿ç”¨Swift3å¼€å‘äº†ä¸ªmacOSçš„ç¨‹åºå¯ä»¥æ£€æµ‹å‡ºobjcé¡¹ç›®ä¸­æ— ç”¨æ–¹æ³•ï¼Œç„¶åä¸€é”®å…¨éƒ¨æ¸…ç†\nä»£ç è¦†ç›–ç‡ï¼šLLVMæ’æ¡©è·å¾—æ‰€æœ‰æ–¹æ³•åŠå…¶è°ƒç”¨å…³ç³»ã€‚é€šè¿‡åˆ†æè°ƒç”¨å…³ç³»ï¼Œæ‰¾å‡ºæœªè¢«è°ƒç”¨çš„æ–¹æ³•ã€‚è¯¦è§ä½¿ç”¨ LLVM\n\nç²¾ç®€é‡å¤ä»£ç \nå·¥å…·ä½¿ç”¨ï¼šé‡‡ç”¨å¼€æºå·¥å…·æ‰«æé‡å¤ä»£ç ã€‚\næ£€æµ‹ä¸é‡æ„ï¼šé€šè¿‡é™æ€åˆ†ææ£€æµ‹é‡å¤ä»£ç ï¼Œå¹¶ç»“åˆå®é™…æƒ…å†µè¿›è¡Œé€»è¾‘é‡æ„ã€‚\n\nåŒ…ä½“ç§¯-ç¼–è¯‘ä¼˜åŒ–XcodeXcode 14çš„ç¼–è¯‘å™¨å¯èƒ½é€šè¿‡æ›´æ™ºèƒ½çš„åˆ†æï¼Œè¯†åˆ«å¹¶æ¶ˆé™¤ä¸å¿…è¦çš„Retainå’ŒReleaseè°ƒç”¨ã€‚è¿™äº›è°ƒç”¨åœ¨å†…å­˜ç®¡ç†ä¸­æ˜¯å¿…è¦çš„ï¼Œä½†åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå®ƒä»¬å¯èƒ½æ˜¯å¤šä½™çš„ï¼Œå› ä¸ºå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†å¯ä»¥é€šè¿‡å…¶ä»–æ–¹å¼æ›´æœ‰æ•ˆåœ°å®ç°ã€‚åœ¨Objective-Cçš„è¿è¡Œæ—¶å±‚é¢ï¼ŒXcode 14å¯èƒ½å¼•å…¥äº†æ›´é«˜æ•ˆçš„å†…å­˜ç®¡ç†ç­–ç•¥ã€‚è¿™äº›ç­–ç•¥å¯èƒ½åŒ…æ‹¬æ›´å¿«çš„å¯¹è±¡å¼•ç”¨è®¡æ•°æ›´æ–°ã€æ›´æ™ºèƒ½çš„å¯¹è±¡ç”Ÿå‘½å‘¨æœŸé¢„æµ‹ç­‰ï¼Œä»è€Œå‡å°‘äº†Retainå’ŒReleaseæ“ä½œçš„æ‰§è¡Œæ¬¡æ•°å’Œå¼€é”€ã€‚å‰¥ç¦»äº†æœªä½¿ç”¨çš„ä»£ç å’Œåº“ï¼ŒåŒ…æ‹¬é‚£äº›ä¸Retainå’ŒReleaseæ“ä½œç›¸å…³çš„éƒ¨åˆ†ã€‚è¿™ç§ä¼˜åŒ–å¯ä»¥å‡å°‘æœ€ç»ˆç”Ÿæˆçš„äºŒè¿›åˆ¶æ–‡ä»¶çš„å¤§å°ã€‚\nç¼–è¯‘ä¼˜åŒ–\nGenerate Debug Symbolsï¼šåœ¨Levelsé€‰é¡¹å†…ï¼Œå°†Generate Debug Symbolsè®¾ç½®ä¸ºNOï¼Œè¿™å¯ä»¥å‡å°å®‰è£…åŒ…ä½“ç§¯ï¼Œä½†éœ€è¦æ³¨æ„ï¼Œè¿™æ ·è®¾ç½®åæ— æ³•åœ¨æ–­ç‚¹å¤„åœä¸‹ã€‚\nèˆå¼ƒè€æ—§æ¶æ„ï¼šèˆå¼ƒä¸å†æ”¯æŒçš„æ¶æ„ï¼Œå¦‚armv7ï¼Œä»¥å‡å°å®‰è£…åŒ…ä½“ç§¯ã€‚\nç¼–è¯‘ä¼˜åŒ–é€‰é¡¹ï¼šåœ¨Build Settingsä¸­ï¼Œå°†Optimization Levelè®¾ç½®ä¸ºFastest, Smallest [-Os]ï¼Œè¿™ä¸ªé€‰é¡¹ä¼šå¼€å¯é‚£äº›ä¸å¢åŠ ä»£ç å¤§å°çš„å…¨éƒ¨ä¼˜åŒ–ï¼Œå¹¶è®©å¯æ‰§è¡Œæ–‡ä»¶å°½å¯èƒ½å°ã€‚åŒæ—¶ï¼Œå°†Strip Debug Symbols During Copyå’ŒSymbols Hidden by Defaultåœ¨releaseç‰ˆæœ¬è®¾ä¸ºyesï¼Œå¯ä»¥å»é™¤ä¸å¿…è¦çš„è°ƒè¯•ç¬¦å·ã€‚\né¢„ç¼–è¯‘å¤´æ–‡ä»¶ï¼šå°†Precompile Prefix Headerè®¾ç½®ä¸ºYESï¼Œé¢„ç¼–è¯‘å¤´æ–‡ä»¶å¯ä»¥åŠ å¿«ç¼–è¯‘é€Ÿåº¦ï¼Œä½†éœ€è¦æ³¨æ„ï¼Œä¸€æ—¦PCHæ–‡ä»¶å’Œå¼•ç”¨çš„å¤´æ–‡ä»¶å†…å®¹å‘ç”Ÿå˜åŒ–ï¼Œæ‰€æœ‰å¼•ç”¨åˆ°PCHçš„æºæ–‡ä»¶éƒ½éœ€è¦é‡æ–°ç¼–è¯‘ã€‚\nä»…ç¼–è¯‘å½“å‰æ¶æ„ï¼šåœ¨Debugæ¨¡å¼ä¸‹ï¼Œå°†Build Active Architecture Onlyè®¾ç½®ä¸ºYESï¼Œè¿™æ ·åªç¼–è¯‘å½“å‰æ¶æ„çš„ç‰ˆæœ¬ï¼Œå¯ä»¥åŠ å¿«ç¼–è¯‘é€Ÿåº¦ã€‚ä½†åœ¨Releaseæ¨¡å¼ä¸‹ï¼Œéœ€è¦è®¾ç½®ä¸ºNOä»¥ç¡®ä¿å…¼å®¹æ€§ã€‚\nDebug Information Formatï¼šè®¾ç½®ä¸ºDWARFï¼Œå‡å°‘dSYMæ–‡ä»¶çš„ç”Ÿæˆï¼Œä»è€Œå‡å°‘åŒ…ä½“ç§¯ã€‚\nEnable Index-While-Building Functionalityï¼šè®¾ç½®ä¸ºNOï¼Œå…³é—­Xcodeåœ¨ç¼–è¯‘æ—¶å»ºç«‹ä»£ç ç´¢å¼•çš„åŠŸèƒ½ï¼Œä»¥åŠ å¿«ç¼–è¯‘é€Ÿåº¦ã€‚\n\nç¼–è¯‘å™¨å’Œè¿è¡Œæ—¶ä¼˜åŒ–\nSwift å’Œ Objective-C çš„ä¼˜åŒ–ï¼šAppleåœ¨Swiftå’ŒObjective-Cçš„ç¼–è¯‘å™¨å’Œè¿è¡Œæ—¶ä¸Šè¿›è¡Œäº†è®¸å¤šä¼˜åŒ–ï¼Œæ¯”å¦‚Swiftåè®®ä¸€è‡´æ€§æ£€æŸ¥çš„ä¼˜åŒ–ï¼Œè¿™äº›ä¼˜åŒ–å¯ä»¥åœ¨ä¸å‡çº§å·¥ç¨‹æœ€ä½éƒ¨ç½²ç‰ˆæœ¬çš„æƒ…å†µä¸‹ï¼Œé€šè¿‡Appè¿è¡Œåœ¨iOS 16ã€tvOS 16æˆ–watchOS 9ä¸Šäº«å—åˆ°æ€§èƒ½æå‡ã€‚\nå¹¶å‘è¯»å–ç¼“å­˜ï¼šSwiftçš„åè®®ä¸€è‡´æ€§æ£€æŸ¥å¼•å…¥äº†ConcurrentReadableHashMapç»“æ„ï¼Œè¯¥ç»“æ„å¹¶è¡Œè¯»å–è€Œæ— éœ€åŠ é”ï¼Œç›¸æ¯”ä¹‹å‰çš„ç¼“å­˜æ–¹æ¡ˆæ›´å¿«ã€‚\n\nåŒ…ä½“ç§¯-é“¾æ¥å™¨ä¼˜åŒ–ä½¿ç”¨ -whyload é“¾æ¥å™¨æ ‡å¿—æ¥å‡å°‘ iOS åº”ç”¨ç¨‹åºçš„äºŒè¿›åˆ¶æ–‡ä»¶å¤§å°ï¼Œ -whyload æ ‡å¿—çš„ä½œç”¨ï¼šå®ƒå¯ä»¥å¸®åŠ©å¼€å‘è€…è¯†åˆ«æœ€ç»ˆäºŒè¿›åˆ¶æ–‡ä»¶ä¸­åŒ…å«çš„ä¸å¿…è¦ç¬¦å·ã€‚\nåœ¨ iOS å¼€å‘ä¸­ï¼Œé“¾æ¥å™¨è´Ÿè´£å°†ä»£ç ã€åº“å’Œèµ„æºç»“åˆæˆä¸€ä¸ªæœ€ç»ˆçš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚åœ¨æ­¤è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½ä¼šæœ‰ä¸€äº›ä¸å¿…è¦çš„ä»£ç è¢«åŒ…å«è¿›å»ï¼Œä¾‹å¦‚æœªä½¿ç”¨çš„åº“ã€é‡å¤çš„ç¬¦å·æˆ–æ¨¡å—ã€‚è¿™äº›å¤šä½™çš„ä»£ç ä¼šå¯¼è‡´åº”ç”¨ç¨‹åºçš„äºŒè¿›åˆ¶æ–‡ä»¶å¢å¤§ï¼Œè¿›è€Œå½±å“åº”ç”¨çš„ä¸‹è½½é€Ÿåº¦ã€å®‰è£…æ—¶é—´ä»¥åŠè®¾å¤‡çš„å­˜å‚¨ç©ºé—´ã€‚\n-ObjC æ ‡å¿—ï¼Œå®ƒé€šå¸¸ç”¨äºå¼ºåˆ¶é“¾æ¥æ‰€æœ‰ Objective-C ä»£ç åˆ°æœ€ç»ˆçš„äºŒè¿›åˆ¶æ–‡ä»¶ä¸­ã€‚è¿™åœ¨æŸäº›æƒ…å†µä¸‹æ˜¯å¿…è¦çš„ï¼Œä¾‹å¦‚ä½¿ç”¨äº†æŸäº›éœ€è¦åå°„çš„ Objective-C ä»£ç æ—¶ï¼Œä½†æ˜¯å®ƒä¹Ÿä¼šå¯¼è‡´æœªä½¿ç”¨çš„ä»£ç è¢«åŒ…å«è¿›å»ã€‚é€šè¿‡ -why_loadï¼Œå¼€å‘è€…å¯ä»¥è¯†åˆ«å‡ºå“ªäº›ä»£ç æ˜¯å¤šä½™çš„ï¼Œå¹¶é€šè¿‡åˆ é™¤ -ObjC æ ‡å¿—æ¥å‡å°‘æ–‡ä»¶å¤§å°ã€‚\nåŒ…ä½“ç§¯-ä¸‰æ–¹åº“ä¼˜åŒ–\nç»„ä»¶äºŒè¿›åˆ¶åŒ–ï¼šå°†ç¬¬ä¸‰æ–¹podåº“æˆ–è‡ªå·±é¡¹ç›®ä¸­çš„ä¸šåŠ¡åº“ç”±ä»£ç æ ¼å¼æ‰“åŒ…æˆframeworkæ ¼å¼ï¼Œæé«˜ç¼–è¯‘é€Ÿåº¦å¹¶å‡å°å®‰è£…åŒ…ä½“ç§¯ã€‚å¯ä»¥ä½¿ç”¨cocoapods-packagerã€cocoapods-binaryç­‰å·¥å…·æ¥å®ç°ã€‚\nå®šæœŸæ›´æ–°ç¬¬ä¸‰æ–¹åº“ï¼šå®šæœŸæ£€æŸ¥é¡¹ç›®ä¸­ä½¿ç”¨çš„ç¬¬ä¸‰æ–¹åº“æ˜¯å¦æœ‰æ›´æ–°ç‰ˆæœ¬ï¼Œæ–°ç‰ˆæœ¬å¯èƒ½åŒ…å«æ€§èƒ½æ”¹è¿›å’Œä½“ç§¯ä¼˜åŒ–ã€‚\n\n","categories":["æ€§èƒ½ä¼˜åŒ–"],"tags":["æ€§èƒ½ä¼˜åŒ–","åŒ…ä½“ç§¯"]},{"title":"å†…å­˜ç®¡ç†","url":"/2025/05/12/%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/","content":"å†…å­˜ç®¡ç†å¼•ç”¨è®¡æ•°iOSçš„Objective-Cå’ŒSwiftè¿è¡Œæ—¶ä½¿ç”¨å¼•ç”¨è®¡æ•°æ¥ç®¡ç†å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸã€‚æ–°å»ºå¯¹è±¡æ—¶å¼•ç”¨è®¡æ•°+1ï¼ŒæŒ‡é’ˆæŒ‡å‘å¯¹è±¡æ—¶+1ï¼ŒæŒ‡é’ˆä¸å†æŒ‡å‘å¯¹è±¡æ—¶-1ï¼Œå½“å¼•ç”¨è®¡æ•°ä¸º0æ—¶å¯¹è±¡è¢«é”€æ¯ã€‚\nTaggedPointerä¸ºå°å‹æ•°æ®ï¼ˆå¦‚NSNumberã€NSDateã€NSStringç­‰ï¼‰æä¾›çš„ä¸€ç§å†…å­˜èŠ‚çœæŠ€æœ¯ã€‚TaggedPointeræ˜¯ä¸€ä¸ªç‰¹åˆ«çš„æŒ‡é’ˆï¼Œå®ƒåˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼šä¸€éƒ¨åˆ†ç›´æ¥ä¿å­˜æ•°æ®ï¼Œå¦ä¸€éƒ¨åˆ†ä½œä¸ºç‰¹æ®Šæ ‡è®°ã€‚TaggedPointeræ˜¯ä¸€ç§ç‰¹åˆ«çš„æŒ‡é’ˆï¼Œç”¨äºå­˜å‚¨å°å‹æ•°æ®ï¼Œä»¥å‡å°‘å†…å­˜å ç”¨ã€‚å®ƒåˆ†ä¸ºæ•°æ®éƒ¨åˆ†å’Œæ ‡è®°éƒ¨åˆ†ï¼Œä¸æŒ‡å‘ä»»ä½•å®é™…çš„å†…å­˜åœ°å€ã€‚\nARCä¸MRCçš„åŒºåˆ«ARCï¼ˆè‡ªåŠ¨å¼•ç”¨è®¡æ•°ï¼‰æ˜¯iOS 5åŠä¹‹åç‰ˆæœ¬å¼•å…¥çš„ä¸€ç§ç¼–è¯‘å™¨ç‰¹æ€§ï¼Œè‡ªåŠ¨ç®¡ç†å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸï¼Œå‡å°‘äº†å†…å­˜æ³„æ¼å’Œé‡æŒ‡é’ˆçš„é£é™©ã€‚ARCä¸‹ï¼Œå¼€å‘è€…ä¸å†éœ€è¦æ‰‹åŠ¨è°ƒç”¨retainã€releaseã€autoreleaseç­‰å†…å­˜ç®¡ç†æ–¹æ³•ã€‚\nMRCï¼ˆæ‰‹åŠ¨å¼•ç”¨è®¡æ•°ï¼‰åœ¨ARCä¹‹å‰ï¼Œå¼€å‘è€…éœ€è¦æ‰‹åŠ¨ç®¡ç†å¯¹è±¡çš„å†…å­˜ï¼Œé€šè¿‡retainã€releaseã€autoreleaseç­‰æ–¹æ³•æ¥æ§åˆ¶å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸã€‚\nSideTableså’ŒSideTableSideTablesæ˜¯ä¸€ä¸ªåŒ…å«8ä¸ªSideTableçš„å“ˆå¸Œæ•°ç»„ï¼Œç”¨äºå­˜å‚¨å¯¹è±¡çš„å¼•ç”¨è®¡æ•°å’Œå¼±å¼•ç”¨ä¿¡æ¯ã€‚æ¯ä¸ªSideTableå¯¹åº”å¤šä¸ªå¯¹è±¡ã€‚\nSideTableåŒ…å«ä¸‰ä¸ªä¸»è¦æˆå‘˜ï¼šè‡ªæ—‹é”ï¼ˆspinlocktï¼‰ã€å¼•ç”¨è®¡æ•°è¡¨ï¼ˆRefcountMapï¼‰ã€å¼±å¼•ç”¨è¡¨ï¼ˆweaktable_tï¼‰ã€‚è‡ªæ—‹é”ç”¨äºé˜²æ­¢å¤šçº¿ç¨‹è®¿é—®å†²çªï¼Œå¼•ç”¨è®¡æ•°è¡¨å­˜å‚¨å¯¹è±¡çš„å¼•ç”¨è®¡æ•°ï¼Œå¼±å¼•ç”¨è¡¨å­˜å‚¨å¯¹è±¡çš„å¼±å¼•ç”¨ä¿¡æ¯ã€‚\nweak_table_tå’Œweak_entry_t\nweak_table_tæ˜¯ä¸€ä¸ªå­˜å‚¨å¼±å¼•ç”¨ä¿¡æ¯çš„å“ˆå¸Œè¡¨ï¼Œå…¶å…ƒç´ æ˜¯weak_entry_tç±»å‹ã€‚\nweak_entry_tå­˜å‚¨äº†å¼±å¼•ç”¨è¯¥å¯¹è±¡çš„æŒ‡é’ˆçš„æŒ‡é’ˆï¼Œå³objc_object new_referrerã€‚å½“å¯¹è±¡è¢«é”€æ¯æ—¶ï¼Œweakå¼•ç”¨çš„æŒ‡é’ˆä¼šè¢«è‡ªåŠ¨ç½®ä¸ºnilï¼Œé˜²æ­¢é‡æŒ‡é’ˆçš„å‡ºç°ã€‚\nç›¸å…³ææ¡ˆå’ŒæŠ€æœ¯æ¼”è¿›\nç›¸å…³ææ¡ˆåŒ…æ‹¬ SE-0349 Unaligned Loads and Stores from Raw Memory ã€SE-0334 Pointer API Usability Improvements ã€SE-0333 Expand usability of withMemoryRebound\nSet ä½¿ç”¨æ–°çš„ Temporary Buffers åŠŸèƒ½ï¼Œè®© intersect é€Ÿåº¦æå‡äº† 4 åˆ° 6 å€ã€‚\nè‡ªåŠ¨å¼•ç”¨è®¡æ•°(ARC)æœºåˆ¶ARC æ˜¯ Swift ç”¨æ¥ç®¡ç†åº”ç”¨ç¨‹åºå†…å­˜çš„æŠ€æœ¯ï¼Œå®ƒä¼šè‡ªåŠ¨è·Ÿè¸ªå’Œç®¡ç†ä½ çš„åº”ç”¨ç¨‹åºä½¿ç”¨çš„å†…å­˜ï¼Œä¸éœ€è¦å¼€å‘è€…æ‰‹åŠ¨åˆ†é…æˆ–é‡Šæ”¾å†…å­˜ã€‚\nARC çš„åŸºæœ¬åŸç†ARC åœ¨å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸå†…è‡ªåŠ¨ç®¡ç†å†…å­˜çš„åˆ†é…ä¸é‡Šæ”¾ã€‚æ¯å½“ä½ åˆ›å»ºä¸€ä¸ªç±»çš„å®ä¾‹æ—¶ï¼ŒARC ä¼šä¸ºè¿™ä¸ªå®ä¾‹åˆ†é…å†…å­˜ï¼Œå¹¶åœ¨ä¸å†éœ€è¦å®ƒæ—¶è‡ªåŠ¨é‡Šæ”¾å†…å­˜ã€‚ARC é€šè¿‡ç»´æŠ¤ä¸€ä¸ªâ€œå¼•ç”¨è®¡æ•°â€æ¥å†³å®šå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸï¼šæ¯æ¬¡å¼•ç”¨å¢åŠ æ—¶è®¡æ•°åŠ ä¸€ï¼Œæ¯æ¬¡å¼•ç”¨å‡å°‘æ—¶è®¡æ•°å‡ä¸€ã€‚å½“å¼•ç”¨è®¡æ•°ä¸ºé›¶æ—¶ï¼ŒARC ä¼šè‡ªåŠ¨é‡Šæ”¾å¯¹è±¡æ‰€å çš„å†…å­˜ã€‚\nå¼ºå¼•ç”¨ã€å¼±å¼•ç”¨å’Œæ— ä¸»å¼•ç”¨ARC çš„æ ¸å¿ƒåœ¨äºç®¡ç†å¼•ç”¨ç±»å‹å˜é‡ä¹‹é—´çš„å¼ºå¼•ç”¨ï¼ˆstrong referenceï¼‰ã€‚å¼ºå¼•ç”¨æ„å‘³ç€åªè¦å¯¹è±¡è¢«æŸä¸ªå˜é‡æŒæœ‰ï¼Œå¼•ç”¨è®¡æ•°å°±ä¸ä¼šä¸ºé›¶ï¼Œå¯¹è±¡ä¹Ÿå°±ä¸ä¼šè¢«é‡Šæ”¾ã€‚ç„¶è€Œï¼Œå¦‚æœä¸¤ä¸ªå¯¹è±¡ä¹‹é—´å½¢æˆäº†å¼ºå¼•ç”¨å¾ªç¯ï¼ˆå³ä¸¤ä¸ªå¯¹è±¡äº’ç›¸å¼•ç”¨ï¼‰ï¼ŒARC å°†æ— æ³•è‡ªåŠ¨é‡Šæ”¾å®ƒä»¬ï¼Œå¯¼è‡´å†…å­˜æ³„æ¼ã€‚\nä¸ºäº†è§£å†³å¼ºå¼•ç”¨å¾ªç¯çš„é—®é¢˜ï¼ŒSwift å¼•å…¥äº†å¼±å¼•ç”¨ï¼ˆweak referenceï¼‰å’Œæ— ä¸»å¼•ç”¨ï¼ˆunowned referenceï¼‰ã€‚å¼±å¼•ç”¨ä¸å¢åŠ å¯¹è±¡çš„å¼•ç”¨è®¡æ•°ï¼Œå½“å¯¹è±¡è¢«é‡Šæ”¾æ—¶ï¼Œå¼±å¼•ç”¨ä¼šè‡ªåŠ¨å˜ä¸º nilã€‚æ— ä¸»å¼•ç”¨åˆ™æ˜¯ä¸€ç§éå¯é€‰ç±»å‹å¼•ç”¨ï¼Œå½“å¯¹è±¡è¢«é‡Šæ”¾æ—¶ï¼Œæ— ä¸»å¼•ç”¨ä¸ä¼šå˜ä¸º nilï¼Œä½†å¦‚æœè®¿é—®å·²ç»è¢«é‡Šæ”¾çš„å¯¹è±¡åˆ™ä¼šå¯¼è‡´è¿è¡Œæ—¶é”™è¯¯ã€‚å› æ­¤ï¼Œæ— ä¸»å¼•ç”¨é€šå¸¸ç”¨äºå¯¹è±¡ç”Ÿå‘½å‘¨æœŸä¸€è‡´çš„æƒ…å†µä¸‹ï¼Œè€Œå¼±å¼•ç”¨åˆ™é€‚ç”¨äºå¯¹è±¡å¯èƒ½ä¼šç‹¬ç«‹é‡Šæ”¾çš„æƒ…å†µã€‚\nå¾ªç¯å¼•ç”¨çš„ç¤ºä¾‹ä¸è§£å†³æ–¹æ¡ˆå½“ä¸¤ä¸ªç±»äº’ç›¸æŒæœ‰å¯¹æ–¹çš„å¼ºå¼•ç”¨æ—¶ï¼Œä¼šå¯¼è‡´å¾ªç¯å¼•ç”¨é—®é¢˜ï¼Œå¯¼è‡´å†…å­˜æ— æ³•æ­£ç¡®é‡Šæ”¾ã€‚è¿™ç±»é—®é¢˜é€šå¸¸å‘ç”Ÿåœ¨é—­åŒ…ä¸ç±»å®ä¾‹ä¹‹é—´ã€‚ä¸ºäº†æ‰“ç ´è¿™ç§å¾ªç¯å¼•ç”¨ï¼Œå¯ä»¥åœ¨é—­åŒ…ä¸­ä½¿ç”¨æ•è·åˆ—è¡¨ï¼ˆcapture listï¼‰å°†é—­åŒ…ä¸­çš„å¼•ç”¨å£°æ˜ä¸ºå¼±å¼•ç”¨æˆ–æ— ä¸»å¼•ç”¨ã€‚\nimport SwiftUIclass Element &#123;    let title: String    let description: String?        lazy var convertToWeb: () -&gt; String = &#123; [unowned self] in        if let description = self.description &#123;            return &quot;&lt;div class=&#x27;line&#x27;&gt;&lt;h2&gt;\\(self.title)&lt;/h2&gt;&lt;p&gt;\\(description)&lt;/p&gt;&lt;/div&gt;&quot;        &#125; else &#123;            return &quot;&lt;div class=&#x27;line&#x27;&gt;&lt;h2&gt;\\(self.title)&lt;/h2&gt;&lt;/div&gt;&quot;        &#125;    &#125;        init(title: String, description: String? = nil) &#123;        self.title = title        self.description = description    &#125;        deinit &#123;        print(&quot;\\(title) is being deinitialized&quot;)    &#125;&#125;struct ContentView: View &#123;    @State private var elm: Element? = Element(title: &quot;Inception&quot;, description: &quot;A mind-bending thriller by Christopher Nolan.&quot;)        var body: some View &#123;        VStack &#123;            if let html = elm?.convertToWeb() &#123;                Text(html)                    .padding()                    .background(Color.yellow)                    .cornerRadius(10)            &#125;            Button(&quot;Clear&quot;) &#123;                elm = nil            &#125;            .padding()            .background(Color.red)            .foregroundColor(.white)            .cornerRadius(10)        &#125;        .padding()    &#125;&#125;\nåœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼ŒconvertToWeb æ˜¯ä¸€ä¸ªé—­åŒ…ï¼Œä½¿ç”¨äº† [unowned self] æ•è·åˆ—è¡¨ï¼Œä»¥é¿å…é—­åŒ…ä¸ Element å®ä¾‹ä¹‹é—´çš„å¼ºå¼•ç”¨å¾ªç¯ã€‚\né—­åŒ…ä¸­çš„å¾ªç¯å¼•ç”¨é—­åŒ…æ˜¯ä¸€ç§åœ¨ Swift ä¸­å¹¿æ³›ä½¿ç”¨çš„åŠŸèƒ½ï¼Œä½†ç”±äºé—­åŒ…ä¼šæ•è·å®ƒä»¬ä½¿ç”¨çš„ä»»ä½•å¤–éƒ¨å˜é‡ï¼Œå¯èƒ½ä¼šå¼•å…¥å¾ªç¯å¼•ç”¨ã€‚ä¸ºäº†é˜²æ­¢è¿™ç§æƒ…å†µå‘ç”Ÿï¼ŒSwift æä¾›äº†æ•è·åˆ—è¡¨ï¼Œä½¿ä½ å¯ä»¥æ˜¾å¼æŒ‡å®šåœ¨é—­åŒ…ä¸­å¦‚ä½•æ•è·å¤–éƒ¨å˜é‡ï¼ˆå¦‚ä½¿ç”¨ weak æˆ– unowned å…³é”®å­—ï¼‰ã€‚\niOSè™šæ‹Ÿå†…å­˜å¯ä»¥é€šè¿‡ADRPï¼ˆAddress Relative to Pageï¼‰æ±‡ç¼–æŒ‡ä»¤æ‰¾åˆ°ç‰¹å®šç¬¦å·åœ¨è™šæ‹Ÿå†…å­˜ä¸­çš„åœ°å€ã€‚ADRPï¼ˆAddress Relative to Pageï¼‰æ˜¯ARMæ¶æ„ä¸­ç”¨äºè®¡ç®—åœ°å€çš„æ±‡ç¼–æŒ‡ä»¤ï¼Œå…¶ä½œç”¨æ˜¯è®¡ç®—ä¸€ä¸ªæ ‡ç­¾ï¼ˆlabelï¼‰æˆ–ç¬¦å·ç›¸å¯¹äºå½“å‰é¡µé¢åŸºåœ°å€çš„åç§»é‡ï¼Œå¹¶å°†è¿™ä¸ªåç§»é‡ä¹˜ä»¥é¡µé¢å¤§å°ï¼ˆé€šå¸¸ä¸º4KBï¼Œå³0x1000ï¼‰åçš„ç»“æœå­˜å‚¨åˆ°æŒ‡å®šçš„å¯„å­˜å™¨ä¸­ã€‚è¿™ä¸€æŒ‡ä»¤åœ¨å¤„ç†å¤§èŒƒå›´çš„å†…å­˜åœ°å€æ—¶éå¸¸æœ‰ç”¨ï¼Œå°¤å…¶æ˜¯åœ¨è™šæ‹Ÿå†…å­˜ç¯å¢ƒä¸­ï¼Œå¯ä»¥æœ‰æ•ˆå‡å°‘åœ°å€è®¡ç®—æ‰€éœ€çš„æŒ‡ä»¤æ•°é‡ã€‚\niOSä¸­çš„åœ°å€ç©ºé—´å¸ƒå±€éšæœºåŒ–ï¼ˆASLR, Address Space Layout Randomizationï¼‰æŠ€æœ¯ã€‚è™šæ‹Ÿå†…å­˜æ˜¯ç°ä»£æ“ä½œç³»ç»Ÿä¸ºäº†æä¾›æ›´å¤§å†…å­˜ç©ºé—´ã€å®ç°å†…å­˜ä¿æŠ¤å’Œç®¡ç†è€Œé‡‡ç”¨çš„ä¸€ç§æŠ€æœ¯ã€‚å®ƒå°†ç‰©ç†å†…å­˜ä¸é€»è¾‘å†…å­˜ï¼ˆå³ç”¨æˆ·è§†è§’çš„å†…å­˜ï¼‰åˆ†ç¦»ï¼Œé€šè¿‡åˆ†é¡µæœºåˆ¶ï¼ˆPagingï¼‰å®ç°ã€‚ASLRåˆ™æ˜¯ä¸€ç§å®‰å…¨ç‰¹æ€§ï¼Œå®ƒé€šè¿‡åœ¨ç¨‹åºåŠ è½½æ—¶éšæœºåŒ–ä»£ç å’Œæ•°æ®åœ¨å†…å­˜ä¸­çš„ä½ç½®ï¼Œæ¥å¢åŠ æ”»å‡»è€…é¢„æµ‹å’Œåˆ©ç”¨å†…å­˜åœ°å€çš„éš¾åº¦ã€‚\nåœ¨iOSä¸­ï¼ŒASLRä¼šå¯¼è‡´æ¯æ¬¡å¯åŠ¨Appæ—¶ï¼ŒAppçš„è™šæ‹Ÿå†…å­˜åœ°å€éƒ½ä¼šå‘ç”Ÿå˜åŒ–ã€‚è¿™å°±ä½¿å¾—åœ¨è°ƒè¯•è¿‡ç¨‹ä¸­ï¼Œéœ€è¦é€šè¿‡ä¸€äº›æŠ€å·§æ¥è·å–ç¬¦å·çš„çœŸå®åœ°å€ã€‚å…¶ä¸­ï¼Œä¸€ç§å¸¸ç”¨çš„æ–¹æ³•æ˜¯é€šè¿‡ADRPæŒ‡ä»¤æ¥è®¡ç®—ç¬¦å·çš„è™šæ‹Ÿå†…å­˜åœ°å€ã€‚\nåœ¨ARM64æ±‡ç¼–ä¸­ï¼ŒADRPæŒ‡ä»¤çš„æ ¼å¼å¦‚ä¸‹ï¼š\nADRP Xd, label\nå…¶ä¸­ï¼ŒXdæ˜¯ç›®æ ‡å¯„å­˜å™¨ï¼Œlabelæ˜¯ä¸€ä¸ªç¬¦å·çš„åœ°å€ã€‚\nADRPæŒ‡ä»¤çš„ä½œç”¨æ˜¯å°†ä¸€ä¸ªç¬¦å·çš„åœ°å€çš„é«˜20ä½åŠ è½½åˆ°å¯„å­˜å™¨ä¸­ï¼Œç„¶åé€šè¿‡ADDæŒ‡ä»¤å°†ä½12ä½åŠ ä¸Šå»ã€‚è¿™æ ·å°±å¯ä»¥å¾—åˆ°ä¸€ä¸ªç¬¦å·çš„è™šæ‹Ÿå†…å­˜åœ°å€ã€‚\nåœ¨LLDBä¸­ï¼Œå¯ä»¥é€šè¿‡image listå‘½ä»¤æŸ¥çœ‹å½“å‰Appçš„ASLRåç§»é‡ï¼Œç„¶åé€šè¿‡image lookup -nå‘½ä»¤æŸ¥çœ‹ç›®æ ‡ç¬¦å·çš„åœ°å€ã€‚åœ¨GDBä¸­ï¼Œå¯ä»¥é€šè¿‡info sharedlibraryå‘½ä»¤æŸ¥çœ‹å½“å‰Appçš„ASLRåç§»é‡ï¼Œç„¶åé€šè¿‡info addresså‘½ä»¤æŸ¥çœ‹ç›®æ ‡ç¬¦å·çš„åœ°å€ã€‚\nåœ¨iOSçš„Mach-Oæ–‡ä»¶ä¸­ï¼Œç¬¦å·ï¼ˆå¦‚ç±»åã€å‡½æ•°åç­‰ï¼‰çš„åœ°å€åœ¨ç¼–è¯‘é“¾æ¥é˜¶æ®µå°±å·²ç»ç¡®å®šï¼Œä½†åœ¨ç¨‹åºè¿è¡Œæ—¶å¯èƒ½ä¼šå—åˆ°ASLRçš„å½±å“è€Œå‘ç”Ÿå˜åŒ–ã€‚ç„¶è€Œï¼Œåœ¨Mach-Oæ–‡ä»¶ä¸­ç›´æ¥æŸ¥çœ‹æ—¶ï¼Œè¿™äº›åœ°å€æ˜¯ä¸åŒ…å«ASLRåç§»é‡çš„ã€‚å› æ­¤ï¼Œä¸ºäº†è·å–ç¬¦å·åœ¨è¿è¡Œæ—¶çš„çœŸå®åœ°å€ï¼Œéœ€è¦é€šè¿‡ADRPæŒ‡ä»¤è®¡ç®—å‡ºç¬¦å·çš„è™šæ‹Ÿå†…å­˜åœ°å€ï¼Œç„¶åå†åŠ ä¸ŠASLRåç§»é‡ã€‚\nSwiftå†…å­˜å®‰å…¨æ€§åŠå…¶å®ç°æœºåˆ¶Swift é€šè¿‡ç¡®ä¿å†…å­˜çš„â€œç‹¬å è®¿é—®â€ï¼ˆExclusive Accessï¼‰æ¥é¿å…å¸¸è§çš„å†…å­˜å®‰å…¨é—®é¢˜ï¼Œä¾‹å¦‚æ•°æ®ç«äº‰ï¼ˆData Raceï¼‰å’Œæœªå®šä¹‰è¡Œä¸ºï¼ˆUndefined Behaviorï¼‰ã€‚åœ¨ Swift ä¸­ï¼Œå†…å­˜çš„è®¿é—®æ–¹å¼è¢«ä¸¥æ ¼æ§åˆ¶ï¼Œå°¤å…¶æ˜¯åœ¨å¯¹å˜é‡è¿›è¡Œè¯»å†™æ—¶ï¼Œç³»ç»Ÿä¼šç¡®ä¿åœ¨ä¸€ä¸ªæ—¶é—´ç‚¹ä¸Šï¼Œåªæœ‰ä¸€ä¸ªä»£ç æ®µå¯ä»¥å¯¹è¯¥å†…å­˜è¿›è¡Œä¿®æ”¹ã€‚è¿™ä¸€è®¾è®¡é€šè¿‡é™åˆ¶å˜é‡çš„è®¿é—®æ–¹å¼å’Œæ—¶é—´ï¼Œæå¤§ç¨‹åº¦ä¸Šé¿å…äº†å†…å­˜å†²çªã€‚\nå†…å­˜å®‰å…¨çš„é‡è¦æ€§å†…å­˜å®‰å…¨æ˜¯æŒ‡åœ¨ç¼–ç¨‹ä¸­ç¡®ä¿å†…å­˜çš„æ­£ç¡®è®¿é—®å’Œç®¡ç†ï¼Œä»¥é¿å…å¸¸è§çš„é”™è¯¯ï¼Œå¦‚è¶Šç•Œè®¿é—®ã€ä½¿ç”¨å·²é‡Šæ”¾çš„å†…å­˜æˆ–å¹¶å‘è®¿é—®å¯¼è‡´çš„æ•°æ®æŸåç­‰ã€‚Swift ä½œä¸ºä¸€ç§ç°ä»£ç¼–ç¨‹è¯­è¨€ï¼Œé€šè¿‡å…¶è®¾è®¡å’Œç¼–è¯‘æ—¶æ£€æŸ¥ï¼Œå®ç°äº†å†…å­˜å®‰å…¨çš„ç›®æ ‡ã€‚\nç‹¬å è®¿é—®çš„æ¦‚å¿µSwift å¦‚ä½•é€šè¿‡ç‹¬å è®¿é—®æœºåˆ¶æ¥å®ç°å†…å­˜å®‰å…¨ã€‚å½“å˜é‡æ­£åœ¨è¢«ä¸€ä¸ªä»£ç æ®µä¿®æ”¹æ—¶ï¼ŒSwift ä¸å…è®¸å…¶ä»–ä»£ç æ®µåŒæ—¶è®¿é—®è¯¥å˜é‡çš„å†…å­˜åœ°å€ã€‚Swift å¼ºåˆ¶æ‰§è¡Œè¿™ä¸€è§„åˆ™ï¼Œå³ä½¿åœ¨å•çº¿ç¨‹ç¯å¢ƒä¸­ä¹Ÿä¸ä¾‹å¤–ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼ŒSwift æœ‰æ•ˆé¿å…äº†æ•°æ®ç«äº‰å’Œæœªå®šä¹‰è¡Œä¸ºã€‚\nåœ¨ Swift ä¸­ï¼Œå†…å­˜çš„è®¿é—®è¢«åˆ†ä¸ºè¯»è®¿é—®å’Œå†™è®¿é—®ã€‚è¯»è®¿é—®æ˜¯æŒ‡è¯»å–å˜é‡çš„å€¼ï¼Œè€Œå†™è®¿é—®æ˜¯æŒ‡ä¿®æ”¹å˜é‡çš„å€¼ã€‚Swift å…è®¸å¤šä¸ªè¯»è®¿é—®åŒæ—¶å‘ç”Ÿï¼Œä½†åœ¨å†™è®¿é—®æœŸé—´ï¼Œä»»ä½•å…¶ä»–è®¿é—®ï¼ˆæ— è®ºæ˜¯è¯»è¿˜æ˜¯å†™ï¼‰éƒ½ä¼šå¯¼è‡´å†²çªï¼Œä»è€Œè§¦å‘ç¼–è¯‘é”™è¯¯ã€‚\nè®¿é—®å†²çªçš„å…·ä½“ç¤ºä¾‹Swift ä¸­å¯èƒ½å¯¼è‡´å†…å­˜è®¿é—®å†²çªçš„æƒ…å†µã€‚ä¸€ä¸ªå¸¸è§çš„ä¾‹å­æ˜¯ï¼Œå½“ä¸€ä¸ªå‡½æ•°åœ¨æ‰§è¡Œæ—¶åŒæ—¶è®¿é—®åŒä¸€å˜é‡ï¼Œä¸”è¯¥å˜é‡çš„æŸäº›å±æ€§æ­£åœ¨è¢«ä¿®æ”¹ï¼Œè¿™ç§æƒ…å†µä¸‹å°±ä¼šäº§ç”Ÿå†²çªã€‚ä¾‹å¦‚ï¼š\nfunc adjustRatings(_ rating1: inout Int, _ rating2: inout Int) &#123;    let total = rating1 + rating2    rating1 = total / 2    rating2 = total - rating1&#125;var movieRating = 85adjustRatings(&amp;movieRating, &amp;movieRating)\nåœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼ŒadjustRatings(&amp;movieRating, &amp;movieRating) è¯•å›¾åŒæ—¶ä¿®æ”¹ movieRating çš„ä¸¤ä¸ªå±æ€§ï¼Œè¿™åœ¨ Swift ä¸­ä¼šè§¦å‘ç¼–è¯‘é”™è¯¯ï¼Œå› ä¸ºè¿™ç§æƒ…å†µä¸‹æ— æ³•ä¿è¯å†…å­˜çš„ç‹¬å è®¿é—®ã€‚\nç»“æ„ä½“çš„å†…å­˜è®¿é—®Swift ä¸­ç»“æ„ä½“çš„å†…å­˜ç®¡ç†ã€‚ä¸ç±»ä¸åŒï¼Œç»“æ„ä½“æ˜¯å€¼ç±»å‹ï¼Œè¿™æ„å‘³ç€å®ƒä»¬çš„æ¯ä¸€ä¸ªå®ä¾‹éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„å†…å­˜ç©ºé—´ã€‚å› æ­¤ï¼Œå¯¹ç»“æ„ä½“çš„è®¿é—®ä¹Ÿéœ€è¦éµå®ˆç‹¬å è®¿é—®è§„åˆ™ã€‚ç‰¹åˆ«æ˜¯åœ¨ç»“æ„ä½“å†…éƒ¨æœ‰å¤šä¸ªå±æ€§æ—¶ï¼ŒSwift ä¼šç¡®ä¿åœ¨ä¿®æ”¹ä¸€ä¸ªå±æ€§æ—¶ï¼Œå…¶ä»–å±æ€§ä¸ä¼šè¢«åŒæ—¶è®¿é—®ã€‚\nå†…å­˜è®¿é—®çš„ä¾‹å¤–æƒ…å†µ\nå°½ç®¡ Swift å¯¹å†…å­˜è®¿é—®è¿›è¡Œäº†ä¸¥æ ¼çš„æ§åˆ¶ï¼Œä½†ä¹Ÿæœ‰ä¸€äº›ä¾‹å¤–æƒ…å†µã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼ŒSwift ä¼šå…è®¸éç‹¬å è®¿é—®ï¼Œä¾‹å¦‚å…¨å±€å˜é‡å’Œé™æ€å˜é‡ã€‚è¿™äº›å˜é‡çš„ç”Ÿå‘½å‘¨æœŸä¸ç¨‹åºä¸€è‡´ï¼Œé€šå¸¸ä¸ä¼šå‘ç”Ÿæ•°æ®ç«äº‰ï¼Œå› æ­¤ Swift å¯¹å®ƒä»¬çš„è®¿é—®æ§åˆ¶ç›¸å¯¹å®½æ¾ã€‚\nSwift çš„å†…å­˜å®‰å…¨ä¸æ€§èƒ½å°½ç®¡ Swift çš„å†…å­˜å®‰å…¨æœºåˆ¶ç¡®ä¿äº†ç¨‹åºçš„ç¨³å®šæ€§ï¼Œä½†å®ƒä¹Ÿå¸¦æ¥äº†ä¸€å®šçš„æ€§èƒ½å¼€é”€ã€‚å¦‚ä½•åœ¨ä¸ç‰ºç‰²å®‰å…¨æ€§çš„å‰æä¸‹ä¼˜åŒ–ç¨‹åºæ€§èƒ½ã€‚ä¾‹å¦‚ï¼Œé€šè¿‡åœ¨åˆé€‚çš„åœºæ™¯ä¸‹ä½¿ç”¨ inout å‚æ•°ï¼Œå¼€å‘è€…å¯ä»¥åœ¨ä¿ç•™ç‹¬å è®¿é—®çš„åŒæ—¶ï¼Œå‡å°‘ä¸å¿…è¦çš„å†…å­˜å¤åˆ¶ã€‚\nSwiftå†…å­˜æ“ä½œSwift ç¼–ç¨‹è¯­è¨€ä¸­è¿›è¡Œä¸å®‰å…¨å†…å­˜æ“ä½œçš„æŠ€æœ¯å’Œæ³¨æ„äº‹é¡¹ã€‚Swift é€šå¸¸é€šè¿‡å¼•ç”¨è®¡æ•°å’Œå†…å­˜è‡ªåŠ¨ç®¡ç†æ¥ä¿è¯å†…å­˜å®‰å…¨ï¼Œç„¶è€Œåœ¨æŸäº›é«˜æ€§èƒ½æˆ–ç‰¹å®šåº•å±‚æ“ä½œä¸­ï¼Œå¼€å‘è€…å¯èƒ½éœ€è¦ç›´æ¥æ“ä½œå†…å­˜ã€‚è¿™æ—¶å°±éœ€è¦ä½¿ç”¨åˆ° Swift çš„ Unsafe ç³»åˆ—æŒ‡é’ˆç±»å‹ï¼Œä¾‹å¦‚ UnsafeMutablePointer å’Œ UnsafePointerã€‚\nUnsafePointer æ˜¯ä¸€ä¸ªæŒ‡å‘æŸç§ç±»å‹çš„æŒ‡é’ˆï¼Œå®ƒå…è®¸åªè¯»è®¿é—®å†…å­˜åœ°å€ä¸Šçš„æ•°æ®ã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥è¯»å–è¯¥åœ°å€çš„æ•°æ®ä½†ä¸èƒ½ä¿®æ”¹å®ƒã€‚ç›¸åï¼ŒUnsafeMutablePointer å…è®¸ä½ ä¿®æ”¹æŒ‡é’ˆæŒ‡å‘çš„å†…å­˜åŒºåŸŸå†…çš„æ•°æ®ã€‚ä½¿ç”¨ UnsafeMutablePointer ä¿®æ”¹å†…å­˜æ—¶ï¼Œå¿…é¡»ç¡®ä¿å†…å­˜å·²ç»æ­£ç¡®åœ°åˆ†é…ä¸”ä¸ä¼šè¢«å…¶ä»–ä»£ç åŒæ—¶è®¿é—®ã€‚å¦åˆ™ï¼Œå¯èƒ½ä¼šå¯¼è‡´ç¨‹åºå´©æºƒæˆ–å‡ºç°éš¾ä»¥è°ƒè¯•çš„é—®é¢˜ã€‚Swift æä¾›çš„ä¸€äº›è¾…åŠ©å·¥å…· withUnsafePointer(to::) å’Œ withUnsafeMutablePointer(to::)ï¼Œå®ƒä»¬å¯ä»¥åœ¨æœ‰é™çš„èŒƒå›´å†…ç¡®ä¿å†…å­˜æ“ä½œçš„å®‰å…¨æ€§ã€‚è¿™äº›å‡½æ•°çš„ä½¿ç”¨å¯ä»¥å¸®åŠ©å¼€å‘è€…é¿å…ä¸€äº›å¸¸è§çš„é”™è¯¯ï¼Œç¡®ä¿æŒ‡é’ˆçš„ç”Ÿå‘½å‘¨æœŸå’Œä½œç”¨åŸŸå—åˆ°æ§åˆ¶ã€‚\nå†…å­˜åˆ†é…å™¨libMalloclibMallociOSåº•å±‚å †å†…å­˜åˆ†é…å™¨libMallociOSåº•å±‚å †å†…å­˜åˆ†é…å™¨libMallocï¼ŒlibMallocæ˜¯iOSç³»ç»Ÿä¸­å¹¿æ³›ä½¿ç”¨çš„å†…å­˜åˆ†é…å™¨ï¼Œæä¾›é«˜æ•ˆçš„å†…å­˜ç®¡ç†ç­–ç•¥ã€‚å­¦ä¹ libMallocæºç æœ‰åŠ©äºæ·±å…¥ç†è§£iOSå†…å­˜ç®¡ç†æœºåˆ¶ï¼Œä¼˜åŒ–å†…å­˜ä½¿ç”¨æ•ˆç‡ã€‚\nZoneæ˜¯libMallocç®¡ç†å†…å­˜çš„åŸºç¡€å•å…ƒï¼Œè´Ÿè´£å¤„ç†å†…å­˜åˆ†é…ã€é‡Šæ”¾ç­‰æ“ä½œã€‚å¸¸è§çš„å†…å­˜æ“ä½œAPIï¼ˆå¦‚mallocã€freeã€reallocï¼‰å‡é€šè¿‡Zoneå®ç°ã€‚Zoneçš„æ ¸å¿ƒæ•°æ®ç»“æ„ï¼ŒåŒ…å«å¤šä¸ªå‡½æ•°æŒ‡é’ˆï¼Œåˆ†åˆ«å¯¹åº”ä¸åŒçš„å†…å­˜æ“ä½œå‡½æ•°ã€‚å¦‚sizeã€mallocã€callocã€vallocã€freeã€reallocç­‰ï¼Œåˆ†åˆ«å¤„ç†å†…å­˜å—çš„å¤§å°æŸ¥è¯¢ã€åˆ†é…ã€é‡Šæ”¾ç­‰æ“ä½œã€‚reserved1å’Œreserved2ï¼Œç”¨äºä¿ç•™ç»™CFAllocatorä½¿ç”¨ï¼Œç”¨æˆ·ä¸åº”ç›´æ¥è®¿é—®ã€‚é€šè¿‡malloc_zone_register_while_lockedå‡½æ•°å°†Zoneæ³¨å†Œåˆ°å…¨å±€Zoneåˆ—è¡¨ä¸­ã€‚åœ¨å†…å­˜åˆ†é…æ—¶ï¼Œæ ¹æ®é…ç½®å’Œå½“å‰çŠ¶æ€é€‰æ‹©åˆé€‚çš„Zoneè¿›è¡Œå¤„ç†ã€‚\ndefault_zoneæ˜¯libMallocé»˜è®¤ä½¿ç”¨çš„Zoneï¼Œé€šè¿‡runtime_default_zone()å‡½æ•°è·å–ã€‚default_zoneçš„å®é™…é€»è¾‘å¯èƒ½ç”±scalable_zoneæˆ–nano_zoneç­‰å…·ä½“Zoneå®ç°ã€‚\nscalable_zoneæ˜¯å¤„ç†å¤§å¤šæ•°å†…å­˜åˆ†é…è¯·æ±‚çš„é»˜è®¤Zoneã€‚æ ¹æ®å†…å­˜å¤§å°ï¼Œé‡‡ç”¨tinyã€smallã€mediumã€largeå››ç§ä¸åŒç­–ç•¥è¿›è¡Œç®¡ç†ã€‚szone_tï¼Œæ‰©å±•è‡ªmalloc_zone_tï¼ŒåŒ…å«tinyã€smallã€mediumç­–ç•¥çš„ç›¸å…³æ•°æ®ç»“æ„å’Œlargeç­–ç•¥çš„ç®¡ç†å­—æ®µã€‚å¯¹äºå¤§å—å†…å­˜çš„åˆ†é…ï¼Œç³»ç»Ÿå¯èƒ½é€‰æ‹©scalable zoneï¼Œè¯¥zoneå…·æœ‰æ›´å¥½çš„æ‰©å±•æ€§å’Œçµæ´»æ€§ã€‚\nnano_zoneä¸“é—¨ç”¨äºç®¡ç†å°å†…å­˜ï¼ˆå¦‚256å­—èŠ‚ä»¥ä¸‹ï¼‰çš„Zoneï¼Œä»¥æé«˜å°å†…å­˜åˆ†é…çš„æ•ˆç‡ã€‚æä¾›äº†V1å’ŒV2ä¸¤ä¸ªç‰ˆæœ¬çš„å®ç°ï¼ŒV2ç‰ˆæœ¬åœ¨æ€§èƒ½å’Œç®¡ç†é€»è¾‘ä¸Šè¿›è¡Œäº†ä¼˜åŒ–ã€‚é€šè¿‡nanov2_create_zoneå‡½æ•°åˆ›å»ºå¹¶åˆå§‹åŒ–nano_zoneã€‚nano_zone_tæ˜¯nano zoneçš„å…·ä½“å®ç°ï¼ŒåŒ…å«malloc_zone_tåŸºç¡€ç»“æ„å’Œé¢å¤–çš„å†…å­˜ç®¡ç†ä¿¡æ¯ã€‚è¯¥å‡½æ•°è´Ÿè´£åˆ›å»ºnano zoneï¼Œå¹¶å¯¹malloc_zone_tä¸­çš„å‡½æ•°æŒ‡é’ˆè¿›è¡Œé‡æ–°èµ‹å€¼ï¼Œä»¥ä½¿ç”¨nano zoneç‰¹æœ‰çš„å†…å­˜åˆ†é…ç­–ç•¥ã€‚nano_callocå‡½æ•°æ ¹æ®è¯·æ±‚çš„å†…å­˜å¤§å°é€‰æ‹©ç›´æ¥åœ¨nano zoneä¸­åˆ†é…æˆ–å›é€€åˆ°helper zoneè¿›è¡Œåˆ†é…ã€‚å½“nano zoneæ— æ³•æ»¡è¶³å†…å­˜åˆ†é…è¯·æ±‚æ—¶ï¼Œä¼šå›é€€åˆ°helper zoneè¿›è¡Œåˆ†é…ã€‚nano zoneä¸­çš„å†…å­˜åˆ†é…ä¼šè¿›è¡Œ16å­—èŠ‚å¯¹é½ï¼Œä»¥æé«˜å†…å­˜è®¿é—®æ•ˆç‡ã€‚nano zoneé€šè¿‡ç»´æŠ¤ä¸€ä¸ªé«˜æ•ˆçš„ç¼“å­˜æœºåˆ¶æ¥å‡å°‘å†…å­˜åˆ†é…å’Œé‡Šæ”¾çš„å¼€é”€ã€‚ç³»ç»Ÿæä¾›äº†è°ƒè¯•å’Œæ—¥å¿—è®°å½•åŠŸèƒ½ï¼Œå¸®åŠ©å¼€å‘è€…è·Ÿè¸ªå†…å­˜åˆ†é…å’Œé‡Šæ”¾çš„è¿‡ç¨‹ï¼Œä»¥ä¾¿å‘ç°å’Œè§£å†³å†…å­˜æ³„æ¼ç­‰é—®é¢˜ã€‚\nmalloc_zone_tæ˜¯ä¸€ä¸ªåŒ…å«å¤šä¸ªå‡½æ•°æŒ‡é’ˆçš„ç»“æ„ä½“ï¼Œç”¨äºå­˜å‚¨å†…å­˜åˆ†é…ã€é‡Šæ”¾ç­‰æ“ä½œçš„å®ç°åœ°å€ã€‚åŒ…æ‹¬mallocã€callocã€freeã€reallocç­‰å‡½æ•°æŒ‡é’ˆï¼Œè¿™äº›å‡½æ•°æŒ‡é’ˆæŒ‡å‘å…·ä½“çš„å†…å­˜ç®¡ç†å‡½æ•°å®ç°ã€‚åŒ…å«ä¸¤ä¸ªreservedå­—æ®µï¼Œä¾›CFAllocatorä½¿ç”¨ï¼Œå¼€å‘è€…ä¸åº”ç›´æ¥è®¿é—®ã€‚\ncallocå‡½æ•°é€šè¿‡è°ƒç”¨malloc_zone_callocå‡½æ•°æ¥åˆ†é…å†…å­˜ï¼Œå¹¶å°†åˆ†é…çš„å†…å­˜æ¸…é›¶ã€‚default_zoneæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„zoneï¼Œç”¨äºå¼•å¯¼ç¨‹åºè¿›å…¥åˆ›å»ºçœŸæ­£zoneçš„æµç¨‹ã€‚æ ¹æ®ç³»ç»Ÿé…ç½®å’Œå†…å­˜éœ€æ±‚ï¼Œé€‰æ‹©nano zoneæˆ–scalable zoneè¿›è¡Œå†…å­˜åˆ†é…ã€‚\nmalloc_zone_register_while_lockedè¯¥å‡½æ•°ç”¨äºä¸ºzoneè®¾ç½®åç§°ï¼Œä¾¿äºè°ƒè¯•å’Œæ—¥å¿—è®°å½•ä¸­è¯†åˆ«ä¸åŒçš„zoneã€‚é€šè¿‡zoneåç§°ï¼Œå¼€å‘è€…å¯ä»¥æ›´å®¹æ˜“åœ°è·Ÿè¸ªå’Œå®šä½å†…å­˜åˆ†é…å’Œé‡Šæ”¾çš„é—®é¢˜ã€‚\nç³»ç»Ÿå†…å®¹åˆ†é…æ–¹å¼CPU é€šå¸¸æœ‰å†…æ ¸æ€å’Œç”¨æˆ·æ€ä¸¤ç§è¿è¡Œæ¨¡å¼ï¼Œå†…æ ¸æ€æ‹¥æœ‰æ›´é«˜çš„æƒé™ï¼Œå¯ä»¥è®¿é—®ç³»ç»Ÿèµ„æºï¼Œè€Œç”¨æˆ·æ€åªèƒ½è®¿é—®å—é™èµ„æºã€‚ç³»ç»Ÿå†…å­˜åˆ†é…æ–¹å¼é€šå¸¸åŒ…æ‹¬å†…æ ¸æ€å’Œç”¨æˆ·æ€ä¸¤ç§ï¼Œå†…æ ¸æ€åˆ†é…ç”±å†…æ ¸ç®¡ç†ï¼Œç”¨æˆ·æ€åˆ†é…ç”±ç”¨æˆ·ç¨‹åºç®¡ç†ã€‚\nç¨‹åºé€šè¿‡ç³»ç»Ÿè°ƒç”¨ï¼ˆSystem Callï¼‰ä»ç”¨æˆ·æ€å‘å†…æ ¸æ€ä¼ é€’ä¿¡æ¯ï¼Œè¯·æ±‚æ“ä½œç³»ç»ŸæœåŠ¡ï¼Œå¦‚æ‰“å¼€æ–‡ä»¶ã€ç½‘ç»œé€šä¿¡ç­‰ã€‚å†…æ ¸æ€å†…å­˜åˆ†é…é€šå¸¸ç”±å†…æ ¸ç®¡ç†ï¼Œå†…æ ¸é€šè¿‡å†…å­˜ç®¡ç†å•å…ƒï¼ˆMMUï¼‰ç®¡ç†å†…å­˜æ˜ å°„ã€åˆ†é¡µç­‰æ“ä½œï¼Œç¡®ä¿å†…å­˜åˆ†é…çš„å®‰å…¨æ€§å’Œæœ‰æ•ˆæ€§ã€‚\nCè¯­è¨€æ ‡å‡†åº“æä¾›äº†å¯¹ç³»ç»Ÿè°ƒç”¨çš„å°è£…ï¼Œä½¿ç¨‹åºå‘˜ç¼–å†™çš„ç¨‹åºèƒ½è·¨å¹³å°è¿è¡Œï¼Œæ— éœ€ä¿®æ”¹åº•å±‚ä»£ç ã€‚Cæ ‡å‡†åº“ä¸­çš„mallocã€freeç­‰å‡½æ•°å°è£…äº†å†…æ ¸æ€çš„å†…å­˜åˆ†é…å’Œé‡Šæ”¾æ“ä½œï¼Œæä¾›äº†ç”¨æˆ·æ€å†…å­˜ç®¡ç†çš„æ¥å£ã€‚å †åŒºç”¨äºåŠ¨æ€å†…å­˜åˆ†é…ï¼Œæ ˆåŒºç”¨äºå‡½æ•°è°ƒç”¨çš„å±€éƒ¨å˜é‡ç­‰ã€‚ä¸¤è€…ä¹‹é—´çš„ç©ºç™½åŒºåŸŸå…è®¸æ ˆåŒºå¢é•¿ã€‚\nmallocæ˜¯æ ‡å‡†åº“ä¸­çš„å†…å­˜åˆ†é…å‡½æ•°ï¼Œè´Ÿè´£åœ¨å †åŒºæœç´¢å¹¶åˆ†é…ç©ºé—²å†…å­˜å—ã€‚å½“mallocå†…éƒ¨ç®¡ç†çš„ç©ºé—²å†…å­˜ä¸è¶³æ—¶ï¼Œä¼šé€šè¿‡ç³»ç»Ÿè°ƒç”¨ï¼ˆå¦‚brkæˆ–mmapï¼‰å‘æ“ä½œç³»ç»Ÿè¯·æ±‚æ‰©å¤§å †åŒºã€‚ç³»ç»Ÿè°ƒç”¨å®Œæˆåï¼Œmallocè¿”å›çš„æ˜¯è™šæ‹Ÿå†…å­˜åœ°å€ï¼Œç‰©ç†å†…å­˜çš„åˆ†é…åœ¨å®é™…ä½¿ç”¨æ—¶æ‰å‘ç”Ÿã€‚\nè¿›ç¨‹çœ‹åˆ°çš„å†…å­˜æ˜¯æ“ä½œç³»ç»Ÿæä¾›çš„è™šæ‹Ÿå†…å­˜ï¼Œä¸ç‰©ç†å†…å­˜ä¸å®Œå…¨å¯¹åº”ã€‚å½“ç¨‹åºé¦–æ¬¡è®¿é—®æ–°ç”³è¯·çš„å†…å­˜æ—¶ï¼Œç¼ºé¡µä¸­æ–­å‘ç”Ÿï¼Œæ“ä½œç³»ç»Ÿåˆ†é…ç‰©ç†å†…å­˜å¹¶å®Œæˆæ˜ å°„ã€‚\né¢‘ç¹è°ƒç”¨mallocä¼šå½±å“ç³»ç»Ÿæ€§èƒ½ï¼Œç‰¹åˆ«æ˜¯åœ¨é«˜æ€§èƒ½ç¨‹åºä¸­ã€‚ç†è§£å†…å­˜ç”³è¯·çš„å¤æ‚æ€§æœ‰åŠ©äºé€‰æ‹©åˆé€‚çš„å†…å­˜åˆ†é…å™¨ï¼Œä¼˜åŒ–å†…å­˜ä½¿ç”¨ç­–ç•¥ï¼Œå‡å°‘ä¸å¿…è¦çš„å†…å­˜åˆ†é…ã€‚\n","categories":["æ€§èƒ½ä¼˜åŒ–"],"tags":["æ€§èƒ½ä¼˜åŒ–","å†…å­˜ç®¡ç†"]},{"title":"å¡æ­»å´©æºƒç›‘æ§","url":"/2025/05/09/%E5%8D%A1%E6%AD%BB%E5%B4%A9%E6%BA%83%E7%9B%91%E6%8E%A7/","content":"é—®é¢˜æ¦‚è¿°iOSç³»ç»Ÿä¸­Appå¡æ­»å´©æºƒé—®é¢˜æ— æˆç†Ÿè§£å†³æ–¹æ¡ˆï¼Œå› iOSå°é—­ç”Ÿæ€ï¼ŒAppå±‚é¢æ— æƒé™è·å–å¡æ­»å´©æºƒæ—¥å¿—ã€‚ç”¨æˆ·é€šå¸¸ä¸ä¼šç­‰å¾…å¡æ­»è¶…è¿‡20sï¼Œä¸”æ‰‹åŠ¨å…³é—­åº”ç”¨ä¸ç”Ÿæˆæ—¥å¿—ï¼Œå¯¼è‡´ç›‘æ§å›°éš¾ã€‚åŸºäºå¡é¡¿ç›‘æ§ï¼Œä½†éš¾ä»¥åŒºåˆ†è½»å¾®å¡é¡¿ä¸ä¸¥é‡å¡æ­»ï¼Œä¸”æ€§èƒ½æŸè€—å¤§ï¼Œå­˜åœ¨è¯¯å¯¼æ€§ã€‚\nå´©æºƒæ—¥å¿—æ ¼å¼ï¼Œå¦‚Exception Type: EXC_CRASH (SIGKILL)ç­‰ï¼ŒæŒ‡å‡ºAppå› watchdogè¶…æ—¶è€Œè¢«ç»ˆæ­¢ã€‚watchdogå´©æºƒå®šä¹‰æ˜¯Appå¯åŠ¨ã€é€€å‡ºæˆ–å“åº”ç³»ç»Ÿäº‹ä»¶æ—¶è€—æ—¶è¿‡é•¿ï¼Œè¢«ç³»ç»Ÿå¼ºåˆ¶ç»“æŸã€‚\nç›‘æ§åŸç†æ³¨å†Œrunloopè§‚å¯Ÿè€…ï¼Œæ£€æµ‹è€—æ—¶ï¼Œè®°å½•è°ƒç”¨æ ˆï¼Œä¸ŠæŠ¥åå°åˆ†æã€‚é•¿æ—¶é—´å¡é¡¿åï¼Œè‹¥æœªè¿›å…¥ä¸‹ä¸€ä¸ªæ´»è·ƒçŠ¶æ€ï¼Œåˆ™æ ‡è®°ä¸ºå¡æ­»å´©æºƒä¸ŠæŠ¥ã€‚\nä»¥ä¸‹æ˜¯ä¸€ä¸ª iOS å¡æ­»ç›‘æ§çš„ä»£ç ç¤ºä¾‹ï¼š\n#import &lt;Foundation/Foundation.h&gt;#import &lt;UIKit/UIKit.h&gt;#import &lt;execinfo.h&gt;#import &lt;sys/time.h&gt;// å®šä¹‰ Runloop æ¨¡å¼çš„æšä¸¾typedef enum &#123;    eRunloopDefaultMode,  // é»˜è®¤æ¨¡å¼    eRunloopTrackingMode  // è¿½è¸ªæ¨¡å¼&#125; RunloopMode;// å…¨å±€å˜é‡ï¼Œç”¨äºè®°å½• Runloop çš„æ´»åŠ¨çŠ¶æ€å’Œæ¨¡å¼static CFRunLoopActivity g_runLoopActivity;static RunloopMode g_runLoopMode;static BOOL g_bRun = NO;  // æ ‡è®° Runloop æ˜¯å¦åœ¨è¿è¡Œstatic struct timeval g_tvRun;  // è®°å½• Runloop å¼€å§‹è¿è¡Œçš„æ—¶é—´// HangMonitor ç±»ï¼Œç”¨äºç›‘æ§å¡æ­»æƒ…å†µ@interface HangMonitor : NSObject@property (nonatomic, assign) CFRunLoopObserverRef runLoopBeginObserver;  // Runloop å¼€å§‹è§‚å¯Ÿè€…@property (nonatomic, assign) CFRunLoopObserverRef runLoopEndObserver;    // Runloop ç»“æŸè§‚å¯Ÿè€…@property (nonatomic, strong) dispatch_semaphore_t semaphore;  // ä¿¡å·é‡ï¼Œç”¨äºåŒæ­¥@property (nonatomic, assign) NSTimeInterval timeoutInterval;  // è¶…æ—¶æ—¶é—´- (void)addRunLoopObserver;  // æ·»åŠ  Runloop è§‚å¯Ÿè€…çš„æ–¹æ³•- (void)startMonitor;  // å¯åŠ¨ç›‘æ§çš„æ–¹æ³•- (void)logStackTrace;  // è®°å½•è°ƒç”¨æ ˆçš„æ–¹æ³•- (void)reportHang;  // ä¸ŠæŠ¥å¡æ­»çš„æ–¹æ³•@end@implementation HangMonitor// å•ä¾‹æ¨¡å¼ï¼Œç¡®ä¿ HangMonitor åªæœ‰ä¸€ä¸ªå®ä¾‹+ (instancetype)sharedInstance &#123;    static HangMonitor *instance;    static dispatch_once_t onceToken;    dispatch_once(&amp;onceToken, ^&#123;        instance = [[HangMonitor alloc] init];    &#125;);    return instance;&#125;// åˆå§‹åŒ–æ–¹æ³•- (instancetype)init &#123;    self = [super init];    if (self) &#123;        _timeoutInterval = 8.0;  // è®¾ç½®è¶…æ—¶æ—¶é—´ä¸º8ç§’        _semaphore = dispatch_semaphore_create(0);  // åˆ›å»ºä¿¡å·é‡        [self addRunLoopObserver];  // æ·»åŠ  Runloop è§‚å¯Ÿè€…        [self startMonitor];  // å¯åŠ¨ç›‘æ§    &#125;    return self;&#125;// æ·»åŠ  Runloop è§‚å¯Ÿè€…çš„æ–¹æ³•- (void)addRunLoopObserver &#123;    NSRunLoop *curRunLoop = [NSRunLoop currentRunLoop];  // è·å–å½“å‰ Runloop    // åˆ›å»ºç¬¬ä¸€ä¸ªè§‚å¯Ÿè€…ï¼Œç›‘æ§ Runloop æ˜¯å¦å¤„äºè¿è¡ŒçŠ¶æ€    CFRunLoopObserverContext context = &#123;0, (__bridge void *) self, NULL, NULL, NULL&#125;;    CFRunLoopObserverRef beginObserver = CFRunLoopObserverCreate(kCFAllocatorDefault, kCFRunLoopAllActivities, YES, LONG_MIN, &amp;myRunLoopBeginCallback, &amp;context);    CFRetain(beginObserver);  // ä¿ç•™è§‚å¯Ÿè€…ï¼Œé˜²æ­¢è¢«é‡Šæ”¾    self.runLoopBeginObserver = beginObserver;    // åˆ›å»ºç¬¬äºŒä¸ªè§‚å¯Ÿè€…ï¼Œç›‘æ§ Runloop æ˜¯å¦å¤„äºç¡çœ çŠ¶æ€    CFRunLoopObserverRef endObserver = CFRunLoopObserverCreate(kCFAllocatorDefault, kCFRunLoopAllActivities, YES, LONG_MAX, &amp;myRunLoopEndCallback, &amp;context);    CFRetain(endObserver);  // ä¿ç•™è§‚å¯Ÿè€…ï¼Œé˜²æ­¢è¢«é‡Šæ”¾    self.runLoopEndObserver = endObserver;    // å°†è§‚å¯Ÿè€…æ·»åŠ åˆ°å½“å‰ Runloop ä¸­    CFRunLoopRef runloop = [curRunLoop getCFRunLoop];    CFRunLoopAddObserver(runloop, beginObserver, kCFRunLoopCommonModes);    CFRunLoopAddObserver(runloop, endObserver, kCFRunLoopCommonModes);&#125;// ç¬¬ä¸€ä¸ªè§‚å¯Ÿè€…çš„å›è°ƒå‡½æ•°ï¼Œç›‘æ§ Runloop æ˜¯å¦å¤„äºè¿è¡ŒçŠ¶æ€void myRunLoopBeginCallback(CFRunLoopObserverRef observer, CFRunLoopActivity activity, void *info) &#123;    HangMonitor *monitor = (__bridge HangMonitor *)info;    g_runLoopActivity = activity;  // æ›´æ–°å…¨å±€å˜é‡ï¼Œè®°å½•å½“å‰çš„ Runloop æ´»åŠ¨çŠ¶æ€    g_runLoopMode = eRunloopDefaultMode;  // æ›´æ–°å…¨å±€å˜é‡ï¼Œè®°å½•å½“å‰çš„ Runloop æ¨¡å¼    switch (activity) &#123;        case kCFRunLoopEntry:            g_bRun = YES;  // æ ‡è®° Runloop è¿›å…¥è¿è¡ŒçŠ¶æ€            break;        case kCFRunLoopBeforeTimers:        case kCFRunLoopBeforeSources:        case kCFRunLoopAfterWaiting:            if (g_bRun == NO) &#123;                gettimeofday(&amp;g_tvRun, NULL);  // è®°å½• Runloop å¼€å§‹è¿è¡Œçš„æ—¶é—´            &#125;            g_bRun = YES;  // æ ‡è®° Runloop å¤„äºè¿è¡ŒçŠ¶æ€            break;        case kCFRunLoopAllActivities:            break;        default:            break;    &#125;    dispatch_semaphore_signal(monitor.semaphore);  // å‘é€ä¿¡å·é‡&#125;// ç¬¬äºŒä¸ªè§‚å¯Ÿè€…çš„å›è°ƒå‡½æ•°ï¼Œç›‘æ§ Runloop æ˜¯å¦å¤„äºç¡çœ çŠ¶æ€void myRunLoopEndCallback(CFRunLoopObserverRef observer, CFRunLoopActivity activity, void *info) &#123;    HangMonitor *monitor = (__bridge HangMonitor *)info;    g_runLoopActivity = activity;  // æ›´æ–°å…¨å±€å˜é‡ï¼Œè®°å½•å½“å‰çš„ Runloop æ´»åŠ¨çŠ¶æ€    g_runLoopMode = eRunloopDefaultMode;  // æ›´æ–°å…¨å±€å˜é‡ï¼Œè®°å½•å½“å‰çš„ Runloop æ¨¡å¼    switch (activity) &#123;        case kCFRunLoopBeforeWaiting:            gettimeofday(&amp;g_tvRun, NULL);  // è®°å½• Runloop è¿›å…¥ç¡çœ çŠ¶æ€çš„æ—¶é—´            g_bRun = NO;  // æ ‡è®° Runloop è¿›å…¥ç¡çœ çŠ¶æ€            break;        case kCFRunLoopExit:            g_bRun = NO;  // æ ‡è®° Runloop é€€å‡ºè¿è¡ŒçŠ¶æ€            break;        case kCFRunLoopAllActivities:            break;        default:            break;    &#125;    dispatch_semaphore_signal(monitor.semaphore);  // å‘é€ä¿¡å·é‡&#125;// å¯åŠ¨ç›‘æ§çš„æ–¹æ³•- (void)startMonitor &#123;    dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_HIGH, 0), ^&#123;        while (YES) &#123;            long result = dispatch_semaphore_wait(self.semaphore, dispatch_time(DISPATCH_TIME_NOW, self.timeoutInterval * NSEC_PER_SEC));            if (result != 0) &#123;                if (g_runLoopActivity == kCFRunLoopBeforeSources || g_runLoopActivity == kCFRunLoopAfterWaiting) &#123;                    [self logStackTrace];  // è®°å½•è°ƒç”¨æ ˆ                    [self reportHang];  // ä¸ŠæŠ¥å¡æ­»                &#125;            &#125;        &#125;    &#125;);&#125;// è®°å½•è°ƒç”¨æ ˆçš„æ–¹æ³•- (void)logStackTrace &#123;    void *callstack[128];    int frames = backtrace(callstack, 128);    char **strs = backtrace_symbols(callstack, frames);    NSMutableString *stackTrace = [NSMutableString stringWithString:@&quot;\\n&quot;];    for (int i = 0; i &lt; frames; i++) &#123;        [stackTrace appendFormat:@&quot;%s\\n&quot;, strs[i]];    &#125;    free(strs);    NSLog(@&quot;%@&quot;, stackTrace);&#125;// ä¸ŠæŠ¥å¡æ­»çš„æ–¹æ³•- (void)reportHang &#123;    // åœ¨è¿™é‡Œå®ç°ä¸ŠæŠ¥åå°åˆ†æçš„é€»è¾‘    NSLog(@&quot;æ£€æµ‹åˆ°å¡æ­»å´©æºƒï¼Œè¿›è¡Œä¸ŠæŠ¥&quot;);&#125;@end// ä¸»å‡½æ•°ï¼Œç¨‹åºå…¥å£int main(int argc, char * argv[]) &#123;    @autoreleasepool &#123;        HangMonitor *monitor = [HangMonitor sharedInstance];  // è·å– HangMonitor å•ä¾‹        return UIApplicationMain(argc, argv, nil, NSStringFromClass([AppDelegate class]));  // å¯åŠ¨åº”ç”¨ç¨‹åº    &#125;&#125;\nè¿™æ®µä»£ç ä¸­ HangMonitor ç±»ä¼šåœ¨ä¸»çº¿ç¨‹çš„ RunLoop æ´»åŠ¨ä¸­æ£€æµ‹æ˜¯å¦æœ‰é•¿æ—¶é—´çš„å¡é¡¿ï¼Œå¹¶åœ¨æ£€æµ‹åˆ°å¡é¡¿æ—¶è®°å½•è°ƒç”¨æ ˆå¹¶ä¸ŠæŠ¥åå°è¿›è¡Œåˆ†æã€‚è¶…æ—¶æ—¶é—´è®¾å®šä¸º 8 ç§’ï¼Œä»¥è¦†ç›–å¤§éƒ¨åˆ†ç”¨æˆ·æ„ŸçŸ¥åœºæ™¯å¹¶å‡å°‘æ€§èƒ½æŸè€—ã€‚\n","categories":["æ€§èƒ½ä¼˜åŒ–"],"tags":["æ€§èƒ½ä¼˜åŒ–","å¡é¡¿ç›‘æ§"]},{"title":"å¡é¡¿åŸå› ","url":"/2025/05/09/%E5%8D%A1%E9%A1%BF%E5%8E%9F%E5%9B%A0/","content":"æ¦‚è¿°iOSå¼€å‘ä¸­ï¼Œç”±äºUIKitçš„éçº¿ç¨‹å®‰å…¨æ€§ï¼Œæ‰€æœ‰UIæ“ä½œå¿…é¡»åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œã€‚ç³»ç»Ÿæ¯16msï¼ˆ1&#x2F;60å¸§ï¼‰é‡ç»˜UIè‡³å±å¹•ã€‚è‹¥ä¸»çº¿ç¨‹è¿›è¡Œè€—æ—¶æ“ä½œæˆ–å‘ç”Ÿæ­»é”ï¼Œä¼šé˜»ç¢UIåˆ·æ–°ï¼Œå¯¼è‡´å¡é¡¿ç”šè‡³å¡æ­»ã€‚ä¸»çº¿ç¨‹åŸºäºRunloopæœºåˆ¶å¤„ç†ä»»åŠ¡ï¼ŒRunloopæ”¯æŒå¤šç§äº‹ä»¶å›è°ƒï¼ŒåŒ…æ‹¬äº‹ä»¶è¿›å…¥ã€å¤„ç†å‰åç­‰æ—¶æœºã€‚è‹¥ä¸»çº¿ç¨‹åœ¨ä»»ä¸€ç¯èŠ‚è¢«é˜»å¡ï¼Œä¼šå¯¼è‡´UIå’Œäº¤äº’éƒ½æ— æ³•è¿›è¡Œï¼Œè¿™æ˜¯å¡æ­»ã€å¡é¡¿çš„æ ¹æœ¬åŸå› ã€‚\nçº¿ç¨‹å’Œé”çº¿ç¨‹å’Œé”çš„ä½¿ç”¨æ˜¯å¯¼è‡´å¡æ­»çš„ä¸»è¦åŸå› ï¼Œå¸¸è§é—®é¢˜åŒ…æ‹¬ï¼š\n\næ­»é”é—®é¢˜ï¼šå¦‚dispatch_onceä¸­åŒæ­¥è®¿é—®ä¸»çº¿ç¨‹å¯¼è‡´çš„æ­»é”ã€‚\né”ç«äº‰ï¼šå­çº¿ç¨‹å ç”¨é”èµ„æºå¯¼è‡´ä¸»çº¿ç¨‹å¡æ­»ã€‚\nç£ç›˜IOå¯†é›†ï¼šä¸»çº¿ç¨‹ç£ç›˜IOè€—æ—¶è¿‡é•¿ã€‚\nè·¨è¿›ç¨‹é€šä¿¡ï¼šå¦‚UIPasteBoardã€NSUserDefaultsç­‰å¯¼è‡´çš„å¡æ­»ã€‚\nOCæ–¹æ³•è°ƒç”¨æ­»é”ï¼šå¦‚dyld lockã€selector lockå’ŒOC runtime lockäº’ç›¸ç­‰å¾…ã€‚\n\nåŒæ­¥åŸè¯­åŒæ­¥åŸè¯­ï¼ˆsynchronization primitiveï¼‰ä¼šé˜»å¡è¯»å†™ä»»åŠ¡æ‰§è¡Œã€‚ä»¥ä¸‹æ˜¯iOSä¸­å¸¸ç”¨çš„ä¼šé˜»å¡è¯»å†™ä»»åŠ¡æ‰§è¡Œçš„åŒæ­¥åŸè¯­ï¼š\né”ï¼ˆLocksï¼‰\nNSLock\nåŸºæœ¬çš„äº’æ–¥é”ï¼Œç”¨äºä¿æŠ¤ä¸´ç•ŒåŒºï¼Œç¡®ä¿åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªçº¿ç¨‹è®¿é—®èµ„æºã€‚\nç¤ºä¾‹ï¼š\n\n  NSLock *lock = [[NSLock alloc] init];[lock lock];// è®¿é—®å…±äº«èµ„æº[lock unlock];\nNSRecursiveLock\né€’å½’é”ï¼Œå…è®¸åŒä¸€ä¸ªçº¿ç¨‹å¤šæ¬¡è·å–é”ï¼Œé€‚ç”¨äºéœ€è¦é€’å½’è°ƒç”¨çš„åœºæ™¯ã€‚\nç¤ºä¾‹ï¼š\n\n  NSRecursiveLock *recursiveLock = [[NSRecursiveLock alloc] init];[recursiveLock lock];// é€’å½’è®¿é—®å…±äº«èµ„æº[recursiveLock unlock];\nNSCondition\næ¡ä»¶é”ï¼Œç»“åˆäº’æ–¥é”å’Œæ¡ä»¶å˜é‡ï¼Œå¯ç”¨äºçº¿ç¨‹ä¹‹é—´çš„ç­‰å¾…å’Œé€šçŸ¥æœºåˆ¶ã€‚\nç¤ºä¾‹ï¼š\n\n  NSCondition *condition = [[NSCondition alloc] init];[condition lock];// ç­‰å¾…æŸä¸ªæ¡ä»¶[condition wait];// æ¡ä»¶æ»¡è¶³åç»§ç»­æ‰§è¡Œ[condition unlock];\nNSConditionLock\nå¸¦æœ‰æ¡ä»¶çš„é”ï¼Œå¯ä»¥åŸºäºæ¡ä»¶å€¼æ¥é”å®šå’Œè§£é”ã€‚\nç¤ºä¾‹ï¼š\n\n  NSConditionLock *conditionLock = [[NSConditionLock alloc] initWithCondition:0];[conditionLock lockWhenCondition:1];// è®¿é—®å…±äº«èµ„æº[conditionLock unlockWithCondition:0];\n\nGCDï¼ˆGrand Central Dispatchï¼‰\nä¿¡å·é‡ï¼ˆDispatch Semaphoreï¼‰\nç”¨äºæ§åˆ¶åŒæ—¶è®¿é—®ç‰¹å®šèµ„æºçš„çº¿ç¨‹æ•°é‡ï¼Œå¯ä»¥ç”¨äºå®ç°ç®€å•çš„é”æœºåˆ¶ã€‚\nç¤ºä¾‹ï¼š\n\n  let semaphore = DispatchSemaphore(value: 1)semaphore.wait()// è®¿é—®å…±äº«èµ„æºsemaphore.signal()\nå±éšœï¼ˆDispatch Barrierï¼‰\nç”¨äºåœ¨å¹¶å‘é˜Ÿåˆ—ä¸­åˆ›å»ºåŒæ­¥ç‚¹ï¼Œç¡®ä¿åœ¨å±éšœä¹‹å‰çš„ä»»åŠ¡å®Œæˆåï¼Œå†æ‰§è¡Œå±éšœä»»åŠ¡ï¼Œå±éšœä»»åŠ¡å®Œæˆåï¼Œæ‰ç»§ç»­æ‰§è¡Œåç»­ä»»åŠ¡ã€‚\nç¤ºä¾‹ï¼š\n\n  let concurrentQueue = DispatchQueue(label: &quot;com.example.queue&quot;, attributes: .concurrent)concurrentQueue.async(flags: .barrier) &#123;    // å†™æ“ä½œï¼Œç¡®ä¿ç‹¬å è®¿é—®&#125;\n\nPOSIX çº¿ç¨‹ï¼ˆpthreadï¼‰\nè¯»å†™é”ï¼ˆpthread_rwlock_tï¼‰\n\nå…è®¸å¤šä¸ªçº¿ç¨‹åŒæ—¶è¯»ï¼Œæˆ–è€…ä¸€ä¸ªçº¿ç¨‹å†™ï¼Œé€‚ç”¨äºè¯»å¤šå†™å°‘çš„åœºæ™¯ã€‚\nç¤ºä¾‹ï¼š\n\n  pthread_rwlock_t rwlock = PTHREAD_RWLOCK_INITIALIZER;// è¯»é”pthread_rwlock_rdlock(&amp;rwlock);// è¯»å–å…±äº«èµ„æºpthread_rwlock_unlock(&amp;rwlock);// å†™é”pthread_rwlock_wrlock(&amp;rwlock);// å†™å…¥å…±äº«èµ„æºpthread_rwlock_unlock(&amp;rwlock);\n\näº’æ–¥é”ï¼ˆpthread_mutex_tï¼‰\n\nåŸºæœ¬çš„äº’æ–¥é”ï¼Œç±»ä¼¼äºNSLockã€‚\nç¤ºä¾‹ï¼š\n\n  pthread_mutex_t mutex = PTHREAD_MUTEX_INITIALIZER;pthread_mutex_lock(&amp;mutex);// è®¿é—®å…±äº«èµ„æºpthread_mutex_unlock(&amp;mutex);\n\nObjective-C çš„ @synchronized æŒ‡ä»¤\n@synchronized\nè¯­æ³•ç³–ï¼Œç”¨äºåœ¨Objective-Cä¸­åˆ›å»ºäº’æ–¥é”ï¼Œä¿æŠ¤ä»£ç å—ã€‚\nç¤ºä¾‹ï¼š\n\n  @synchronized(self) &#123;    // è®¿é—®å…±äº«èµ„æº&#125;\n\nä½çº§é”\nos_unfair_lock\nä½çº§åˆ«çš„é”ï¼Œæ›¿ä»£äº†è¿‡æ—¶çš„OSSpinLockï¼Œé€‚ç”¨äºéœ€è¦é«˜æ€§èƒ½çš„é”åœºæ™¯ã€‚\nç¤ºä¾‹ï¼š\n\n  var unfairLock = os_unfair_lock()os_unfair_lock_lock(&amp;unfairLock)// è®¿é—®å…±äº«èµ„æºos_unfair_lock_unlock(&amp;unfairLock)\n\nåŸå­å±æ€§\nåŸå­æ€§å±æ€§ï¼ˆAtomic Propertiesï¼‰\nåœ¨Objective-Cä¸­ï¼Œé€šè¿‡è®¾ç½®å±æ€§ä¸ºatomicï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨ç”Ÿæˆçº¿ç¨‹å®‰å…¨çš„è®¿é—®å™¨ï¼Œå†…éƒ¨ä½¿ç”¨é”æœºåˆ¶ç¡®ä¿åŸå­æ€§ã€‚\nç¤ºä¾‹ï¼š\n\n  @property (atomic, strong) NSString *name;\n\né«˜å±‚æ¬¡æŠ½è±¡\nNSOperationQueue å’Œ æ“ä½œä¾èµ–ï¼ˆDependenciesï¼‰\nè™½ç„¶ä¸æ˜¯ç›´æ¥çš„é”æœºåˆ¶ï¼Œä½†é€šè¿‡è®¾ç½®æ“ä½œçš„ä¾èµ–å…³ç³»ï¼Œå¯ä»¥æ§åˆ¶ä»»åŠ¡çš„æ‰§è¡Œé¡ºåºï¼Œé—´æ¥å®ç°åŒæ­¥ã€‚\nç¤ºä¾‹ï¼š\n\n  NSOperationQueue *queue = [[NSOperationQueue alloc] init];NSOperation *op1 = [NSBlockOperation blockOperationWithBlock:^&#123;    // ä»»åŠ¡1&#125;];NSOperation *op2 = [NSBlockOperation blockOperationWithBlock:^&#123;    // ä»»åŠ¡2ï¼Œä¾èµ–ä»»åŠ¡1&#125;];[op2 addDependency:op1];[queue addOperations:@[op1, op2] waitUntilFinished:NO];\n\nSwift å¹¶å‘ï¼ˆSwift Concurrencyï¼‰\nActors\nåœ¨Swift 5.5åŠä»¥ä¸Šç‰ˆæœ¬ä¸­å¼•å…¥çš„Actoræ¨¡å‹ï¼Œç”¨äºä¿æŠ¤æ•°æ®ï¼Œç¡®ä¿åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªä»»åŠ¡å¯ä»¥è®¿é—®å…¶å†…éƒ¨çŠ¶æ€ã€‚\nç¤ºä¾‹ï¼š\n\n  actor MyActor &#123;    var value: Int = 0        func increment() &#123;        value += 1    &#125;&#125;let myActor = MyActor()Task &#123;    await myActor.increment()&#125;\n\nè¿™äº›åŒæ­¥åŸè¯­å„æœ‰ä¼˜ç¼ºç‚¹ï¼Œé€‰æ‹©åˆé€‚çš„åŒæ­¥æœºåˆ¶å–å†³äºå…·ä½“çš„åº”ç”¨åœºæ™¯ã€‚ä¾‹å¦‚ï¼Œpthread_rwlock_té€‚ç”¨äºè¯»å¤šå†™å°‘çš„æƒ…å†µï¼Œè€ŒNSLockæˆ–@synchronizedåˆ™é€‚ç”¨äºç®€å•çš„äº’æ–¥éœ€æ±‚ã€‚GCDçš„ä¿¡å·é‡å’Œå±éšœåˆ™æä¾›äº†æ›´é«˜å±‚æ¬¡çš„å¹¶å‘æ§åˆ¶æ‰‹æ®µã€‚\nCPU è´Ÿè½½CPU è´Ÿè½½è¿‡é‡ä¹Ÿä¼šå¯¼è‡´è€—æ—¶é•¿ï¼ŒCPUä¸»è¦è´Ÿè´£ç”¨æˆ·äº¤äº’çš„å¤„ç†ï¼Œå¦‚æœèƒ½å¤Ÿå°†è¿ç®—è½¬ç§»åˆ° GPU ä¸Šï¼ŒCPU å°±å¯ä»¥æ›´è½»æ¾çš„å¤„ç†æ¥è‡ªç”¨æˆ·çš„äº¤äº’ã€‚æ¯”å¦‚å¯ä»¥é€šè¿‡ä½¿ç”¨ CoreAnimation ä¸­ layer.cornerRadius å±æ€§å’Œ masksToBounds å±æ€§æ›¿ä»£åœ†è§’å›¾ç‰‡ã€ä½¿ç”¨ CoreGraphics ç»˜åˆ¶å›¾å½¢æ›¿ä»£å›¾ç‰‡ã€ä½¿ç”¨ CoreAnimation ç»˜åˆ¶åŠ¨ç”»æ›¿ä»£ UIView åŠ¨ç”»ç­‰æ–¹å¼ä¼˜åŒ–æ€§èƒ½ã€‚\nä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„æ–¹æ³•å’ŒæŠ€æœ¯ï¼Œå¯ä»¥åœ¨iOSä¸­å°†è®¡ç®—ä»»åŠ¡ä»CPUè½¬ç§»åˆ°GPUï¼š\nMetal æ¡†æ¶\nMetal æ˜¯è‹¹æœä¸ºiOSå’ŒmacOSæä¾›çš„åº•å±‚å›¾å½¢å’Œè®¡ç®—APIï¼Œå®ƒå…è®¸å¼€å‘è€…ç›´æ¥è®¿é—®GPUæ¥æ‰§è¡Œå›¾å½¢æ¸²æŸ“å’Œå¹¶è¡Œè®¡ç®—ä»»åŠ¡ã€‚\nä½¿ç”¨åœºæ™¯åŒ…æ‹¬ï¼š\næ¸²æŸ“3Då›¾å½¢ï¼šMetalæä¾›é«˜æ•ˆçš„å›¾å½¢æ¸²æŸ“åŠŸèƒ½ï¼Œæ¯”OpenGL ESæ›´é«˜æ•ˆã€‚\nå›¾åƒå¤„ç†ï¼šå¯ä»¥ä½¿ç”¨Metalç¼–å†™è‡ªå®šä¹‰ç€è‰²å™¨ï¼ˆShadersï¼‰è¿›è¡Œå®æ—¶å›¾åƒå¤„ç†ï¼Œå¦‚æ»¤é•œåº”ç”¨ã€è§†é¢‘å¤„ç†ç­‰ã€‚\nå¹¶è¡Œè®¡ç®—ï¼šé€šè¿‡Metalçš„è®¡ç®—ç®¡çº¿ï¼ˆCompute Pipelineï¼‰ï¼Œå¯ä»¥ç¼–å†™è®¡ç®—ç€è‰²å™¨ï¼ˆCompute Shadersï¼‰åœ¨GPUä¸Šæ‰§è¡Œå¤§é‡å¹¶è¡Œè®¡ç®—ä»»åŠ¡ï¼Œå¦‚ç‰©ç†æ¨¡æ‹Ÿã€æ•°æ®åˆ†æç­‰ã€‚\nç¤ºä¾‹ä»£ç ï¼š\n\n  // ä½¿ç”¨Metalè¿›è¡Œç®€å•çš„è®¡ç®—æ“ä½œlet device = MTLCreateSystemDefaultDevice()let commandQueue = device?.makeCommandQueue()let shaderLibrary = device?.makeDefaultLibrary()let computeFunction = shaderLibrary?.makeFunction(name: &quot;computeShader&quot;)let computePipelineState = try? device?.makeComputePipelineState(function: computeFunction!)\n\nCore Image\nCore Image æ˜¯ä¸€ä¸ªå¼ºå¤§çš„å›¾åƒå¤„ç†æ¡†æ¶ï¼Œå†…ç½®äº†è®¸å¤šä¼˜åŒ–çš„æ»¤é•œï¼ˆFiltersï¼‰ï¼Œå¹¶èƒ½å¤Ÿè‡ªåŠ¨å°†å›¾åƒå¤„ç†ä»»åŠ¡åˆ†é…åˆ°GPUä¸Šæ‰§è¡Œã€‚\né€šè¿‡Core Imageï¼Œä½ å¯ä»¥éå¸¸å®¹æ˜“åœ°è¿›è¡Œå›¾åƒå¢å¼ºã€æ»¤é•œåº”ç”¨ã€é¢éƒ¨è¯†åˆ«ç­‰ï¼Œè€Œè¿™äº›æ“ä½œéƒ½ä¼šå°½é‡åœ¨GPUä¸Šæ‰§è¡Œï¼Œä»¥å‡è½»CPUçš„è´Ÿæ‹…ã€‚\nç¤ºä¾‹ä»£ç ï¼š\n\nlet ciImage = CIImage(image: inputImage)let filter = CIFilter(name: &quot;CISepiaTone&quot;)filter?.setValue(ciImage, forKey: kCIInputImageKey)filter?.setValue(0.8, forKey: kCIInputIntensityKey)let outputImage = filter?.outputImage\n\nCore Animation\nCore Animation æ˜¯iOSçš„é«˜æ•ˆåŠ¨ç”»æ¡†æ¶ï¼Œå®ƒä¼šå°†å¤§éƒ¨åˆ†åŠ¨ç”»çš„æ‰§è¡Œè¿‡ç¨‹è‡ªåŠ¨è½¬ç§»åˆ°GPUä¸Šã€‚è¿™åŒ…æ‹¬è§†å›¾çš„å¹³ç§»ã€ç¼©æ”¾ã€æ—‹è½¬ã€æ·¡å…¥æ·¡å‡ºç­‰åŸºæœ¬åŠ¨ç”»æ•ˆæœã€‚\né€šè¿‡ä½¿ç”¨CALayerå’Œå„ç§åŠ¨ç”»å±æ€§ï¼ˆå¦‚positionã€transformç­‰ï¼‰ï¼Œä½ å¯ä»¥åˆ›å»ºå¹³æ»‘çš„åŠ¨ç”»ï¼Œè¿™äº›åŠ¨ç”»å°†åœ¨GPUä¸Šç¡¬ä»¶åŠ é€Ÿæ‰§è¡Œã€‚\nç¤ºä¾‹ä»£ç ï¼š\n\nlet layer = CALayer()layer.position = CGPoint(x: 100, y: 100)let animation = CABasicAnimation(keyPath: &quot;position&quot;)animation.toValue = CGPoint(x: 200, y: 200)animation.duration = 1.0layer.add(animation, forKey: &quot;positionAnimation&quot;)\n\nSpriteKit å’Œ SceneKit\nSpriteKit å’Œ SceneKit æ˜¯ä¸¤ä¸ªé«˜å±‚æ¬¡çš„æ¡†æ¶ï¼Œåˆ†åˆ«ç”¨äº2Då’Œ3Dæ¸¸æˆå¼€å‘ã€‚å®ƒä»¬å†…éƒ¨åˆ©ç”¨GPUè¿›è¡Œå›¾å½¢æ¸²æŸ“å’Œç‰©ç†æ¨¡æ‹Ÿï¼Œæå¤§åœ°å‡å°‘äº†CPUçš„è´Ÿæ‹…ã€‚\nSpriteKit ç”¨äº2Dæ¸¸æˆï¼Œå¯ä»¥é€šè¿‡ç®€å•çš„ä»£ç åˆ›å»ºå’Œæ¸²æŸ“å¤æ‚çš„åœºæ™¯ã€‚\nSceneKit ç”¨äº3Dæ¸¸æˆï¼Œæ”¯æŒå…‰ç…§ã€é˜´å½±ã€ç‰©ç†å¼•æ“ç­‰é«˜çº§ç‰¹æ€§ï¼Œè¿™äº›éƒ½åœ¨GPUä¸Šè¿›è¡Œè®¡ç®—ã€‚\nç¤ºä¾‹ä»£ç ï¼š\n\nlet scene = SKScene(size: CGSize(width: 1024, height: 768))let spriteNode = SKSpriteNode(imageNamed: &quot;Spaceship&quot;)spriteNode.position = CGPoint(x: scene.size.width/2, y: scene.size.height/2)scene.addChild(spriteNode)\n\nOpenGL ES\nè™½ç„¶OpenGL ESå·²ç»è¢«Metalå–ä»£ä¸ºä¸»è¦çš„å›¾å½¢APIï¼Œä½†å®ƒä»ç„¶å¯ä»¥ç”¨äºå°†å›¾å½¢æ¸²æŸ“ä»»åŠ¡è½¬ç§»åˆ°GPUä¸Šã€‚ä½¿ç”¨OpenGL ESï¼Œå¼€å‘è€…å¯ä»¥ç¼–å†™è‡ªå®šä¹‰ç€è‰²å™¨ï¼Œå¹¶åœ¨GPUä¸Šæ‰§è¡Œå›¾å½¢æ¸²æŸ“ã€‚\nç¤ºä¾‹ä»£ç ï¼š\n\n// åˆ›å»ºOpenGL ESä¸Šä¸‹æ–‡EAGLContext *context = [[EAGLContext alloc] initWithAPI:kEAGLRenderingAPIOpenGLES3];[EAGLContext setCurrentContext:context];\nCore Graphics (Quartz 2D)\nCore Graphics è™½ç„¶ä¸»è¦åœ¨CPUä¸Šæ‰§è¡Œï¼Œä½†æ˜¯åœ¨ä¸€äº›æƒ…å†µä¸‹ï¼Œç‰¹åˆ«æ˜¯å½“ä½¿ç”¨ç¡¬ä»¶åŠ é€Ÿçš„ç»˜å›¾æ“ä½œæ—¶ï¼ˆå¦‚åœ¨UIViewä¸Šè¿›è¡Œç»˜å›¾æ“ä½œï¼‰ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å°†éƒ¨åˆ†ç»˜å›¾æ“ä½œè½¬ç§»åˆ°GPUä¸Šã€‚\nCore Graphicsä¸»è¦ç”¨äºç»˜åˆ¶çŸ¢é‡å›¾å½¢ã€å¤„ç†å›¾åƒã€æ¸²æŸ“æ–‡æœ¬ç­‰ã€‚\n\nVideoToolbox\nVideoToolbox æ˜¯ä¸€ä¸ªç”¨äºç¡¬ä»¶åŠ é€Ÿçš„è§†é¢‘ç¼–ç ã€è§£ç çš„æ¡†æ¶ã€‚é€šè¿‡ä½¿ç”¨VideoToolboxï¼Œå¯ä»¥å°†è§†é¢‘ç¼–è§£ç ä»»åŠ¡è½¬ç§»åˆ°GPUä¸Šï¼Œä»è€Œå¤§å¤§å‡è½»CPUçš„å‹åŠ›ï¼Œå°¤å…¶åœ¨å¤„ç†é«˜æ¸…è§†é¢‘æ—¶æ•ˆæœæ˜¾è‘—ã€‚\nç¤ºä¾‹ä»£ç ï¼š\n\nvar videoSession: VTDecompressionSession?VTDecompressionSessionCreate(nil, formatDescription, nil, nil, nil, &amp;videoSession)\n\nAccelerate æ¡†æ¶\nAccelerate æ¡†æ¶åŒ…å«äº†ä¸€ç»„é«˜åº¦ä¼˜åŒ–çš„æ•°å­¦è®¡ç®—å‡½æ•°åº“ï¼ŒåŒ…æ‹¬å‘é‡è¿ç®—ã€çŸ©é˜µè¿ç®—ã€FFTï¼ˆå¿«é€Ÿå‚…é‡Œå¶å˜æ¢ï¼‰ç­‰ã€‚è™½ç„¶ä¸»è¦åœ¨CPUä¸Šè¿è¡Œï¼Œä½†åœ¨æŸäº›æƒ…å†µä¸‹ï¼ˆå¦‚ä½¿ç”¨vImageï¼‰ï¼Œå¯ä»¥é€šè¿‡Metal Performance Shaders (MPS)å°†éƒ¨åˆ†è®¡ç®—ä»»åŠ¡è½¬ç§»åˆ°GPUä¸Šã€‚\n\nç£ç›˜ IO è¿‡äºå¯†é›†ç£ç›˜ IO è¿‡äºå¯†é›†å¯èƒ½ä¼šå¯¼è‡´åº”ç”¨ç¨‹åºå¡é¡¿ï¼Œè¿™æ˜¯å› ä¸ºç£ç›˜æ“ä½œé€šå¸¸æ˜¯é˜»å¡æ€§çš„ï¼Œå°¤å…¶æ˜¯åœ¨è¯»å–æˆ–å†™å…¥å¤§é‡æ•°æ®æ—¶ã€‚ä¸ºäº†ç¼“è§£è¿™ä¸€é—®é¢˜ï¼Œå¯ä»¥å°†ç£ç›˜ IO æ“ä½œæ”¾åˆ°åå°çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œé¿å…é˜»å¡ä¸»çº¿ç¨‹ã€‚è¿™æ—¶ï¼ŒSwift Concurrency æŠ€æœ¯ï¼ˆå¦‚ async&#x2F;await å’Œ Taskï¼‰å¯ä»¥æ´¾ä¸Šç”¨åœºã€‚\nä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨ SwiftUI å’Œ Swift Concurrency å¤„ç†ç£ç›˜ IO çš„ç¤ºä¾‹ä»£ç ã€‚è¿™ä¸ªä¾‹å­å±•ç¤ºäº†å¦‚ä½•åœ¨åå°çº¿ç¨‹ä¸­æ‰§è¡Œç£ç›˜è¯»å–æ“ä½œï¼Œå¹¶å°†ç»“æœæ›´æ–°åˆ° UI ä¸Šã€‚\nimport SwiftUIstruct ContentView: View &#123;    @State private var data: String = &quot;Loading...&quot; // `data` ç”¨äºå­˜å‚¨ä»ç£ç›˜è¯»å–çš„æ•°æ®ï¼Œå¹¶åœ¨ UI ä¸­æ˜¾ç¤ºã€‚        var body: some View &#123;        VStack &#123;            Text(data)                .padding()            Button(&quot;Load Data&quot;) &#123;                loadData()            &#125;        &#125;    &#125;        func loadData() &#123;        // é€šè¿‡ `Task` åˆ›å»ºä¸€ä¸ªå¹¶å‘ä¸Šä¸‹æ–‡æ¥è¿è¡Œå¼‚æ­¥ä»£ç å—ã€‚åœ¨è¿™ä¸ªä»£ç å—ä¸­æ‰§è¡Œè€—æ—¶çš„ç£ç›˜ IO æ“ä½œã€‚        Task &#123;            // åœ¨åå°æ‰§è¡Œç£ç›˜ IO æ“ä½œ            let loadedData = await performDiskIO()            // åœ¨ä¸»çº¿ç¨‹æ›´æ–° UI            await MainActor.run &#123;                data = loadedData            &#125;        &#125;    &#125;        // æ¨¡æ‹Ÿä¸€ä¸ªç£ç›˜ IO æ“ä½œï¼Œå¯èƒ½æ˜¯ä»æ–‡ä»¶ä¸­è¯»å–å¤§æ•°æ®    func performDiskIO() async -&gt; String &#123;        // æ¨¡æ‹Ÿç£ç›˜æ“ä½œè€—æ—¶        try? await Task.sleep(nanoseconds: 2_000_000_000) // 2 seconds delay                // è¿™é‡Œå¯ä»¥è¿›è¡Œå®é™…çš„ç£ç›˜è¯»å–æ“ä½œ        // ä¾‹å¦‚è¯»å–æ–‡ä»¶å†…å®¹ï¼š        // let fileURL = ...        // let data = try? String(contentsOf: fileURL)                return &quot;Data Loaded Successfully!&quot;    &#125;&#125;@mainstruct DiskIOApp: App &#123;    var body: some Scene &#123;        WindowGroup &#123;            ContentView()        &#125;    &#125;&#125;\n\nè·¨è¿›ç¨‹é€šä¿¡å¯¼è‡´å¡é¡¿è¿›ç¨‹é—´é€šä¿¡ï¼ˆIPCï¼‰æ˜¯ä¸€ç§é‡è¦çš„æœºåˆ¶ï¼Œå®ƒå…è®¸ä¸åŒçš„è¿›ç¨‹æˆ–åº”ç”¨ç¨‹åºä¹‹é—´äº¤æ¢ä¿¡æ¯ã€‚ç„¶è€Œï¼ŒæŸäº›ç³»ç»ŸAPIçš„è°ƒç”¨å¯èƒ½ä¼šå¯¼è‡´å¡é¡¿æˆ–æ€§èƒ½é—®é¢˜ï¼Œç‰¹åˆ«æ˜¯åœ¨ä»¥ä¸‹å‡ ç§æƒ…å†µä¸‹ï¼š\nCNCopyCurrentNetworkInfo è·å– WiFi ä¿¡æ¯CNCopyCurrentNetworkInfo ç”¨äºè·å–å½“å‰çš„ WiFi ç½‘ç»œä¿¡æ¯ã€‚ç”±äºå®ƒæ¶‰åŠåˆ°ä¸ç³»ç»Ÿçš„ç½‘ç»œæœåŠ¡äº¤äº’ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜ï¼Œç‰¹åˆ«æ˜¯åœ¨é¢‘ç¹è°ƒç”¨æ—¶ã€‚\n#import &lt;SystemConfiguration/CaptiveNetwork.h&gt;NSDictionary *networkInfo = (__bridge NSDictionary *)CNCopyCurrentNetworkInfo((__bridge CFStringRef)@&quot;en0&quot;);NSLog(@&quot;Network Info: %@&quot;, networkInfo);\nåœ¨è·å– WiFi ä¿¡æ¯æ—¶ï¼Œå¦‚æœè°ƒç”¨é¢‘ç¹ï¼Œå¯èƒ½ä¼šå¯¹æ€§èƒ½äº§ç”Ÿè´Ÿé¢å½±å“ã€‚\nè®¾ç½®ç³»ç»Ÿé’¥åŒ™ä¸² (Keychain) ä¸­çš„å€¼é’¥åŒ™ä¸²ç”¨äºå­˜å‚¨æ•æ„Ÿæ•°æ®ï¼Œå¦‚å¯†ç ã€‚æ“ä½œé’¥åŒ™ä¸²é€šå¸¸æ¶‰åŠåŠ å¯†æ“ä½œï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´ä¸€å®šçš„æ€§èƒ½å¼€é”€ï¼Œç‰¹åˆ«æ˜¯åœ¨æ“ä½œè¾ƒå¤šæˆ–æ•°æ®è¾ƒå¤§æ—¶ã€‚\n#import &lt;Security/Security.h&gt;NSString *service = @&quot;com.example.myapp&quot;;NSString *account = @&quot;user@example.com&quot;;NSString *password = @&quot;password123&quot;;NSDictionary *query = @&#123;    (id)kSecClass: (id)kSecClassGenericPassword,    (id)kSecAttrService: service,    (id)kSecAttrAccount: account,    (id)kSecValueData: [password dataUsingEncoding:NSUTF8StringEncoding]&#125;;SecItemAdd((__bridge CFDictionaryRef)query, NULL); // æ·»åŠ æˆ–æ›´æ–°é’¥åŒ™ä¸²é¡¹\n\nNSUserDefaults è°ƒç”¨å†™æ“ä½œä½¿ç”¨ NSUserDefaults é€ æˆçš„è·¨è¿›ç¨‹é€šä¿¡å¯¼è‡´çš„å¡é¡¿ï¼Œå¯ä»¥ä½¿ç”¨ Swift Concurrency æ¥å®ç°ä¸€ä¸ªè½»é‡çº§çš„é”®å€¼å­˜å‚¨æ–¹æ¡ˆï¼Œåˆ©ç”¨ Swift çš„ async&#x2F;await æ¥å¤„ç†å¹¶å‘æ“ä½œã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨ Swift å’Œ SwiftUI çš„å¯è¿è¡Œç¤ºä¾‹ï¼Œå±•ç¤ºäº†å¦‚ä½•å®ç°å’Œä½¿ç”¨ä¸€ä¸ªåŸºäº Swift Concurrency çš„è½»é‡çº§é”®å€¼å­˜å‚¨ç±»ã€‚\nè½»é‡çº§ UserDefaults æ›¿ä»£å®ç°\nimport Foundation// `LightweightUserDefaults` ç±»æ˜¯ä¸€ä¸ª `actor`ï¼Œç”¨äºç¡®ä¿å…¶å†…éƒ¨çŠ¶æ€åœ¨å¹¶å‘ç¯å¢ƒä¸­æ˜¯å®‰å…¨çš„ã€‚`actor` ä¼šè‡ªåŠ¨å¤„ç†å¹¶å‘çš„è®¿é—®ï¼Œå› æ­¤ä¸éœ€è¦æ‰‹åŠ¨ä½¿ç”¨é”æˆ–é˜Ÿåˆ—ã€‚actor LightweightUserDefaults &#123;    private var storage: [String: Any] = [:]    func set(_ value: Any?, forKey key: String) async &#123;        if let value = value &#123;            storage[key] = value        &#125; else &#123;            storage.removeValue(forKey: key)        &#125;    &#125;    func value(forKey key: String) async -&gt; Any? &#123;        return storage[key]    &#125;    func removeValue(forKey key: String) async &#123;        storage.removeValue(forKey: key)    &#125;&#125;\nSwiftUI ç¤ºä¾‹\nimport SwiftUI// é€šè¿‡æŒ‰é’®è°ƒç”¨å¼‚æ­¥æ–¹æ³•å°†ç”¨æˆ·è¾“å…¥å­˜å‚¨ã€è¯»å–å’Œæ¸…é™¤åˆ°è‡ªå®šä¹‰çš„é”®å€¼å­˜å‚¨ç±»ä¸­ã€‚struct ContentView: View &#123;    @StateObject private var userDefaults = LightweightUserDefaultsWrapper()    @State private var inputText: String = &quot;&quot;    var body: some View &#123;        VStack(spacing: 20) &#123;            TextField(&quot;Enter some text&quot;, text: $inputText)                .textFieldStyle(RoundedBorderTextFieldStyle())                .padding()            Button(&quot;Save to Custom UserDefaults&quot;) &#123;                Task &#123;                    await userDefaults.save(inputText, forKey: &quot;userInput&quot;)                &#125;            &#125;            Button(&quot;Load from Custom UserDefaults&quot;) &#123;                Task &#123;                    if let loadedText = await userDefaults.load(forKey: &quot;userInput&quot;) as? String &#123;                        inputText = loadedText                    &#125;                &#125;            &#125;            Button(&quot;Clear Custom UserDefaults&quot;) &#123;                Task &#123;                    await userDefaults.clear(forKey: &quot;userInput&quot;)                &#125;            &#125;        &#125;        .padding()    &#125;&#125;// ç”¨äºä¸ SwiftUI çš„è§†å›¾ç»‘å®šï¼Œå¹¶åœ¨éœ€è¦æ—¶è°ƒç”¨å¼‚æ­¥çš„å­˜å‚¨å’Œè¯»å–æ“ä½œã€‚@MainActorclass LightweightUserDefaultsWrapper: ObservableObject &#123;    private let lightweightUserDefaults = LightweightUserDefaults()    func save(_ value: Any?, forKey key: String) async &#123;        await lightweightUserDefaults.set(value, forKey: key)    &#125;    func load(forKey key: String) async -&gt; Any? &#123;        return await lightweightUserDefaults.value(forKey: key)    &#125;    func clear(forKey key: String) async &#123;        await lightweightUserDefaults.removeValue(forKey: key)    &#125;&#125;@mainstruct MyApp: App &#123;    var body: some Scene &#123;        WindowGroup &#123;            ContentView()        &#125;    &#125;&#125;\n\nCLLocationManager è·å–å½“å‰ä½ç½®æƒé™çŠ¶æ€CLLocationManager ç”¨äºå®šä½æœåŠ¡ï¼Œå¦‚æœé¢‘ç¹è°ƒç”¨å®šä½æƒé™çŠ¶æ€çš„è·å–ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜ã€‚ç‰¹åˆ«æ˜¯åœ¨è·å–æƒé™çŠ¶æ€æ—¶ï¼Œç³»ç»Ÿä¼šè¿›è¡Œä¸€äº›é¢å¤–çš„æ“ä½œï¼Œè¿™å¯èƒ½ä¼šé€ æˆå¡é¡¿ã€‚\nCLLocationManager *locationManager = [[CLLocationManager alloc] init];CLAuthorizationStatus status = [CLLocationManager authorizationStatus];// è·å–å½“å‰çš„å®šä½æƒé™çŠ¶æ€\né¢‘ç¹è°ƒç”¨ authorizationStatus å¯èƒ½å¯¼è‡´æ€§èƒ½é—®é¢˜ï¼Œç‰¹åˆ«æ˜¯å½“åº”ç”¨åœ¨è¿›è¡Œå®šä½ç›¸å…³çš„æ“ä½œæ—¶ã€‚\nUIPasteboard è®¾ç½®å’Œè·å–å€¼UIPasteboard ç”¨äºå®ç°å‰ªè´´æ¿åŠŸèƒ½ï¼Œè¯»å–å’Œå†™å…¥å‰ªè´´æ¿æ•°æ®å¯èƒ½ä¼šæ¶‰åŠåˆ° IPC æ“ä½œã€‚å¦‚æœæ“ä½œè¿‡äºé¢‘ç¹æˆ–æ•°æ®è¿‡å¤§ï¼Œå¯èƒ½ä¼šå¯¼è‡´å¡é¡¿ã€‚\nUIPasteboard *pasteboard = [UIPasteboard generalPasteboard];pasteboard.string = @&quot;SomeString&quot;; // è®¾ç½®å‰ªè´´æ¿å†…å®¹NSString *clipboardContent = pasteboard.string; // è·å–å‰ªè´´æ¿å†…å®¹\n\nUIApplication é€šè¿‡ openURL æ‰“å¼€å…¶ä»–åº”ç”¨ä½¿ç”¨ UIApplication çš„ openURL: æ–¹æ³•å¯ä»¥æ‰“å¼€å…¶ä»–åº”ç”¨ç¨‹åºã€‚å¦‚æœè°ƒç”¨é¢‘ç¹æˆ–ç›®æ ‡åº”ç”¨å¤„ç†æ…¢ï¼Œå¯èƒ½ä¼šå¯¼è‡´å¡é¡¿ã€‚\nNSURL *url = [NSURL URLWithString:@&quot;myapp://&quot;];[[UIApplication sharedApplication] openURL:url options:@&#123;&#125; completionHandler:^(BOOL success) &#123;    if (success) &#123;        NSLog(@&quot;Opened URL successfully&quot;);    &#125; else &#123;        NSLog(@&quot;Failed to open URL&quot;);    &#125;&#125;];\nå¦‚æœç›®æ ‡åº”ç”¨çš„å“åº”æ—¶é—´è¾ƒé•¿ï¼Œå¯èƒ½ä¼šå½±å“å½“å‰åº”ç”¨çš„æµç•…åº¦ã€‚\n","categories":["æ€§èƒ½ä¼˜åŒ–"],"tags":["æ€§èƒ½ä¼˜åŒ–","å¡é¡¿ç›‘æ§"]},{"title":"æ€§èƒ½åˆ†æ","url":"/2025/05/14/%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90/","content":"æ€§èƒ½åˆ†æ-å·¥å…·å¼€æºå·¥å…·\nFLEX (Flipboard Explorer) æ˜¯ä¸€ä¸ªéå¸¸å—æ¬¢è¿çš„å¼€æº iOS å†…éƒ¨å·¥å…·ï¼Œæä¾›äº†å¼ºå¤§çš„ UIï¼Œå…è®¸å¼€å‘è€…åœ¨è¿è¡Œæ—¶æ£€æŸ¥åº”ç”¨çš„è§†å›¾å±‚æ¬¡ç»“æ„ã€ç½‘ç»œè¯·æ±‚ã€æ•°æ®åº“ã€ç”¨æˆ·åå¥½è®¾ç½®ç­‰ã€‚é€‚åˆå¼€å‘è€…åœ¨åº”ç”¨å†…å®æ—¶è°ƒè¯•å’Œæ£€æŸ¥æ€§èƒ½é—®é¢˜ã€‚\nXCTest XCTest æ˜¯ Apple å®˜æ–¹çš„å•å…ƒæµ‹è¯•æ¡†æ¶ï¼Œæ”¯æŒæ€§èƒ½æµ‹è¯•ã€‚å¼€å‘è€…å¯ä»¥é€šè¿‡ measure æ–¹æ³•æ¥è¡¡é‡ä»£ç å—çš„æ‰§è¡Œæ—¶é—´ï¼Œä»è€Œå‘ç°æ€§èƒ½ç“¶é¢ˆã€‚é€‚åˆéœ€è¦åœ¨å•å…ƒæµ‹è¯•ä¸­æ·»åŠ æ€§èƒ½æµ‹è¯•çš„åœºæ™¯ã€‚\nKSCrash KSCrash æ˜¯ä¸€ä¸ªå¼ºå¤§çš„å´©æºƒæŠ¥å‘Šæ¡†æ¶ï¼Œå®ƒä¸ä»…èƒ½å¤Ÿæ•è·å´©æºƒä¿¡æ¯ï¼Œè¿˜èƒ½æä¾›åº”ç”¨ç¨‹åºçš„æ€§èƒ½æ•°æ®ï¼Œä¾‹å¦‚å†…å­˜ä½¿ç”¨å’Œ CPU ä½¿ç”¨æƒ…å†µã€‚é€‚åˆéœ€è¦æ·±å…¥äº†è§£å´©æºƒåŸå› å¹¶ç›‘æ§ç›¸å…³æ€§èƒ½æ•°æ®çš„åœºæ™¯ã€‚\nGT (GDT, GodEye) GodEye æ˜¯ä¸€ä¸ªå¼€æºçš„ iOS æ€§èƒ½ç›‘æ§å·¥å…·åŒ…ï¼Œæä¾›äº†å¤šç§ç›‘æ§åŠŸèƒ½ï¼ŒåŒ…æ‹¬ FPSã€å†…å­˜ä½¿ç”¨ã€CPU ä½¿ç”¨ç‡ã€ç½‘ç»œè¯·æ±‚ã€å´©æºƒæ—¥å¿—ç­‰ã€‚å®ƒæœ‰ä¸€ä¸ªæ–¹ä¾¿çš„ UIï¼Œå¯ä»¥å®æ—¶æ˜¾ç¤ºæ€§èƒ½æ•°æ®ã€‚é€‚åˆåœ¨å¼€å‘è¿‡ç¨‹ä¸­åµŒå…¥åº”ç”¨è¿›è¡Œå®æ—¶æ€§èƒ½ç›‘æ§ã€‚\nlibimobiledevice libimobiledevice æ˜¯ä¸€ä¸ªå¼€æºçš„åº“ï¼Œæä¾›äº†ä¸ iOS è®¾å¤‡äº¤äº’çš„ APIï¼Œå¯ä»¥ç”¨æ¥ç›‘æ§è®¾å¤‡çŠ¶æ€å’Œæ€§èƒ½ï¼Œç‰¹åˆ«æ˜¯å¯¹éè¶Šç‹±è®¾å¤‡è¿›è¡Œæ“ä½œã€‚\n\nInstrumentsInstruments æ˜¯ Xcode è‡ªå¸¦çš„ä¸€æ¬¾å¼ºå¤§çš„æ€§èƒ½åˆ†æå’Œè°ƒè¯•å·¥å…·ï¼Œå¹¿æ³›ç”¨äº iOS åº”ç”¨çš„æ€§èƒ½ç›‘æµ‹å’Œé—®é¢˜æ’æŸ¥ã€‚\næ‰“å¼€ Xcode é¡¹ç›®ï¼Œé€‰æ‹© Product &gt; Profileï¼Œæˆ–è€…ä½¿ç”¨å¿«æ·é”® Command + Iã€‚è¿™ä¼šç¼–è¯‘å¹¶å¯åŠ¨åº”ç”¨ï¼Œç„¶åæ‰“å¼€ Instruments ç•Œé¢ã€‚ä½ ä¹Ÿå¯ä»¥ç›´æ¥ä» Xcode ä¸­é€‰æ‹© Xcode &gt; Open Developer Tool &gt; Instruments å¯åŠ¨ Instrumentsã€‚\nInstruments æä¾›äº†å¤šç§æ¨¡æ¿ï¼Œæ¯ä¸ªæ¨¡æ¿ç”¨äºä¸åŒç±»å‹çš„æ€§èƒ½åˆ†æã€‚å¸¸ç”¨çš„æ¨¡æ¿æœ‰ï¼š\n\nTime Profilerï¼šç”¨äºåˆ†æ CPU ä½¿ç”¨æƒ…å†µï¼Œæ‰¾å‡ºæ€§èƒ½ç“¶é¢ˆã€‚\nAllocationsï¼šç›‘æ§å†…å­˜åˆ†é…ï¼Œå¸®åŠ©è¯†åˆ«å†…å­˜æ³„æ¼å’Œè¿‡åº¦ä½¿ç”¨ã€‚\nLeaksï¼šæ£€æµ‹å†…å­˜æ³„æ¼ã€‚\nCore Animationï¼šåˆ†æåº”ç”¨çš„åŠ¨ç”»æ€§èƒ½ï¼Œæ‰¾å‡ºå¯¼è‡´æ‰å¸§çš„åŸå› ã€‚\nEnergy Logï¼šè¯„ä¼°åº”ç”¨çš„èƒ½è€—è¡¨ç°ã€‚\n\nå½“åº”ç”¨è¿è¡Œæ—¶ï¼Œæ­£å¸¸ä½¿ç”¨å®ƒæˆ–æ‰§è¡Œä½ éœ€è¦åˆ†æçš„ç‰¹å®šæ“ä½œã€‚Instruments å°†è®°å½•è¿™äº›æ“ä½œæœŸé—´çš„æ€§èƒ½æ•°æ®ã€‚ç‚¹å‡» Record æŒ‰é’®ï¼ˆé€šå¸¸æ˜¯çº¢è‰²åœ†ç‚¹ï¼‰ï¼Œå¼€å§‹è®°å½•æ•°æ®ã€‚å®Œæˆåï¼Œç‚¹å‡» Stop æŒ‰é’®åœæ­¢è®°å½•ã€‚Instruments ä¼šç”Ÿæˆä¸€ä¸ªæ—¶é—´è½´ï¼Œå±•ç¤ºåº”ç”¨åœ¨è¿è¡ŒæœŸé—´çš„å„ç§æ€§èƒ½æ•°æ®ã€‚ä½ å¯ä»¥é€šè¿‡æ‹–åŠ¨æ—¶é—´è½´ï¼Œæ”¾å¤§æˆ–ç¼©å°æŸæ®µæ—¶é—´èŒƒå›´å†…çš„æ•°æ®ã€‚\nç»†èŠ‚åˆ†æï¼š\n\nCPU ä½¿ç”¨æƒ…å†µï¼šä½¿ç”¨ Time Profiler æŸ¥çœ‹å‡½æ•°è°ƒç”¨æ ˆï¼Œè¯†åˆ«æ€§èƒ½ç“¶é¢ˆã€‚\nå†…å­˜ä½¿ç”¨æƒ…å†µï¼šä½¿ç”¨ Allocations æˆ– Leaks æŸ¥çœ‹å¯¹è±¡åˆ†é…æƒ…å†µï¼Œåˆ†æå†…å­˜æ³„æ¼å’Œä¸å½“çš„å†…å­˜ä½¿ç”¨ã€‚\nå¸§ç‡åˆ†æï¼šä½¿ç”¨ Core Animation æ£€æŸ¥åº”ç”¨çš„å¸§ç‡ï¼ŒæŸ¥æ‰¾å¯¼è‡´æ‰å¸§çš„æ“ä½œã€‚\n\nä½ å¯ä»¥åœ¨å…³é”®ç‚¹æ·»åŠ æ ‡è®°ï¼ˆMarkï¼‰ï¼Œå¸®åŠ©æ›´å®¹æ˜“åœ°å®šä½å’Œåˆ†æé—®é¢˜ã€‚\nSystem TraceSystem Trace æ˜¯ä¸€ä¸ªå¼ºå¤§çš„å·¥å…·ï¼Œå¯ä»¥å¸®åŠ©ä½ æ·±å…¥åˆ†æå’Œè§£å†³æ€§èƒ½é—®é¢˜ã€‚System Trace æ˜¯ Xcode Instruments ä¸­çš„ä¸€ä¸ªæ¨¡æ¿ï¼Œå®ƒæä¾›äº†å…³äºç³»ç»Ÿæ€§èƒ½çš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬ CPU ä½¿ç”¨æƒ…å†µã€çº¿ç¨‹æ´»åŠ¨ã€ç³»ç»Ÿè°ƒç”¨ã€åˆ†é¡µé”™è¯¯ã€I&#x2F;O æ¥å£ä¿¡æ¯ç­‰ï¼Œç”šè‡³åŒ…æ‹¬è¿›ç¨‹å†…ä»¥åŠè¿›ç¨‹é—´çš„æƒ…å†µã€‚ä»¥ä¸‹æ˜¯ System Trace çš„ä½¿ç”¨æ–¹æ³•ï¼š\næ­¥éª¤ä¸€ï¼šå‡†å¤‡å·¥ä½œ\n\nç¡®ä¿ Xcode å’Œè®¾å¤‡å‡†å¤‡å¥½ï¼šç¡®ä¿ä½ å·²ç»å®‰è£…äº†æœ€æ–°ç‰ˆæœ¬çš„ Xcodeï¼Œå¹¶å°† iOS è®¾å¤‡è¿æ¥åˆ°ä½ çš„ Macã€‚\næ‰“å¼€ Xcode Instrumentsï¼šåœ¨ Xcode ä¸­é€‰æ‹© Product &gt; Profileï¼Œæˆ–è€…ç›´æ¥åœ¨ Finder ä¸­æ‰“å¼€ Instruments åº”ç”¨ã€‚\n\næ­¥éª¤äºŒï¼šé€‰æ‹© System Trace æ¨¡æ¿\n\né€‰æ‹©æ¨¡æ¿ï¼šåœ¨ Instruments ä¸­ï¼Œæ‰“å¼€â€œé€‰æ‹©æ¨¡æ¿â€çª—å£ï¼Œé€‰æ‹© System Trace æ¨¡æ¿ã€‚\nè¿æ¥è®¾å¤‡ï¼šé€‰æ‹©ä½ è¦åˆ†æçš„ iOS è®¾å¤‡ï¼Œç¡®ä¿è®¾å¤‡å¤„äºè°ƒè¯•æ¨¡å¼å¹¶å·²è¿æ¥ã€‚\n\næ­¥éª¤ä¸‰ï¼šå¼€å§‹è®°å½•\n\nå¯åŠ¨è®°å½•ï¼šç‚¹å‡»çº¢è‰²çš„è®°å½•æŒ‰é’®ï¼Œå¼€å§‹é‡‡é›†æ•°æ®ã€‚è¿è¡Œä½ çš„åº”ç”¨ç¨‹åºï¼Œå¹¶é‡ç°å¡é¡¿æˆ–æ€§èƒ½é—®é¢˜ã€‚\nç»“æŸè®°å½•ï¼šå½“ä½ æ•è·åˆ°é—®é¢˜æˆ–å®Œæˆæµ‹è¯•åï¼Œç‚¹å‡»åœæ­¢æŒ‰é’®åœæ­¢è®°å½•ã€‚\n\næ­¥éª¤å››ï¼šåˆ†ææ•°æ®\n\næŸ¥çœ‹æ—¶é—´çº¿ï¼šSystem Trace ä¼šç”Ÿæˆä¸€ä¸ªæ—¶é—´çº¿è§†å›¾ï¼Œå…¶ä¸­åŒ…æ‹¬ CPU ä½¿ç”¨æƒ…å†µã€çº¿ç¨‹æ´»åŠ¨ã€ç¡¬ä»¶ä¸­æ–­ç­‰ã€‚ä½ å¯ä»¥é€šè¿‡ç¼©æ”¾å’Œæ»šåŠ¨æ¥æŸ¥çœ‹ä¸åŒæ—¶é—´ç‚¹çš„è¯¦ç»†ä¿¡æ¯ã€‚\nåˆ†æçº¿ç¨‹æ´»åŠ¨ï¼šæŸ¥çœ‹å“ªäº›çº¿ç¨‹åœ¨ç‰¹å®šæ—¶é—´æ®µå†…å ç”¨äº†å¤§é‡ CPU èµ„æºï¼Œæ‰¾å‡ºæ˜¯å¦å­˜åœ¨é•¿æ—¶é—´è¿è¡Œçš„ä»»åŠ¡æˆ–æ­»é”ã€‚\næŸ¥çœ‹å†…æ ¸äº‹ä»¶ï¼šSystem Trace è¿˜ä¼šæ˜¾ç¤ºå†…æ ¸ç›¸å…³çš„äº‹ä»¶ï¼Œå¦‚ä¸­æ–­å¤„ç†å’Œå†…å­˜ç®¡ç†ï¼Œè¿™å¯¹äºæ·±å…¥åˆ†æç³»ç»Ÿçº§é—®é¢˜éå¸¸æœ‰å¸®åŠ©ã€‚\næ ‡è®°å’Œè¿‡æ»¤ï¼šä½¿ç”¨æ ‡è®°å’Œè¿‡æ»¤åŠŸèƒ½ï¼Œä¸“æ³¨äºç‰¹å®šæ—¶é—´æ®µæˆ–çº¿ç¨‹ï¼Œä»¥æ›´å®¹æ˜“åœ°è¯†åˆ«é—®é¢˜ã€‚\n\næ­¥éª¤äº”ï¼šä¼˜åŒ–å’Œè°ƒè¯•\n\nè¯†åˆ«é—®é¢˜ä»£ç ï¼šæ ¹æ®åˆ†æç»“æœï¼Œæ‰¾åˆ°å¯èƒ½å¯¼è‡´å¡é¡¿çš„ä»£ç æ®µï¼ŒæŸ¥çœ‹æ˜¯å¦æœ‰å¯ä»¥ä¼˜åŒ–çš„éƒ¨åˆ†ã€‚\nä¿®æ”¹ä»£ç å¹¶é‡æ–°æµ‹è¯•ï¼šä¿®æ”¹ä»£ç åï¼Œé‡æ–°è¿è¡Œ System Trace æ¥éªŒè¯ä¼˜åŒ–æ˜¯å¦è§£å†³äº†æ€§èƒ½é—®é¢˜ã€‚\n\næ­¥éª¤å…­ï¼šç”ŸæˆæŠ¥å‘Š\n\nä¿å­˜å’Œåˆ†äº«ï¼šä½ å¯ä»¥å°† System Trace ç”Ÿæˆçš„åˆ†ææ•°æ®å¯¼å‡ºä¸º .trace æ–‡ä»¶ï¼Œæ–¹ä¾¿å…±äº«æˆ–è¿›ä¸€æ­¥åˆ†æã€‚\nå¯¹æ¯”åˆ†æï¼šå¯ä»¥å¤šæ¬¡è¿è¡Œ System Traceï¼Œæ¯”è¾ƒä¼˜åŒ–å‰åçš„æ•°æ®ï¼Œç¡®ä¿æ€§èƒ½å¾—åˆ°æ”¹å–„ã€‚\n\nMetricKitåŸºæœ¬ä½¿ç”¨MetricKit å…è®¸å¼€å‘è€…æ”¶é›†å’Œåˆ†æä¸åº”ç”¨ç¨‹åºæ€§èƒ½ã€å´©æºƒã€åŠŸè€—ç­‰ç›¸å…³çš„å…³é”®æŒ‡æ ‡ã€‚ä»¥ä¸‹æ˜¯ä½¿ç”¨ MetricKit çš„æ–¹æ³•ï¼š\né¦–å…ˆï¼Œåœ¨ä½ çš„é¡¹ç›®ä¸­å¯¼å…¥ MetricKit æ¡†æ¶ï¼š\nimport MetricKit\nåˆ›å»ºä¸€ä¸ª MXMetricManager çš„å®ä¾‹ï¼Œå®ƒæ˜¯æ”¶é›†æŒ‡æ ‡æ•°æ®çš„ä¸»è¦æ¥å£ã€‚\nlet metricManager = MXMetricManager.shared\næ³¨å†Œ Metrics ç®¡ç†å™¨\nä½ éœ€è¦è®©ä½ çš„ç±»ï¼ˆé€šå¸¸æ˜¯ AppDelegate æˆ–å…¶ä»–é€‚åˆçš„å•ä¾‹ç±»ï¼‰éµå¾ª MXMetricManagerSubscriber åè®®ï¼Œå¹¶æ³¨å†Œä¸º MXMetricManager çš„è®¢é˜…è€…ã€‚\nclass AppDelegate: UIResponder, UIApplicationDelegate, MXMetricManagerSubscriber &#123;    func application(_ application: UIApplication,                     didFinishLaunchingWithOptions launchOptions: [UIApplication.LaunchOptionsKey: Any]?) -&gt; Bool &#123;        MXMetricManager.shared.add(self)        return true    &#125;    // å¤„ç† Metrics æ•°æ®    func didReceive(_ payloads: [MXMetricPayload]) &#123;        for payload in payloads &#123;            // å¤„ç†æ¥æ”¶åˆ°çš„ Metrics æ•°æ®            print(&quot;Received metrics payload: \\(payload)&quot;)        &#125;    &#125;        // å¤„ç†å´©æºƒè¯Šæ–­æ•°æ®    func didReceive(_ payloads: [MXCrashDiagnosticPayload]) &#123;        for payload in payloads &#123;            // å¤„ç†æ¥æ”¶åˆ°çš„å´©æºƒè¯Šæ–­æ•°æ®            print(&quot;Received crash diagnostics payload: \\(payload)&quot;)        &#125;    &#125;&#125;\nåˆ†æå’Œå­˜å‚¨æŒ‡æ ‡æ•°æ®\nMXMetricPayload åŒ…å«äº†å¤šç§æŒ‡æ ‡æ•°æ®ï¼Œå¦‚ CPU ä½¿ç”¨ç‡ã€å†…å­˜ä½¿ç”¨æƒ…å†µã€ç½‘ç»œæµé‡ç­‰ã€‚ä½ å¯ä»¥éå†è¿™äº›æ•°æ®ï¼Œå­˜å‚¨æˆ–å‘é€åˆ°ä½ çš„åç«¯è¿›è¡Œè¿›ä¸€æ­¥åˆ†æã€‚\nfunc didReceive(_ payloads: [MXMetricPayload]) &#123;    for payload in payloads &#123;        if let cpuMetrics = payload.cpuMetrics &#123;            print(&quot;CPU Usage: \\(cpuMetrics)&quot;)        &#125;                if let memoryMetrics = payload.memoryMetrics &#123;            print(&quot;Memory Usage: \\(memoryMetrics)&quot;)        &#125;                if let networkMetrics = payload.networkTransferMetrics &#123;            print(&quot;Network Usage: \\(networkMetrics)&quot;)        &#125;                // ä½ å¯ä»¥å°†è¿™äº›æ•°æ®ä¿å­˜åˆ°æ–‡ä»¶æˆ–å‘é€åˆ°æœåŠ¡å™¨    &#125;&#125;\nå¤„ç†å´©æºƒè¯Šæ–­æ•°æ®\nMetricKit ä¹Ÿå¯ä»¥æ”¶é›†åº”ç”¨çš„å´©æºƒè¯Šæ–­ä¿¡æ¯ï¼Œæ–¹ä¾¿ä½ è¿½è¸ªå’Œè§£å†³å´©æºƒé—®é¢˜ã€‚\nfunc didReceive(_ payloads: [MXCrashDiagnosticPayload]) &#123;    for payload in payloads &#123;        // å¤„ç†å´©æºƒè¯Šæ–­æ•°æ®        if let diagnostics = payload.crashDiagnostics &#123;            for diagnostic in diagnostics &#123;                print(&quot;Crash Diagnostic: \\(diagnostic)&quot;)            &#125;        &#125;    &#125;&#125;\nä» Metric Manager ç§»é™¤è®¢é˜…è€…\nå¦‚æœä½ ä¸å†éœ€è¦æ”¶é›†æŒ‡æ ‡æ•°æ®ï¼Œå¯ä»¥ä» MXMetricManager ä¸­ç§»é™¤ä½ çš„è®¢é˜…è€…ã€‚\nMXMetricManager.shared.remove(self)\nMXMetricManager åªåœ¨å®é™…è®¾å¤‡ä¸Šè¿è¡Œæ—¶æ‰ä¼šæ”¶é›†æ•°æ®ï¼Œæ¨¡æ‹Ÿå™¨ä¸­ä¸ä¼šç”Ÿæˆæœ‰æ•ˆçš„æ•°æ®ã€‚MetricKit æ•°æ®çš„æ”¶é›†æ˜¯å¼‚æ­¥çš„ï¼Œä¸”ç³»ç»Ÿä¼šè‡ªåŠ¨å†³å®šä½•æ—¶å‘é€æ•°æ®ç»™ä½ çš„åº”ç”¨ï¼Œæ‰€ä»¥ä½ ä¸ä¼šç«‹å³æ”¶åˆ°æ•°æ®ã€‚æ•°æ®çš„ä¿ç•™æœŸè¾ƒçŸ­ï¼ŒApple å»ºè®®å°½å¿«å¤„ç†å’Œå­˜å‚¨æ¥æ”¶åˆ°çš„æŒ‡æ ‡æ•°æ®ã€‚\nè‡ªå®šä¹‰å’Œæ”¶é›†ç‰¹å®šçš„åº”ç”¨æŒ‡æ ‡è™½ç„¶ MetricKit æœ¬èº«ä¸»è¦æä¾›äº†ä¸€ç»„é¢„å®šä¹‰çš„æŒ‡æ ‡ï¼Œå¦‚å¯åŠ¨æ—¶é—´ã€CPU ä½¿ç”¨ç‡ã€å†…å­˜ä½¿ç”¨æƒ…å†µç­‰ï¼Œä½†ä½ ä¹Ÿå¯ä»¥é€šè¿‡ç»“åˆå…¶ä»–æŠ€æœ¯æ‰‹æ®µæ¥è‡ªå®šä¹‰å’Œæ”¶é›†ç‰¹å®šçš„åº”ç”¨æŒ‡æ ‡ã€‚\næ€è·¯\n\nåˆ©ç”¨ç°æœ‰çš„ MetricKit æŒ‡æ ‡ï¼š å¦‚æœä½ çš„è‡ªå®šä¹‰æŒ‡æ ‡èƒ½å¤Ÿä¸ MetricKit æä¾›çš„ç°æœ‰æŒ‡æ ‡å…³è”ï¼Œæœ€å¥½ä¼˜å…ˆåˆ©ç”¨è¿™äº›æŒ‡æ ‡ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥åˆ©ç”¨ MXAppLaunchMetric æ¥æµ‹é‡ç‰¹å®šåœºæ™¯ä¸‹çš„å¯åŠ¨æ—¶é—´ã€‚\nç»“åˆæ—¥å¿—ç³»ç»Ÿï¼ˆå¦‚ os_logï¼‰ï¼š ä½ å¯ä»¥é€šè¿‡ os_log ç³»ç»Ÿè®°å½•ç‰¹å®šçš„è‡ªå®šä¹‰äº‹ä»¶å’Œæ•°æ®ï¼Œç„¶ååœ¨ MXLogHandle æä¾›çš„æ—¥å¿—ä¸­åˆ†æè¿™äº›è‡ªå®šä¹‰æŒ‡æ ‡ã€‚è™½ç„¶è¿™ä¸æ˜¯ç›´æ¥é€šè¿‡ MetricKit è®°å½•ï¼Œä½†ä½ å¯ä»¥é€šè¿‡è¿™äº›æ—¥å¿—ç”Ÿæˆè‡ªå®šä¹‰æŠ¥å‘Šã€‚\nä½¿ç”¨ç¬¬ä¸‰æ–¹å·¥å…·æˆ–åº“ï¼š å¦‚æœ MetricKit æ— æ³•æ»¡è¶³éœ€æ±‚ï¼Œå¯ä»¥ä½¿ç”¨å…¶ä»–åˆ†æå·¥å…·æˆ–åº“æ¥æ”¶é›†å’Œå‘é€è‡ªå®šä¹‰æŒ‡æ ‡ï¼Œä¾‹å¦‚ Firebase Analytics æˆ– Amplitudeã€‚\nè‡ªå®šä¹‰ä»£ç å®ç°ï¼š ä½ å¯ä»¥åœ¨åº”ç”¨ä¸­è‡ªè¡Œç¼–å†™ä»£ç ï¼Œå®šæœŸæ”¶é›†å¹¶è®°å½•è‡ªå®šä¹‰æŒ‡æ ‡æ•°æ®ï¼Œç„¶åé€šè¿‡ç½‘ç»œè¯·æ±‚æˆ–å…¶ä»–æ–¹å¼å°†å…¶å‘é€åˆ°åç«¯æœåŠ¡å™¨è¿›è¡Œåˆ†æã€‚å‡è®¾ä½ æƒ³è‡ªå®šä¹‰ä¸€ä¸ªæŒ‡æ ‡ï¼Œç”¨äºç›‘æµ‹ç”¨æˆ·åœ¨æŸä¸ªç‰¹å®šåŠŸèƒ½é¡µé¢çš„åœç•™æ—¶é—´ã€‚ä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼å®ç°ï¼š\n\nåœ¨ ViewController ä¸­è®°å½•å¼€å§‹æ—¶é—´å’Œç»“æŸæ—¶é—´\nimport UIKitimport osclass FeatureViewController: UIViewController &#123;    private var startTime: Date?    private var osLog = OSLog(subsystem: &quot;com.yourapp.feature&quot;, category: &quot;Performance&quot;)    override func viewDidAppear(_ animated: Bool) &#123;        super.viewDidAppear(animated)        startTime = Date()        os_log(&quot;Feature page appeared&quot;, log: osLog, type: .info)    &#125;    override func viewDidDisappear(_ animated: Bool) &#123;        super.viewDidDisappear(animated)        if let startTime = startTime &#123;            let elapsedTime = Date().timeIntervalSince(startTime)            os_log(&quot;Feature page disappeared, duration: %&#123;public&#125;.2f seconds&quot;, log: osLog, type: .info, elapsedTime)            // ä½ å¯ä»¥åœ¨è¿™é‡Œå°† elapsedTime å‘é€åˆ°æœåŠ¡å™¨æˆ–å…¶ä»–å­˜å‚¨ç³»ç»Ÿ        &#125;    &#125;&#125;\nå®šæœŸå‘é€æ”¶é›†åˆ°çš„æ•°æ®ã€‚ä½ å¯ä»¥é€šè¿‡å®šæ—¶ä»»åŠ¡æˆ–åº”ç”¨è¿›å…¥åå°æ—¶ï¼Œå°†æ”¶é›†åˆ°çš„è‡ªå®šä¹‰æŒ‡æ ‡å‘é€åˆ°æœåŠ¡å™¨æˆ–åˆ†æç³»ç»Ÿã€‚\nfunc applicationDidEnterBackground(_ application: UIApplication) &#123;    // å‘é€æ•°æ®åˆ°æœåŠ¡å™¨&#125;\nå°†è‡ªå®šä¹‰æŒ‡æ ‡ä¸ MetricKit é›†æˆã€‚è™½ç„¶ MetricKit æ²¡æœ‰ç›´æ¥æ”¯æŒè‡ªå®šä¹‰æŒ‡æ ‡çš„åŠŸèƒ½ï¼Œä½†ä½ å¯ä»¥é€šè¿‡ MXMetricManager çš„ä»£ç†æ–¹æ³•æ•è·ç³»ç»Ÿæä¾›çš„æŒ‡æ ‡æ•°æ®ï¼Œå¹¶ç»“åˆè‡ªå®šä¹‰æŒ‡æ ‡è¿›è¡Œåˆ†æã€‚\nimport MetricKitclass MetricManager: NSObject, MXMetricManagerSubscriber &#123;    override init() &#123;        super.init()        MXMetricManager.shared.add(self)    &#125;    func didReceive(_ payloads: [MXMetricPayload]) &#123;        for payload in payloads &#123;            // å¤„ç† MetricKit æä¾›çš„ç³»ç»ŸæŒ‡æ ‡            let cpuMetrics = payload.cpuMetrics            // ç»“åˆä½ çš„è‡ªå®šä¹‰æŒ‡æ ‡è¿›è¡Œç»¼åˆåˆ†æ        &#125;    &#125;&#125;\nInAppåˆ†æå·¥å…·iOS å¹³å°ä¸Šå¸¸ç”¨çš„ In-app Debug å·¥å…·æœ‰ä»¥ä¸‹å‡ ç§ï¼š\n\nFlex æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„ In-app Debug å·¥å…·ï¼Œå…è®¸å¼€å‘è€…åœ¨åº”ç”¨å†…å®æ—¶æŸ¥çœ‹å’Œä¿®æ”¹è§†å›¾å±‚æ¬¡ç»“æ„ã€ç½‘ç»œè¯·æ±‚ã€ç”¨æˆ·é»˜è®¤è®¾ç½®ç­‰ã€‚å®ƒè¿˜æ”¯æŒåŠ¨æ€è°ƒæ•´ UI ä»¥åŠè°ƒè¯•å…¶ä»– app å†…éƒ¨é€»è¾‘ã€‚æ— éœ€é‡æ–°ç¼–è¯‘ä»£ç å³å¯ç›´æ¥è°ƒè¯•ï¼›å¯ä»¥ä¿®æ”¹å†…å­˜ä¸­çš„å€¼æ¥è§‚å¯Ÿå˜åŒ–ã€‚\nChisel æ˜¯ Facebook å¼€å‘çš„ä¸€ç»„ LLDB å‘½ä»¤é›†ï¼Œä¸“é—¨ç”¨äºåœ¨è°ƒè¯•æ—¶æä¾›æ›´æ–¹ä¾¿çš„æ“ä½œã€‚å®ƒèƒ½å¸®åŠ©å¼€å‘è€…å¿«é€Ÿæ£€æŸ¥è§†å›¾å±‚æ¬¡ç»“æ„ã€æŸ¥çœ‹æ§ä»¶ä¿¡æ¯ç­‰ã€‚ä¸ Xcode LLDB æ— ç¼é›†æˆï¼Œé€šè¿‡å‘½ä»¤è¡Œè°ƒè¯•è§†å›¾ã€æ‰“å°å‡ºå¸ƒå±€ç›¸å…³ä¿¡æ¯ç­‰ã€‚\nReveal æ˜¯ä¸€ä¸ªå›¾å½¢åŒ–çš„ In-app Debug å·¥å…·ï¼Œå®ƒå…è®¸å¼€å‘è€…åœ¨è¿è¡Œä¸­çš„åº”ç”¨ä¸­å®æ—¶æŸ¥çœ‹å’Œç¼–è¾‘è§†å›¾å±‚æ¬¡ç»“æ„ï¼Œæ”¯æŒ 2D å’Œ 3D çš„è§†å›¾å±•ç¤ºã€‚æä¾›ç›´è§‚çš„ UI è°ƒè¯•ç•Œé¢ï¼Œå¯ä»¥è½»æ¾åœ°æŸ¥çœ‹å’Œä¿®æ”¹è§†å›¾å±æ€§ï¼›æ”¯æŒ iOS å’Œ tvOSã€‚\nLookin æ˜¯ä¸€ä¸ªå¼€æºçš„ iOS è§†è§‰è°ƒè¯•å·¥å…·ï¼Œä¸“é—¨ç”¨äºåˆ†æå’Œæ£€æŸ¥ iOS åº”ç”¨çš„ç•Œé¢ç»“æ„ã€‚å®ƒæä¾›ç±»ä¼¼äº Xcode çš„ View Debugging åŠŸèƒ½ï¼Œä½†æ›´åŠ çµæ´»å’Œå¼ºå¤§ï¼Œå°¤å…¶æ˜¯åœ¨å¤æ‚ UI å¸ƒå±€çš„åˆ†æä¸Šã€‚é€šè¿‡ Lookinï¼Œä½ å¯ä»¥è½»æ¾åœ°è·å– iOS åº”ç”¨ä¸­çš„ç•Œé¢å±‚çº§ã€å¸ƒå±€ä¿¡æ¯ï¼Œå¹¶è¿›è¡Œå®æ—¶çš„ UI è°ƒè¯•å’Œè°ƒæ•´ã€‚å¯ä»¥ç§°ä¹‹ä¸ºå¼€æºç‰ˆçš„ Revealã€‚\n\nfishhookfishhook æ˜¯ä¸€ä¸ªç”¨äºåœ¨ iOS å’Œ macOS ç¯å¢ƒä¸­è¿›è¡Œå‡½æ•°æ›¿æ¢çš„å¼€æºåº“ï¼Œä¸»è¦ç”¨äºåŠ¨æ€é“¾æ¥åº“ï¼ˆdylibï¼‰ä¸­çš„ç¬¦å·é‡å†™ã€‚\nfishhook é€šè¿‡æ“ä½œ Mach-O æ–‡ä»¶çš„ç¬¦å·è¡¨æ¥æ‰¾åˆ°éœ€è¦æ›¿æ¢çš„å‡½æ•°ã€‚Mach-O æ–‡ä»¶çš„ç¬¦å·è¡¨åŒ…å«äº†æ‰€æœ‰å‡½æ•°å’Œå˜é‡çš„ç¬¦å·ï¼ˆåç§°å’Œåœ°å€ï¼‰ä¿¡æ¯ã€‚fishhook ä½¿ç”¨ dyldï¼ˆåŠ¨æ€é“¾æ¥å™¨ï¼‰çš„ç›¸å…³å‡½æ•°æ¥è¿›è¡Œç¬¦å·é‡å®šå‘ã€‚å®ƒé¦–å…ˆä½¿ç”¨ dyld æä¾›çš„æ¥å£æ‰¾åˆ°ç¬¦å·çš„åœ°å€ï¼Œç„¶åå°†è¿™äº›ç¬¦å·çš„åœ°å€æ›¿æ¢ä¸ºæ–°çš„åœ°å€ã€‚é€šè¿‡ä¿®æ”¹ Mach-O æ–‡ä»¶ä¸­çš„ç¬¦å·è¡¨æ¥å®Œæˆå‡½æ•°æ›¿æ¢ã€‚è¿™åŒ…æ‹¬ä¿®æ”¹åŠ¨æ€é“¾æ¥åº“ä¸­çš„ __dyld çš„ç¬¦å·ä¿¡æ¯ï¼Œä½¿å¾—åœ¨è¿è¡Œæ—¶è°ƒç”¨è¿™äº›ç¬¦å·æ—¶ä¼šè·³è½¬åˆ°æ–°çš„å®ç°ã€‚\nfishhook å…è®¸åœ¨ç¨‹åºè¿è¡Œæ—¶åŠ¨æ€æ›¿æ¢å‡½æ•°å®ç°ï¼Œè¿™å¯¹äºè°ƒè¯•å’Œä¿®æ”¹ç¬¬ä¸‰æ–¹åº“çš„è¡Œä¸ºéå¸¸æœ‰ç”¨ã€‚\nä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œå±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ fishhook æ¥æ›¿æ¢å‡½æ•°å®ç°ï¼š\n#include &lt;stdio.h&gt;#include &lt;dlfcn.h&gt;#include &quot;fishhook.h&quot;// éœ€è¦è¢«æ›¿æ¢çš„åŸå§‹å‡½æ•°static int (*orig_printf)(const char *, ...) = NULL;// æ–°çš„å‡½æ•°å®ç°int new_printf(const char *format, ...) &#123;    printf(&quot;Intercepted: &quot;);    va_list args;    va_start(args, format);    int result = orig_printf(format, args);    va_end(args);    return result;&#125;// æ›¿æ¢å‡½æ•°å®ç°void replace_printf() &#123;    // ç¡®ä¿åœ¨æ›¿æ¢ä¹‹å‰å·²ç»åŠ è½½äº†åŠ¨æ€åº“    rebind_symbols((struct rebinding[1])&#123;&#123;&quot;printf&quot;, new_printf, (void *)&amp;orig_printf&#125;&#125;, 1);&#125;int main() &#123;    replace_printf();    printf(&quot;Hello, World!\\n&quot;);    return 0;&#125;\nåœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œreplace_printf å‡½æ•°å°† printf å‡½æ•°çš„å®ç°æ›¿æ¢ä¸º new_printfï¼Œå¹¶åœ¨æ§åˆ¶å°ä¸Šè¾“å‡º â€œIntercepted: â€œã€‚\nFridaä½¿ç”¨ Frida æ¥è¿›è¡ŒåŠ¨æ€åˆ†æå’Œè°ƒè¯•\n\nå‡†å¤‡å·¥ä½œ\n\n\nFrida å·¥å…·é“¾: å®‰è£… Frida çš„å‘½ä»¤è¡Œå·¥å…·ã€‚åœ¨ macOS ä¸Šå¯ä»¥é€šè¿‡ pip å®‰è£…ï¼š bash pip install frida-tools \nå¼€å‘è€…è¯ä¹¦: éœ€è¦ä¸€ä¸ªæœ‰æ•ˆçš„è‹¹æœå¼€å‘è€…è´¦å·ï¼Œç”¨äºç­¾åè‡ªå®šä¹‰çš„ Frida æœåŠ¡å™¨åº”ç”¨ã€‚\n\n\nç¼–è¯‘å¹¶ç­¾å Frida Server\n\n\nä¸‹è½½ Frida æºç : ä» Frida çš„ GitHub ä»“åº“å…‹éš†æºç ã€‚\n\ngit clone https://github.com/frida/frida.gitcd frida\n\nç¼–è¯‘ Frida Server: ä½¿ç”¨ Frida æä¾›çš„æ„å»ºè„šæœ¬æ¥ç¼–è¯‘ Frida Serverã€‚è¿™ä¸ªæ­¥éª¤å¯èƒ½éœ€è¦ä¸€äº›é…ç½®ï¼Œå…·ä½“è¿‡ç¨‹å¯ä»¥å‚è€ƒ Frida å®˜æ–¹æ–‡æ¡£ã€‚ç¼–-è¯‘å®Œæˆåï¼Œä½ ä¼šå¾—åˆ°ä¸€ä¸ª frida-server å¯æ‰§è¡Œæ–‡ä»¶ã€‚\nä½¿ç”¨å¼€å‘è€…è¯ä¹¦ç­¾å: å°†ç¼–è¯‘å¥½çš„ frida-server æ–‡ä»¶è¿›è¡Œç­¾åï¼Œç¡®ä¿å®ƒå¯ä»¥åœ¨éè¶Šç‹±çš„è®¾å¤‡ä¸Šè¿è¡Œã€‚\n\ncodesign -s &quot;iPhone Developer: Your Name (Team ID)&quot; --entitlements entitlements.plist frida-server\nentitlements.plist æ–‡ä»¶éœ€è¦åŒ…æ‹¬å…è®¸è°ƒè¯•å’Œ taskforpid æƒé™çš„é…ç½®ã€‚\n\néƒ¨ç½² Frida Server åˆ°è®¾å¤‡\n\n\nä½¿ç”¨ Xcode éƒ¨ç½²: å°† frida-server æ–‡ä»¶æ‰“åŒ…æˆä¸€ä¸ªåº”ç”¨ï¼Œç„¶åé€šè¿‡ Xcode éƒ¨ç½²åˆ°ç›®æ ‡è®¾å¤‡ä¸Šã€‚\næˆ–è€…é€šè¿‡ SSH éƒ¨ç½²: å¦‚æœä½ å·²ç»æœ‰å…¶ä»–æ–¹å¼åœ¨éè¶Šç‹±è®¾å¤‡ä¸Šè¿è¡Œè‡ªç­¾ååº”ç”¨ï¼Œå¯ä»¥é€šè¿‡ SSH å°† frida-server ç›´æ¥æ‹·è´åˆ°è®¾å¤‡ä¸Šã€‚\n\n\nå¯åŠ¨ Frida Server\n\n\nåœ¨è®¾å¤‡ä¸Šå¯åŠ¨: æ‰“å¼€ä½ éƒ¨ç½²çš„åº”ç”¨ï¼Œç¡®ä¿ frida-server åœ¨åå°è¿è¡Œã€‚ä½ å¯ä»¥é€šè¿‡ Xcode çš„è°ƒè¯•æ§åˆ¶å°æˆ–ç»ˆç«¯å‘½ä»¤æ¥å¯åŠ¨å®ƒã€‚\nè¿æ¥ Frida Server: åœ¨ä½ çš„ç”µè„‘ä¸Šé€šè¿‡ USB è¿æ¥è®¾å¤‡ï¼Œå¹¶ä½¿ç”¨ Frida CLI è¿æ¥åˆ°è¿è¡Œä¸­çš„ Frida Serverã€‚\n\nfrida-ps -U\n\nå¼€å§‹è°ƒè¯•: ä½ å¯ä»¥ä½¿ç”¨ Frida çš„å„ç§å‘½ä»¤æ¥åˆ†æå’Œè°ƒè¯•ç›®æ ‡åº”ç”¨ã€‚\n\n\nFrida CLI ä½¿ç”¨ç¤ºä¾‹\n\n\nåˆ—å‡ºæ‰€æœ‰è¿›ç¨‹:\n\nfrida-ps -U\n\né™„åŠ åˆ°ç›®æ ‡è¿›ç¨‹:\n\nfrida -U -n &lt;AppName&gt;\n\nè¿è¡Œè„šæœ¬:\n\nfrida -U -n &lt;AppName&gt; -l script.js","categories":["æ€§èƒ½ä¼˜åŒ–"],"tags":["æ€§èƒ½ä¼˜åŒ–","æ€§èƒ½åˆ†æ"]},{"title":"å­¦ä¹ è®¡åˆ’","url":"/2025/04/23/%E5%AD%A6%E4%B9%A0%E8%AE%A1%E5%88%92/","content":"æ¯æ—¥èŠ‚å¥å»ºè®®ï¼š\nğŸ“– æŠ€æœ¯çŸ¥è¯†å­¦ä¹ ï¼š1.5h\nğŸ§± é¡¹ç›®å›é¡¾ &amp; ç³»ç»Ÿè®¾è®¡ï¼š1h\nğŸ§  ç®—æ³•è®­ç»ƒï¼š1h\nğŸ¤ é¢è¯•é¢˜æ¼”ç»ƒï¼š1h\nğŸ““ æ€»ç»“è®°å½•ï¼š0.5h\n\n\nğŸ—“ï¸ ç¬¬ 1 å‘¨ï¼šUIKitã€Blockã€Runtime\n\n\næ˜ŸæœŸ\nå­¦ä¹ å†…å®¹\n\n\n\nå‘¨ä¸€\nUIKit äº‹ä»¶ä¼ é€’æœºåˆ¶ &amp; Responder Chain\n\n\nå‘¨äºŒ\nView å¸ƒå±€æµç¨‹ï¼ˆlayoutSubviews ç­‰ï¼‰\n\n\nå‘¨ä¸‰\nBlock åˆ†ç±»ã€å˜é‡æ•è·ä¸ä½œç”¨åŸŸ\n\n\nå‘¨å››\nBlock å†…å­˜ç®¡ç† &amp; å¾ªç¯å¼•ç”¨åˆ†æ\n\n\nå‘¨äº”\nObjective-C Runtime åŸºç¡€ç»“æ„\n\n\nå‘¨å…­\nRuntime å®æˆ˜æŠ€å·§ï¼ˆSwizzlingã€æ¶ˆæ¯è½¬å‘ï¼‰\n\n\nå‘¨æ—¥\nå¤ç›˜æ€»ç»“ + è¾“å‡ºç¬”è®°ï¼ˆRuntime&#x2F;Block&#x2F;UIï¼‰\n\n\n\nğŸ—“ï¸ ç¬¬ 2 å‘¨ï¼šRunLoopã€çº¿ç¨‹ã€å†…å­˜ç®¡ç†\n\n\næ˜ŸæœŸ\nå­¦ä¹ å†…å®¹\n\n\n\nå‘¨ä¸€\nRunLoop æ„æˆä¸çº¿ç¨‹ä¿æ´»\n\n\nå‘¨äºŒ\nRunLoop å¡é¡¿ä¼˜åŒ–åœºæ™¯å®æˆ˜\n\n\nå‘¨ä¸‰\nGCD è¿›é˜¶ï¼šbarrier&#x2F;group&#x2F;target queue\n\n\nå‘¨å››\nGCD vs NSOperation æ¡†æ¶å¯¹æ¯”\n\n\nå‘¨äº”\nARC æœ¬è´¨ã€Weak å®ç°ã€å¾ªç¯å¼•ç”¨å¤„ç†\n\n\nå‘¨å…­\nå†…å­˜æ³„æ¼æ’æŸ¥ã€åƒµå°¸å¯¹è±¡ä¸ MRC å›é¡¾\n\n\nå‘¨æ—¥\næ€»ç»“è„‘å›¾ï¼šRunLoop + å¤šçº¿ç¨‹ + å†…å­˜ç®¡ç†\n\n\n\nğŸ—“ï¸ ç¬¬ 3 å‘¨ï¼šé¡¹ç›®å¤ç›˜ + ç½‘ç»œ &amp; ç¼“å­˜\n\n\næ˜ŸæœŸ\nå­¦ä¹ å†…å®¹\n\n\n\nå‘¨ä¸€\nä¸»é¡¹ç›®æ¶æ„æ¢³ç† + æ¶æ„å›¾åˆç¨¿\n\n\nå‘¨äºŒ\nNSURLSession æ–­ç‚¹ç»­ä¼  + ç½‘ç»œå°è£…\n\n\nå‘¨ä¸‰\nç½‘ç»œåº“åº•å±‚ï¼šAFNetworkingã€Alamofire\n\n\nå‘¨å››\nç¼“å­˜ç­–ç•¥ + URLProtocol æ‹¦æˆª\n\n\nå‘¨äº”\næ•°æ®æŒä¹…åŒ–æ–¹æ¡ˆï¼ˆCoreData&#x2F;SQLiteï¼‰\n\n\nå‘¨å…­\nç¦»çº¿ç¼“å­˜æ¶æ„å›¾ + å®é™…åœºæ™¯æ€»ç»“\n\n\nå‘¨æ—¥\nè¾“å‡ºï¼šé¡¹ç›®äº®ç‚¹ bullet listï¼ˆ10 æ¡ï¼‰\n\n\n\nğŸ—“ï¸ ç¬¬ 4 å‘¨ï¼šæ¶æ„æ¨¡å¼ &amp; åŠ¨æ€åŒ–æŠ€æœ¯\n\n\næ˜ŸæœŸ\nå­¦ä¹ å†…å®¹\n\n\n\nå‘¨ä¸€\nMVC&#x2F;MVVM&#x2F;VIPER&#x2F;Redux æ¨¡å¼æ€»ç»“\n\n\nå‘¨äºŒ\næ¨¡å—åŒ–è®¾è®¡ + è·¯ç”±æœºåˆ¶å®è·µ\n\n\nå‘¨ä¸‰\nè·¨ç»„ä»¶é€šä¿¡æ–¹æ¡ˆï¼ˆRouter &#x2F; URLSchemeï¼‰\n\n\nå‘¨å››\nçƒ­æ›´æ–°æ–¹æ¡ˆï¼ˆJSPatch &#x2F; Flutter &#x2F; RNï¼‰\n\n\nå‘¨äº”\nå­—èŠ‚è·³åŠ¨é«˜é¢‘æ¶æ„ç±»é¢è¯•é¢˜æ•´ç†\n\n\nå‘¨å…­\né¡¹ç›®æ¶æ„æ¼”è®²æ¨¡æ‹Ÿ\n\n\nå‘¨æ—¥\næ¶æ„å›¾æœ€ç»ˆç‰ˆ + é¡¹ç›®å¤ç›˜æ–‡æ¡£æ•´ç†\n\n\n\nğŸ—“ï¸ ç¬¬ 5 å‘¨ï¼šç³»ç»Ÿè®¾è®¡ &amp; ç®—æ³•è¿›é˜¶\n\n\næ˜ŸæœŸ\nå­¦ä¹ å†…å®¹\n\n\n\nå‘¨ä¸€\nç³»ç»Ÿè®¾è®¡é¢˜ï¼šè§†é¢‘æ’­æ”¾ App è®¾è®¡\n\n\nå‘¨äºŒ\nè§†é¢‘ç¼“å­˜ã€å¼‚å¸¸å¤„ç†æ¨¡å—\n\n\nå‘¨ä¸‰\nå›¾ç‰‡åŠ è½½ä¼˜åŒ–ï¼ˆLRU&#x2F;å¼‚æ­¥è§£ç ï¼‰\n\n\nå‘¨å››\nå¤šçº¿ç¨‹æ•°æ®ä¸€è‡´æ€§åœºæ™¯é¢˜\n\n\nå‘¨äº”\nå¯åŠ¨ä¼˜åŒ– &amp; ç™½å±ä¼˜åŒ–åœºæ™¯\n\n\nå‘¨å…­\nç®—æ³•ä¸“é¢˜ï¼šæ»‘åŠ¨çª—å£ + æœç´¢ç±»\n\n\nå‘¨æ—¥\nè¾“å‡ºç³»ç»Ÿè®¾è®¡ç­”é¢˜ç¨¿ï¼ˆé™„å›¾+è¦ç‚¹ï¼‰\n\n\n\nğŸ—“ï¸ ç¬¬ 6 å‘¨ï¼šçœŸé¢˜ç²¾ç»ƒ + æ¨¡æ‹Ÿé¢è¯•\n\n\næ˜ŸæœŸ\nå­¦ä¹ å†…å®¹\n\n\n\nå‘¨ä¸€\nå­—èŠ‚è·³åŠ¨ iOS é¢ç»æ¨¡æ‹Ÿä¸€è½®\n\n\nå‘¨äºŒ\nç®—æ³• + é¡¹ç›® + ç³»ç»Ÿè®¾è®¡è‡ªæµ‹\n\n\nå‘¨ä¸‰\né¢ç»é«˜é¢‘é¢˜å£å¤´å›ç­”è®­ç»ƒ\n\n\nå‘¨å››\nç³»ç»Ÿè®¾è®¡ + æ¡†æ¶ç±»é—®é¢˜æ¼”ç»ƒ\n\n\nå‘¨äº”\nç®—æ³•é¢è¯•é¢˜ï¼šæ‰‹å†™ç»å…¸é¢˜\n\n\nå‘¨å…­\næ¨¡æ‹Ÿé¢è¯•ï¼ˆå¯æ‰¾æœ‹å‹&#x2F;AI æ¼”ç»ƒï¼‰\n\n\nå‘¨æ—¥\næ€»ç»“é”™é¢˜ã€é¢è¯•è¡¨ç°å¤ç›˜ç¬”è®°\n\n\n\nğŸ—“ï¸ ç¬¬ 7 å‘¨ï¼šç®€å†æ‰“ç£¨ + é«˜é¢‘å›é¡¾\n\n\næ˜ŸæœŸ\nå­¦ä¹ å†…å®¹\n\n\n\nå‘¨ä¸€\nç®€å†ä¼˜åŒ– + STAR æ³•é¡¹ç›®ç²¾ç‚¼\n\n\nå‘¨äºŒ\né«˜é¢‘ iOS é¢è¯•é¢˜ Top20 æ¢³ç†\n\n\nå‘¨ä¸‰\né¡¹ç›®æ·±æŒ–å›ç­”æ¼”ç»ƒ\n\n\nå‘¨å››\nç®—æ³•æ¯æ—¥ä¸‰é¢˜ï¼ˆé“¾è¡¨&#x2F;DP&#x2F;å­—ç¬¦ä¸²ï¼‰\n\n\nå‘¨äº”\nçªç ´çŸ¥è¯†çŸ­æ¿æ¨¡å—\n\n\nå‘¨å…­\nå½•åˆ¶é¡¹ç›®è®²è§£ or æŠ€æœ¯è®²æ¼”è§†é¢‘\n\n\nå‘¨æ—¥\næ€»ç»“ç­”é¢˜è¯æœ¯æ–‡æ¡£ &amp; PPT èµ„æ–™\n\n\n\nğŸ—“ï¸ ç¬¬ 8 å‘¨ï¼šå†²åˆº &amp; æ¨¡æ‹Ÿæ¼”ç»ƒ\n\n\næ˜ŸæœŸ\nå­¦ä¹ å†…å®¹\n\n\n\nå‘¨ä¸€\nå¿«é€Ÿè¿‡ä¸€éé¢è¯• 50 é—®\n\n\nå‘¨äºŒ\næ¨¡æ‹Ÿå®Œæ•´é¡¹ç›®ç­”è¾©æ¼”è®²\n\n\nå‘¨ä¸‰\né«˜é¢‘ç®—æ³•åˆ·é¢˜ï¼ˆ6 é¢˜å†²åˆºï¼‰\n\n\nå‘¨å››\næ¨¡æ‹Ÿå®Œæ•´é¢è¯•ï¼ˆå…¨æµç¨‹ï¼‰\n\n\nå‘¨äº”\næ€»ç»“æ‰€æœ‰ç¬”è®° + ç²¾é€‰ç­”é¢˜å¡\n\n\nå‘¨å…­\nå¿ƒæ€è°ƒæ•´ &amp; å‡†å¤‡ç¯å¢ƒ\n\n\nå‘¨æ—¥\næ­£å¼é¢è¯• day ğŸš€ï¼ˆæˆ–ä¼‘æ¯å¤‡æˆ˜ï¼‰\n\n\n\n"},{"title":"æ£€æµ‹å’Œè¯Šæ–­å†…å­˜é—®é¢˜","url":"/2025/05/12/%E6%A3%80%E6%B5%8B%E5%92%8C%E8%AF%8A%E6%96%AD%E5%86%85%E5%AD%98%E9%97%AE%E9%A2%98/","content":"OOMå†…å­˜æ³„æ¼ï¼Œéš¾ä»¥ç›‘æ§ã€‚å†…å­˜æ³„æ¼æ˜¯æŒ‡ç¨‹åºåœ¨è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œç”±äºè®¾è®¡é”™è¯¯æˆ–è€…ä»£ç å®ç°ä¸å½“ï¼Œå¯¼è‡´ç¨‹åºæœªèƒ½é‡Šæ”¾å·²ç»ä¸å†ä½¿ç”¨çš„å†…å­˜ï¼Œä»è€Œé€ æˆç³»ç»Ÿå†…å­˜çš„æµªè´¹ï¼Œä¸¥é‡çš„ä¼šå¯¼è‡´ç¨‹åºå´©æºƒã€‚å†…å­˜æ³„æ¼æ˜¯ä¸€ä¸ªéå¸¸ä¸¥é‡çš„é—®é¢˜ï¼Œå› ä¸ºå®ƒä¼šå¯¼è‡´ç¨‹åºè¿è¡Œé€Ÿåº¦å˜æ…¢ï¼Œç”šè‡³ä¼šå¯¼è‡´ç¨‹åºå´©æºƒã€‚å› æ­¤ï¼Œæˆ‘ä»¬åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œä¸€å®šè¦æ³¨æ„å†…å­˜æ³„æ¼çš„é—®é¢˜ã€‚\nOOMï¼ˆOut Of Memoryï¼‰æŒ‡çš„æ˜¯iOSè®¾å¤‡ä¸Šåº”ç”¨å› å†…å­˜å ç”¨è¿‡é«˜è¢«ç³»ç»Ÿå¼ºåˆ¶ç»ˆæ­¢çš„ç°è±¡ã€‚iOSé€šè¿‡Jetsamæœºåˆ¶ç®¡ç†å†…å­˜èµ„æºï¼Œå½“è®¾å¤‡å†…å­˜ç´§å¼ æ—¶ï¼Œä¼šç»ˆæ­¢ä¼˜å…ˆçº§ä½æˆ–å†…å­˜å ç”¨å¤§çš„è¿›ç¨‹ã€‚åˆ†ä¸ºFOOMï¼ˆå‰å°OOMï¼‰å’ŒBOOMï¼ˆåå°OOMï¼‰ï¼ŒFOOMå¯¹ç”¨æˆ·ä½“éªŒå½±å“æ›´å¤§ã€‚\nJetsamæ—¥å¿—åŒ…æ‹¬pageSizeï¼ˆå†…å­˜é¡µå¤§å°ï¼‰ã€statesï¼ˆåº”ç”¨çŠ¶æ€ï¼‰ã€rpagesï¼ˆå ç”¨çš„å†…å­˜é¡µæ•°ï¼‰ã€reasonï¼ˆç»ˆæ­¢åŸå› ï¼‰ã€‚é€šè¿‡pageSizeå’Œrpageså¯è®¡ç®—å‡ºåº”ç”¨å´©æºƒæ—¶å ç”¨çš„å†…å­˜å¤§å°ã€‚\nåœ¨ç°ä»£æ“ä½œç³»ç»Ÿä¸­ï¼Œå†…å­˜ç®¡ç†æ˜¯ä¸€é¡¹å…³é”®ä»»åŠ¡ã€‚éšç€ç§»åŠ¨è®¾å¤‡å’Œæ¡Œé¢ç³»ç»Ÿçš„å¤æ‚æ€§å¢åŠ ï¼Œå†…å­˜èµ„æºçš„é«˜æ•ˆä½¿ç”¨å˜å¾—æ›´åŠ é‡è¦ã€‚iOSå’ŒmacOSé€šè¿‡å¼•å…¥â€œå†…å­˜å‹åŠ›â€ï¼ˆMemory Pressureï¼‰æœºåˆ¶æ¥ä¼˜åŒ–å†…å­˜ç®¡ç†ï¼Œå–ä»£äº†ä¼ ç»Ÿçš„åŸºäºè™šæ‹Ÿå†…å­˜åˆ†é¡µçš„ç®¡ç†æ–¹æ³•ã€‚\nè™šæ‹Ÿå†…å­˜ç³»ç»Ÿå…è®¸æ“ä½œç³»ç»Ÿå°†ç‰©ç†å†…å­˜ï¼ˆRAMï¼‰å’Œç£ç›˜å­˜å‚¨ç»“åˆä½¿ç”¨ï¼Œä»¥ä¾¿åœ¨å†…å­˜ä¸è¶³æ—¶å°†ä¸å¸¸ç”¨çš„æ•°æ®ç§»è‡³ç£ç›˜ã€‚åˆ†é¡µï¼ˆpagingï¼‰æ˜¯è™šæ‹Ÿå†…å­˜ç®¡ç†ä¸­çš„ä¸€ç§æŠ€æœ¯ï¼Œå®ƒå°†å†…å­˜åˆ’åˆ†ä¸ºå°å—ï¼ˆé¡µé¢ï¼‰ï¼Œå¹¶æ ¹æ®éœ€è¦å°†å®ƒä»¬ä»ç‰©ç†å†…å­˜äº¤æ¢åˆ°ç£ç›˜ã€‚ç„¶è€Œï¼Œåˆ†é¡µå­˜åœ¨æ€§èƒ½ç“¶é¢ˆï¼Œå°¤å…¶æ˜¯åœ¨å­˜å‚¨è®¿é—®é€Ÿåº¦è¿œä½äºå†…å­˜çš„æƒ…å†µä¸‹ã€‚\néšç€è®¾å¤‡ç¡¬ä»¶çš„å˜åŒ–å’Œç”¨æˆ·ä½“éªŒè¦æ±‚çš„æé«˜ï¼Œè‹¹æœå…¬å¸åœ¨iOSå’ŒmacOSä¸­å¼•å…¥äº†â€œå†…å­˜å‹åŠ›â€æœºåˆ¶ã€‚å†…å­˜å‹åŠ›æ˜¯ä¸€ç§åŠ¨æ€ç›‘æµ‹å†…å­˜ä½¿ç”¨æƒ…å†µçš„æŠ€æœ¯ï¼Œå®ƒèƒ½å¤Ÿå®æ—¶è¯„ä¼°ç³»ç»Ÿå†…å­˜çš„ä½¿ç”¨çŠ¶æ€ï¼Œå¹¶æ ¹æ®ä¸åŒçš„å‹åŠ›çº§åˆ«é‡‡å–ç›¸åº”çš„æªæ–½ã€‚\nå†…å­˜å‹åŠ›æœºåˆ¶é€šè¿‡ç³»ç»Ÿçº§åˆ«çš„åé¦ˆæ¥ç®¡ç†å†…å­˜ã€‚ç³»ç»Ÿä¼šç›‘æµ‹å†…å­˜çš„ä½¿ç”¨æƒ…å†µï¼Œå¹¶å°†å‹åŠ›åˆ†ä¸ºå››ä¸ªçº§åˆ«ï¼šæ— å‹åŠ›ï¼ˆNo Pressureï¼‰ã€è½»åº¦å‹åŠ›ï¼ˆModerate Pressureï¼‰ã€é‡åº¦å‹åŠ›ï¼ˆCritical Pressureï¼‰å’Œç´§æ€¥å‹åŠ›ï¼ˆJetsamï¼‰ã€‚\nå‹åŠ›çº§åˆ«çš„å®šä¹‰ä¸å“åº”ï¼š\n\næ— å‹åŠ›ï¼ˆNo Pressureï¼‰ï¼šç³»ç»Ÿå†…å­˜å……è¶³ï¼Œæ²¡æœ‰ç‰¹åˆ«çš„å†…å­˜ç®¡ç†æªæ–½ã€‚\nè½»åº¦å‹åŠ›ï¼ˆModerate Pressureï¼‰ï¼šç³»ç»Ÿå†…å­˜å¼€å§‹ç´§å¼ ï¼Œæ“ä½œç³»ç»Ÿä¼šå»ºè®®åº”ç”¨ç¨‹åºé‡Šæ”¾ç¼“å­˜æˆ–éå¿…è¦çš„èµ„æºã€‚\né‡åº¦å‹åŠ›ï¼ˆCritical Pressureï¼‰ï¼šç³»ç»Ÿå†…å­˜éå¸¸ç´§å¼ ï¼Œæ“ä½œç³»ç»Ÿå¯èƒ½ä¼šæš‚åœåå°ä»»åŠ¡æˆ–ç»ˆæ­¢ä¸æ´»è·ƒçš„åº”ç”¨ç¨‹åºã€‚\nç´§æ€¥å‹åŠ›ï¼ˆJetsamï¼‰ï¼šè¿™æ˜¯æœ€ä¸¥é‡çš„å†…å­˜å‹åŠ›çŠ¶æ€ï¼Œç³»ç»Ÿå¯èƒ½ä¼šç›´æ¥å¼ºåˆ¶å…³é—­å ç”¨å¤§é‡å†…å­˜çš„åº”ç”¨ç¨‹åºï¼Œä»¥é‡Šæ”¾èµ„æºç¡®ä¿ç³»ç»Ÿçš„ç¨³å®šæ€§ã€‚ç³»ç»Ÿå¯¹å†…å­˜å‹åŠ›çš„åº”å¯¹æªæ–½\n\nä¸ºäº†åº”å¯¹ä¸åŒçš„å†…å­˜å‹åŠ›ï¼ŒiOSå’ŒmacOSç³»ç»Ÿé‡‡å–äº†å¤šç§ç­–ç•¥ï¼ŒåŒ…æ‹¬ï¼š\n\nç¼“å­˜ç®¡ç†ï¼šç³»ç»Ÿä¼šé¦–å…ˆæ¸…é™¤å¯ä¸¢å¼ƒçš„ç¼“å­˜æ•°æ®ï¼Œä»¥å‡è½»å†…å­˜è´Ÿæ‹…ã€‚\nåå°ä»»åŠ¡ç®¡ç†ï¼šåœ¨å‹åŠ›å¢åŠ æ—¶ï¼Œæ“ä½œç³»ç»Ÿä¼šä¼˜å…ˆæš‚åœæˆ–ç»ˆæ­¢ä½ä¼˜å…ˆçº§çš„åå°ä»»åŠ¡ã€‚\nåº”ç”¨ç¨‹åºç»ˆæ­¢ï¼šåœ¨ç´§æ€¥æƒ…å†µä¸‹ï¼Œç³»ç»Ÿä¼šé€‰æ‹©æ€§åœ°å…³é—­é‚£äº›å ç”¨å¤§é‡å†…å­˜ä¸”å½“å‰ä¸æ´»è·ƒçš„åº”ç”¨ç¨‹åºï¼Œè¿™ä¸€è¿‡ç¨‹è¢«ç§°ä¸ºâ€œJetsamâ€ã€‚\n\nä½¿ç”¨ç³»ç»Ÿæä¾›çš„å·¥å…·ï¼ˆå¦‚vm_statã€memory_pressureç­‰ï¼‰ç›‘æµ‹åº”ç”¨ç¨‹åºçš„å†…å­˜ä½¿ç”¨æƒ…å†µã€‚è¿™äº›å·¥å…·å¯ä»¥å¸®åŠ©å¼€å‘è€…è¯†åˆ«å†…å­˜æ³„æ¼ã€è¿‡åº¦çš„ç¼“å­˜ä½¿ç”¨ç­‰é—®é¢˜ã€‚å¼€å‘è€…å¯ä»¥-é€šè¿‡è¿™äº›æœºåˆ¶æ„ŸçŸ¥å†…å­˜å‹åŠ›çš„å˜åŒ–ã€‚ä¾‹å¦‚ï¼Œå½“ç³»ç»Ÿå‘å‡ºUIApplicationDidReceiveMemoryWarningNotificationé€šçŸ¥æ—¶ï¼Œåº”ç”¨ç¨‹åºåº”ç«‹å³é‡Šæ”¾ä¸å¿…è¦çš„èµ„æºã€‚\nå›¾åƒå¤„ç†çš„è¿‡ç¨‹ä¸­å†…å­˜å®¹æ˜“å‡ºç°ç›¸å½“å¤§çš„å³°å€¼ï¼Œè¿™ä¼šå¯¼è‡´äº†å´©æºƒã€‚æ¯”å¦‚å¯¼å…¥æˆ–è£å‰ªå¤§å›¾æ—¶ã€‚\né¿å…ä¸å¿…è¦çš„å›¾ç‰‡è§£ç ï¼Œä½¿ç”¨æ›´é«˜æ•ˆçš„å›¾åƒå¤„ç†æ–¹æ³•å¯ä»¥å¯¹å›¾å½¢å¤„ç†è¿›è¡Œä¼˜åŒ–ã€‚\né€šè¿‡é¿å…æå‰è§£ç å’ŒåŠ è½½é«˜åˆ†è¾¨ç‡å›¾ç‰‡ï¼Œåªåœ¨éœ€è¦æ—¶è§£ç æŒ‡å®šå°ºå¯¸çš„å›¾ç‰‡ã€‚ä¾‹å¦‚ï¼Œåœ¨åŠ è½½å’Œè£å‰ªå›¾ç‰‡æ—¶ï¼Œåªå¤„ç†å®é™…æ˜¾ç¤ºåœ¨å±å¹•ä¸Šçš„éƒ¨åˆ†ï¼Œè€Œä¸æ˜¯æ•´ä¸ªå›¾ç‰‡ã€‚é€šè¿‡å¼•å…¥ CGImageSource å’Œ CGImageThumbnailOptionsï¼Œåœ¨å›¾åƒåŠ è½½æ—¶ç›´æ¥ç”Ÿæˆç¼©ç•¥å›¾ï¼Œä»è€Œå‡å°‘å†…å­˜å ç”¨ã€‚ä¸ç›´æ¥ä½¿ç”¨ UIImage å¤„ç†æ•´ä¸ªå›¾åƒç›¸æ¯”ï¼Œè¿™ç§æ–¹æ³•æ›´åŠ é«˜æ•ˆã€‚\nç¤ºä¾‹å¦‚ä¸‹ï¼š\nimport SwiftUIimport SwiftDatastruct ContentView: View &#123;    @State private var image: UIImage? = nil    var body: some View &#123;        VStack &#123;            if let image = image &#123;                Image(uiImage: image)                    .resizable()                    .scaledToFit()                    .frame(width: 200, height: 200)            &#125; else &#123;                Text(&quot;Loading image...&quot;)            &#125;        &#125;        .onAppear(perform: loadImage)    &#125;    func loadImage() &#123;        Task &#123;            // `CGImageSourceCreateWithURL` ä»å›¾ç‰‡çš„ URL åˆ›å»ºä¸€ä¸ª `CGImageSource`ï¼Œè€Œä¸æ˜¯ç›´æ¥åŠ è½½æ•´ä¸ªå›¾ç‰‡ã€‚            if let url = Bundle.main.url(forResource: &quot;largeImage&quot;, withExtension: &quot;jpg&quot;),               let source = CGImageSourceCreateWithURL(url as CFURL, nil) &#123;                // è®¾ç½®ç¼©ç•¥å›¾é€‰é¡¹                let options: [CFString: Any] = [                    kCGImageSourceThumbnailMaxPixelSize: 200,                    kCGImageSourceCreateThumbnailFromImageAlways: true                ]                                // ç”Ÿæˆç¼©ç•¥å›¾ã€‚é€šè¿‡è®¾ç½® `kCGImageSourceThumbnailMaxPixelSize`ï¼Œä»…ç”Ÿæˆæ‰€éœ€å°ºå¯¸çš„ç¼©ç•¥å›¾ï¼Œè€Œä¸æ˜¯åŠ è½½æ•´ä¸ªå›¾ç‰‡ï¼Œä»è€Œå¤§å¹…å‡å°‘å†…å­˜å ç”¨ã€‚                if let cgImage = CGImageSourceCreateThumbnailAtIndex(source, 0, options as CFDictionary) &#123;                    let uiImage = UIImage(cgImage: cgImage)                                        // æ›´æ–° UIï¼Œå›åˆ°ä¸»çº¿ç¨‹                    await MainActor.run &#123;                        self.image = uiImage                    &#125;                &#125;            &#125; // end if        &#125; // end Task    &#125;&#125;\næŸ¥çœ‹å†…å­˜ä½¿ç”¨æƒ…å†µåœ¨ iOS ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ mach_task_basic_info ç»“æ„ä½“æ¥æŸ¥çœ‹åº”ç”¨çš„å®é™…å†…å­˜ä½¿ç”¨æƒ…å†µã€‚mach_task_basic_info æ˜¯ä¸€ä¸ª task_info ç»“æ„ä½“çš„å­é›†ï¼Œå®ƒæä¾›äº†å…³äºä»»åŠ¡ï¼ˆè¿›ç¨‹ï¼‰çš„åŸºæœ¬ä¿¡æ¯ï¼ŒåŒ…æ‹¬å†…å­˜ä½¿ç”¨æƒ…å†µã€‚ç‰¹åˆ«åœ°ï¼Œä½ å¯ä»¥é€šè¿‡ phys_footprint å­—æ®µæ¥è·å–åº”ç”¨ç¨‹åºå®é™…å ç”¨çš„ç‰©ç†å†…å­˜é‡ã€‚\nimport Foundationfunc getMemoryUsage() -&gt; UInt64? &#123;    var info = mach_task_basic_info()    var count = mach_msg_type_number_t(MemoryLayout&lt;mach_task_basic_info&gt;.size) / 4        let kret = withUnsafeMutablePointer(to: &amp;info) &#123; infoPtr in        infoPtr.withMemoryRebound(to: integer_t.self, capacity: 1) &#123; intPtr in            task_info(mach_task_self_, task_flavor_t(MACH_TASK_BASIC_INFO), intPtr, &amp;count)        &#125;    &#125;        if kret == KERN_SUCCESS &#123;        return info.phys_footprint    &#125; else &#123;        print(&quot;Failed to get task info with error code \\(kret)&quot;)        return nil    &#125;&#125;// Usageif let memoryUsage = getMemoryUsage() &#123;    print(&quot;Memory usage: \\(memoryUsage / 1024 / 1024) MB&quot;)&#125;\nåœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œmach_task_basic_info ç»“æ„ä½“ç”¨äºå­˜å‚¨åŸºæœ¬ä¿¡æ¯ï¼Œtask_info() å‡½æ•°ç”¨æ¥å¡«å……è¿™äº›ä¿¡æ¯ï¼Œphys_footprint å­—æ®µæä¾›äº†ç‰©ç†å†…å­˜å ç”¨çš„å®é™…æ•°æ®ã€‚ä½¿ç”¨è¿™äº›åº•å±‚ API éœ€è¦é€‚å½“çš„æƒé™ï¼Œæœ‰æ—¶å¯èƒ½æ— æ³•åœ¨åº”ç”¨ç¨‹åºçš„æ²™ç›’ç¯å¢ƒä¸­è®¿é—®æ‰€æœ‰å†…å­˜ä¿¡æ¯ã€‚\nåœ¨ iOS ä¸­ï¼ŒNSProcessInfo çš„ physicalMemory å±æ€§å¯ä»¥ç”¨æ¥è·å–è®¾å¤‡çš„æ€»ç‰©ç†å†…å­˜å¤§å°ã€‚è¿™ä¸ªå±æ€§è¿”å›ä¸€ä¸ª NSUInteger ç±»å‹çš„å€¼ï¼Œè¡¨ç¤ºç‰©ç†å†…å­˜çš„å¤§å°ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ã€‚è¿™ä¸ªæ–¹æ³•åœ¨ iOS 9 åŠæ›´é«˜ç‰ˆæœ¬ä¸­å¯ç”¨ã€‚\nimport Foundationfunc getPhysicalMemorySize() -&gt; UInt64 &#123;    let physicalMemory = ProcessInfo.processInfo.physicalMemory    return physicalMemory&#125;// Usagelet memorySize = getPhysicalMemorySize()print(&quot;Total physical memory: \\(memorySize / 1024 / 1024) MB&quot;)\nvm_statistics_data_t æ˜¯ä¸€ä¸ªä¸è™šæ‹Ÿå†…å­˜ç›¸å…³çš„æ•°æ®ç»“æ„ï¼Œå®ƒæä¾›äº†å…³äºè™šæ‹Ÿå†…å­˜çš„ç»Ÿè®¡ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç³»ç»Ÿçš„å†…å­˜ä½¿ç”¨æƒ…å†µã€‚è™½ç„¶å®ƒä¸èƒ½ç›´æ¥æä¾›åº”ç”¨ç¨‹åºä½¿ç”¨çš„å†…å­˜ï¼Œä½†å®ƒå¯ä»¥æä¾›æœ‰å…³æ•´ä¸ªç³»ç»Ÿçš„è™šæ‹Ÿå†…å­˜çŠ¶æ€çš„ä¿¡æ¯ã€‚ä½¿ç”¨ vm_statistics_data_t å¯ä»¥è·å–æœ‰å…³ç³»ç»Ÿå†…å­˜çš„æ›´è¯¦ç»†çš„ç»Ÿè®¡æ•°æ®ã€‚\nimport Foundationimport MachOfunc getVMStatistics() -&gt; (freeMemory: UInt64, usedMemory: UInt64)? &#123;    var vmStats = vm_statistics_data_t()    var count = mach_msg_type_number_t(MemoryLayout&lt;vm_statistics_data_t&gt;.size) / 4    var hostPort: mach_port_t = mach_host_self()        let result = withUnsafeMutablePointer(to: &amp;vmStats) &#123; vmStatsPtr in        vmStatsPtr.withMemoryRebound(to: integer_t.self, capacity: 1) &#123; intPtr in            // ç”¨äºè·å–ä¸»æœºçš„ç»Ÿè®¡ä¿¡æ¯ã€‚é€šè¿‡æŒ‡å®š `HOST_VM_INFO`ï¼Œå¯ä»¥è·å–è™šæ‹Ÿå†…å­˜ç›¸å…³çš„æ•°æ®ã€‚            host_statistics(hostPort, HOST_VM_INFO, intPtr, &amp;count)        &#125;    &#125;        if result == KERN_SUCCESS &#123;        let pageSize = vm_kernel_page_size // ç³»ç»Ÿçš„é¡µé¢å¤§å°ï¼ˆé€šå¸¸ä¸º 4096 å­—èŠ‚ï¼‰ã€‚        let freeMemory = UInt64(vmStats.free_count) * UInt64(pageSize)        let usedMemory = (UInt64(vmStats.active_count) + UInt64(vmStats.inactive_count) + UInt64(vmStats.wire_count)) * UInt64(pageSize)        return (freeMemory, usedMemory)    &#125; else &#123;        print(&quot;Failed to get VM statistics with error code \\(result)&quot;)        return nil    &#125;&#125;// Usageif let vmStats = getVMStatistics() &#123;    print(&quot;Free memory: \\(vmStats.freeMemory / 1024 / 1024) MB&quot;)    print(&quot;Used memory: \\(vmStats.usedMemory / 1024 / 1024) MB&quot;)&#125;\nvm_statistics_data_t æ•°æ®ç»“æ„åŒ…å«äº†æœ‰å…³è™šæ‹Ÿå†…å­˜çš„ç»Ÿè®¡ä¿¡æ¯ï¼Œå¦‚ free_countï¼ˆè‡ªç”±é¡µæ•°ï¼‰ã€active_countï¼ˆæ´»è·ƒé¡µæ•°ï¼‰ã€inactive_countï¼ˆéæ´»è·ƒé¡µæ•°ï¼‰å’Œ wire_countï¼ˆè¢«é”å®šçš„é¡µæ•°ï¼‰ã€‚\nè·å–å¯ç”¨å†…å­˜çš„æ–¹æ³•å¦‚ä¸‹ï¼š\nimport Foundationimport MachOfunc getAvailableMemory() -&gt; UInt64? &#123;    var vmStats = vm_statistics_data_t()    var count = mach_msg_type_number_t(MemoryLayout&lt;vm_statistics_data_t&gt;.size) / 4    var hostPort: mach_port_t = mach_host_self()        let result = withUnsafeMutablePointer(to: &amp;vmStats) &#123; vmStatsPtr in        vmStatsPtr.withMemoryRebound(to: integer_t.self, capacity: 1) &#123; intPtr in            host_statistics(hostPort, HOST_VM_INFO, intPtr, &amp;count)        &#125;    &#125;        if result == KERN_SUCCESS &#123;        let pageSize = vm_kernel_page_size        let freeMemory = UInt64(vmStats.free_count) * UInt64(pageSize)        let inactiveMemory = UInt64(vmStats.inactive_count) * UInt64(pageSize)        return freeMemory + inactiveMemory    &#125; else &#123;        print(&quot;Failed to get VM statistics with error code \\(result)&quot;)        return nil    &#125;&#125;// Usageif let availableMemory = getAvailableMemory() &#123;    print(&quot;Available memory: \\(availableMemory / 1024 / 1024) MB&quot;)&#125;\nfree_count è¡¨ç¤ºç³»ç»Ÿä¸­æœªä½¿ç”¨çš„ç©ºé—²å†…å­˜é¡µæ•°ã€‚inactive_count è¡¨ç¤ºç³»ç»Ÿä¸­æœªä½¿ç”¨ä½†å¯èƒ½ä¼šé‡æ–°ä½¿ç”¨çš„å†…å­˜é¡µæ•°ã€‚å¯ç”¨å†…å­˜å¯ä»¥é€šè¿‡å°†ç©ºé—²å†…å­˜å’Œéæ´»è·ƒå†…å­˜çš„é¡µæ•°ä¹˜ä»¥é¡µé¢å¤§å°æ¥è®¡ç®—å¾—åˆ°ã€‚\né€ æˆå†…å­˜æ³„æ¼çš„å¸¸è§åŸå› å†…å­˜æ³„æ¼æŒ‡çš„æ˜¯ç¨‹åºä¸­å·²åŠ¨æ€åˆ†é…çš„å †å†…å­˜ç”±äºæŸäº›åŸå› æœªèƒ½é‡Šæ”¾æˆ–æ— æ³•é‡Šæ”¾ï¼Œå¯¼è‡´ç³»ç»Ÿå†…å­˜æµªè´¹ï¼Œç¨‹åºè¿è¡Œé€Ÿåº¦å˜æ…¢ç”šè‡³ç³»ç»Ÿå´©æºƒã€‚\n\nå¾ªç¯å¼•ç”¨ï¼šå¯¹è±¡Aå¼ºå¼•ç”¨å¯¹è±¡Bï¼Œå¯¹è±¡Båˆå¼ºå¼•ç”¨å¯¹è±¡Aï¼Œæˆ–å¤šä¸ªå¯¹è±¡äº’ç›¸å¼ºå¼•ç”¨å½¢æˆé—­ç¯ã€‚ä½¿ç”¨Weak-Strong Danceã€æ–­å¼€æŒæœ‰å…³ç³»ï¼ˆå¦‚ä½¿ç”¨__blockå…³é”®å­—ã€å°†selfä½œä¸ºå‚æ•°ä¼ å…¥blockï¼‰ã€‚\nBlockå¯¼è‡´çš„å†…å­˜æ³„æ¼ï¼šBlockä¼šå¯¹å…¶å†…éƒ¨çš„å¯¹è±¡å¼ºå¼•ç”¨ï¼Œå®¹æ˜“å½¢æˆå¾ªç¯å¼•ç”¨ã€‚ä½¿ç”¨Weak-Strong Danceã€æ–­å¼€æŒæœ‰å…³ç³»ï¼ˆå¦‚å°†selfä½œä¸ºå‚æ•°ä¼ å…¥blockï¼‰ã€‚\nNSTimerå¯¼è‡´çš„å†…å­˜æ³„æ¼ï¼šNSTimerçš„target-actionæœºåˆ¶å®¹æ˜“å¯¼è‡´selfä¸timerä¹‹é—´çš„å¾ªç¯å¼•ç”¨ã€‚åœ¨åˆé€‚çš„æ—¶æœºé”€æ¯NSTimerã€ä½¿ç”¨GCDçš„å®šæ—¶å™¨ã€å€ŸåŠ©ä¸­ä»‹è€…ï¼ˆå¦‚NSObjectå¯¹è±¡æˆ–NSProxyå­ç±»ï¼‰æ–­å¼€å¾ªç¯å¼•ç”¨ã€ä½¿ç”¨iOS 10åæä¾›çš„blockæ–¹å¼åˆ›å»ºtimerã€‚\nå§”æ‰˜æ¨¡å¼ä¸­çš„å†…å­˜æ³„æ¼ï¼šUITableViewçš„delegateå’ŒdataSourceã€NSURLSessionçš„delegateã€‚æ ¹æ®å…·ä½“åœºæ™¯é€‰æ‹©ä½¿ç”¨weakæˆ–strongä¿®é¥°delegateå±æ€§ï¼Œæˆ–åœ¨è¯·æ±‚ç»“æŸæ—¶æ‰‹åŠ¨é”€æ¯sessionå¯¹è±¡ã€‚\néOCå¯¹è±¡çš„å†…å­˜ç®¡ç†ï¼šCoreFoundationæ¡†æ¶ä¸‹çš„å¯¹è±¡ï¼ˆå¦‚CIã€CGã€CFå¼€å¤´çš„å¯¹è±¡ï¼‰å’ŒCè¯­è¨€ä¸­çš„mallocåˆ†é…çš„å†…å­˜ã€‚ä½¿ç”¨å®Œæ¯•åéœ€æ‰‹åŠ¨é‡Šæ”¾ï¼ˆå¦‚CFReleaseã€freeï¼‰ã€‚\n\nMetricsMetricså’ŒXCTestä¸­çš„memgraph äº†è§£å’Œè¯Šæ–­ Xcode çš„å†…å­˜æ€§èƒ½é—®é¢˜ã€‚\nå†…å­˜æ³„æ¼æ£€æµ‹å·¥å…·åŸç†å†…å­˜æ³„æ¼æŒ‡çš„æ˜¯ç¨‹åºåœ¨è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œåˆ†é…çš„å†…å­˜æœªèƒ½åŠæ—¶é‡Šæ”¾ï¼Œå¯¼è‡´ç¨‹åºå ç”¨çš„å†…å­˜æŒç»­å¢åŠ ã€‚å†…å­˜æ³„æ¼æ£€æµ‹å·¥å…·çš„åŸºæœ¬åŸç†æ˜¯ç›‘æ§å’Œç®¡ç†å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸï¼Œæ£€æµ‹é‚£äº›åœ¨ç”Ÿå‘½å‘¨æœŸç»“æŸåä»æœªè¢«é‡Šæ”¾çš„å¯¹è±¡ã€‚\nFBRetainCycleDetectorFBRetainCycleDetector æ˜¯ç”± Facebook å¼€æºçš„ä¸€ä¸ªç”¨äºæ£€æµ‹ iOS åº”ç”¨ä¸­çš„å†…å­˜æ³„æ¼çš„å·¥å…·ã€‚å†…å­˜æ³„æ¼é€šå¸¸æ˜¯ç”±äºå¯¹è±¡ä¹‹é—´çš„å¼ºå¼•ç”¨å¾ªç¯å¯¼è‡´çš„ï¼ŒFBRetainCycleDetector çš„å·¥ä½œåŸç†å°±æ˜¯æ£€æµ‹å¯¹è±¡å›¾ä¸­çš„å¼ºå¼•ç”¨å¾ªç¯ï¼Œè¿›è€Œå¸®åŠ©å¼€å‘è€…è¯†åˆ«å’Œä¿®å¤è¿™äº›æ³„æ¼ã€‚\nFBRetainCycleDetector çš„æ ¸å¿ƒæ€æƒ³æ˜¯é€šè¿‡åˆ†æå¯¹è±¡ä¹‹é—´çš„å¼•ç”¨å…³ç³»æ¥è¯†åˆ«å¯èƒ½çš„å¾ªç¯å¼•ç”¨ã€‚å®ƒé€šè¿‡ä»¥ä¸‹æ­¥éª¤å®ç°è¿™ä¸€ç‚¹ï¼š\n\nå¯¹è±¡å›¾æ„å»ºï¼šFBRetainCycleDetector é¦–å…ˆä¼šä»ä¸€ä¸ªæŒ‡å®šçš„å¯¹è±¡å¼€å§‹ï¼Œé€’å½’åœ°éå†è¯¥å¯¹è±¡çš„æ‰€æœ‰å±æ€§å’Œå…³è”å¯¹è±¡ï¼Œæ„å»ºä¸€ä¸ªå¼•ç”¨å›¾ã€‚è¿™ä¸ªå›¾çš„èŠ‚ç‚¹æ˜¯å¯¹è±¡ï¼Œè¾¹æ˜¯å¯¹è±¡ä¹‹é—´çš„å¼ºå¼•ç”¨ã€‚\næ·±åº¦ä¼˜å…ˆæœç´¢ (DFS)ï¼šåœ¨æ„å»ºå®Œå¯¹è±¡å›¾ä¹‹åï¼ŒFBRetainCycleDetector ä¼šå¯¹å›¾è¿›è¡Œæ·±åº¦ä¼˜å…ˆæœç´¢ï¼Œå¯»æ‰¾ä»èµ·å§‹å¯¹è±¡åˆ°è‡ªèº«çš„å¾ªç¯è·¯å¾„ã€‚æ¢å¥è¯è¯´ï¼Œå®ƒä¼šæŸ¥æ‰¾è·¯å¾„èµ·å§‹å’Œç»ˆæ­¢äºåŒä¸€ä¸ªå¯¹è±¡çš„é—­ç¯ã€‚\nå¾ªç¯æ£€æµ‹ï¼šå½“æ‰¾åˆ°ä¸€ä¸ªå¾ªç¯è·¯å¾„æ—¶ï¼ŒFBRetainCycleDetector å°±ä¼šå°†å…¶æ ‡è®°ä¸ºæ½œåœ¨çš„å†…å­˜æ³„æ¼ã€‚æ£€æµ‹åˆ°çš„å¾ªç¯ä¼šä»¥æ˜“äºç†è§£çš„æ–¹å¼è¾“å‡ºï¼Œå¸®åŠ©å¼€å‘è€…å®šä½å’Œè§£å†³é—®é¢˜ã€‚\n\nä¸ºäº†é¿å…ä¸å¿…è¦çš„æ£€æµ‹ï¼ŒFBRetainCycleDetector å…è®¸å¼€å‘è€…å®šä¹‰ä¸€äº›å±æ€§è¿‡æ»¤è§„åˆ™ï¼Œå¿½ç•¥ä¸€äº›ä¸ä¼šå¯¼è‡´æ³„æ¼çš„å¼•ç”¨ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥è·³è¿‡ä¸€äº›ä¸å¯è§çš„ç³»ç»Ÿå±æ€§æˆ–è‡ªå®šä¹‰çš„éæŒæœ‰æ€§å¼•ç”¨ã€‚å·¥å…·èƒ½å¤Ÿè¯†åˆ«å¹¶å¿½ç•¥å¼±å¼•ç”¨ï¼ˆweakæˆ–unownedï¼‰ï¼Œå› ä¸ºè¿™äº›å¼•ç”¨ä¸ä¼šå¯¼è‡´å†…å­˜æ³„æ¼ã€‚FBRetainCycleDetector å…·æœ‰è¾ƒé«˜çš„çµæ´»æ€§ï¼Œå¼€å‘è€…å¯ä»¥é€šè¿‡æ‰©å±•å’Œå®šåˆ¶å¯¹è±¡å›¾çš„éå†è§„åˆ™ï¼Œä½¿å…¶é€‚åº”ä¸åŒçš„åº”ç”¨åœºæ™¯å’Œå¤æ‚å¯¹è±¡ç»“æ„ã€‚ç”±äºå¯¹è±¡å›¾çš„éå†å’Œå¾ªç¯æ£€æµ‹å¯èƒ½ä¼šå¸¦æ¥æ€§èƒ½å¼€é”€ï¼ŒFBRetainCycleDetector ä¸»è¦ç”¨äºå¼€å‘å’Œè°ƒè¯•é˜¶æ®µï¼Œè€Œä¸å»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒä¸­é•¿æœŸä½¿ç”¨ã€‚\né€šå¸¸ï¼ŒFBRetainCycleDetector ä¼šåœ¨è°ƒè¯•æ—¶è¢«ä½¿ç”¨ã€‚å¼€å‘è€…å¯ä»¥é€šè¿‡ç®€å•çš„ä»£ç è°ƒç”¨ï¼Œæ£€æµ‹æŒ‡å®šå¯¹è±¡æ˜¯å¦å­˜åœ¨å¾ªç¯å¼•ç”¨ã€‚ä¾‹å¦‚ï¼š\nFBRetainCycleDetector *detector = [FBRetainCycleDetector new];[detector addCandidate:someObject];NSSet *retainCycles = [detector findRetainCycles];\né€šè¿‡ä»¥ä¸Šä»£ç ï¼Œå¯ä»¥æŸ¥æ‰¾someObject æ˜¯å¦å­˜åœ¨å¾ªç¯å¼•ç”¨ï¼Œå¹¶è¿”å›æ£€æµ‹åˆ°çš„å¾ªç¯è·¯å¾„ã€‚\nåœ¨å®é™…åº”ç”¨ä¸­ï¼ŒFBRetainCycleDetector è¢«å¹¿æ³›ç”¨äºæ£€æµ‹å¤æ‚çš„å¯¹è±¡ä¹‹é—´çš„å¼•ç”¨å…³ç³»ï¼Œç‰¹åˆ«æ˜¯åœ¨è‡ªå®šä¹‰æ§ä»¶ã€å¤§å‹è§†å›¾æ§åˆ¶å™¨ã€ç½‘ç»œå›è°ƒç­‰åœºæ™¯ä¸‹ï¼Œå®¹æ˜“äº§ç”Ÿå¼ºå¼•ç”¨å¾ªç¯çš„é—®é¢˜ã€‚é€šè¿‡æ—©æœŸæ£€æµ‹å’Œè§£å†³è¿™äº›å¾ªç¯å¼•ç”¨ï¼Œå¯ä»¥å¤§å¤§æé«˜åº”ç”¨çš„å†…å­˜ç®¡ç†æ•ˆç‡ï¼Œå‡å°‘å†…å­˜æ³„æ¼å¸¦æ¥çš„é—®é¢˜ã€‚\nMLeaksFinderMLeaksFinder æ˜¯ä¸€æ¬¾ç”±è…¾è®¯ WeRead å›¢é˜Ÿå¼€æºçš„ iOS å†…å­˜æ³„æ¼æ£€æµ‹å·¥å…·ï¼Œå…¶åŸç†ä¸»è¦åŸºäºå¯¹è±¡ç”Ÿå‘½å‘¨æœŸçš„ç›‘æ§å’Œå»¶è¿Ÿæ£€æµ‹æœºåˆ¶ã€‚\nMLeaksFinder é€šè¿‡ä¸ºåŸºç±» NSObject æ·»åŠ ä¸€ä¸ª -willDealloc æ–¹æ³•æ¥ç›‘æ§å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸã€‚å½“å¯¹è±¡åº”è¯¥è¢«é‡Šæ”¾æ—¶ï¼ˆä¾‹å¦‚ï¼ŒViewController è¢« pop æˆ– dismiss åï¼‰ï¼Œè¯¥æ–¹æ³•è¢«è°ƒç”¨ã€‚åœ¨ -willDealloc æ–¹æ³•ä¸­ï¼ŒMLeaksFinder ä½¿ç”¨ä¸€ä¸ªå¼±æŒ‡é’ˆï¼ˆweak pointerï¼‰æŒ‡å‘å¾…æ£€æµ‹çš„å¯¹è±¡ï¼Œä»¥é¿å…å› ä¸ºå¯¹è±¡å·²ç»è¢«é‡Šæ”¾è€Œå¯¼è‡´çš„é‡æŒ‡é’ˆè®¿é—®é—®é¢˜ã€‚MLeaksFinder é€šè¿‡æ£€æŸ¥è§†å›¾æ§åˆ¶å™¨çš„ç”Ÿå‘½å‘¨æœŸæ¥æ£€æµ‹å†…å­˜æ³„æ¼ã€‚æ¯ä¸ª UIViewController éƒ½æœ‰ä¸€ä¸ª viewDidDisappear æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šåœ¨è§†å›¾æ§åˆ¶å™¨ä»å±å¹•ä¸Šæ¶ˆå¤±æ—¶è¢«è°ƒç”¨ã€‚MLeaksFinder é€šè¿‡åœ¨ viewDidDisappear è¢«è°ƒç”¨æ—¶ï¼Œæ£€æµ‹è¯¥è§†å›¾æ§åˆ¶å™¨æ˜¯å¦å·²ç»è¢«é‡Šæ”¾ï¼Œå¦‚æœæ²¡æœ‰è¢«é‡Šæ”¾åˆ™è®¤ä¸ºå­˜åœ¨å†…å­˜æ³„æ¼ã€‚å¯¹äºè§†å›¾ (UIView)ï¼ŒMLeaksFinder ä¼šåœ¨è§†å›¾è¢«ä»å…¶çˆ¶è§†å›¾ä¸­ç§»é™¤æ—¶ï¼ˆå³ removeFromSuperview è°ƒç”¨åï¼‰æ£€æŸ¥è§†å›¾æ˜¯å¦å·²ç»è¢«é‡Šæ”¾ã€‚å¦‚æœè§†å›¾æ²¡æœ‰è¢«é‡Šæ”¾ï¼Œåˆ™è®¤ä¸ºå­˜åœ¨å†…å­˜æ³„æ¼ã€‚MLeaksFinder é€šè¿‡æ‰©å±• NSObject çš„åŠŸèƒ½ï¼ˆå³ä¸º NSObject æ·»åŠ ä¸€ä¸ª Categoryï¼‰æ¥è¿½è¸ªå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸã€‚å½“å¯¹è±¡çš„ dealloc æ–¹æ³•æ²¡æœ‰åœ¨é¢„æœŸçš„æ—¶é—´å†…è¢«è°ƒç”¨æ—¶ï¼Œå°±å¯ä»¥åˆ¤æ–­è¯¥å¯¹è±¡æ˜¯å¦æ³„æ¼ã€‚\nåœ¨ -willDealloc æ–¹æ³•ä¸­ï¼ŒMLeaksFinder ä½¿ç”¨ dispatch_after å‡½æ•°åœ¨ GCDï¼ˆGrand Central Dispatchï¼‰çš„ä¸»é˜Ÿåˆ—ä¸Šè®¾ç½®ä¸€ä¸ªå»¶è¿Ÿï¼ˆé€šå¸¸æ˜¯2åˆ°3ç§’ï¼‰æ‰§è¡Œçš„ blockã€‚è¿™ä¸ª block åœ¨å»¶è¿Ÿæ—¶é—´åæ‰§è¡Œï¼Œå°è¯•é€šè¿‡ä¹‹å‰è®¾ç½®çš„å¼±æŒ‡é’ˆè®¿é—®å¯¹è±¡ã€‚å¦‚æœå¯¹è±¡å·²ç»è¢«é‡Šæ”¾ï¼ˆå³å¼±æŒ‡é’ˆä¸º nilï¼‰ï¼Œåˆ™è®¤ä¸ºæ²¡æœ‰å†…å­˜æ³„æ¼ï¼›å¦‚æœå¯¹è±¡ä»ç„¶å­˜æ´»ï¼Œåˆ™è®¤ä¸ºå­˜åœ¨å†…å­˜æ³„æ¼ã€‚MLeaksFinder é€šè¿‡å°†å¯¹è±¡çš„æ£€æµ‹ä»»åŠ¡åŠ å…¥åˆ°ä¸‹ä¸€ä¸ª Runloop ä¸­æ‰§è¡Œï¼Œä»è€Œé¿å…åœ¨å½“å‰çº¿ç¨‹ä¸­ç›´æ¥æ‰§è¡Œæ£€æµ‹æ“ä½œã€‚è¿™ç§æ–¹å¼ç¡®ä¿äº†ä¸ä¼šå½±å“ä¸»çº¿ç¨‹çš„æ€§èƒ½ï¼ŒåŒæ—¶èƒ½åœ¨é€‚å½“çš„æ—¶é—´è¿›è¡Œå†…å­˜æ³„æ¼çš„æ£€æµ‹ã€‚\nå¦‚æœåœ¨å»¶è¿Ÿæ—¶é—´åå¯¹è±¡ä»ç„¶å­˜æ´»ï¼ŒMLeaksFinder ä¼šæ‰§è¡Œç›¸åº”çš„æ£€æµ‹é€»è¾‘ï¼Œå¹¶å¯èƒ½é€šè¿‡æ–­è¨€ï¼ˆassertionï¼‰ä¸­æ–­åº”ç”¨ï¼ˆå…·ä½“è¡Œä¸ºå¯èƒ½æ ¹æ®é…ç½®å’Œç‰ˆæœ¬æœ‰æ‰€ä¸åŒï¼‰ã€‚MLeaksFinder ä¼šåœ¨åº”ç”¨è¿è¡Œæ—¶è‡ªåŠ¨æ£€æµ‹å†…å­˜æ³„æ¼ï¼Œä¸éœ€è¦å¼€å‘è€…æ‰‹åŠ¨è§¦å‘ã€‚æ£€æµ‹åˆ°å†…å­˜æ³„æ¼åï¼ŒMLeaksFinder é€šå¸¸ä¼šå¼¹å‡ºè­¦å‘Šæ¡†ï¼ˆalertï¼‰æˆ–é€šè¿‡æ—¥å¿—ï¼ˆlogï¼‰è¾“å‡ºç›¸å…³ä¿¡æ¯ï¼Œå¸®åŠ©å¼€å‘è€…å®šä½å’Œè§£å†³å†…å­˜æ³„æ¼é—®é¢˜ã€‚\nMLeaksFinder ä½¿ç”¨äº†æ–¹æ³•äº¤æ¢æŠ€æœ¯æ›¿æ¢å¦‚dismissViewControllerAnimated:completion:ç­‰æ–¹æ³•ï¼Œç¡®ä¿é‡Šæ”¾æ—¶è§¦å‘æ£€æµ‹ã€‚è°ƒç”¨willDeallocæ–¹æ³•ï¼Œè®¾ç½®å»¶æ—¶æ£€æŸ¥å¯¹è±¡æ˜¯å¦å·²é‡Šæ”¾ã€‚è‹¥æœªé‡Šæ”¾ï¼Œåˆ™è¿›å…¥assertNotDeallocæ–¹æ³•ï¼Œä¸­æ–­è¨€æé†’å¼€å‘è€…ã€‚\nå½“ MLeaksFinder æ£€æµ‹åˆ°æ½œåœ¨çš„å†…å­˜æ³„æ¼æ—¶ï¼Œå®ƒè¿˜å¯ä»¥æ‰“å°å †æ ˆä¿¡æ¯ï¼Œå¸®åŠ©å¼€å‘è€…æ‰¾å‡ºå¯¼è‡´å¯¹è±¡æ— æ³•é‡Šæ”¾çš„å…·ä½“ä»£ç è·¯å¾„ã€‚é€šè¿‡willReleaseChildã€willReleaseChildrenæ–¹æ³•æ„å»ºå­å¯¹è±¡çš„é‡Šæ”¾å †æ ˆä¿¡æ¯ã€‚è¿™é€šå¸¸é€šè¿‡é€’å½’éå†å­å¯¹è±¡ï¼Œå¹¶å°†çˆ¶å¯¹è±¡å’Œå­å¯¹è±¡çš„ç±»åç»„åˆæˆè§†å›¾å †æ ˆï¼ˆview stackï¼‰æ¥å®ç°ã€‚\nMLeaksFinder è¿˜å¯èƒ½é›†æˆäº†å¾ªç¯å¼•ç”¨æ£€æµ‹åŠŸèƒ½ï¼Œä½¿ç”¨å¦‚ Facebook çš„ FBRetainCycleDetector è¿™æ ·çš„å·¥å…·æ¥æ‰¾å‡ºç”± block ç­‰é€ æˆçš„å¾ªç¯å¼•ç”¨é—®é¢˜ã€‚MLeaksFinder æä¾›äº†ä¸€ç§ç™½åå•æœºåˆ¶ï¼Œå…è®¸å¼€å‘è€…å°†ä¸€äº›ç‰¹å®šçš„å¯¹è±¡æ’é™¤åœ¨æ³„æ¼æ£€æµ‹ä¹‹å¤–ã€‚è¿™åœ¨æŸäº›å¯¹è±¡ç¡®å®éœ€è¦æŒä¹…å­˜åœ¨çš„åœºæ™¯ä¸‹éå¸¸æœ‰ç”¨ã€‚MLeaksFinder éå¸¸è½»é‡ï¼Œä¸ä¼šæ˜¾è‘—å½±å“åº”ç”¨çš„æ€§èƒ½ã€‚é›†æˆç®€å•ï¼Œè‡ªåŠ¨åŒ–æ£€æµ‹ï¼Œæå¤§åœ°æ–¹ä¾¿äº†å¼€å‘è€…å‘ç°å†…å­˜æ³„æ¼é—®é¢˜ã€‚åœ¨æŸäº›å¤æ‚çš„æƒ…å†µä¸‹ï¼Œå¯èƒ½ä¼šæœ‰è¯¯æŠ¥ï¼ˆå³è®¤ä¸ºå¯¹è±¡æ³„æ¼äº†ï¼Œä½†å®é™…ä¸Šæ²¡æœ‰ï¼‰ã€‚\nPLeakSnifferPLeakSnifferæ˜¯ä¸€ä¸ªç”¨äºæ£€æµ‹iOSåº”ç”¨ç¨‹åºä¸­å†…å­˜æ³„æ¼çš„å·¥å…·ã€‚PLeakSnifferçš„åŸºæœ¬å·¥ä½œåŸç†ï¼šé€šè¿‡å¯¹æ§åˆ¶å™¨å’Œè§†å›¾å¯¹è±¡è®¾ç½®å¼±å¼•ç”¨ï¼Œå¹¶ä½¿ç”¨å•ä¾‹å¯¹è±¡å‘¨æœŸæ€§åœ°å‘é€pingé€šçŸ¥ï¼Œå¦‚æœå¯¹è±¡åœ¨æ§åˆ¶å™¨å·²é‡Šæ”¾çš„æƒ…å†µä¸‹ä»ç„¶å“åº”é€šçŸ¥ï¼Œåˆ™å¯èƒ½å­˜åœ¨å†…å­˜æ³„æ¼ã€‚\nPLeakSnifferCitizenåè®®çš„è®¾è®¡åŠå…¶åœ¨NSObjectã€UIViewControllerã€UINavigationControllerå’ŒUIViewä¸­çš„å®ç°ã€‚æ¯ä¸ªç±»éƒ½é€šè¿‡å®ç°prepareForSnifferæ–¹æ³•æ¥æŒ‚é’©é€‚å½“çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼ˆå¦‚viewDidAppearã€pushViewControllerç­‰ï¼‰ï¼Œåœ¨é€‚å½“çš„æ—¶æœºè°ƒç”¨markAliveæ–¹æ³•ï¼Œå°†ä»£ç†å¯¹è±¡é™„åŠ åˆ°è¢«ç›‘æµ‹çš„å¯¹è±¡ä¸Šï¼Œä»¥ä¾¿åç»­çš„pingæ“ä½œèƒ½å¤Ÿæ£€æµ‹åˆ°å¯¹è±¡çš„å­˜æ´»çŠ¶æ€ã€‚\nä»£ç†å¯¹è±¡PObjectProxyçš„åŠŸèƒ½ï¼Œå®ƒä¸»è¦è´Ÿè´£æ¥æ”¶pingé€šçŸ¥å¹¶æ£€æŸ¥å®¿ä¸»å¯¹è±¡æ˜¯å¦åº”å½“è¢«é‡Šæ”¾ï¼Œå¦‚æœæ£€æµ‹åˆ°å¯èƒ½çš„å†…å­˜æ³„æ¼ï¼Œå°±ä¼šè§¦å‘è­¦æŠ¥æˆ–æ‰“å°æ—¥å¿—ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼ŒPLeakSnifferèƒ½å¤Ÿåœ¨è¿è¡Œæ—¶æ£€æµ‹åˆ°iOSåº”ç”¨ä¸­å¯èƒ½å­˜åœ¨çš„å†…å­˜æ³„æ¼é—®é¢˜ã€‚\nå…¶ä»–å†…å­˜æ³„æ¼æ£€æµ‹å·¥å…·\nLifetimeTracker\n\nhook mallocæ–¹æ³•è¦åœ¨ iOS ä¸Š hook malloc æ–¹æ³•ï¼Œå¯ä»¥ä½¿ç”¨å‡½æ•°æ‹¦æˆªæŠ€æœ¯ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œå±•ç¤ºå¦‚ä½•ä½¿ç”¨ Fishhook åº“æ¥ hook malloc æ–¹æ³•ã€‚\nå°† Fishhook åº“æ·»åŠ åˆ°ä½ çš„é¡¹ç›®ä¸­ã€‚ä½ å¯ä»¥é€šè¿‡ CocoaPods æˆ–æ‰‹åŠ¨æ·»åŠ  Fishhook æºä»£ç ã€‚\n#import &lt;Foundation/Foundation.h&gt;#import &lt;malloc/malloc.h&gt;#import &quot;fishhook.h&quot;// åŸå§‹ malloc å‡½æ•°æŒ‡é’ˆstatic void* (*original_malloc)(size_t size);// è‡ªå®šä¹‰ malloc å‡½æ•°void* custom_malloc(size_t size) &#123;    void *result = original_malloc(size);    NSLog(@&quot;Allocated %zu bytes at %p&quot;, size, result);    return result;&#125;// Hook å‡½æ•°void hookMalloc() &#123;    // é‡æ–°ç»‘å®š malloc å‡½æ•°    rebind_symbols((struct rebinding[1])&#123;&#123;&quot;malloc&quot;, custom_malloc, (void *)&amp;original_malloc&#125;&#125;, 1);&#125;int main(int argc, const char * argv[]) &#123;    @autoreleasepool &#123;        // Hook malloc        hookMalloc();                // æµ‹è¯• malloc å’Œ free        void *ptr = malloc(1024);        free(ptr);    &#125;    return 0;&#125;\nåœ¨å®é™…é¡¹ç›®ä¸­ä½¿ç”¨æ—¶ï¼Œæ³¨æ„æ€§èƒ½å¼€é”€å’Œæ—¥å¿—è®°å½•çš„å½±å“ã€‚\nmalloc loggermalloc_logger æ˜¯ iOS å’Œ macOS ä¸­ç”¨äºå†…å­˜åˆ†é…è°ƒè¯•çš„ä¸€ä¸ªå·¥å…·ã€‚å®ƒå…è®¸å¼€å‘è€…è®¾ç½®ä¸€ä¸ªè‡ªå®šä¹‰çš„æ—¥å¿—è®°å½•å™¨å‡½æ•°ï¼Œä»¥ä¾¿åœ¨å†…å­˜åˆ†é…å’Œé‡Šæ”¾æ“ä½œå‘ç”Ÿæ—¶è®°å½•ç›¸å…³ä¿¡æ¯ã€‚é€šè¿‡ä½¿ç”¨ malloc_loggerï¼Œå¼€å‘è€…å¯ä»¥æ›´å®¹æ˜“åœ°æ£€æµ‹å’Œè¯Šæ–­å†…å­˜é—®é¢˜ï¼Œå¦‚å†…å­˜æ³„æ¼ã€è¿‡åº¦åˆ†é…ç­‰ã€‚\nä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨ Objective-C å®ç°çš„ç¤ºä¾‹ï¼Œå±•ç¤ºå¦‚ä½•è®¾ç½®å’Œä½¿ç”¨ malloc_loggerï¼š\n#import &lt;Foundation/Foundation.h&gt;#import &lt;malloc/malloc.h&gt;// å®šä¹‰è‡ªå®šä¹‰çš„ malloc logger å‡½æ•°void custom_malloc_logger(uint32_t type, uintptr_t arg1, uintptr_t arg2, uintptr_t result, uintptr_t num_bytes) &#123;    switch (type) &#123;        case MALLOC_LOG_TYPE_ALLOCATE:            NSLog(@&quot;Allocated %lu bytes at %p&quot;, (unsigned long)num_bytes, (void *)result);            break;        case MALLOC_LOG_TYPE_DEALLOCATE:            NSLog(@&quot;Deallocated memory at %p&quot;, (void *)arg1);            break;        case MALLOC_LOG_TYPE_HAS_ZONE:            NSLog(@&quot;Memory operation with zone at %p&quot;, (void *)arg1);            break;        default:            break;    &#125;&#125;// è®¾ç½®è‡ªå®šä¹‰çš„ malloc loggervoid setCustomMallocLogger() &#123;    malloc_logger = custom_malloc_logger;&#125;int main(int argc, const char * argv[]) &#123;    @autoreleasepool &#123;        // è®¾ç½®è‡ªå®šä¹‰ malloc logger        setCustomMallocLogger();                // æµ‹è¯• malloc å’Œ free        void *ptr = malloc(1024);        free(ptr);    &#125;    return 0;&#125;\nåœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªè‡ªå®šä¹‰çš„ malloc_logger å‡½æ•° custom_malloc_loggerï¼Œå¹¶åœ¨ setCustomMallocLogger å‡½æ•°ä¸­å°†å…¶è®¾ç½®ä¸ºå½“å‰çš„ malloc_loggerã€‚ç„¶åï¼Œåœ¨ main å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬æµ‹è¯•äº†å†…å­˜çš„åˆ†é…å’Œé‡Šæ”¾æ“ä½œï¼Œå¹¶é€šè¿‡æ—¥å¿—è®°å½•å™¨è®°å½•è¿™äº›æ“ä½œçš„ä¿¡æ¯ã€‚\né€šè¿‡è¿™ç§æ–¹å¼ï¼Œå¼€å‘è€…å¯ä»¥åœ¨å†…å­˜åˆ†é…å’Œé‡Šæ”¾æ—¶è®°å½•ç›¸å…³ä¿¡æ¯ï¼Œä»è€Œæ›´å¥½åœ°ç†è§£å’Œä¼˜åŒ–åº”ç”¨ç¨‹åºçš„å†…å­˜ä½¿ç”¨æƒ…å†µã€‚\nå†…å­˜å¿«ç…§æ£€æµ‹æ–¹æ¡ˆæ‰«æè¿›ç¨‹ä¸­æ‰€æœ‰Dirtyå†…å­˜ï¼Œå»ºç«‹å†…å­˜èŠ‚ç‚¹ä¹‹é—´çš„å¼•ç”¨å…³ç³»æœ‰å‘å›¾ï¼Œç”¨äºå†…å­˜é—®é¢˜çš„åˆ†æå®šä½ã€‚\nåœ¨ iOS ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ vmregionrecurse_64 å‡½æ•°æ¥è·å–æ‰€æœ‰å†…å­˜åŒºåŸŸçš„ä¿¡æ¯ã€‚\n#include &lt;stdio.h&gt;  #include &lt;stdlib.h&gt;  #include &lt;mach/mach.h&gt;  #include &lt;mach/vm_map.h&gt;    int main(int argc, const char * argv[]) &#123;      mach_port_t task = mach_task_self();      vm_address_t address = VM_MIN_ADDRESS;      vm_size_t size = VM_MAX_ADDRESS - VM_MIN_ADDRESS;      vm_region_basic_info_data_64_t info;      mach_msg_type_number_t info_count = VM_REGION_BASIC_INFO_COUNT_64;      memory_object_name_t object_name;      mach_port_t object_handle;        kern_return_t kr;        while (size &gt; 0) &#123;          kr = vm_region_recurse_64(task, &amp;address, &amp;size, VM_REGION_BASIC_INFO,                                    (vm_region_info_t)&amp;info, &amp;info_count, &amp;object_name,                                    &amp;object_handle);            if (kr != KERN_SUCCESS)              break;            printf(&quot;Address: 0x%llx, Size: 0x%llx, Protection: 0x%x, In Use: %s\\n&quot;,                 (unsigned long long)info.protection,                 (unsigned long long)info.size,                 (unsigned int)info.protection,                 info.is_submap ? &quot;Yes&quot; : &quot;No&quot;);            address += info.size;          size -= info.size;      &#125;        if (kr != KERN_SUCCESS) &#123;          char *err = mach_error_string(kr);          fprintf(stderr, &quot;vm_region_recurse_64 failed: %s\\n&quot;, err);          free(err);      &#125;        return 0;  &#125;\nåœ¨iOSä¸­ï¼Œå¯ä»¥ä½¿ç”¨libmallocåº“æä¾›çš„malloc_get_all_zoneså‡½æ•°æ¥è·å–æ‰€æœ‰å†…å­˜åŒºåŸŸï¼ˆzoneï¼‰çš„ä¿¡æ¯ã€‚malloc_get_all_zoneså¯ä»¥éå†æ‰€æœ‰çš„å†…å­˜åŒºåŸŸï¼Œå¹¶ä¸ºæ¯ä¸ªåŒºåŸŸæ‰§è¡Œä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œä»è€Œè·å–è¯¦ç»†çš„å†…å­˜åˆ†é…ä¿¡æ¯ã€‚\nä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ä»£ç ç¤ºä¾‹ï¼Œå±•ç¤ºå¦‚ä½•ä½¿ç”¨malloc_get_all_zonesæ¥è·å–å¹¶æ‰“å°å†…å­˜åŒºåŸŸçš„ä¿¡æ¯ï¼š\n#import &lt;malloc/malloc.h&gt;#import &lt;mach/mach.h&gt;// è‡ªå®šä¹‰çš„å›è°ƒå‡½æ•°ï¼Œç”¨äºå¤„ç†æ¯ä¸ªå†…å­˜åŒºåŸŸçš„å—ã€‚è¯¥å‡½æ•°ç”¨äºå¤„ç†æ¯ä¸ªzoneä¸­çš„å†…å­˜å—ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå®ƒç®€å•åœ°æ‰“å°å‡ºæ¯ä¸ªå†…å­˜å—çš„åœ°å€å’Œå¤§å°ã€‚void my_zone_enumerator(task_t task, void *context, unsigned type_mask, vm_range_t *ranges, unsigned range_count) &#123;    for (unsigned i = 0; i &lt; range_count; i++) &#123;        printf(&quot;Memory range: 0x%llx, Size: %llu\\n&quot;, ranges[i].address, ranges[i].size);    &#125;&#125;void print_all_zones() &#123;    // è·å–å½“å‰ä»»åŠ¡çš„mach portã€‚ç”¨äºè·å–å½“å‰ä»»åŠ¡çš„Machç«¯å£ï¼Œè¿™å¯¹äºä¸Machå†…æ ¸é€šä¿¡æ˜¯å¿…éœ€çš„ã€‚    task_t task = mach_task_self();    unsigned int count;    // è¿™æ˜¯`libmalloc`åº“ä¸­çš„ä¸€ä¸ªç»“æ„ä½“ï¼Œè¡¨ç¤ºå†…å­˜åŒºåŸŸã€‚é€šè¿‡è°ƒç”¨å…¶`introspect`å±æ€§ä¸‹çš„`enumerator`å‡½æ•°ï¼Œå¯ä»¥éå†è¯¥zoneä¸­çš„æ‰€æœ‰å†…å­˜å—ã€‚    malloc_zone_t **zones = NULL;    // è·å–æ‰€æœ‰çš„å†…å­˜åŒºåŸŸã€‚è¿™ä¸ªå‡½æ•°è¿”å›å½“å‰ä»»åŠ¡çš„æ‰€æœ‰å†…å­˜åŒºåŸŸï¼ˆzoneï¼‰ï¼Œè¿™äº›zoneé€šå¸¸å¯¹åº”äºä¸åŒçš„åˆ†é…å™¨æˆ–å†…å­˜æ± ã€‚    kern_return_t kr = malloc_get_all_zones(task, NULL, &amp;zones, &amp;count);    if (kr != KERN_SUCCESS) &#123;        fprintf(stderr, &quot;Error: Unable to get all zones\\n&quot;);        return;    &#125;    // éå†æ‰€æœ‰çš„zone    for (unsigned int i = 0; i &lt; count; i++) &#123;        malloc_zone_t *zone = zones[i];        if (zone != NULL) &#123;            printf(&quot;Zone name: %s\\n&quot;, zone-&gt;zone_name);            // æšä¸¾zoneä¸­çš„å†…å­˜å—            zone-&gt;introspect-&gt;enumerator(task, NULL, MALLOC_PTR_IN_USE_RANGE_TYPE, (vm_address_t)zone, my_zone_enumerator);        &#125;    &#125;&#125;int main(int argc, const char * argv[]) &#123;    print_all_zones();    return 0;&#125;\nä½¿ç”¨å•ç‹¬çš„malloc_zoneç®¡ç†é‡‡é›†æ¨¡å—çš„å†…å­˜ä½¿ç”¨ï¼Œå‡å°‘éæ³•å†…å­˜è®¿é—®ã€‚éå†è¿›ç¨‹å†…æ‰€æœ‰VM Regionï¼ˆè™šæ‹Ÿå†…å­˜åŒºåŸŸï¼‰ï¼Œè·å–Dirtyå’ŒSwappedå†…å­˜é¡µæ•°ã€‚é‡ç‚¹å…³æ³¨libmallocç®¡ç†çš„å †å†…å­˜ï¼Œè·å–å­˜æ´»å†…å­˜èŠ‚ç‚¹çš„æŒ‡é’ˆå’Œå¤§å°ã€‚\nä¸ºå†…å­˜èŠ‚ç‚¹èµ‹äºˆè¯¦ç»†çš„ç±»å‹åç§°ï¼Œå¦‚Objective-C&#x2F;Swift&#x2F;C++å®ä¾‹ç±»åç­‰ã€‚é€šè¿‡è¿è¡Œæ—¶ä¿¡æ¯å’Œmach-oã€C++ ABIæ–‡æ¡£è·å–C++å¯¹è±¡çš„ç±»å‹ä¿¡æ¯ã€‚éå†å†…å­˜èŠ‚ç‚¹ï¼Œæœç´¢å¹¶ç¡®è®¤èŠ‚ç‚¹é—´çš„å¼•ç”¨å…³ç³»ã€‚å¯¹æ ˆå†…å­˜å’ŒObjective-C&#x2F;Swiftå †å†…å­˜è¿›è¡Œç‰¹æ®Šå¤„ç†ï¼Œè·å–æ›´è¯¦ç»†çš„å¼•ç”¨ä¿¡æ¯ã€‚\nåå°çº¿ç¨‹å®šæ—¶æ£€æµ‹å†…å­˜å ç”¨ï¼Œè¶…è¿‡è®¾å®šçš„å±é™©é˜ˆå€¼åè§¦å‘å†…å­˜åˆ†æã€‚å†…å­˜åˆ†æè¿‡ç¨‹ä¸­ï¼Œå¯¹å†…å­˜èŠ‚ç‚¹è¿›è¡Œå¼•ç”¨å…³ç³»åˆ†æï¼Œç”Ÿæˆå†…å­˜èŠ‚ç‚¹ä¹‹é—´çš„å¼•ç”¨å…³ç³»æœ‰å‘å›¾ã€‚é€šè¿‡å›¾ç®—æ³•ï¼Œæ‰¾åˆ°å†…å­˜æ³„æ¼çš„æ ¹åŸå› ã€‚\nlibmalloc å†…å­˜æ—¥å¿—åˆ†æé€šè¿‡ä»£ç æ§åˆ¶å†…å­˜æ—¥å¿—å¼€å…³ï¼Œå¯ä»¥åœ¨å†…å­˜æ³„æ¼å‘ç”Ÿæ—¶ï¼Œè¾“å‡ºå†…å­˜æ—¥å¿—ã€‚å†…å­˜æ—¥å¿—åŒ…æ‹¬å†…å­˜åˆ†é…ã€é‡Šæ”¾ã€å¼•ç”¨è®¡æ•°å˜åŒ–ç­‰ä¿¡æ¯ï¼Œç”¨äºåˆ†æå†…å­˜æ³„æ¼çš„åŸå› ã€‚\nåœ¨ iOS å¼€å‘ä¸­ï¼Œlibmalloc æä¾›äº† turn_on_stack_logging å’Œ turn_off_stack_logging æ–¹æ³•ï¼Œç”¨äºå¯ç”¨å’Œç¦ç”¨å †æ ˆæ—¥å¿—è®°å½•ã€‚è¿™äº›æ–¹æ³•å¯ä»¥å¸®åŠ©å¼€å‘è€…åœ¨è°ƒè¯•å’Œåˆ†æå†…å­˜é—®é¢˜æ—¶è®°å½•å†…å­˜åˆ†é…çš„å †æ ˆä¿¡æ¯ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨è¿™äº›æ–¹æ³•çš„ä»£ç ç¤ºä¾‹ï¼š\n#import &lt;Foundation/Foundation.h&gt;#import &lt;malloc/malloc.h&gt;#import &lt;mach/mach.h&gt;#import &lt;mach/mach_init.h&gt;#import &lt;mach/mach_vm.h&gt;// å¯ç”¨å †æ ˆæ—¥å¿—è®°å½•void enableStackLogging() &#123;    turn_on_stack_logging(1);    NSLog(@&quot;Stack logging turned on&quot;);&#125;// ç¦ç”¨å †æ ˆæ—¥å¿—è®°å½•void disableStackLogging() &#123;    turn_off_stack_logging();    NSLog(@&quot;Stack logging turned off&quot;);&#125;// è·å–å †æ ˆæ—¥å¿—è®°å½•void getStackLoggingRecords() &#123;    // è·å–å½“å‰ä»»åŠ¡    task_t task = mach_task_self();        // è·å–æ‰€æœ‰å †æ ˆæ—¥å¿—è®°å½•    mach_vm_address_t *records;    uint32_t count;    kern_return_t kr = __mach_stack_logging_enumerate_records(task, &amp;records, &amp;count);        if (kr != KERN_SUCCESS) &#123;        NSLog(@&quot;Failed to enumerate stack logging records: %s&quot;, mach_error_string(kr));        return;    &#125;        for (uint32_t i = 0; i &lt; count; i++) &#123;        mach_vm_address_t record = records[i];        NSLog(@&quot;Record %u: %p&quot;, i, (void *)record);                // å®šä¹‰å †æ ˆå¸§æ•°ç»„        uint64_t frames[128];        // è·å–å †æ ˆå¸§ä¿¡æ¯        uint32_t frameCount = __mach_stack_logging_frames_for_uniqued_stack(task, record, frames, 128);                // éå†å †æ ˆå¸§ï¼Œæ¯æ¬¡å¾ªç¯ä¸­ï¼Œè·å–å½“å‰å †æ ˆå¸§åœ°å€å¹¶æ‰“å°åœ°å€ä¿¡æ¯        for (uint32_t j = 0; j &lt; frameCount; j++) &#123;            NSLog(@&quot;Frame %u: %p&quot;, j, (void *)frames[j]);        &#125;    &#125;        // é‡Šæ”¾è®°å½•æ•°ç»„    vm_deallocate(task, (vm_address_t)records, count * sizeof(mach_vm_address_t));&#125;// ç¤ºä¾‹å‡½æ•°ï¼Œåˆ†é…ä¸€äº›å†…å­˜void allocateMemory() &#123;    void *ptr1 = malloc(1024);    void *ptr2 = malloc(2048);    free(ptr1);    free(ptr2);&#125;// ä¸»å‡½æ•°int main(int argc, const char * argv[]) &#123;    @autoreleasepool &#123;        // å¯ç”¨å †æ ˆæ—¥å¿—è®°å½•        enableStackLogging();                // åˆ†é…å†…å­˜        allocateMemory();                // è·å–å †æ ˆæ—¥å¿—è®°å½•        getStackLoggingRecords();                // ç¦ç”¨å †æ ˆæ—¥å¿—è®°å½•        disableStackLogging();    &#125;    return 0;&#125;\nåœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆè°ƒç”¨ turnonstacklogging æ–¹æ³•æ¥å¯ç”¨å †æ ˆæ—¥å¿—è®°å½•ï¼Œç„¶åè¿›è¡Œä¸€äº›å†…å­˜åˆ†é…å’Œé‡Šæ”¾æ“ä½œã€‚æ¥ç€ï¼Œæˆ‘ä»¬è°ƒç”¨ __machstackloggingenumeraterecords æ–¹æ³•è·å–æ‰€æœ‰å †æ ˆæ—¥å¿—è®°å½•ï¼Œå¹¶ä½¿ç”¨ __machstackloggingframesforuniquedstack æ–¹æ³•è§£ææ¯ä¸ªæ—¥å¿—è®°å½•ä»¥è·å–å †æ ˆå¸§ä¿¡æ¯ã€‚æœ€åï¼Œæˆ‘ä»¬è°ƒç”¨ turnoffstacklogging æ–¹æ³•æ¥ç¦ç”¨å †æ ˆæ—¥å¿—è®°å½•ã€‚\né€šè¿‡è¿™ç§æ–¹å¼ï¼Œå¼€å‘è€…å¯ä»¥åœ¨éœ€è¦æ—¶å¯ç”¨å’Œç¦ç”¨å †æ ˆæ—¥å¿—è®°å½•ï¼Œå¹¶è§£æè¿™äº›æ—¥å¿—è®°å½•ä»¥è·å–è¯¦ç»†çš„å †æ ˆä¿¡æ¯ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™äº›å‡½æ•°åœ¨å®é™…é¡¹ç›®ä¸­ä½¿ç”¨æ—¶ï¼Œéœ€è¦ç¡®ä¿åœ¨åˆé€‚çš„æ—¶æœºå¯ç”¨å’Œç¦ç”¨å †æ ˆæ—¥å¿—è®°å½•ï¼Œä»¥é¿å…æ€§èƒ½å¼€é”€å’Œä¸å¿…è¦çš„æ—¥å¿—è®°å½•ã€‚\n","categories":["æ€§èƒ½ä¼˜åŒ–"],"tags":["æ€§èƒ½ä¼˜åŒ–","å†…å­˜ç®¡ç†"]},{"title":"é™æ€åˆ†æ","url":"/2025/05/19/%E9%9D%99%E6%80%81%E5%88%86%E6%9E%90/","content":"æ¦‚è¿°é™æ€ç¨‹åºåˆ†ææ˜¯ä¸€ç§åœ¨ä¸æ‰§è¡Œä»£ç çš„æƒ…å†µä¸‹ï¼Œå¯¹ä»£ç è¿›è¡Œåˆ†æä»¥å‘ç°æ½œåœ¨é—®é¢˜ã€ä¼˜åŒ–ä»£ç è´¨é‡æˆ–æ£€æµ‹å®‰å…¨æ¼æ´çš„æ–¹æ³•ã€‚\né™æ€åˆ†ææ–¹æ³•æœ‰ï¼š\n\nè¯­æ³•æ£€æŸ¥ (Syntax Checking)\nä»£ç è§„èŒƒæ£€æŸ¥ (Linting)\næ•°æ®æµåˆ†æ (Data Flow Analysis)\næ§åˆ¶æµåˆ†æ (Control Flow Analysis)\nå®‰å…¨æ¼æ´æ£€æµ‹ (Security Vulnerability Detection)\n\nå¸¸ç”¨é™æ€åˆ†æå·¥å…·æœ‰ï¼š\nXcode é™æ€åˆ†æå™¨ã€‚Xcode è‡ªå¸¦çš„é™æ€åˆ†æå™¨èƒ½å¤Ÿåˆ†æ Objective-C å’Œ Swift ä»£ç ï¼Œè‡ªåŠ¨æ£€æµ‹æ½œåœ¨çš„å†…å­˜ç®¡ç†é—®é¢˜ã€é€»è¾‘é”™è¯¯ä»¥åŠå¯èƒ½çš„å®‰å…¨æ¼æ´ã€‚å¼€å‘è€…å¯ä»¥åœ¨ Xcode ä¸­å¼€å¯é™æ€åˆ†æåŠŸèƒ½ï¼Œé€šè¿‡èœå•è·¯å¾„ Product -&gt; Analyze æ¥æ‰§è¡Œåˆ†æã€‚\nSwiftLint æ˜¯ä¸€ä¸ªä¸“ä¸º Swift è¯­è¨€è®¾è®¡çš„é™æ€åˆ†æå·¥å…·ï¼Œç”¨äºç¡®ä¿ä»£ç ç¬¦åˆ Swift çš„ç¼–ç é£æ ¼å’Œæœ€ä½³å®è·µã€‚å®ƒèƒ½å¤Ÿæ£€æµ‹ä»£ç ä¸­çš„æ ¼å¼é—®é¢˜ã€ä¸è§„èŒƒçš„å‘½åã€æœªä½¿ç”¨çš„ä»£ç ç­‰ã€‚\nbrew install swiftlintswiftlint lint\n\nOCLint æ˜¯ä¸€æ¬¾é€‚ç”¨äº Objective-Cã€C å’Œ C++ ä»£ç çš„é™æ€åˆ†æå·¥å…·ï¼Œä¸“æ³¨äºä»£ç è´¨é‡çš„æå‡ã€‚å®ƒèƒ½å¤Ÿæ£€æµ‹ä»£ç ä¸­çš„å¸¸è§é—®é¢˜ï¼Œå¦‚å¤æ‚åº¦è¿‡é«˜ã€æœªä½¿ç”¨çš„ä»£ç ç­‰ï¼Œå¹¶æä¾›è¯¦ç»†çš„æŠ¥å‘Šã€‚\nbrew install oclintoclint-json-compilation-database -e Pods -- -report-type html -o oclint_report.html\n\nInfer æ˜¯ç”± Facebook å¼€å‘çš„ä¸€æ¬¾å¼€æºé™æ€åˆ†æå·¥å…·ï¼Œæ”¯æŒåˆ†æ Objective-C å’Œ Swift ä»£ç ã€‚å®ƒç‰¹åˆ«æ“…é•¿æ£€æµ‹ç©ºæŒ‡é’ˆå¼•ç”¨ã€å†…å­˜æ³„æ¼å’Œèµ„æºæ³„æ¼ç­‰å¸¸è§é—®é¢˜ã€‚\nbrew install inferinfer run -- xcodebuild -workspace YourApp.xcworkspace -scheme YourApp\nä¸ºäº†è·å¾—æ›´å…¨é¢çš„é™æ€åˆ†æç»“æœï¼Œå¼€å‘è€…é€šå¸¸ä¼šç»“åˆå¤šç§å·¥å…·å’Œæ–¹æ³•ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ Xcode çš„é™æ€åˆ†æå™¨è¿›è¡ŒåŸºæœ¬çš„ä»£ç æ£€æŸ¥ï¼Œä½¿ç”¨ SwiftLint å’Œ OCLint ç¡®ä¿ä»£ç è§„èŒƒï¼Œæœ€åé€šè¿‡ Infer è¿›è¡Œæ·±å…¥çš„é€»è¾‘å’Œå®‰å…¨åˆ†æã€‚\næ­¤å¤–ï¼Œè®¸å¤šé™æ€åˆ†æå·¥å…·æ”¯æŒé›†æˆåˆ°æŒç»­é›†æˆï¼ˆCIï¼‰ç³»ç»Ÿä¸­ï¼Œä½¿å¾—é™æ€åˆ†ææˆä¸ºå¼€å‘æµç¨‹çš„ä¸€éƒ¨åˆ†ï¼Œç¡®ä¿æ¯æ¬¡ä»£ç æäº¤éƒ½ç¬¦åˆè´¨é‡æ ‡å‡†ã€‚\nClangé™æ€åˆ†æå™¨ä½¿ç”¨é™æ€åˆ†æå™¨æ˜¯Xcodeå†…ç½®çš„ä¸€ä¸ªå·¥å…·ï¼Œå®ƒå¯ä»¥åœ¨ä¸è¿è¡Œæºä»£ç çš„æƒ…å†µä¸‹è¿›è¡Œé™æ€çš„ä»£ç åˆ†æã€‚é™æ€åˆ†æå™¨ä¸æ‰§è¡Œä»£ç ï¼Œè€Œæ˜¯é€šè¿‡é™æ€åˆ†ææ¥æ£€æŸ¥ä»£ç ä¸­çš„é€»è¾‘ã€å®‰å…¨å’ŒAPIä½¿ç”¨ç­‰é—®é¢˜ã€‚ä¸»è¦æ”¯æŒC&#x2F;C++&#x2F;Objective-Cï¼Œå¯¹Objective-Cå’ŒSwiftæ··ç¼–çš„å·¥ç¨‹ä¹Ÿæœ‰å¾ˆå¥½çš„æ”¯æŒã€‚\nåœ¨Xcodeä¸­ï¼Œé€šè¿‡ç‚¹å‡»Productèœå•ä¸‹çš„Analyzeé€‰é¡¹æ¥å¯åŠ¨é™æ€åˆ†æå™¨ã€‚åˆ†æå®Œæˆåï¼Œé—®é¢˜ä¼šä»¥è“è‰²çš„æ„Ÿå¹å·åœ¨Xcodeä¸Šæ–¹æ˜¾ç¤ºï¼Œä¹Ÿå¯ä»¥åœ¨Issue Navigatorä¸­æŸ¥çœ‹ã€‚\nClangé™æ€åˆ†æå™¨çš„æ¨¡å—ä½äº&#x2F;llvm&#x2F;tools&#x2F;clang&#x2F;lib&#x2F;StaticAnalyzerã€‚Checkersç›®å½•ä¸‹åŒ…å«äº†å„ç§æ£€æŸ¥å™¨ï¼Œæ¯ä¸ªæ£€æŸ¥å™¨è´Ÿè´£ä¸€ä¸ªç‹¬ç«‹çš„æ£€æŸ¥é¡¹ç›®ã€‚å…±ç”¨é€»è¾‘éƒ¨åˆ†ä¸‹æ²‰åˆ°Coreæ¨¡å—ä¸­ï¼Œå¤§é‡ä¾èµ–LLVMå’ŒClangçš„åº“ã€‚\n\nscan-buildï¼šè´Ÿè´£å¯¹ç›®æ ‡ä»£ç è¿›è¡Œåˆ†æï¼Œå¹¶ç”ŸæˆHTMLæ ·å¼çš„åˆ†ææŠ¥å‘Šã€‚\nscan-viewï¼šè´Ÿè´£åœ¨æœ¬åœ°è¿è¡Œä¸€ä¸ªç®€æ˜“çš„web serverï¼Œæ–¹ä¾¿æŸ¥çœ‹ç”Ÿæˆçš„æŠ¥å‘Šã€‚\n\nä½ ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ clang å‘½ä»¤æ¥è¿è¡Œé™æ€åˆ†æã€‚å‡è®¾ä½ æœ‰ä¸€ä¸ª C æ–‡ä»¶ example.cï¼Œå¯ä»¥è¿™æ ·è¿è¡Œåˆ†æï¼š\nclang --analyze example.c\nè¿™å°†å¯¹ example.c è¿›è¡Œé™æ€åˆ†æï¼Œå¹¶è¾“å‡ºåˆ†æç»“æœã€‚\nè®©æˆ‘ä»¬ä»¥ä¸€ä¸ªç®€å•çš„ C ç¨‹åºä¸ºä¾‹ï¼Œå®ƒå¯èƒ½åŒ…å«ä¸€äº›æ½œåœ¨çš„é”™è¯¯ï¼š\n#include &lt;stdio.h&gt;#include &lt;stdlib.h&gt;void risky_function(int *ptr) &#123;    if (*ptr &gt; 0) &#123;        printf(&quot;Value: %d\\n&quot;, *ptr);    &#125;&#125;int main() &#123;    int *p = malloc(sizeof(int) * 10);    // é”™è¯¯ï¼šæ²¡æœ‰æ£€æŸ¥ malloc æ˜¯å¦æˆåŠŸ    p[0] = 10;    // æ½œåœ¨çš„ç©ºæŒ‡é’ˆå¼•ç”¨    risky_function(p);    free(p);    return 0;&#125;\nåœ¨è¿™æ®µä»£ç ä¸­ï¼Œå­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š\n\nmalloc ä¹‹åæ²¡æœ‰æ£€æŸ¥æ˜¯å¦æˆåŠŸåˆ†é…å†…å­˜ã€‚\nå‡½æ•° risky_function ä¸­ï¼Œå¦‚æœä¼ å…¥ä¸€ä¸ªç©ºæŒ‡é’ˆ ptrï¼Œåˆ™å¯èƒ½ä¼šè§£å¼•ç”¨ç©ºæŒ‡é’ˆã€‚\n\nä½¿ç”¨ clang â€“analyze æ¥åˆ†æè¿™æ®µä»£ç ï¼š\nclang --analyze example.c\nè¾“å‡ºå¯èƒ½ä¼šåŒ…æ‹¬å¦‚ä¸‹è­¦å‘Šï¼š\nexample.c:12:5: warning: Dereference of null pointer (loaded from variable &#x27;p&#x27;)    p[0] = 10;    ^example.c:15:5: warning: Dereference of null pointer (loaded from variable &#x27;ptr&#x27;)    if (*ptr &gt; 0) &#123;    ^\nå¦‚æœä½ åœ¨ä½¿ç”¨ Xcode è¿›è¡Œå¼€å‘ï¼Œä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼å¯ç”¨é™æ€åˆ†æï¼š\n\nåœ¨ Xcode ä¸­æ‰“å¼€ä½ çš„é¡¹ç›®ã€‚\né€‰æ‹© Product &gt; Analyzeï¼ŒXcode å°†è¿è¡Œé™æ€åˆ†æå¹¶åœ¨æŠ¥å‘Šå¯¼èˆªå™¨ä¸­æ˜¾ç¤ºå‘ç°çš„æ‰€æœ‰é—®é¢˜ã€‚\n\næ ¹æ® Clang é™æ€åˆ†æå™¨çš„æç¤ºï¼Œæˆ‘ä»¬å¯ä»¥ä¿®æ”¹ä»£ç æ¥ä¿®å¤è¿™äº›æ½œåœ¨çš„é—®é¢˜ï¼š\n#include &lt;stdio.h&gt;#include &lt;stdlib.h&gt;void risky_function(int *ptr) &#123;    if (ptr != NULL &amp;&amp; *ptr &gt; 0) &#123;        printf(&quot;Value: %d\\n&quot;, *ptr);    &#125;&#125;int main() &#123;    int *p = malloc(sizeof(int) * 10);    if (p == NULL) &#123;        printf(&quot;Memory allocation failed\\n&quot;);        return 1;    &#125;    p[0] = 10;    risky_function(p);    free(p);    return 0;&#125;\nåœ¨ä¿®å¤åçš„ä»£ç ä¸­ï¼š\n\næˆ‘ä»¬åœ¨ä½¿ç”¨ malloc åæ£€æŸ¥äº†æ˜¯å¦åˆ†é…æˆåŠŸã€‚\nåœ¨ risky_function ä¸­æ·»åŠ äº†ä¸€ä¸ªæ£€æŸ¥ï¼Œä»¥ç¡®ä¿ ptr ä¸ä¸º NULLã€‚\n\nClang é™æ€åˆ†æå™¨å¯ä»¥é›†æˆåˆ°æŒç»­é›†æˆï¼ˆCIï¼‰ç³»ç»Ÿä¸­ï¼Œè‡ªåŠ¨åˆ†æä»£ç åº“ä¸­çš„æ½œåœ¨é—®é¢˜ã€‚ä¸€ä¸ªç®€å•çš„æ–¹å¼æ˜¯å°† clang â€“analyze å‘½ä»¤æ·»åŠ åˆ°ä½ çš„ CI è„šæœ¬ä¸­ï¼Œè¿™æ ·æ¯æ¬¡æäº¤ä»£ç æ—¶éƒ½ä¼šè‡ªåŠ¨è¿è¡Œåˆ†æã€‚\nè‡ªå®šä¹‰Clang é™æ€åˆ†æå™¨å…è®¸ä½ è‡ªå®šä¹‰åˆ†æå™¨ï¼Œä»¥ä¾¿æ£€æµ‹ç‰¹å®šçš„ä»£ç æ¨¡å¼æˆ–éµå¾ªè‡ªå®šä¹‰è§„åˆ™ã€‚ä½ å¯ä»¥é€šè¿‡ç¼–å†™ Clang æ’ä»¶æˆ–ç›´æ¥ä¿®æ”¹ Clang æºä»£ç æ¥å®ç°è‡ªå®šä¹‰åˆ†æã€‚\nè‡ªå®šä¹‰æ£€æŸ¥å™¨æ˜¯ Clang é™æ€åˆ†æå™¨çš„ä¸€ä¸ªæ¨¡å—ï¼Œç”¨äºåˆ†æç‰¹å®šçš„ä»£ç æ¨¡å¼ã€‚ä½ å¯ä»¥é€šè¿‡åˆ›å»ºä¸€ä¸ªæ–°çš„ C++ ç±»å¹¶ç»§æ‰¿è‡ª Checker åŸºç±»æ¥å®ç°å®ƒã€‚\n#include &quot;clang/StaticAnalyzer/Core/Checker.h&quot;#include &quot;clang/StaticAnalyzer/Core/CheckerManager.h&quot;#include &quot;clang/StaticAnalyzer/Core/BugReporter/BugType.h&quot;#include &quot;clang/StaticAnalyzer/Core/PathSensitive/CheckerContext.h&quot;using namespace clang;using namespace ento;class NullDerefChecker : public Checker&lt;check::PreStmt&lt;UnaryOperator&gt;&gt; &#123;    mutable std::unique_ptr&lt;BugType&gt; BT;public:    void checkPreStmt(const UnaryOperator *U, CheckerContext &amp;C) const;private:    void reportBug(const UnaryOperator *U, CheckerContext &amp;C) const;&#125;;void NullDerefChecker::checkPreStmt(const UnaryOperator *U, CheckerContext &amp;C) const &#123;    if (U-&gt;getOpcode() == UO_Deref) &#123;        const Expr *SubExpr = U-&gt;getSubExpr()-&gt;IgnoreParenCasts();        const LocationContext *LCtx = C.getLocationContext();        const SVal &amp;Val = C.getState()-&gt;getSVal(SubExpr, LCtx);        if (Val.isUndef() || Val.isZeroConstant()) &#123;            reportBug(U, C);        &#125;    &#125;&#125;void NullDerefChecker::reportBug(const UnaryOperator *U, CheckerContext &amp;C) const &#123;    if (!BT)        BT.reset(new BugType(this, &quot;Dereference of null pointer&quot;, &quot;Example Checker&quot;));    auto Report = std::make_unique&lt;PathSensitiveBugReport&gt;(*BT, BT-&gt;getName(), C.generateErrorNode());    Report-&gt;addRange(U-&gt;getSourceRange());    C.emitReport(std::move(Report));&#125;extern &quot;C&quot; void clang_registerCheckers(CheckerRegistry &amp;registry) &#123;    registry.addChecker&lt;NullDerefChecker&gt;(&quot;example.NullDerefChecker&quot;, &quot;Checks for null pointer dereference&quot;, &quot;&quot;);&#125;\nå°†ä¸Šè¿°ä»£ç ä¿å­˜ä¸º NullDerefChecker.cppï¼Œç„¶åç¼–è¯‘å®ƒï¼š\nclang++ -shared -fPIC -o NullDerefChecker.so NullDerefChecker.cpp \\    $(llvm-config --cxxflags --ldflags --system-libs --libs all)\nç”Ÿæˆçš„ NullDerefChecker.so æ˜¯ä¸€ä¸ªå…±äº«åº“ï¼Œå¯ä»¥åœ¨è¿è¡Œ Clang é™æ€åˆ†ææ—¶åŠ è½½è¿™ä¸ªè‡ªå®šä¹‰æ£€æŸ¥å™¨ã€‚\nä½¿ç”¨ clang å‘½ä»¤è¿è¡Œä½ çš„è‡ªå®šä¹‰æ£€æŸ¥å™¨ï¼š\nclang --analyze -Xclang -load -Xclang ./NullDerefChecker.so -Xclang -analyzer-checker=example.NullDerefChecker example.c\nè¿™é‡Œ example.c æ˜¯è¦åˆ†æçš„ä»£ç æ–‡ä»¶ã€‚è‡ªå®šä¹‰æ£€æŸ¥å™¨å°†ä¼šåœ¨åˆ†ææ—¶æŸ¥æ‰¾ç©ºæŒ‡é’ˆè§£å¼•ç”¨çš„æƒ…å†µï¼Œå¹¶æŠ¥å‘Šä»»ä½•å‘ç°çš„é—®é¢˜ã€‚\nä¸Šé¢çš„ä»£ç å®ç°äº†ä¸€ä¸ªç®€å•çš„æ£€æŸ¥å™¨ NullDerefCheckerï¼Œå®ƒä¼šæ£€æµ‹æ‰€æœ‰çš„æŒ‡é’ˆè§£å¼•ç”¨æ“ä½œï¼Œå¹¶æ£€æŸ¥è¯¥æŒ‡é’ˆæ˜¯å¦ä¸ºç©ºæˆ–æœªå®šä¹‰ã€‚å¦‚æœå‘ç°æ½œåœ¨çš„ç©ºæŒ‡é’ˆè§£å¼•ç”¨ï¼Œå®ƒå°†æŠ¥å‘Šä¸€ä¸ªé”™è¯¯ã€‚\n\ncheckPreStmt æ–¹æ³•ï¼šåœ¨æ¯ä¸ªè§£å¼•ç”¨æ“ä½œä¹‹å‰è°ƒç”¨ï¼Œæ£€æŸ¥æŒ‡é’ˆæ˜¯å¦ä¸ºç©ºã€‚\nreportBug æ–¹æ³•ï¼šå½“æ£€æµ‹åˆ°æ½œåœ¨é—®é¢˜æ—¶ï¼Œç”Ÿæˆå¹¶æŠ¥å‘Šä¸€ä¸ªé”™è¯¯ã€‚\n\nä½ å¯ä»¥æ‰©å±•è‡ªå®šä¹‰æ£€æŸ¥å™¨æ¥æ”¯æŒæ›´å¤šç±»å‹çš„æ£€æŸ¥ï¼Œæˆ–ä½¿ç”¨å…¶ä»– Clang API æ¥åˆ†ææ›´å¤æ‚çš„ä»£ç ç»“æ„ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥åœ¨ checkPostCall ä¸­æ£€æŸ¥å‡½æ•°è°ƒç”¨åçš„è¿”å›å€¼ï¼Œæˆ–è€…åœ¨ checkEndAnalysis ä¸­å¯¹æ•´ä¸ªä»£ç è·¯å¾„è¿›è¡Œæ€»ç»“åˆ†æã€‚\nä»£ç è§„èŒƒä»£ç è§„èŒƒæŒ‡å—ä¸€äº›å¸¸è§çš„ iOS ä»£ç è§„èŒƒåŠå…¶å‚è€ƒèµ„æ–™ï¼š\n\nSwift å®˜æ–¹æ–‡æ¡£ï¼šåŒ…å« Swift è¯­è¨€çš„è¯¦ç»†è¯´æ˜å’Œè§„èŒƒã€‚\nGoogle Swift Style Guideï¼šGoogle æä¾›çš„ Swift ä»£ç é£æ ¼æŒ‡å—ã€‚\nSwiftLintï¼šä¸€ä¸ªç”¨äºå¼ºåˆ¶æ‰§è¡Œ Swift ä»£ç é£æ ¼å’Œè§„èŒƒçš„å·¥å…·ã€‚\nSwiftFormatï¼šä¸€ä¸ªç”¨äºè‡ªåŠ¨æ ¼å¼åŒ– Swift ä»£ç çš„å·¥å…·ã€‚\nNSHipsterï¼šä¸€ä¸ªæ¶µç›– iOS å’Œ macOS ç¼–ç¨‹çš„åšå®¢ï¼Œæä¾›äº†è®¸å¤šæœ‰ç”¨çš„æŠ€å·§å’Œæœ€ä½³å®è·µã€‚\n\nCode Review çš„é‡è¦æ€§\næé«˜ä»£ç è´¨é‡ï¼šé€šè¿‡å¤æŸ¥ä»£ç ï¼Œèƒ½å¤ŸåŠæ—¶å‘ç°å¹¶ä¿®å¤æ½œåœ¨çš„é—®é¢˜ï¼Œå¦‚é€»è¾‘é”™è¯¯ã€æ€§èƒ½ç“¶é¢ˆã€å®‰å…¨æ¼æ´ç­‰ã€‚\nä¿ƒè¿›çŸ¥è¯†å…±äº«ï¼šé«˜æ‰‹å¯ä»¥é€šè¿‡å®¡æŸ¥æ–°æ‰‹çš„ä»£ç ï¼Œä¼ æˆå¥½çš„ç¼–ç¨‹å®è·µå’Œç»éªŒï¼Œå¸®åŠ©æ–°æ‰‹å¿«é€Ÿæˆé•¿ã€‚åŒæ—¶ï¼Œå®¡æŸ¥è¿‡ç¨‹ä¹Ÿæ˜¯äº’ç›¸å­¦ä¹ çš„è¿‡ç¨‹ï¼Œæœ‰åŠ©äºå›¢é˜Ÿæˆå‘˜ä¹‹é—´çš„çŸ¥è¯†ä¼ é€’ã€‚\nä¿è¯å›¢é˜Ÿè§„èŒƒçš„æ‰§è¡Œï¼šæ¯ä¸ªå›¢é˜Ÿéƒ½æœ‰è‡ªå·±çš„ä»£ç è§„èŒƒå’Œå¼€å‘è§„èŒƒï¼Œé€šè¿‡ä»£ç å®¡æŸ¥å¯ä»¥ç¡®ä¿è¿™äº›è§„èŒƒå¾—åˆ°æ‰§è¡Œï¼Œé¿å…ä»£ç ä¸­å‡ºç°ä¸è§„èŒƒçš„æƒ…å†µã€‚\nå‡å°‘æŠ€æœ¯å€ºåŠ¡ï¼šåœ¨ä»£ç åˆå¹¶å‰è¿›è¡Œå®¡æŸ¥ï¼Œå¯ä»¥åŠæ—¶å‘ç°å¹¶ä¿®å¤é—®é¢˜ï¼Œé¿å…é—®é¢˜åœ¨åç»­å¼€å‘ä¸­è¢«æ”¾å¤§ï¼Œä»è€Œå‡å°‘æŠ€æœ¯å€ºåŠ¡ã€‚\n\nCode Review çš„æœ€ä½³å®è·µ\nä½œä¸ºå¼€å‘æµç¨‹çš„å¿…é€‰é¡¹ï¼šå°†Code Reviewä½œä¸ºå¼€å‘æµç¨‹çš„ä¸€ä¸ªå¿…è¦ç¯èŠ‚ï¼Œç¡®ä¿æ¯æ¬¡ä»£ç åˆå¹¶å‰éƒ½ç»è¿‡å®¡æŸ¥ã€‚è¿™æ ·å¯ä»¥ä¿è¯å®¡æŸ¥çš„ä»£ç é‡é€‚ä¸­ï¼Œå‡è½»å®¡æŸ¥è€…çš„å‹åŠ›ï¼ŒåŒæ—¶ä¹Ÿä½¿è¢«å®¡æŸ¥è€…æ›´æ„¿æ„ç§¯æä¿®æ”¹é—®é¢˜ã€‚\nå½¢æˆå¼€å‘æ–‡åŒ–ï¼šè®©Code Reviewæˆä¸ºå›¢é˜Ÿçš„ä¸€ç§æ–‡åŒ–ï¼Œè€Œä¸æ˜¯ä»…ä»…ä½œä¸ºä¸€ç§åˆ¶åº¦æ¥æ‰§è¡Œã€‚è¿™éœ€è¦å›¢é˜Ÿæˆå‘˜ä»å¿ƒåº•æ¥å—å¹¶è®¤çœŸæ‰§è¡ŒCode Reviewï¼ŒåŒæ—¶ç®¡ç†è€…ä¹Ÿéœ€è¦é€šè¿‡æ¿€åŠ±å’Œè¡¨ç‡ä½œç”¨æ¥æ¨åŠ¨è¿™ä¸€æ–‡åŒ–çš„å½¢æˆã€‚\nä½¿ç”¨åˆé€‚çš„å·¥å…·ï¼šç°åœ¨è®¸å¤šæºä»£ç ç®¡ç†å·¥å…·éƒ½è‡ªå¸¦Code Reviewå·¥å…·ï¼Œå¦‚Githubã€Gitlabã€Azure DevOpsç­‰ã€‚è¿™äº›å·¥å…·æä¾›äº†ä¸°å¯Œçš„åŠŸèƒ½ï¼Œå¦‚çº¿ä¸Šè®¨è®ºã€è¡Œçº§åˆ«çš„æ³¨é‡Šã€ç‰ˆæœ¬å†å²ç­‰ï¼Œæœ‰åŠ©äºæ›´é«˜æ•ˆåœ°è¿›è¡ŒCode Reviewã€‚\nåšå¥½è®¾è®¡å®¡æŸ¥ï¼šåœ¨å¼€å‘æ–°åŠŸèƒ½ä¹‹å‰ï¼Œå»ºè®®å…ˆå†™ä¸€ä¸ªç®€å•çš„è®¾è®¡æ–‡æ¡£ï¼Œå¹¶æ‰¾èµ„æ·±çš„å›¢é˜Ÿæˆå‘˜è¿›è¡Œè®¾è®¡å®¡æŸ¥ã€‚è¿™æ ·å¯ä»¥ç¡®ä¿è®¾è®¡ä¸Šçš„åˆç†æ€§ï¼Œå‡å°‘åœ¨Code Reviewæ—¶å‡ºç°çš„é—®é¢˜ã€‚\næäº¤å‰è‡ªæˆ‘å®¡æŸ¥ï¼šå¼€å‘äººå‘˜åœ¨æäº¤ä»£ç è¿›è¡ŒCode Reviewä¹‹å‰ï¼Œåº”è¯¥å…ˆè¿›è¡Œè‡ªæˆ‘å®¡æŸ¥ï¼Œç¡®ä¿ä»£ç çš„åŸºæœ¬è´¨é‡ã€‚è¿™åŒ…æ‹¬ç¼–å†™å¿…è¦çš„è‡ªåŠ¨åŒ–æµ‹è¯•ä»£ç ã€è¿è¡Œæµ‹è¯•ç”¨ä¾‹ç­‰ã€‚\nå°èŒƒå›´æäº¤ï¼šåœ¨æäº¤Pull Requestï¼ˆPRï¼‰æ—¶ï¼Œå°½é‡ä¿æŒå°èŒƒå›´çš„ä¿®æ”¹ã€‚å¦‚æœæ”¹åŠ¨è¾ƒå¤§ï¼Œå¯ä»¥åˆ†æ‰¹æäº¤ï¼Œä»¥å‡è½»å®¡æŸ¥è€…çš„å‹åŠ›ã€‚\næ˜ç¡®å®¡æŸ¥æ ‡å‡†ï¼šåˆ¶å®šæ˜ç¡®çš„å®¡æŸ¥æ ‡å‡†ï¼Œå¦‚ä»£ç é£æ ¼ã€æ³¨é‡Šè§„èŒƒã€æ€§èƒ½è¦æ±‚ç­‰ã€‚è¿™æœ‰åŠ©äºå®¡æŸ¥è€…æ›´å‡†ç¡®åœ°è¯„ä¼°ä»£ç è´¨é‡ï¼Œå¹¶ç»™å‡ºæœ‰é’ˆå¯¹æ€§çš„åé¦ˆã€‚\nåˆ†çº§è¯„è®ºï¼šå¯¹Reviewçš„è¯„è®ºè¿›è¡Œåˆ†çº§ï¼Œå¦‚[blocker]ï¼ˆå¿…é¡»ä¿®æ”¹ï¼‰ã€[optional]ï¼ˆå¯æ”¹å¯ä¸æ”¹ï¼‰ã€[question]ï¼ˆéœ€è¦æ¾„æ¸…ï¼‰ç­‰ã€‚è¿™æœ‰åŠ©äºè¢«å®¡æŸ¥è€…æ›´ç›´è§‚åœ°äº†è§£Reviewç»“æœï¼Œå¹¶æé«˜Reviewæ•ˆç‡ã€‚\n\nåº”é‡ç‚¹å…³æ³¨çš„æ–¹é¢\nä»£ç çš„æ•´ä½“ç»“æ„æ˜¯å¦åˆç†ï¼Ÿæ¨¡å—åŒ–æ˜¯å¦æ¸…æ™°ï¼Ÿ\nä»£ç æ˜¯å¦æ­£ç¡®åœ°å®ç°äº†é¢„æœŸåŠŸèƒ½ï¼Ÿæ˜¯å¦å­˜åœ¨é€»è¾‘é”™è¯¯ï¼Ÿ\nä»£ç æ˜¯å¦å¯ä»¥è¿›ä¸€æ­¥ç®€åŒ–ï¼Ÿæ˜¯å¦æœ‰é‡å¤ä»£ç ï¼Ÿ\nä»£ç æ˜¯å¦æœ‰å……åˆ†çš„æµ‹è¯•è¦†ç›–ï¼Ÿæ˜¯å¦æœ‰è¾¹ç•Œæ¡ä»¶çš„æµ‹è¯•ï¼Ÿ\nå‘½åæ˜¯å¦æ¸…æ™°ä¸”ç¬¦åˆå›¢é˜Ÿé£æ ¼ï¼Ÿæ˜¯å¦æœ‰æ³¨é‡Šï¼Ÿ\n\nCode Review éµå¾ªçš„åŸåˆ™éµå¾ª KISS åŸåˆ™ï¼ˆKeep It Simple, Stupid!ï¼‰ç®€å•æ˜¯ç¼–ç çš„æœ€é«˜å¢ƒç•Œã€‚ç¡®ä¿ä½ çš„ä»£ç ç®€æ´æ˜äº†ï¼Œæ˜“äºç†è§£å’Œç»´æŠ¤ã€‚\nç¤ºä¾‹\n// ç¤ºä¾‹ï¼šä¸€ä¸ªç®€å•çš„ç”¨æˆ·æ¨¡å‹å’Œç”¨æˆ·è§†å›¾// SwiftData: UserModelstruct UserModel: Codable, Identifiable &#123;    var id: String    var name: String    var email: String&#125;// SwiftUI: UserViewstruct UserView: View &#123;    @ObservedObject var viewModel: UserViewModel    var body: some View &#123;        VStack &#123;            Text(viewModel.user.name)            Text(viewModel.user.email)        &#125;        .padding()    &#125;&#125;// ViewModel ç®€åŒ–é€»è¾‘å¤„ç†class UserViewModel: ObservableObject &#123;    @Published var user: UserModel    init(user: UserModel) &#123;        self.user = user    &#125;&#125;// ä½¿ç”¨let user = UserModel(id: &quot;123&quot;, name: &quot;John Doe&quot;, email: &quot;john@example.com&quot;)let viewModel = UserViewModel(user: user)UserView(viewModel: viewModel)\né¿å…é‡å¤ä»£ç æ£€æŸ¥å¹¶åˆ é™¤é‡å¤çš„ä»£ç æ®µï¼Œä½¿ç”¨å‡½æ•°ã€ç±»ã€ç»“æ„ä½“æˆ–æšä¸¾æ¥å°è£…é‡å¤é€»è¾‘ã€‚\n// é¿å…åœ¨æ¯ä¸ªè§†å›¾ä¸­é‡å¤å†™ç”¨æˆ·ä¿¡æ¯å±•ç¤ºé€»è¾‘func displayUserInfo(user: UserModel) -&gt; some View &#123;    VStack &#123;        Text(user.name)        Text(user.email)    &#125;&#125;// åœ¨éœ€è¦çš„åœ°æ–¹ä½¿ç”¨UserView &#123;    displayUserInfo(user: viewModel.user)&#125;\nä¿æŒå‡½æ•°èŒè´£å•ä¸€ç¡®ä¿æ¯ä¸ªå‡½æ•°åªè´Ÿè´£ä¸€é¡¹åŠŸèƒ½ï¼Œè¿™æœ‰åŠ©äºä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚\n// å‡è®¾æœ‰ä¸€ä¸ªå‡½æ•°å¤„ç†ç”¨æˆ·ç™»å½•func loginUser(username: String, password: String) -&gt; Bool &#123;    // å‡è®¾è¿™é‡Œæ˜¯ç™»å½•é€»è¾‘    // ...    return true // ç™»å½•æˆåŠŸ&#125;// è€Œä¸æ˜¯func handleLogin(username: String, password: String, onSuccess: @escaping () -&gt; Void, onFailure: @escaping (Error) -&gt; Void) &#123;    // ç™»å½•é€»è¾‘ + UI æ›´æ–°é€»è¾‘    // ...&#125;\n\nä¼˜åŒ–é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•ç¡®ä¿ä»£ç ä¸­æœ‰é€‚å½“çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•ï¼Œä»¥ä¾¿åœ¨å‡ºç°é—®é¢˜æ—¶èƒ½å¤Ÿå¿«é€Ÿå®šä½å’Œè§£å†³ã€‚\n// å‡è®¾çš„æ—¥å¿—è®°å½•å‡½æ•°func logError(_ error: Error) &#123;    print(&quot;Error: \\(error.localizedDescription)&quot;)&#125;// ç¤ºä¾‹å‡½æ•°ä½¿ç”¨æ—¥å¿—è®°å½•func fetchData() &#123;    do &#123;        // å‡è®¾è¿™é‡Œæ˜¯æ•°æ®è·å–é€»è¾‘        // ...    &#125; catch let error &#123;        logError(error)    &#125;&#125;\n\nä»£ç å®¡æŸ¥å’Œåé¦ˆåœ¨å›¢é˜Ÿä¸­è¿›è¡Œå®šæœŸçš„ä»£ç å®¡æŸ¥ï¼Œåˆ†äº«æœ€ä½³å®è·µï¼ŒæŒ‡å‡ºæ½œåœ¨çš„é—®é¢˜ï¼Œå¹¶ä¿ƒè¿›å›¢é˜Ÿæ•´ä½“ä»£ç è´¨é‡çš„æå‡ã€‚\nå®é™…æ“ä½œï¼š\n\nä½¿ç”¨ GitHub Pull Requests, GitLab Merge Requests æˆ–å…¶ä»–ä»£ç æ‰˜ç®¡å¹³å°çš„å®¡æŸ¥åŠŸèƒ½ã€‚\nåœ¨å®¡æŸ¥è¿‡ç¨‹ä¸­ï¼Œæ³¨é‡ä»£ç çš„å¯è¯»æ€§ã€å¯ç»´æŠ¤æ€§ã€æ€§èƒ½ä¼˜åŒ–ç­‰æ–¹é¢ã€‚\næä¾›å…·ä½“çš„æ”¹è¿›å»ºè®®å’Œåé¦ˆï¼Œè€Œä¸æ˜¯ç®€å•çš„â€œè¿™ä¸ªä¸å¥½â€ã€‚\n\nåº¦é‡ä¸æ”¹è¿›é¡¹ç›®ææµ‹åç¬¬ä¸€æ—¶é—´è¿›è¡Œ Code Reviewã€‚å°æ¨¡å—éšæ—¶reviewï¼Œé¡¹ç›®ä»£ç é¢å¯¹é¢æŠ•å±ã€‚å…³æ³¨ä»£ç è®¾è®¡ã€æ€»ä½“æµç¨‹ã€å…³é”®è®¾è®¡ã€é‡ç‚¹åŠŸèƒ½ç­‰ã€‚éµå¾ªchecklistã€‚\næ”¹è¿›\n\nè·Ÿè¸ªCode Reviewç»“æœçš„æ‰§è¡Œï¼Œå¿…è¦æ—¶åŠ todoæŒ‡å®šæ—¶é—´å’Œäººå‘˜ä¿®æ”¹ã€‚\nå®šæœŸå›é¡¾å’Œæ€»ç»“ï¼Œæ›´æ–°checklistå’Œä»£ç è§„èŒƒã€‚\nå‘ç°å¥½çš„ä»£ç å’Œè®¾è®¡ï¼Œå®šæœŸå±•ç¤ºå¹¶ç»™äºˆå¥–åŠ±ã€‚\n\nCode Reviewçš„æ³¨æ„äº‹é¡¹\nä¿æŒå‹å¥½æ²Ÿé€šï¼šåœ¨Code Reviewè¿‡ç¨‹ä¸­ï¼Œåº”ä¿æŒå‹å¥½å’Œå°Šé‡çš„æ²Ÿé€šæ€åº¦ã€‚é¿å…ä½¿ç”¨è´Ÿé¢è¯æ±‡å’Œæ”»å‡»æ€§è¯­è¨€ï¼Œä»¥å…å¯¹å›¢é˜Ÿæˆå‘˜çš„å£«æ°”é€ æˆè´Ÿé¢å½±å“ã€‚\nåŠæ—¶åé¦ˆï¼šå®¡æŸ¥è€…åº”åŠæ—¶ç»™å‡ºåé¦ˆæ„è§ï¼Œå¹¶å°½é‡åœ¨ä»£ç æäº¤åçš„çŸ­æ—¶é—´å†…å®Œæˆå®¡æŸ¥ã€‚è¿™æœ‰åŠ©äºè¢«å®¡æŸ¥è€…åŠæ—¶ä¿®æ”¹é—®é¢˜ï¼Œå¹¶ä¿æŒå¼€å‘è¿›åº¦ã€‚\né‡è§†ä»£ç å¯è¯»æ€§ï¼šä»£ç çš„å¯è¯»æ€§å¯¹äºç»´æŠ¤æ€§å’Œæ‰©å±•æ€§è‡³å…³é‡è¦ã€‚åœ¨Code Reviewæ—¶ï¼Œåº”ç‰¹åˆ«å…³æ³¨ä»£ç çš„å¯è¯»æ€§ï¼Œå¦‚å‘½åè§„èŒƒã€æ³¨é‡Šæ¸…æ™°ç­‰ã€‚\nè€ƒè™‘æ€§èƒ½å’Œå®‰å…¨ï¼šé™¤äº†å…³æ³¨ä»£ç çš„åŸºæœ¬é€»è¾‘å’Œå¯è¯»æ€§å¤–ï¼Œè¿˜åº”è€ƒè™‘ä»£ç çš„æ€§èƒ½å’Œå®‰å…¨æ€§ã€‚å®¡æŸ¥è€…åº”è¯„ä¼°ä»£ç çš„æ€§èƒ½ç“¶é¢ˆå’Œæ½œåœ¨çš„å®‰å…¨æ¼æ´ï¼Œå¹¶ç»™å‡ºç›¸åº”çš„æ”¹è¿›å»ºè®®ã€‚\n\nPre-Commit Hookså®ç°ä»£ç è¯„å®¡ï¼ˆCode Reviewï¼‰ä¸ pre-commit é’©å­çš„ç»“åˆï¼Œå¯ä»¥åœ¨ä»£ç æäº¤å‰è‡ªåŠ¨æ‰§è¡Œä»£ç è¯„å®¡ï¼Œç¡®ä¿ä»£ç è´¨é‡ã€‚\n\nå®‰è£… Pre-Commitï¼š é¦–å…ˆéœ€è¦åœ¨é¡¹ç›®ä¸­å®‰è£… pre-commitï¼Œå¯ä»¥é€šè¿‡ pip æˆ–å…¶ä»–åŒ…ç®¡ç†å™¨å®‰è£…ã€‚\n\npip install pre-commit\n\né…ç½® Pre-Commitï¼š åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º .pre-commit-config.yaml æ–‡ä»¶ï¼Œå®šä¹‰éœ€è¦è¿è¡Œçš„é’©å­ã€‚ä¾‹å¦‚ï¼š\n\nrepos:  - repo: https://github.com/pre-commit/pre-commit-hooks    rev: v4.0.1    hooks:      - id: trailing-whitespace      - id: end-of-file-fixer  - repo: https://github.com/psf/black    rev: 23.1a1    hooks:      - id: black\nè¿™ä¸ªé…ç½®æ–‡ä»¶å®šä¹‰äº†å‡ ä¸ªå¸¸ç”¨çš„é’©å­ï¼Œæ¯”å¦‚å»é™¤å¤šä½™ç©ºæ ¼ã€ç¡®ä¿æ–‡ä»¶æœ«å°¾æœ‰æ¢è¡Œç¬¦ä»¥åŠä»£ç æ ¼å¼åŒ–ã€‚\n\nå®‰è£… Pre-Commit é’©å­ï¼š è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥å®‰è£…é¢„å®šä¹‰çš„é’©å­åˆ° Git ä»“åº“ä¸­ã€‚\n\npre-commit install\n\nè‡ªå®šä¹‰ Shell è„šæœ¬é’©å­ï¼š å¦‚æœéœ€è¦è‡ªå®šä¹‰ä¸€äº›ç‰¹å®šçš„ä»£ç æ£€æŸ¥ï¼Œå¯ä»¥ç¼–å†™ shell è„šæœ¬ä½œä¸ºé’©å­ã€‚ä¾‹å¦‚ï¼Œæ£€æŸ¥ä»£ç ä¸­æ˜¯å¦å­˜åœ¨ TODO æ³¨é‡Šï¼š\n\n#!/bin/bashif git grep -q &#x27;TODO&#x27;; then  echo &quot;Error: There are TODO comments in the code.&quot;  exit 1fi\nç„¶ååœ¨ .pre-commit-config.yaml ä¸­æ·»åŠ è¿™ä¸ªé’©å­ï¼š\n- repo: local  hooks:    - id: check-todos      name: Check for TODO comments      entry: ./check_todos.sh      language: script      files: \\.swift$\nä»£ç è¯„å®¡ï¼ˆCode Reviewï¼‰æµç¨‹ä¸­çš„é›†æˆ\n\nå›¢é˜Ÿçº¦å®šï¼š åœ¨å›¢é˜Ÿä¸­çº¦å®šæ¯ä¸ªå¼€å‘è€…éƒ½å¿…é¡»å¯ç”¨ pre-commit é’©å­ï¼Œç¡®ä¿æäº¤çš„ä»£ç ç¬¦åˆé¡¹ç›®çš„ä»£ç è§„èŒƒï¼Œå¹¶ç»è¿‡åŸºæœ¬æ£€æŸ¥ã€‚\næŒç»­é›†æˆï¼ˆCIï¼‰æ”¯æŒï¼š åœ¨ CI æµç¨‹ä¸­ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ç›¸åŒçš„ pre-commit é…ç½®ï¼Œç¡®ä¿æ‰€æœ‰æäº¤å’Œåˆå¹¶è¯·æ±‚éƒ½ç»è¿‡ç»Ÿä¸€çš„æ£€æŸ¥ã€‚å¯ä»¥åœ¨ CI ç®¡é“ä¸­è¿è¡Œ pre-commit run â€“all-files æ¥æ£€æŸ¥æ‰€æœ‰ä»£ç ã€‚å‡è®¾æˆ‘ä»¬å¸Œæœ›åœ¨ Swift é¡¹ç›®ä¸­æ£€æŸ¥ä»£ç æ ¼å¼ï¼ˆä½¿ç”¨ SwiftFormatï¼‰ã€é™æ€åˆ†æï¼ˆä½¿ç”¨ SwiftLintï¼‰ï¼Œä»¥åŠç¡®ä¿æ²¡æœ‰ TODO æ³¨é‡Šï¼Œå¯ä»¥è¿™æ ·é…ç½®ï¼š\n\nrepos:  - repo: https://github.com/nicklockwood/SwiftFormat    rev: &#x27;0.48.17&#x27;    hooks:      - id: swiftformat  - repo: https://github.com/realm/SwiftLint    rev: &#x27;0.42.0&#x27;    hooks:      - id: swiftlint  - repo: local    hooks:      - id: check-todos        name: Check for TODO comments        entry: ./check_todos.sh        language: script        files: \\.swift$\næ‰©å±•é˜…è¯»ã€Šç¼–å†™å¯è¯»ä»£ç çš„è‰ºæœ¯ã€‹ã€ã€Šé‡æ„ã€‹ã€ã€Šé‡æ„ä¸æ¨¡å¼ã€‹ã€ã€Šä»£ç ç²¾è¿›ä¹‹è·¯ã€‹ä»¥åŠGoogle Engineering Practices Documentationç­‰ã€‚\nLanguage Server Protocolä»‹ç»Language Server Protocol (LSP) æ˜¯ä¸€ç§åè®®ï¼Œç”¨äºåœ¨ä»£ç ç¼–è¾‘å™¨å’Œè¯­è¨€æœåŠ¡å™¨ä¹‹é—´äº¤æ¢ä¿¡æ¯ã€‚LSP ç”± Microsoft æå‡ºçš„ï¼Œæ—¨åœ¨ä½¿ä¸åŒçš„ç¼–è¾‘å™¨èƒ½å¤Ÿä¸å„ç§ç¼–ç¨‹è¯­è¨€çš„è¯­è¨€æœåŠ¡å™¨è¿›è¡Œäº¤äº’ï¼Œä»¥æä¾›ç»Ÿä¸€çš„ä»£ç ç¼–è¾‘åŠŸèƒ½ã€‚LSP çš„æ ¸å¿ƒæ€æƒ³æ˜¯å°†è¯­è¨€ç‰¹å®šçš„åŠŸèƒ½ï¼ˆå¦‚è¯­æ³•æ£€æŸ¥ã€ä»£ç è¡¥å…¨ã€è·³è½¬åˆ°å®šä¹‰ç­‰ï¼‰å°è£…åœ¨è¯­è¨€æœåŠ¡å™¨ä¸­ï¼Œè€Œå°†ç¼–è¾‘å™¨çš„åŠŸèƒ½ï¼ˆå¦‚ç”¨æˆ·ç•Œé¢ï¼‰ä¸è¯­è¨€æœåŠ¡è§£è€¦ã€‚LSP å®šä¹‰äº†ä¸€ç»„æ ‡å‡†åŒ–çš„åè®®å’Œæ¶ˆæ¯æ ¼å¼ï¼Œä½¿å¾—è¯­è¨€æœåŠ¡å™¨å’Œç¼–è¾‘å™¨å¯ä»¥é€šè¿‡è¿™äº›åè®®è¿›è¡Œé€šä¿¡ã€‚\nä¸»è¦ç»„ä»¶\n\nè¯­è¨€æœåŠ¡å™¨ï¼šæä¾›è¯­è¨€ç‰¹å®šçš„æœåŠ¡ï¼Œå¦‚è¯­æ³•æ£€æŸ¥ã€ä»£ç è¡¥å…¨ã€é”™è¯¯æç¤ºç­‰ã€‚ä¸€ä¸ªè¯­è¨€æœåŠ¡å™¨å¯ä»¥æœåŠ¡äºå¤šä¸ªç¼–è¾‘å™¨ã€‚\nå®¢æˆ·ç«¯ï¼ˆç¼–è¾‘å™¨ï¼‰ï¼šå®ç° LSP åè®®ï¼Œå¹¶é€šè¿‡åè®®ä¸è¯­è¨€æœåŠ¡å™¨è¿›è¡Œé€šä¿¡ã€‚å¸¸è§çš„ç¼–è¾‘å™¨å¦‚ VS Codeã€Sublime Textã€Atom ç­‰éƒ½å¯ä»¥ä½œä¸º LSP å®¢æˆ·ç«¯ã€‚\n\nLSP åè®®åŒ…æ‹¬ä»¥ä¸‹ä¸»è¦éƒ¨åˆ†ï¼š\n\nåˆå§‹åŒ–ï¼šå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å»ºç«‹è¿æ¥æ—¶ï¼Œè¿›è¡Œåˆå§‹åŒ–åå•†ã€‚\næ–‡æœ¬åŒæ­¥ï¼šå®¢æˆ·ç«¯é€šçŸ¥æœåŠ¡å™¨æ–‡ä»¶å†…å®¹çš„å˜åŒ–ï¼ŒåŒ…æ‹¬æ–‡ä»¶çš„åˆ›å»ºã€ä¿®æ”¹å’Œåˆ é™¤ã€‚\nä»£ç è¡¥å…¨ï¼šå®¢æˆ·ç«¯è¯·æ±‚è¯­è¨€æœåŠ¡å™¨æä¾›ä»£ç è¡¥å…¨å»ºè®®ã€‚\né”™è¯¯æ£€æŸ¥ï¼šæœåŠ¡å™¨è¿”å›ä»£ç ä¸­çš„é”™è¯¯å’Œè­¦å‘Šä¿¡æ¯ã€‚\nä»£ç å¯¼èˆªï¼šæ”¯æŒè·³è½¬åˆ°å®šä¹‰ã€æŸ¥æ‰¾å¼•ç”¨ç­‰åŠŸèƒ½ã€‚\næ–‡æ¡£æ³¨é‡Šï¼šæä¾›å…³äºç¬¦å·çš„è¯¦ç»†ä¿¡æ¯å’Œæ–‡æ¡£æ³¨é‡Šã€‚\n\nLSP çš„ä¼˜ç‚¹\n\nç»Ÿä¸€æ¥å£ï¼šä¸ºä¸åŒç¼–è¾‘å™¨å’Œ IDE æä¾›ä¸€è‡´çš„è¯­è¨€æœåŠ¡æ¥å£ï¼Œç®€åŒ–äº†è¯­è¨€æœåŠ¡çš„å®ç°å’Œç»´æŠ¤ã€‚\næå‡æ•ˆç‡ï¼šå‡å°‘äº†ç¼–è¾‘å™¨å’Œè¯­è¨€æœåŠ¡ä¹‹é—´çš„é‡å¤å·¥ä½œï¼Œæé«˜äº†å¼€å‘æ•ˆç‡ã€‚\nå¢å¼ºå…¼å®¹æ€§ï¼šæ”¯æŒå¤šç§ç¼–è¾‘å™¨å’Œ IDEï¼Œä½¿å¾—è¯­è¨€æœåŠ¡å¯ä»¥è·¨å¹³å°ä½¿ç”¨ã€‚\n\nsourcekit-lspsourcekit-lsp æ˜¯ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œç”± Swift å›¢é˜Ÿå¼€å‘ï¼Œç”¨äºä¸º Swift ä»£ç æä¾›è¯­è¨€æœåŠ¡ã€‚å®ƒåŸºäº Language Server Protocol (LSP)ï¼Œæä¾›äº†ä¸€ç»„åŠŸèƒ½æ¥æ”¯æŒç¼–è¾‘å™¨å’Œ IDE ä¸­çš„ä»£ç æ™ºèƒ½åŒ–ã€‚\nsourcekit-lsp æä¾›äº†ä»¥ä¸‹ä¸»è¦åŠŸèƒ½ï¼š\n\nä»£ç è¡¥å…¨ï¼šåœ¨ç¼–è¾‘ä»£ç æ—¶æä¾›æ™ºèƒ½æç¤ºå’Œè‡ªåŠ¨è¡¥å…¨å»ºè®®ã€‚\nè¯­æ³•é«˜äº®ï¼šå¯¹ Swift ä»£ç è¿›è¡Œè¯­æ³•é«˜äº®æ˜¾ç¤ºã€‚\né”™è¯¯æ£€æŸ¥ï¼šå®æ—¶æ˜¾ç¤ºä»£ç ä¸­çš„è¯­æ³•é”™è¯¯å’Œè­¦å‘Šã€‚\nä»£ç å¯¼èˆªï¼šæ”¯æŒè·³è½¬åˆ°å®šä¹‰ã€æŸ¥çœ‹ç¬¦å·ã€æŸ¥æ‰¾æ‰€æœ‰å¼•ç”¨ç­‰ã€‚\nä»£ç é‡æ„ï¼šæ”¯æŒé‡å‘½åç¬¦å·ç­‰åŸºæœ¬çš„ä»£ç é‡æ„æ“ä½œã€‚\næ–‡æ¡£æ³¨é‡Šï¼šæ˜¾ç¤ºå‡½æ•°ã€æ–¹æ³•ã€å˜é‡ç­‰çš„æ–‡æ¡£æ³¨é‡Šä¿¡æ¯ã€‚\n\nåœ¨ Swift 5.1 åŠæ›´é«˜ç‰ˆæœ¬ä¸­ï¼Œsourcekit-lsp å·²ç»åŒ…å«åœ¨ Swift å·¥å…·é“¾ä¸­ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤å®‰è£…ï¼š\nswift package update\nå¦‚æœä½ ä½¿ç”¨çš„æ˜¯ macOSï¼Œå¯ä»¥é€šè¿‡ Homebrew å®‰è£… sourcekit-lspï¼š\nbrew install sourcekit-lsp\nsourcekit-lsp éœ€è¦é…ç½®åˆ°ä½ çš„ä»£ç ç¼–è¾‘å™¨ä¸­ã€‚æ”¯æŒçš„ç¼–è¾‘å™¨åŒ…æ‹¬ Visual Studio Codeã€Sublime Textã€Atom ç­‰ã€‚åœ¨ Visual Studio Code ä¸­ï¼Œæ‰“å¼€æ‰©å±•å¸‚åœºï¼ˆExtensionsï¼‰ï¼Œæœç´¢å¹¶å®‰è£… â€œSwiftâ€ æ‰©å±•ï¼Œè¿™ä¸ªæ‰©å±•é€šå¸¸ä¼šè‡ªåŠ¨å®‰è£… sourcekit-lspã€‚åœ¨ VS Code çš„è®¾ç½®ä¸­ï¼Œä½ å¯ä»¥é…ç½® sourcekit-lsp çš„è·¯å¾„ã€‚å¦‚æœä½ é€šè¿‡ Homebrew å®‰è£…äº† sourcekit-lspï¼Œé€šå¸¸å®ƒä¼šè‡ªåŠ¨é…ç½®å¥½ã€‚\nåœ¨ VS Code ä¸­æ‰“å¼€ä½ çš„ Swift é¡¹ç›®ã€‚ç¼–è¾‘å™¨ä¼šè‡ªåŠ¨å¯åŠ¨ sourcekit-lspï¼Œå¹¶åœ¨åå°æä¾›è¯­è¨€æœåŠ¡ã€‚ä½ å¯ä»¥åœ¨ç¼–è¾‘å™¨çš„çŠ¶æ€æ ä¸­çœ‹åˆ°ç›¸å…³çš„ä¿¡æ¯ã€‚\n","categories":["æ€§èƒ½ä¼˜åŒ–"]},{"title":"é¿å…è§†å›¾ç»˜åˆ¶æ‰å¸§","url":"/2025/05/07/%E9%81%BF%E5%85%8D%E8%A7%86%E5%9B%BE%E7%BB%98%E5%88%B6%E6%8E%89%E5%B8%A7/","content":"å›¾åƒæ˜¾ç¤ºåŸç†iOS å›¾åƒæ˜¾ç¤ºçš„åŸç†æ¶‰åŠå¤šä¸ªå±‚æ¬¡ï¼Œä»åº•å±‚çš„ç¡¬ä»¶åŠ é€Ÿåˆ°ä¸Šå±‚çš„æ¡†æ¶å®ç°ã€‚UIKit æä¾›äº†é«˜å±‚æ¬¡çš„ APIï¼Œç”¨äºç®¡ç†åº”ç”¨çš„ç”¨æˆ·ç•Œé¢å…ƒç´ ï¼ŒåŒ…æ‹¬è§†å›¾ã€æ§ä»¶å’Œå›¾åƒæ˜¾ç¤ºã€‚UIImageView æ˜¯ UIKit ä¸­ç”¨äºæ˜¾ç¤ºå›¾åƒçš„ä¸»è¦ç±»ã€‚Core Graphics (ä¹Ÿç§°ä¸º Quartz) æ˜¯ iOS çš„ 2D ç»˜å›¾å¼•æ“ã€‚å®ƒç›´æ¥ä¸ç¡¬ä»¶äº¤äº’ï¼Œè´Ÿè´£å›¾å½¢çš„ç»˜åˆ¶å’Œå¤„ç†ã€‚UIKit çš„è®¸å¤šç»˜å›¾æ“ä½œæœ€ç»ˆéƒ½é€šè¿‡ Core Graphics å®ç°ã€‚Core Animation æ˜¯ iOS ç”¨æ¥å¤„ç†åŠ¨ç”»å’Œå›¾åƒæ¸²æŸ“çš„æ¡†æ¶ã€‚æ¯ä¸ª UIView éƒ½æœ‰ä¸€ä¸ªå…³è”çš„ CALayerï¼Œç”¨äºå¤„ç†å›¾åƒå’Œå†…å®¹çš„æ¸²æŸ“ã€‚Core Animation è´Ÿè´£å°†è¿™äº›å›¾å±‚çš„å†…å®¹æäº¤åˆ°å±å¹•ä¸Šï¼Œå¹¶å¤„ç†å›¾å±‚ä¹‹é—´çš„åŠ¨ç”»ã€‚\niOS ä½¿ç”¨ OpenGL ES æˆ– Metal ä½œä¸ºåº•å±‚å›¾å½¢æ¸²æŸ“ç®¡çº¿ã€‚UIKit å’Œ Core Animation ä¼šå°†å›¾åƒã€è§†å›¾å’ŒåŠ¨ç”»è½¬æ¢ä¸º GPU å¯ç†è§£çš„å‘½ä»¤ï¼Œå¹¶é€šè¿‡ OpenGL ES æˆ– Metal æ¸²æŸ“åˆ°å±å¹•ä¸Šã€‚\nå½“ä½ ä½¿ç”¨ UIImageView æ¥æ˜¾ç¤ºå›¾åƒæ—¶ï¼Œä»¥ä¸‹æ­¥éª¤ä¼šå‘ç”Ÿï¼š\n\nåŠ è½½å›¾åƒï¼šUIImage ç±»ç”¨äºåŠ è½½å›¾åƒèµ„æºã€‚ä½ å¯ä»¥ä»æ–‡ä»¶ç³»ç»Ÿã€ç½‘ç»œã€æˆ–èµ„æºåŒ…ä¸­åŠ è½½å›¾åƒã€‚\nè®¾ç½®å›¾åƒï¼šå°† UIImage å¯¹è±¡åˆ†é…ç»™ UIImageView çš„ image å±æ€§ã€‚\nå›¾å±‚æ˜¾ç¤ºï¼šUIImageView æ˜¯ä¸€ä¸ª UIView å­ç±»ï¼Œå› æ­¤å®ƒæœ‰ä¸€ä¸ªå…³è”çš„ CALayerã€‚UIImageView ä¼šå°†å›¾åƒè®¾ç½®ä¸ºå…¶å›¾å±‚çš„ contentsã€‚\næ¸²æŸ“å›¾åƒï¼šCore Animation å°†è´Ÿè´£å°† CALayer çš„å†…å®¹æäº¤åˆ° GPU è¿›è¡Œæ¸²æŸ“ï¼Œæœ€åæ˜¾ç¤ºåœ¨å±å¹•ä¸Šã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œå±•ç¤ºå¦‚ä½•åœ¨ iOS ä¸­ä½¿ç”¨ UIImageView æ¥æ˜¾ç¤ºå›¾åƒã€‚\n\nimport UIKitclass ViewController: UIViewController &#123;    override func viewDidLoad() &#123;        super.viewDidLoad()                // åˆ›å»º UIImage å¯¹è±¡        if let image = UIImage(named: &quot;example.jpg&quot;) &#123;                        // åˆ›å»º UIImageView å¯¹è±¡            let imageView = UIImageView(image: image)                        // è®¾ç½® UIImageView çš„å¤§å°å’Œä½ç½®            imageView.frame = CGRect(x: 50, y: 100, width: 200, height: 200)                        // è®¾ç½®å†…å®¹æ¨¡å¼            imageView.contentMode = .scaleAspectFill                        // å°† UIImageView æ·»åŠ åˆ°è§†å›¾ä¸­            self.view.addSubview(imageView)        &#125;    &#125;&#125;\niOS ä¼šè‡ªåŠ¨ç¼“å­˜ UIImage å¯¹è±¡ï¼Œä»¥æé«˜æ€§èƒ½å¹¶å‡å°‘å†…å­˜æ¶ˆè€—ã€‚UIImageView ä½¿ç”¨çš„å›¾åƒå¯ä»¥é€šè¿‡ç³»ç»Ÿçš„å›¾åƒç¼“å­˜æœºåˆ¶ä¼˜åŒ–ã€‚\nå¯¹äºå¤§å›¾åƒï¼Œæœ€å¥½ä½¿ç”¨åˆ†å—åŠ è½½æˆ–ç¼©ç•¥å›¾æ˜¾ç¤ºä»¥å‡å°‘å†…å­˜å ç”¨ã€‚å¯ä»¥ä½¿ç”¨ CGImageSource æ¥é€æ­¥åŠ è½½å›¾åƒã€‚\nä¸¾ä¸ªä¾‹å­ï¼š\nimport SwiftUIstruct ThumbnailImageView: View &#123;    let thumbnailImage: UIImage    let fullSizeImageURL: URL        @State private var fullSizeImage: UIImage? = nil    var body: some View &#123;        ZStack &#123;            if let fullSizeImage = fullSizeImage &#123;                Image(uiImage: fullSizeImage)                    .resizable()                    .scaledToFit()            &#125; else &#123;                Image(uiImage: thumbnailImage)                    .resizable()                    .scaledToFit()                    .onAppear(perform: loadFullSizeImage)            &#125;        &#125;    &#125;    private func loadFullSizeImage() &#123;        DispatchQueue.global().async &#123;            if let data = try? Data(contentsOf: fullSizeImageURL),               let image = UIImage(data: data) &#123;                DispatchQueue.main.async &#123;                    self.fullSizeImage = image                &#125;            &#125;        &#125;    &#125;&#125;\nåœ¨åŠ è½½å¤§å›¾æ—¶ä½¿ç”¨ CGImageSource é€æ­¥è§£ç å›¾ç‰‡ï¼Œåœ¨ä½åˆ†è¾¨ç‡æ—¶å‡å°‘å†…å­˜å ç”¨ã€‚\nimport UIKitfunc loadImageWithLowMemoryUsage(url: URL) -&gt; UIImage? &#123;    guard let source = CGImageSourceCreateWithURL(url as CFURL, nil) else &#123;        return nil    &#125;        let options: [NSString: Any] = [        kCGImageSourceShouldCache: false, // é¿å…ç›´æ¥ç¼“å­˜åˆ°å†…å­˜        kCGImageSourceShouldAllowFloat: true    ]        return CGImageSourceCreateImageAtIndex(source, 0, options as CFDictionary).flatMap &#123;        UIImage(cgImage: $0)    &#125;&#125;\nå¦‚æœå›¾åƒéœ€è¦ä»ç½‘ç»œåŠ è½½ï¼Œå»ºè®®ä½¿ç”¨å¼‚æ­¥åŠ è½½æ¥é¿å…é˜»å¡ä¸»çº¿ç¨‹ã€‚å¯ä»¥ç»“åˆä½¿ç”¨ URLSession æˆ–ç¬¬ä¸‰æ–¹åº“å¦‚ SDWebImage æ¥å®ç°ã€‚\nå¦‚æœä½ éœ€è¦è‡ªå®šä¹‰å›¾åƒæ˜¾ç¤ºæˆ–è¿›è¡Œå¤æ‚çš„å›¾å½¢å¤„ç†ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ Core Graphicsã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨ Core Graphics ç»˜åˆ¶å›¾åƒçš„ä¾‹å­ï¼š\nimport UIKitclass CustomView: UIView &#123;    override func draw(_ rect: CGRect) &#123;        guard let context = UIGraphicsGetCurrentContext() else &#123; return &#125;        // è®¾ç½®å¡«å……é¢œè‰²        context.setFillColor(UIColor.red.cgColor)        context.fill(rect)                // åŠ è½½å›¾ç‰‡        if let image = UIImage(named: &quot;example.jpg&quot;)?.cgImage &#123;            context.draw(image, in: rect)        &#125;    &#125;&#125;class ViewController: UIViewController &#123;    override func viewDidLoad() &#123;        super.viewDidLoad()                let customView = CustomView(frame: self.view.bounds)        self.view.addSubview(customView)    &#125;&#125;\nCPU å’Œ GPU åˆ†åˆ«åšäº†ä»€ä¹ˆCPU åšçš„äº‹æƒ…ï¼š\n\nè§†å›¾å±‚æ¬¡ç»“æ„çš„è®¡ç®—ï¼ˆView Hierarchy Calculationï¼‰ï¼š CPU è´Ÿè´£è®¡ç®—è§†å›¾çš„å±‚æ¬¡ç»“æ„ï¼ŒåŒ…æ‹¬è§†å›¾çš„ä½ç½®ã€å°ºå¯¸ã€é€æ˜åº¦å’Œå…¶ä»–å±æ€§ã€‚æ¯å½“è§†å›¾çš„è¿™äº›å±æ€§å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒCPU ä¼šé‡æ–°è®¡ç®—è¿™äº›ä¿¡æ¯ã€‚\nå¸ƒå±€ï¼ˆLayoutï¼‰ï¼š å½“ä½¿ç”¨ Auto Layout æˆ–æ‰‹åŠ¨å¸ƒå±€æ—¶ï¼ŒCPU ä¼šè®¡ç®—æ‰€æœ‰è§†å›¾çš„ä½ç½®å’Œå°ºå¯¸ã€‚æ¯”å¦‚è°ƒç”¨ layoutSubviews() æ–¹æ³•æ—¶ï¼ŒCPU ä¼šå‚ä¸å¸ƒå±€è®¡ç®—ã€‚\næ–‡æœ¬ç»˜åˆ¶ï¼ˆText Renderingï¼‰ï¼š å¦‚æœä½ åœ¨è§†å›¾ä¸­ç»˜åˆ¶æ–‡æœ¬ï¼Œæ¯”å¦‚ä½¿ç”¨ UILabel æˆ– CATextLayerï¼ŒCPU ä¼šè´Ÿè´£å¯¹æ–‡æœ¬è¿›è¡Œæ’ç‰ˆå’Œç»˜åˆ¶ã€‚\nå›¾åƒè§£ç ï¼ˆImage Decodingï¼‰ï¼š ä»ç½‘ç»œæˆ–ç£ç›˜åŠ è½½çš„å›¾åƒé€šå¸¸æ˜¯ç»è¿‡å‹ç¼©çš„æ ¼å¼ï¼ˆå¦‚ PNGã€JPEGï¼‰ã€‚CPU è´Ÿè´£å°†è¿™äº›å›¾åƒè§£ç ä¸ºå¯ä¾› GPU ä½¿ç”¨çš„åŸå§‹ä½å›¾æ ¼å¼ã€‚\nCore Graphics ç»˜åˆ¶ï¼ˆCore Graphics Drawingï¼‰ï¼š ä½¿ç”¨ CGContext è¿›è¡Œçš„æ‰€æœ‰ç»˜åˆ¶æ“ä½œï¼ˆå¦‚ç»˜åˆ¶è·¯å¾„ã€å¡«å……é¢œè‰²ç­‰ï¼‰éƒ½æ˜¯åœ¨ CPU ä¸Šæ‰§è¡Œçš„ã€‚\n\nä»£ç ç¤ºä¾‹\nclass CustomView: UIView &#123;    override func layoutSubviews() &#123;        super.layoutSubviews()        // CPU è´Ÿè´£å¸ƒå±€è®¡ç®—        let subview = UIView(frame: CGRect(x: 10, y: 10, width: 100, height: 50))        addSubview(subview)    &#125;    override func draw(_ rect: CGRect) &#123;        super.draw(rect)        // CPU è´Ÿè´£æ–‡æœ¬ç»˜åˆ¶        let text = &quot;Hello, World!&quot;        let attributes: [NSAttributedString.Key: Any] = [            .font: UIFont.systemFont(ofSize: 16),            .foregroundColor: UIColor.black        ]        text.draw(in: rect, withAttributes: attributes)    &#125;&#125;\nGPU åšçš„äº‹æƒ…ï¼š\n\nå›¾å±‚åˆæˆï¼ˆLayer Compositionï¼‰ï¼š GPU è´Ÿè´£å°†å„ä¸ªå›¾å±‚ï¼ˆå¦‚ UIView æˆ– CALayerï¼‰è¿›è¡Œåˆæˆå’Œæ¸²æŸ“ã€‚æ¯ä¸ªè§†å›¾æˆ–å›¾å±‚éƒ½ä¼šè¢«è½¬æ¢ä¸ºä¸€ä¸ªçº¹ç†ï¼ŒGPU ä¼šå°†è¿™äº›çº¹ç†ç»„åˆåˆ°æœ€ç»ˆçš„å¸§ç¼“å†²åŒºä¸­ã€‚\nå›¾åƒæ¸²æŸ“ï¼ˆImage Renderingï¼‰ï¼š GPU è´Ÿè´£æ¸²æŸ“å·²ç»ç”± CPU è§£ç çš„å›¾åƒä½å›¾ã€‚å®ƒè¿˜è´Ÿè´£å¤„ç†å„ç§å›¾åƒç‰¹æ•ˆï¼Œå¦‚æ¨¡ç³Šã€é˜´å½±ã€é€æ˜åº¦ç­‰ã€‚\nåŠ¨ç”»å¤„ç†ï¼ˆAnimations Handlingï¼‰ï¼š iOS ä¸­çš„å¤§å¤šæ•°åŠ¨ç”»ï¼ˆå¦‚ UIView åŠ¨ç”»å’Œ Core Animationï¼‰éƒ½æ˜¯åœ¨ GPU ä¸Šæ‰§è¡Œçš„ã€‚GPU è´Ÿè´£å¤„ç†åŠ¨ç”»çš„ä¸­é—´å¸§æ¸²æŸ“ã€‚\nOpenGL&#x2F;Metal ç»˜åˆ¶ï¼š å½“ä½¿ç”¨ OpenGL ES æˆ– Metal ç›´æ¥è¿›è¡Œå›¾å½¢ç»˜åˆ¶æ—¶ï¼ŒGPU ä¼šè´Ÿè´£æ‰§è¡Œè¿™äº›ç»˜åˆ¶å‘½ä»¤ã€‚\n\nUIView.animate(withDuration: 1.0) &#123;    self.view.alpha = 0.5    // è¿™æ®µä»£ç çš„åŠ¨ç”»æ¸²æŸ“ç”± GPU å¤„ç†&#125;\né€šå¸¸ï¼ŒCPU è´Ÿè´£å‡†å¤‡æ•°æ®ï¼ŒGPU è´Ÿè´£æ¸²æŸ“è¿™äº›æ•°æ®ã€‚ä¸ºäº†ä¼˜åŒ–æ€§èƒ½ï¼Œæˆ‘ä»¬åº”è¯¥å°½é‡å‡å°‘ CPU çš„è´Ÿæ‹…ï¼Œå‡å°‘å¤æ‚çš„å¸ƒå±€è®¡ç®—ã€é¿å…é¢‘ç¹çš„è§†å›¾å±‚æ¬¡å˜æ›´ï¼Œä»¥åŠå°½é‡å»¶è¿Ÿå›¾åƒè§£ç ç­‰æ“ä½œã€‚\nä¼˜åŒ–å»ºè®®ï¼š\n\nå°½é‡ç®€åŒ–è§†å›¾å±‚æ¬¡ç»“æ„ï¼š è¿‡å¤šçš„å­è§†å›¾ä¼šå¢åŠ  CPU çš„è®¡ç®—è´Ÿæ‹…ã€‚\nå‡å°‘è¿‡åº¦çš„é‡ç»˜ï¼š å°½é‡é¿å…é¢‘ç¹è°ƒç”¨ setNeedsDisplay æˆ– layoutSubviewsã€‚\nä½¿ç”¨å¼‚æ­¥å›¾åƒåŠ è½½å’Œè§£ç ï¼š é¿å…åœ¨ä¸»çº¿ç¨‹ä¸Šè¿›è¡Œå›¾åƒè§£ç ï¼Œä»¥å‡è½» CPU çš„è´Ÿæ‹…ã€‚\nåˆç†ä½¿ç”¨å›¾åƒç¼“å­˜ï¼š å°½é‡ä½¿ç”¨é€‚åˆå°ºå¯¸çš„å›¾ç‰‡ï¼Œé¿å… GPU å¤„ç†è¿‡å¤§å›¾åƒå¸¦æ¥çš„é¢å¤–å¼€é”€ã€‚\n\nUIView çš„ç»˜åˆ¶åŸç†UIView æ˜¯æ‰€æœ‰ç”¨æˆ·ç•Œé¢å…ƒç´ çš„åŸºç¡€ã€‚æ¯ä¸ª UIView å¯¹è±¡éƒ½è´Ÿè´£æ˜¾ç¤ºå†…å®¹ï¼Œå¹¶å“åº”ç”¨æˆ·è¾“å…¥ã€‚UIView çš„ç»˜åˆ¶è¿‡ç¨‹æ¶‰åŠå¤šä¸ªæ­¥éª¤ï¼Œä»å±‚çº§è§†å›¾ç³»ç»Ÿåˆ° Core Graphics å’Œ Core Animationã€‚\nUIView æ˜¯åŸºäºå±‚æ¬¡ç»“æ„çš„ï¼Œæ¯ä¸ª UIView éƒ½å¯ä»¥æœ‰å¤šä¸ªå­è§†å›¾ (subviews)ã€‚æ‰€æœ‰çš„è§†å›¾éƒ½ç”±ä¸€ä¸ªæ ¹è§†å›¾ (root view) ç®¡ç†ï¼Œé€šå¸¸æ˜¯ UIViewController çš„ view å±æ€§ã€‚\nç»˜åˆ¶æµç¨‹ï¼š\n\nå½“éœ€è¦æ›´æ–°ç•Œé¢æ—¶ï¼ˆå¦‚å±å¹•é¦–æ¬¡æ¸²æŸ“ã€è§†å›¾å†…å®¹æ›´æ–°ã€è§†å›¾å¤§å°å˜åŒ–ç­‰ï¼‰ï¼Œç³»ç»Ÿä¼šè§¦å‘è§†å›¾çš„ç»˜åˆ¶è¿‡ç¨‹ã€‚\nç³»ç»Ÿè°ƒç”¨è§†å›¾çš„ setNeedsDisplay æˆ– setNeedsLayout æ–¹æ³•æ ‡è®°è§†å›¾ä¸ºâ€œéœ€è¦æ›´æ–°â€çŠ¶æ€ã€‚\nç³»ç»Ÿåœ¨ä¸‹ä¸€ä¸ªè¿è¡Œå¾ªç¯ä¸­è°ƒç”¨ drawRect: æ–¹æ³•ç»˜åˆ¶è§†å›¾ã€‚\n\nUIView çš„ç»˜åˆ¶æ˜¯é€šè¿‡ Core Graphics æ¥å®Œæˆçš„ã€‚Core Graphics æ˜¯ä¸€ä¸ª 2D ç»˜å›¾å¼•æ“ï¼Œå¯ä»¥è¿›è¡Œå›¾å½¢ç»˜åˆ¶ã€å›¾åƒå¤„ç†ç­‰ã€‚Core Animation è´Ÿè´£å°† UIView çš„å†…å®¹æ˜¾ç¤ºåœ¨å±å¹•ä¸Šã€‚å®ƒå°†æ‰€æœ‰çš„ç»˜åˆ¶æ“ä½œä½œä¸ºåŠ¨ç”»å›¾å±‚ (CALayer&#96;) çš„æ›´æ–°å¹¶è¿›è¡Œåˆæˆï¼Œæœ€åå‘ˆç°ç»™ç”¨æˆ·ã€‚\nUIView ç»˜åˆ¶æµç¨‹çš„å…³é”®æ­¥éª¤ï¼š\n\nsetNeedsDisplay å’Œ setNeedsLayoutï¼š\nsetNeedsDisplayï¼šæ ‡è®°è§†å›¾ä¸ºéœ€è¦é‡ç»˜ï¼Œä¼šåœ¨ä¸‹ä¸€æ¬¡å±å¹•åˆ·æ–°æ—¶è°ƒç”¨ drawRect: æ–¹æ³•ã€‚\nsetNeedsLayoutï¼šæ ‡è®°è§†å›¾éœ€è¦é‡æ–°å¸ƒå±€ï¼Œä¼šåœ¨ä¸‹ä¸€æ¬¡å¸ƒå±€å‘¨æœŸè°ƒç”¨ layoutSubviews æ–¹æ³•ã€‚\n\n\ndrawRect:ï¼š\ndrawRect: æ–¹æ³•æ˜¯ UIView è‡ªå®šä¹‰ç»˜åˆ¶çš„å…¥å£ã€‚åœ¨è¿™é‡Œï¼Œå¯ä»¥ä½¿ç”¨ Core Graphics è¿›è¡Œå›¾å½¢ç»˜åˆ¶ã€‚\n\n\n\nä»¥ä¸‹æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰ UIView çš„ç¤ºä¾‹ï¼Œå®ƒåœ¨å±å¹•ä¸Šç»˜åˆ¶ä¸€ä¸ªç®€å•çš„çŸ©å½¢ï¼š\nimport UIKitclass CustomView: UIView &#123;        // ä»…åœ¨åˆå§‹åŒ–æ—¶è°ƒç”¨ä¸€æ¬¡    override init(frame: CGRect) &#123;        super.init(frame: frame)        // è®¾ç½®è§†å›¾çš„ä¸€äº›å±æ€§ï¼Œä¾‹å¦‚èƒŒæ™¯é¢œè‰²        self.backgroundColor = UIColor.white    &#125;        required init?(coder: NSCoder) &#123;        super.init(coder: coder)    &#125;        // é‡å†™ drawRect: æ–¹æ³•æ¥æ‰§è¡Œè‡ªå®šä¹‰ç»˜åˆ¶ã€‚ä½¿ç”¨ Core Graphics API æ¥ç»˜åˆ¶ä¸€ä¸ªè“è‰²çš„çŸ©å½¢ã€‚    override func draw(_ rect: CGRect) &#123;        super.draw(rect)                // è·å–å½“å‰çš„ç»˜å›¾ä¸Šä¸‹æ–‡ï¼Œè¿™æ˜¯ä¸€ä¸ª Core Graphics çš„ `CGContext` å¯¹è±¡ï¼Œå®ƒä»£è¡¨ç€ä¸€ä¸ªç»˜åˆ¶ç¯å¢ƒã€‚        guard let context = UIGraphicsGetCurrentContext() else &#123; return &#125;                // è®¾ç½®å¡«å……é¢œè‰²        context.setFillColor(UIColor.blue.cgColor)                // åˆ›å»ºä¸€ä¸ªçŸ©å½¢        let rectangle = CGRect(x: 50, y: 50, width: 200, height: 100)                // åœ¨ä¸Šä¸‹æ–‡ä¸­ç»˜åˆ¶çŸ©å½¢        context.addRect(rectangle)        context.drawPath(using: .fill)    &#125;&#125;// ä½¿ç”¨è‡ªå®šä¹‰è§†å›¾class ViewController: UIViewController &#123;        override func viewDidLoad() &#123;        super.viewDidLoad()                // åˆ›å»ºå¹¶æ·»åŠ è‡ªå®šä¹‰è§†å›¾        let customView = CustomView(frame: CGRect(x: 0, y: 0, width: 300, height: 300))        self.view.addSubview(customView)    &#125;&#125;\nUIView çš„ç»˜åˆ¶åŸç†æ ¸å¿ƒæ˜¯åŸºäº Core Graphics å’Œ Core Animationï¼Œé€šè¿‡ drawRect: æ–¹æ³•è¿›è¡Œè‡ªå®šä¹‰ç»˜åˆ¶ã€‚è¿™ä¸ªè¿‡ç¨‹æ¶‰åŠåˆ°å¤šä¸ªæ­¥éª¤ï¼ŒåŒ…æ‹¬è§†å›¾å±‚æ¬¡ç»“æ„ã€ç»˜åˆ¶æµç¨‹ã€ä¸Šä¸‹æ–‡è·å–ï¼Œä»¥åŠæœ€ç»ˆçš„å†…å®¹åˆæˆå¹¶å‘ˆç°ç»™ç”¨æˆ·ã€‚åœ¨å®é™…å¼€å‘ä¸­ï¼Œè‡ªå®šä¹‰ç»˜åˆ¶çš„ UIView å¾€å¾€ç”¨äºå®ç°ç‰¹æ®Šçš„å›¾å½¢æ•ˆæœæˆ–è‡ªå®šä¹‰ UI æ§ä»¶ã€‚\nå¼‚æ­¥ç»˜åˆ¶å¼‚æ­¥ç»˜åˆ¶ä¸»è¦æŒ‡çš„æ˜¯åœ¨åå°çº¿ç¨‹ä¸­å¤„ç†ç»˜åˆ¶æ“ä½œï¼Œä»¥é¿å…é˜»å¡ä¸»çº¿ç¨‹ã€‚Core Graphics å’Œ UIKit æä¾›äº†æ”¯æŒå¼‚æ­¥ç»˜åˆ¶çš„åŠŸèƒ½ã€‚\nä½¿ç”¨ Core Graphics çš„å¼‚æ­¥ç»˜åˆ¶ã€‚ä½¿ç”¨ UIGraphicsBeginImageContextWithOptions å‡½æ•°åœ¨åå°çº¿ç¨‹ä¸­åˆ›å»ºä¸€ä¸ª CGContextã€‚ä½¿ç”¨ GCD æˆ– NSOperationQueue æ¥åœ¨åå°çº¿ç¨‹ä¸­è¿›è¡Œç»˜åˆ¶æ“ä½œã€‚å®Œæˆç»˜åˆ¶åï¼Œå°†ç»“æœè¿”å›ä¸»çº¿ç¨‹ä»¥æ›´æ–° UIã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªå¼‚æ­¥ç»˜åˆ¶çš„ç¤ºä¾‹ä»£ç ï¼š\nimport UIKitclass AsyncDrawingView: UIView &#123;        private var asyncImage: UIImage?        override func draw(_ rect: CGRect) &#123;        super.draw(rect)                // å¦‚æœæœ‰å¼‚æ­¥ç»˜åˆ¶çš„å›¾ç‰‡ï¼Œç›´æ¥ç»˜åˆ¶å®ƒ        asyncImage?.draw(in: rect)    &#125;        func drawAsync() &#123;        Task &#123;            // åˆ›å»ºå›¾å½¢ä¸Šä¸‹æ–‡            let size = self.bounds.size            UIGraphicsBeginImageContextWithOptions(size, false, 0.0)            guard let context = UIGraphicsGetCurrentContext() else &#123; return &#125;                        // è¿›è¡Œç»˜åˆ¶æ“ä½œ            context.setFillColor(UIColor.blue.cgColor)            context.fill(CGRect(x: 0, y: 0, width: size.width, height: size.height))                        // è·å–ç»˜åˆ¶ç»“æœ            let image = UIGraphicsGetImageFromCurrentImageContext()            UIGraphicsEndImageContext()                        // æ›´æ–° UIï¼Œå›åˆ°ä¸»çº¿ç¨‹            await MainActor.run &#123;                self.asyncImage = image                self.setNeedsDisplay() // è§¦å‘ draw(_:) æ–¹æ³•é‡æ–°ç»˜åˆ¶            &#125;        &#125;    &#125;&#125;\nä½¿ç”¨ UIKit çš„å¼‚æ­¥ç»˜åˆ¶\nå¯¹äºå¤æ‚çš„å¼‚æ­¥ç»˜åˆ¶ï¼Œç‰¹åˆ«æ˜¯æ¶‰åŠ UIView çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥è€ƒè™‘è¿™ä¸¤ä¸ªæ–¹æ³•ã€‚é¦–å…ˆæ˜¯è‡ªå®šä¹‰ CALayer å¹¶å®ç°å…¶ draw(in:) æ–¹æ³•æ¥è¿›è¡Œå¼‚æ­¥ç»˜åˆ¶ã€‚å…¶æ¬¡æ˜¯ä½¿ç”¨ UIView çš„ draw(:) æ–¹æ³•ï¼Œåœ¨å­ç±»ä¸­é‡å†™ draw(:) æ–¹æ³•ï¼Œå¹¶ç»“åˆå¼‚æ­¥æ“ä½œæ¥æ›´æ–°ç»˜åˆ¶å†…å®¹ã€‚\nimport UIKitclass AsyncDrawingLayer: CALayer &#123;        override func draw(in ctx: CGContext) &#123;        super.draw(in: ctx)                Task &#123;            // åœ¨å­çº¿ç¨‹ä¸­æ‰§è¡Œç»˜åˆ¶æ“ä½œ            await withCheckedContinuation &#123; continuation in                Task.detached &#123;                    // æ‰§è¡Œç»˜åˆ¶æ“ä½œ                    ctx.setFillColor(UIColor.red.cgColor)                    ctx.fill(self.bounds)                                        // å®Œæˆç»˜åˆ¶æ“ä½œåç»§ç»­                    continuation.resume()                &#125;            &#125;                        // å›åˆ°ä¸»çº¿ç¨‹æ›´æ–° UI            await MainActor.run &#123;                self.setNeedsDisplay() // è§¦å‘ draw(in:) é‡æ–°ç»˜åˆ¶            &#125;        &#125;    &#125;&#125;\nç¦»å±æ¸²æŸ“ç¦»å±æ¸²æŸ“ï¼ˆOffscreen Renderingï¼‰åœ¨ iOS ä¸­æ˜¯æŒ‡åœ¨æ˜¾ç¤ºå™¨æ˜¾ç¤ºå†…å®¹ä¹‹å‰ï¼Œå…ˆåœ¨å†…å­˜ä¸­å®Œæˆæ¸²æŸ“ã€‚è¿™ç§æ–¹å¼çš„ä¸»è¦ä»£ä»·ä½“ç°åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š\n\nå†…å­˜æ¶ˆè€—ï¼šç¦»å±æ¸²æŸ“ä¼šå ç”¨é¢å¤–çš„å†…å­˜ï¼Œå› ä¸ºæ¯æ¬¡æ¸²æŸ“éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å›¾åƒç¼“å†²åŒºï¼ˆå³ç¦»å±ç¼“å­˜ï¼‰ã€‚è¿™äº›ç¼“å­˜å¯èƒ½ä¼šè¿…é€Ÿæ¶ˆè€—å¤§é‡å†…å­˜ï¼Œç‰¹åˆ«æ˜¯å¯¹äºå¤æ‚çš„è§†å›¾æˆ–é«˜åˆ†è¾¨ç‡çš„å›¾åƒã€‚\nå¤„ç†æ—¶é—´ï¼šè¿›è¡Œç¦»å±æ¸²æŸ“æ—¶ï¼ŒCPU å’Œ GPU éœ€è¦é¢å¤–çš„æ—¶é—´æ¥å¤„ç†æ¸²æŸ“æ“ä½œã€‚è¿™å¯èƒ½ä¼šå¯¼è‡´æ¸²æŸ“æ—¶é—´å¢åŠ ï¼Œå½±å“åˆ°åº”ç”¨çš„æµç•…æ€§ã€‚\nä¸Šä¸‹æ–‡åˆ‡æ¢ï¼šç¦»å±æ¸²æŸ“éœ€è¦å°†æ¸²æŸ“æ“ä½œä»ä¸»çº¿ç¨‹è½¬ç§»åˆ°åå°çº¿ç¨‹æˆ–é¢å¤–çš„å›¾å½¢ä¸Šä¸‹æ–‡ï¼Œè¿™å¢åŠ äº†ä¸Šä¸‹æ–‡åˆ‡æ¢çš„å¼€é”€ã€‚\nç»˜åˆ¶æ¬¡æ•°ï¼šæ¯æ¬¡éœ€è¦é‡æ–°ç»˜åˆ¶æ—¶ï¼ˆä¾‹å¦‚è§†å›¾çš„å†…å®¹æ›´æ–°ï¼‰ï¼Œéƒ½éœ€è¦æ‰§è¡Œç¦»å±æ¸²æŸ“ï¼Œè¿™å¯èƒ½å¯¼è‡´é¢‘ç¹çš„æ¸²æŸ“æ“ä½œï¼Œä»è€Œå½±å“æ€§èƒ½ã€‚\n\näº§ç”Ÿç¦»å±æ¸²æŸ“çš„å¸¸è§åŸå› æœ‰ï¼š\n\nåœ†è§’ï¼ˆCorner Radiusï¼‰ï¼šå¦‚æœåœ¨è§†å›¾æˆ–å›¾å±‚ä¸Šåº”ç”¨åœ†è§’æ•ˆæœï¼ŒiOS éœ€è¦åœ¨ç¦»å±ç¼“å­˜ä¸­å®Œæˆè¿™äº›æ“ä½œï¼Œå°¤å…¶æ˜¯å½“åœ†è§’åŠå¾„è¾ƒå¤§æ—¶ã€‚\né˜´å½±ï¼ˆShadowï¼‰ï¼šé˜´å½±æ•ˆæœé€šå¸¸éœ€è¦ç¦»å±æ¸²æŸ“ï¼Œå› ä¸ºé˜´å½±éœ€è¦åœ¨åŸå§‹è§†å›¾ä¹‹å¤–çš„åŒºåŸŸè¿›è¡Œå¤„ç†ã€‚\né€æ˜åº¦ï¼ˆOpacityï¼‰ï¼šå¯¹äºåŠé€æ˜çš„è§†å›¾æˆ–å›¾å±‚ï¼ŒiOS éœ€è¦è¿›è¡Œç¦»å±æ¸²æŸ“ä»¥æ­£ç¡®å¤„ç†æ··åˆæ•ˆæœã€‚\nå¤æ‚çš„å›¾å½¢æ“ä½œï¼šæ¯”å¦‚è·¯å¾„ï¼ˆUIBezierPathï¼‰çš„å¤æ‚ç»˜åˆ¶ï¼Œä¹Ÿå¯èƒ½å¯¼è‡´ç¦»å±æ¸²æŸ“ã€‚\n\né¿å…ç¦»å±æ¸²æŸ“çš„ä¼˜åŒ–ã€‚å¦‚æœè§†å›¾çš„å†…å®¹ä¸ä¼šé¢‘ç¹å˜åŒ–ï¼Œå¯ä»¥å°†è§†å›¾æ¸²æŸ“åˆ° layer.contents ä¸­ï¼Œä»è€Œé¿å…æ¯æ¬¡ç»˜åˆ¶æ—¶çš„ç¦»å±æ¸²æŸ“å¼€é”€ã€‚å°½é‡é¿å…å¤æ‚çš„åœ†è§’ã€é˜´å½±æ•ˆæœï¼Œæˆ–è€…ä½¿ç”¨æ›´ç®€å•çš„å›¾å½¢æ“ä½œã€‚å¦‚å¯èƒ½ï¼Œå‡å°‘å¯¹ layer çš„å±æ€§è®¾ç½®ï¼Œå°¤å…¶æ˜¯é‚£äº›å¯èƒ½å¼•èµ·ç¦»å±æ¸²æŸ“çš„å±æ€§ã€‚\n","categories":["æ€§èƒ½ä¼˜åŒ–"],"tags":["æ€§èƒ½ä¼˜åŒ–","å¡é¡¿ç›‘æ§"]},{"title":"é˜²æ­¢å¡é¡¿çš„æ–¹æ³•","url":"/2025/05/09/%E9%98%B2%E6%AD%A2%E5%8D%A1%E9%A1%BF%E7%9A%84%E6%96%B9%E6%B3%95/","content":"ä½¿ç”¨ç¼“å­˜åœ¨ iOS ä¸Šä½¿ç”¨ NSCache å¯ä»¥æœ‰æ•ˆå‡å°‘ä¸»çº¿ç¨‹ä¸Šçš„å·¥ä½œè´Ÿæ‹…ï¼Œç‰¹åˆ«æ˜¯åœ¨éœ€è¦é¢‘ç¹è®¿é—®å’Œé‡å¤è®¡ç®—çš„æƒ…å†µä¸‹ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ SwiftUI ç¤ºä¾‹ï¼Œå±•ç¤ºå¦‚ä½•åœ¨åº”ç”¨ä¸­ä½¿ç”¨ NSCache æ¥ç¼“å­˜å›¾åƒä»¥å‡å°‘åŠ è½½æ—¶é—´å’Œä¸»çº¿ç¨‹çš„è´Ÿæ‹…ã€‚\nç¤ºä¾‹ä»£ç ï¼š\nimport SwiftUI// ä½¿ç”¨ `NSCache` åˆ›å»ºä¸€ä¸ªå•ä¾‹ `ImageCache` ç±»ï¼Œç”¨äºç¼“å­˜å›¾åƒã€‚class ImageCache &#123;    static let shared = NSCache&lt;NSString, UIImage&gt;()&#125;// è¿™æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰çš„è§†å›¾ï¼Œç”¨äºå¼‚æ­¥åŠ è½½å’Œæ˜¾ç¤ºå›¾åƒã€‚struct AsyncImageView: View &#123;    let url: URL    @State private var image: UIImage? = nil        var body: some View &#123;        Group &#123;            if let image = image &#123;                Image(uiImage: image)                    .resizable()                    .scaledToFit()            &#125; else &#123;                ProgressView() // æ˜¾ç¤ºåŠ è½½è¿›åº¦                    // `onAppear` ä¿®é¥°ç¬¦ç”¨äºåœ¨è§†å›¾å‡ºç°æ—¶å¯åŠ¨å›¾åƒåŠ è½½ã€‚                    .onAppear &#123;                        loadImage()                    &#125;            &#125;        &#125;    &#125;        // åœ¨ `loadImage` å‡½æ•°ä¸­ï¼Œé¦–å…ˆå°è¯•ä» `NSCache` ä¸­è·å–å›¾åƒã€‚å¦‚æœå›¾åƒå·²ç»ç¼“å­˜ï¼Œåˆ™ç›´æ¥ä½¿ç”¨ï¼›å¦åˆ™ï¼Œå®ƒå°†åœ¨åå°çº¿ç¨‹ä¸Šå¼‚æ­¥åŠ è½½å›¾åƒï¼Œå¹¶åœ¨åŠ è½½å®Œæˆåæ›´æ–° UIã€‚    private func loadImage() &#123;        // å°è¯•ä»ç¼“å­˜ä¸­è·å–å›¾åƒ        if let cachedImage = ImageCache.shared.object(forKey: url.absoluteString as NSString) &#123;            self.image = cachedImage            return        &#125;                // å¼‚æ­¥åŠ è½½å›¾åƒ        DispatchQueue.global().async &#123;            if let data = try? Data(contentsOf: url), let loadedImage = UIImage(data: data) &#123;                // å°†å›¾åƒå­˜å‚¨åˆ°ç¼“å­˜ä¸­                ImageCache.shared.setObject(loadedImage, forKey: url.absoluteString as NSString)                                // æ›´æ–° UI å¿…é¡»åœ¨ä¸»çº¿ç¨‹ä¸Š                DispatchQueue.main.async &#123;                    self.image = loadedImage                &#125;            &#125;        &#125;    &#125;&#125;// æ˜¾ç¤º `AsyncImageView`ï¼Œå¹¶æä¾›è¦åŠ è½½çš„å›¾åƒ URLã€‚struct ContentView: View &#123;    let imageUrl = URL(string: &quot;https://www.example.com/image.jpg&quot;)! // æ›¿æ¢ä¸ºå®é™…çš„å›¾åƒ URL        var body: some View &#123;        AsyncImageView(url: imageUrl)            .frame(width: 300, height: 300)            .padding()    &#125;&#125;@mainstruct CacheExampleApp: App &#123;    var body: some Scene &#123;        WindowGroup &#123;            ContentView()        &#125;    &#125;&#125;\n\næ·»åŠ è§‚å¯Ÿè€…ä½¿ç”¨é€šçŸ¥ä¸­å¿ƒï¼ˆNotificationCenterï¼‰æ¥ç›‘å¬é€šçŸ¥æ˜¯ä¸€ç§å¸¸è§çš„æ–¹å¼ï¼Œå¯ä»¥æœ‰æ•ˆåœ°å‡å°‘ä¸»çº¿ç¨‹çš„è´Ÿæ‹…ï¼Œä»è€Œæé«˜åº”ç”¨çš„å“åº”æ€§ã€‚ä½ å¯ä»¥é€šè¿‡æ·»åŠ è§‚å¯Ÿè€…æ¥ç›‘å¬ç‰¹å®šçš„é€šçŸ¥ï¼Œå¹¶åœ¨æ¥æ”¶åˆ°é€šçŸ¥æ—¶å†æ‰§è¡Œç›¸åº”çš„æ“ä½œï¼Œé¿å…åœ¨ä¸»çº¿ç¨‹ä¸Šä¸€ç›´ç­‰å¾…ï¼Œé˜»ç¢å…¶å®ƒäº¤äº’æ“ä½œã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ SwiftUI ç¤ºä¾‹ï¼Œå±•ç¤ºå¦‚ä½•ä½¿ç”¨ NotificationCenter æ¥ç›‘å¬å’Œå¤„ç†é€šçŸ¥ã€‚\nç¤ºä¾‹ä»£ç ï¼š\nimport SwiftUIimport Combine// è‡ªå®šä¹‰é€šçŸ¥åç§°extension Notification.Name &#123;    static let customNotification = Notification.Name(&quot;customNotification&quot;)&#125;struct ContentView: View &#123;    @State private var value: Int = 0    private var notificationObserver: AnyCancellable?        var body: some View &#123;        VStack &#123;            Text(&quot;Value: \\(value)&quot;)                .padding()                        // å½“ç”¨æˆ·ç‚¹å‡»æŒ‰é’®æ—¶ï¼Œ`NotificationCenter.default.post` æ–¹æ³•ä¼šå‘å¸ƒä¸€ä¸ªé€šçŸ¥ï¼Œå¹¶åœ¨ `userInfo` ä¸­ä¼ é€’ä¸€ä¸ªæ–°çš„å€¼ã€‚            Button(&quot;Increase Value&quot;) &#123;                // å‘é€é€šçŸ¥                NotificationCenter.default.post(name: .customNotification, object: nil, userInfo: [&quot;newValue&quot;: value + 1])            &#125;        &#125;        // åœ¨ `onAppear` ä¸­ï¼Œé€šè¿‡ `NotificationCenter.default.publisher(for:)` æ·»åŠ ä¸€ä¸ªé€šçŸ¥è§‚å¯Ÿè€…ã€‚å½“æ¥æ”¶åˆ°é€šçŸ¥æ—¶ï¼Œ`sink` é—­åŒ…ä¼šè¢«è°ƒç”¨ï¼Œæ›´æ–°è§†å›¾ä¸­çš„çŠ¶æ€ã€‚        .onAppear &#123;            // ç›‘å¬è‡ªå®šä¹‰é€šçŸ¥            notificationObserver = NotificationCenter.default.publisher(for: .customNotification)                .sink &#123; notification in                    if let newValue = notification.userInfo?[&quot;newValue&quot;] as? Int &#123;                        value = newValue                    &#125;                &#125;        &#125;        // åœ¨ `onDisappear` ä¸­ï¼Œé€šè¿‡è°ƒç”¨ `cancel` æ–¹æ³•å–æ¶ˆè§‚å¯Ÿè€…ï¼Œé¿å…æ½œåœ¨çš„å†…å­˜æ³„æ¼ã€‚        .onDisappear &#123;            // å–æ¶ˆè§‚å¯Ÿè€…è®¢é˜…            notificationObserver?.cancel()        &#125;    &#125;&#125;@mainstruct MyApp: App &#123;    var body: some Scene &#123;        WindowGroup &#123;            ContentView()        &#125;    &#125;&#125;\nå¼‚æ­¥ä¸ºäº†é¿å…ä¸»çº¿ç¨‹å¡æ­»ï¼Œå¯ä»¥åˆ©ç”¨ Swift Concurrency æŠ€æœ¯ï¼ˆå¦‚ async&#x2F;awaitï¼‰å°†è€—æ—¶çš„è®¡ç®—ä»»åŠ¡è½¬ç§»åˆ°åå°çº¿ç¨‹æ‰§è¡Œï¼ŒåŒæ—¶åœ¨ä»»åŠ¡å®Œæˆåå°†ç»“æœæ›´æ–°åˆ°ä¸»çº¿ç¨‹ä¸Šã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨ Swift Concurrency æŠ€æœ¯çš„ SwiftUI ç¤ºä¾‹ï¼Œå±•ç¤ºå¦‚ä½•åœ¨åå°çº¿ç¨‹æ‰§è¡Œé¢„åŠ è½½ä»»åŠ¡ï¼Œå¹¶åœ¨ä¸»çº¿ç¨‹ä¸Šæ›´æ–° UIã€‚\nç¤ºä¾‹ä»£ç \nimport SwiftUIstruct ContentView: View &#123;    @State private var data: String = &quot;Loading...&quot;        var body: some View &#123;        VStack &#123;            Text(data)                .padding()                        // ç”¨æˆ·å¯ä»¥ç‚¹å‡»æŒ‰é’®æ¥æ‰‹åŠ¨è§¦å‘æ•°æ®åŠ è½½ä»»åŠ¡ï¼Œè¿™æ—¶ä»»åŠ¡ä¼šåœ¨åå°çº¿ç¨‹æ‰§è¡Œï¼Œè€Œä¸ä¼šé˜»å¡ä¸»çº¿ç¨‹ã€‚            Button(&quot;Load Data&quot;) &#123;                Task &#123;                    await loadData()                &#125;            &#125;        &#125;        .onAppear &#123;            // åœ¨ SwiftUI çš„ `onAppear` æˆ–è€…æŒ‰é’®ç‚¹å‡»äº‹ä»¶ä¸­ï¼Œä½¿ç”¨ `Task &#123;&#125;` å¯åŠ¨ä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡ã€‚è¿™å¯ä»¥è®©ä½ åœ¨ä¸é˜»å¡ä¸»çº¿ç¨‹çš„æƒ…å†µä¸‹æ‰§è¡Œè€—æ—¶æ“ä½œã€‚            Task &#123;                // `loadData()` å‡½æ•°æ˜¯ä¸€ä¸ªå¼‚æ­¥å‡½æ•°ï¼Œåœ¨è¿™ä¸ªå‡½æ•°ä¸­ä½¿ç”¨ `await` æ¥ç­‰å¾… `performHeavyTask()` çš„ç»“æœã€‚`performHeavyTask()` æ¨¡æ‹Ÿäº†ä¸€ä¸ªè€—æ—¶çš„ä»»åŠ¡ï¼Œå¦‚é¢„åŠ è½½æ•°æ®æˆ–å¤æ‚çš„è®¡ç®—ã€‚                await loadData()            &#125;        &#125;    &#125;        // å¼‚æ­¥åŠ è½½æ•°æ®    func loadData() async &#123;        // åœ¨åå°çº¿ç¨‹ä¸Šæ‰§è¡Œè€—æ—¶ä»»åŠ¡        let result = await performHeavyTask()                // ä¸ºäº†æ›´æ–°ä¸»çº¿ç¨‹ä¸Šçš„ UIï¼Œä½ éœ€è¦æ˜¾å¼åœ°å°†æ“ä½œåˆ‡æ¢å›ä¸»çº¿ç¨‹ã€‚`MainActor.run &#123;&#125;` ç¡®ä¿åœ¨ä¸»çº¿ç¨‹ä¸Šæ‰§è¡Œæ›´æ–°æ“ä½œã€‚        await MainActor.run &#123;            data = result        &#125;    &#125;        // æ¨¡æ‹Ÿè€—æ—¶ä»»åŠ¡    func performHeavyTask() async -&gt; String &#123;        // æ¨¡æ‹Ÿä¸€ä¸ªè€—æ—¶çš„æ“ä½œï¼Œæ¯”å¦‚ä¸€ä¸ªå¤æ‚çš„è®¡ç®—æˆ–æ•°æ®åŠ è½½ä»»åŠ¡ã€‚å®é™…å¼€å‘ä¸­ï¼Œè¿™å¯ä»¥æ›¿æ¢ä¸ºç½‘ç»œè¯·æ±‚æˆ–æ•°æ®åº“æ“ä½œç­‰ã€‚        try? await Task.sleep(nanoseconds: 2_000_000_000) // 2ç§’                return &quot;Data Loaded&quot;    &#125;&#125;@mainstruct MyApp: App &#123;    var body: some Scene &#123;        WindowGroup &#123;            ContentView()        &#125;    &#125;&#125;\nè¿™ä¸ªç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ Swift Concurrency æŠ€æœ¯å°†è€—æ—¶ä»»åŠ¡ç§»åˆ°åå°çº¿ç¨‹æ‰§è¡Œï¼Œä»è€Œé¿å…ä¸»çº¿ç¨‹å¡é¡¿ï¼Œå¹¶åœ¨ä»»åŠ¡å®Œæˆåå®‰å…¨åœ°æ›´æ–° UIã€‚è¿™æ ·å¯ä»¥ç¡®ä¿ä½ çš„åº”ç”¨åœ¨æ‰§è¡Œå¤æ‚ä»»åŠ¡æ—¶ä¾ç„¶ä¿æŒæµç•…çš„ç”¨æˆ·ä½“éªŒã€‚\n","categories":["æ€§èƒ½ä¼˜åŒ–"],"tags":["æ€§èƒ½ä¼˜åŒ–","å¡é¡¿ç›‘æ§"]}]