[{"title":"Day1-UIKitäº‹ä»¶ä¼ é€’æœºåˆ¶ & Responder Chain","url":"/2025/04/23/Day1-UIKit%E4%BA%8B%E4%BB%B6%E4%BC%A0%E9%80%92%E6%9C%BA%E5%88%B6-Responder-Chain/","content":"UIKit äº‹ä»¶ä¼ é€’æœºåˆ¶ &amp; Responder Chainä¸€ã€äº‹ä»¶ç±»å‹UIKit ä¸­ä¸»è¦çš„äº‹ä»¶ç±»å‹åŒ…æ‹¬ï¼š\n\nè§¦æ‘¸äº‹ä»¶ï¼ˆTouch Eventsï¼‰ï¼šå¦‚ tapã€swipeã€pinch ç­‰ã€‚\nè¿åŠ¨äº‹ä»¶ï¼ˆMotion Eventsï¼‰ï¼šå¦‚æ‘‡åŠ¨è®¾å¤‡ã€‚\nè¿œç¨‹æ§åˆ¶äº‹ä»¶ï¼ˆRemote-Control Eventsï¼‰ï¼šå¦‚è€³æœºæ§åˆ¶ã€CarPlayã€‚\næŒ‰é”®äº‹ä»¶ï¼ˆPress Eventsï¼‰ï¼ˆä»…é™ tvOS æˆ–æ”¯æŒç¡¬ä»¶é”®ç›˜æ—¶çš„ iOSï¼‰ã€‚\n\n\näºŒã€äº‹ä»¶ä¼ é€’æµç¨‹\näº‹ä»¶äº§ç”Ÿï¼š\n\näº‹ä»¶ç”±ç¡¬ä»¶ï¼ˆå±å¹•ã€ä¼ æ„Ÿå™¨ç­‰ï¼‰æ£€æµ‹åäº¤ç»™ç³»ç»Ÿã€‚\niOS å°†äº‹ä»¶åŠ å…¥åˆ°ä¸»çº¿ç¨‹çš„ UIApplication å¯¹è±¡ä¸­è¿›è¡Œåˆ†å‘ã€‚\n\n\näº‹ä»¶åˆ†å‘è·¯å¾„ï¼š\n\nUIApplication â†’ UIWindow â†’ UIView\n\n\nå‘½ä¸­æµ‹è¯•ï¼ˆHit-Testingï¼‰ï¼š\n\nä»æ ¹è§†å›¾ï¼ˆwindow çš„ rootViewï¼‰å¼€å§‹é€’å½’æŸ¥æ‰¾ç›®æ ‡è§†å›¾ã€‚\nä½¿ç”¨ä¸¤ä¸ªæ–¹æ³•ï¼š\npoint(inside:with:)\nhitTest(_:with:)\n\n\næœ€ç»ˆæ‰¾åˆ°æœ€åˆé€‚çš„è§†å›¾æ¥æ”¶è§¦æ‘¸äº‹ä»¶ã€‚\n\n\n\n\nä¸‰ã€Responder Chainï¼ˆå“åº”è€…é“¾ï¼‰1. ä»€ä¹ˆæ˜¯ Responder Chainï¼ŸResponder Chain æ˜¯ä¸€æ¡äº‹ä»¶å“åº”é“¾ï¼Œç”¨æ¥å¤„ç†è§†å›¾æ— æ³•å“åº”çš„äº‹ä»¶ã€‚\n2. Responder Chain æ„æˆä¸€ä¸ª UIResponder å¯¹è±¡ï¼ˆå¦‚ UIViewã€UIViewControllerï¼‰å¯ä»¥ä¼ é€’äº‹ä»¶ç»™å…¶ä¸Šå±‚å“åº”è€…ï¼šUIView â†’ UIViewController â†’ UIWindow â†’ UIApplication â†’ AppDelegate\nå¦‚æœæŸä¸ªå¯¹è±¡æ— æ³•å¤„ç†äº‹ä»¶ï¼Œå®ƒä¼šæŠŠäº‹ä»¶ä¼ é€’ç»™ä¸‹ä¸€ä¸ªå“åº”è€…ã€‚\n3. UIResponder æ–¹æ³•\n\n\næ–¹æ³•å\nè¯´æ˜\n\n\n\ntouchesBegan(_:with:)\nå¼€å§‹è§¦æ‘¸\n\n\ntouchesMoved(_:with:)\nè§¦æ‘¸ç§»åŠ¨\n\n\ntouchesEnded(_:with:)\nè§¦æ‘¸ç»“æŸ\n\n\ntouchesCancelled(_:with:)\nè§¦æ‘¸è¢«å–æ¶ˆ\n\n\nè¿˜å¯ä»¥é€šè¿‡ canBecomeFirstResponder å’Œ becomeFirstResponder() æ§åˆ¶ç„¦ç‚¹ã€‚\n\nå››ã€è‡ªå®šä¹‰äº‹ä»¶ä¼ é€’ï¼ˆå¸¸è§åœºæ™¯ï¼‰1. UIView ä¸å“åº”äº‹ä»¶å¯èƒ½æ˜¯å› ä¸ºä»¥ä¸‹åŸå› ï¼š\n\nisUserInteractionEnabled = false\nalpha &lt; 0.01\nhidden = true\n\n2. è‡ªå®šä¹‰æ§ä»¶äº‹ä»¶ä¼ é€’å¯é‡å†™ä»¥ä¸‹æ–¹æ³•ï¼š\n\nhitTest(_:with:)ï¼šå†³å®šè°æ˜¯äº‹ä»¶çš„æœ€ç»ˆå“åº”è€…ã€‚\npoint(inside:with:)ï¼šåˆ¤æ–­ç‚¹æ˜¯å¦åœ¨å½“å‰è§†å›¾å†…ã€‚\n\n\näº”ã€Responder Chain åº”ç”¨åœºæ™¯\næ§ä»¶äº‹ä»¶ä¼ é€’ï¼šå¦‚ UIButton ç‚¹å‡»äº‹ä»¶å‘ä¸Šä¼ é€’ã€‚\nèœå•å¤„ç†ï¼šå¦‚å¤åˆ¶ç²˜è´´èœå•å“åº”ã€‚\né”®ç›˜å“åº”ç®¡ç†ã€‚\nè‡ªå®šä¹‰äº‹ä»¶è·¯ç”±ï¼ˆtarget-action æ— æ³•å¤„ç†æ—¶ï¼‰ã€‚\n\n\nå…­ã€è°ƒè¯•æŠ€å·§\nä½¿ç”¨ View Debugger æ£€æŸ¥è§†å›¾å±‚çº§ã€‚\næ‰“æ–­ç‚¹è°ƒè¯• hitTest å’Œ touchesBeganã€‚\næŸ¥çœ‹ next å±æ€§è¿½è¸ª Responder Chainã€‚\n\n\nä¸ƒã€æ€»ç»“\nUIKit äº‹ä»¶ä» UIApplication å¼€å§‹ï¼Œç»è¿‡ UIWindow æœ€ç»ˆä¼ é€’ç»™å…·ä½“çš„ UIViewã€‚\nResponder Chain æ˜¯äº‹ä»¶å†’æ³¡æœºåˆ¶çš„å®ç°ï¼Œæ”¯æŒäº‹ä»¶çš„å¤šçº§å¤„ç†ã€‚\né€šè¿‡åˆç†åˆ©ç”¨ hitTest: å’Œ Responder Chainï¼Œå¯ä»¥å®ç°å¤æ‚äº¤äº’éœ€æ±‚ã€‚\n\n","categories":["åŸºç¡€"]},{"title":"Day1-ä¸¤æ•°ä¹‹å’Œ","url":"/2025/04/23/Day1-%E4%B8%A4%E6%95%B0%E4%B9%8B%E5%92%8C/","content":"ğŸ§  ç®—æ³•é¢˜ï¼šä¸¤æ•°ä¹‹å’Œï¼ˆTwo Sumï¼‰\nğŸ¯ é¢˜ç›®æè¿°ï¼š\nç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ nums å’Œä¸€ä¸ªç›®æ ‡å€¼ targetï¼Œè¯·ä½ åœ¨æ•°ç»„ä¸­æ‰¾å‡ºä¸¤ä¸ªåŠ èµ·æ¥ç­‰äºç›®æ ‡å€¼çš„æ•°å­—ï¼Œå¹¶è¿”å›å®ƒä»¬çš„æ•°ç»„ä¸‹æ ‡ã€‚\nä½ å¯ä»¥å‡è®¾æ¯ç§è¾“å…¥åªä¼šå¯¹åº”ä¸€ä¸ªç­”æ¡ˆã€‚ä½†æ•°ç»„ä¸­åŒä¸€ä¸ªå…ƒç´ ä¸èƒ½ä½¿ç”¨ä¸¤éã€‚\n\nğŸ’¡ ç¤ºä¾‹ï¼š\nè¾“å…¥: nums = [2, 7, 11, 15], target = 9è¾“å‡º: [0, 1] è§£é‡Š: å› ä¸º nums[0] + nums[1] == 9\n\nâœ… è§£é¢˜è¦æ±‚ï¼š\tâ€¢\tæ—¶é—´å¤æ‚åº¦å°½é‡åšåˆ° O(n)\tâ€¢\tè¿”å›ä¸€ç»„ä¸‹æ ‡å³å¯ï¼Œæ— éœ€è€ƒè™‘é¡ºåº\tâ€¢\tæä¾› Swift æˆ– Objective-C å®ç°\n\nâœ¨ æç¤ºï¼š\nä½ å¯ä»¥ç”¨å“ˆå¸Œè¡¨è®°å½•è®¿é—®è¿‡çš„æ•°å­—åŠå…¶ä¸‹æ ‡ï¼Œåœ¨éå†æ—¶ç›´æ¥åˆ¤æ–­ target - å½“å‰å€¼ æ˜¯å¦å­˜åœ¨äº map ä¸­ã€‚\n\nğŸš€ æ‹“å±•æ€è€ƒï¼ˆå»ºè®®å°è¯•ï¼‰ï¼š\t1.\tå¦‚æœè¦æ±‚è¿”å›æ‰€æœ‰å¯èƒ½çš„ä¸¤æ•°ç»„åˆï¼ˆå³å¯èƒ½æœ‰å¤šä¸ªç­”æ¡ˆï¼‰ï¼Œä½ ä¼šæ€ä¹ˆåšï¼Ÿ\t2.\tå¦‚æœè¾“å…¥æ˜¯ä¸€ä¸ªæœ‰åºæ•°ç»„ï¼Œä½ æ˜¯å¦å¯ä»¥ç”¨åŒæŒ‡é’ˆä¼˜åŒ–ï¼Ÿ\n\nğŸ”§ æ¨¡æ¿ï¼ˆSwift ç¤ºä¾‹ï¼‰ï¼š\nfunc twoSum(_ nums: [Int], _ target: Int) -&gt; [Int] &#123;    var map = [Int: Int]()  // è®°å½•æ•°å­—å’Œå¯¹åº”çš„ä¸‹æ ‡    for (index, num) in nums.enumerated() &#123;        let complement = target - num        if let otherIndex = map[complement] &#123;            return [otherIndex, index]        &#125;        map[num] = index    &#125;    return []&#125;\n\nJSç‰ˆæœ¬ï¼š\n/** * @param &#123;number[]&#125; nums * @param &#123;number&#125; target * @return &#123;number[]&#125; */var twoSum = function(nums, target) &#123;    let map = new Map();    for (let i = 0; i &lt; nums.length; i++) &#123;        let diff = target - nums[i];        if (map.has(diff)) &#123;            return [map.get(diff), i];        &#125;        map.set(nums[i], i);    &#125;&#125;;\n\nğŸ‘‰ LeetCode 1. ä¸¤æ•°ä¹‹å’Œ\n","categories":["ç®—æ³•"],"tags":["ç®—æ³•"]},{"title":"Day10-GCD è¿›é˜¶","url":"/2025/05/08/Day10-GCD-%E8%BF%9B%E9%98%B6/","content":"ä¸€ã€GCD é˜Ÿåˆ—åº•å±‚åŸç†1.1 é˜Ÿåˆ—ç±»å‹\nä¸²è¡Œé˜Ÿåˆ—ï¼šä¸€æ¬¡åªæ‰§è¡Œä¸€ä¸ªä»»åŠ¡ã€‚\nå¹¶å‘é˜Ÿåˆ—ï¼šå¯ä»¥å¹¶å‘æ‰§è¡Œå¤šä¸ªä»»åŠ¡ã€‚\nä¸»é˜Ÿåˆ—ï¼šä¸»çº¿ç¨‹çš„ä¸²è¡Œé˜Ÿåˆ—ï¼Œç”¨äºæ›´æ–° UIã€‚\n\n1.2 é˜Ÿåˆ—èƒŒåçš„çº¿ç¨‹\nGCD ä½¿ç”¨ çº¿ç¨‹æ±  ç®¡ç†çº¿ç¨‹ï¼Œå…·ä½“ç”± libdispatch + pthread å®ç°ã€‚\nå¹¶å‘é˜Ÿåˆ—ä»»åŠ¡å®é™…æ˜¯ä¸²è¡Œè°ƒåº¦ã€å¹¶å‘æ‰§è¡Œï¼ˆç”±ç³»ç»Ÿæ ¹æ®çº¿ç¨‹æ± å’Œèµ„æºè‡ªåŠ¨è°ƒåº¦ï¼‰ã€‚\n\näºŒã€å¸¸è§ GCD é«˜çº§ç”¨æ³•2.1 dispatch_barrierï¼ˆæ …æ å‡½æ•°ï¼‰dispatch_queue_t queue = dispatch_queue_create(&quot;com.example.queue&quot;, DISPATCH_QUEUE_CONCURRENT);dispatch_async(queue, ^&#123;    // ä»»åŠ¡1&#125;);dispatch_barrier_async(queue, ^&#123;    // æ …æ ä»»åŠ¡ï¼šå†™æ“ä½œ&#125;);dispatch_async(queue, ^&#123;    // ä»»åŠ¡2&#125;);\n\n2.2 dispatch_groupï¼ˆä»»åŠ¡ç»„ï¼‰dispatch_group_t group = dispatch_group_create();dispatch_queue_t queue = dispatch_get_global_queue(0, 0);dispatch_group_async(group, queue, ^&#123;    // ä»»åŠ¡1&#125;);dispatch_group_async(group, queue, ^&#123;    // ä»»åŠ¡2&#125;);dispatch_group_notify(group, dispatch_get_main_queue(), ^&#123;    // æ‰€æœ‰ä»»åŠ¡å®Œæˆåæ‰§è¡Œ&#125;);\n\n2.3 dispatch_semaphoreï¼ˆä¿¡å·é‡ï¼‰dispatch_semaphore_t semaphore = dispatch_semaphore_create(1);dispatch_async(queue, ^&#123;    dispatch_semaphore_wait(semaphore, DISPATCH_TIME_FOREVER);    // ä¸´ç•ŒåŒº    dispatch_semaphore_signal(semaphore);&#125;);\n\nä¸‰ã€é¿å…æ­»é”ä¸ä¼˜é›…ä½¿ç”¨3.1 æ­»é”ç¤ºä¾‹ï¼ˆä¸»é˜Ÿåˆ—åŒæ­¥è°ƒç”¨ï¼‰dispatch_sync(dispatch_get_main_queue(), ^&#123;    // æ­»é”ï¼šå½“å‰å·²ç»åœ¨ä¸»çº¿ç¨‹ï¼Œåˆç­‰ä¸»é˜Ÿåˆ—æ‰§è¡Œ&#125;);\n\n3.2 dispatch_onceï¼ˆçº¿ç¨‹å®‰å…¨çš„å•ä¾‹åˆå§‹åŒ–ï¼‰static dispatch_once_t onceToken;dispatch_once(&amp;onceToken, ^&#123;    // åˆå§‹åŒ–é€»è¾‘&#125;);\n\nå››ã€GCD ä¼˜åŒ–æŠ€å·§ä¸å®è·µ4.1 æ§åˆ¶æœ€å¤§å¹¶å‘æ•°ï¼ˆç»“åˆ semaphoreï¼‰dispatch_semaphore_t sema = dispatch_semaphore_create(3);for (int i = 0; i &lt; 10; i++) &#123;    dispatch_async(queue, ^&#123;        dispatch_semaphore_wait(sema, DISPATCH_TIME_FOREVER);        // ä¸‹è½½ä»»åŠ¡        dispatch_semaphore_signal(sema);    &#125;);&#125;\n\n4.2 ä½¿ç”¨ QoSï¼ˆæœåŠ¡è´¨é‡ï¼‰dispatch_queue_attr_t attr = dispatch_queue_attr_make_with_qos_class(DISPATCH_QUEUE_CONCURRENT, QOS_CLASS_USER_INITIATED, 0);dispatch_queue_t queue = dispatch_queue_create(&quot;com.example.qosqueue&quot;, attr);\n\näº”ã€å’Œ NSOperation æ¯”è¾ƒ\n\n\nç‰¹æ€§\nGCD\nNSOperation\n\n\n\nç®€æ´æ€§\nâœ…\nâŒï¼ˆæ›´å¤æ‚ï¼‰\n\n\nä¾èµ–ç®¡ç†\nâŒ\nâœ…ï¼ˆoperation.addDependencyï¼‰\n\n\nå–æ¶ˆä»»åŠ¡\nâŒ\nâœ…ï¼ˆoperation.cancelï¼‰\n\n\né‡ç”¨æ€§&#x2F;æ‰©å±•æ€§\nâŒ\nâœ…ï¼ˆå­ç±»åŒ–ï¼‰\n\n\nå¹¶å‘æ§åˆ¶ï¼ˆæ•°é‡ï¼‰\nå€ŸåŠ© semaphore\nâœ…ï¼ˆmaxConcurrentOperationCountï¼‰\n\n\nGCD çš„åº•å±‚å®ç°åŸç†Grand Central Dispatchï¼ˆGCDï¼‰æ˜¯è‹¹æœæä¾›çš„ä¸€ä¸ªå¤šçº¿ç¨‹å¹¶å‘ç¼–ç¨‹æ¡†æ¶ï¼Œå…¶åº•å±‚å®ç°åŸç†å¯ä»¥ä»å‡ ä¸ªå…³é”®çš„æŠ€æœ¯ç‚¹æ¥ç†è§£ï¼ŒåŒ…æ‹¬ï¼š\n\nä¸€ã€æ ¸å¿ƒç»“æ„ä¸å®ç°åŸºç¡€1. GCD åŸºäº libdispatch å®ç°GCD çš„åº•å±‚æ˜¯å¼€æºçš„ libdispatch åº“ï¼Œæ ¸å¿ƒç”¨ C å’Œ C++ ç¼–å†™ï¼Œè¿è¡Œåœ¨ç³»ç»Ÿå†…æ ¸ä¹‹ä¸Šï¼Œå°è£…äº†çº¿ç¨‹è°ƒåº¦ã€ä»»åŠ¡åˆ†å‘ã€é˜Ÿåˆ—ç®¡ç†ç­‰åŠŸèƒ½ã€‚\n\näºŒã€ä»»åŠ¡ä¸é˜Ÿåˆ—æ¨¡å‹1. ä»»åŠ¡ï¼šBlock å½¢å¼çš„å°è£…ä»£ç ï¼ˆå®è´¨æ˜¯é—­åŒ…ï¼‰æ¯ä¸ªä»»åŠ¡æ˜¯ä¸€ä¸ª dispatch_block_tï¼Œæœ¬è´¨æ˜¯å°è£…åœ¨ç»“æ„ä½“ä¸­çš„å‡½æ•°æŒ‡é’ˆå’Œä¸Šä¸‹æ–‡æ•°æ®ã€‚\n2. é˜Ÿåˆ—ï¼šä¸²è¡Œ or å¹¶å‘\nä¸²è¡Œé˜Ÿåˆ—ï¼šä»»åŠ¡ä¸€ä¸ªä¸ªé¡ºåºæ‰§è¡Œã€‚\nå¹¶å‘é˜Ÿåˆ—ï¼šä»»åŠ¡å¯åŒæ—¶æ‰§è¡Œï¼Œå…·ä½“æ˜¯å¦å¹¶è¡Œå–å†³äºç³»ç»Ÿèµ„æºã€‚\n\nåº•å±‚ç”±ç»“æ„ä½“ dispatch_queue_s è¡¨ç¤ºï¼Œå†…éƒ¨åŒ…å«ï¼š\n\né˜Ÿåˆ—åç§°\nä¼˜å…ˆçº§ï¼ˆQoSï¼‰\nTarget Queueï¼ˆç”¨äºç»§æ‰¿è¡Œä¸ºï¼‰\né˜Ÿåˆ—çŠ¶æ€ï¼ˆæ˜¯å¦æ­£åœ¨æ‰§è¡Œä»»åŠ¡ï¼‰\né˜Ÿåˆ—ç±»å‹ï¼ˆä¸²è¡Œ&#x2F;å¹¶å‘ï¼‰\n\n\nä¸‰ã€çº¿ç¨‹è°ƒåº¦åŸç†1. çº¿ç¨‹æ± æœºåˆ¶GCD ä¸ç›´æ¥åˆ›å»ºçº¿ç¨‹ï¼Œè€Œæ˜¯å¤ç”¨ä¸€ä¸ªç³»ç»Ÿç®¡ç†çš„çº¿ç¨‹æ± ï¼ˆManaged Thread Poolï¼‰ï¼š\n\nApple ä½¿ç”¨å†…æ ¸çš„ pthread å’Œ kqueue æœºåˆ¶åŠ¨æ€åˆ›å»ºå’Œè°ƒåº¦çº¿ç¨‹ã€‚\nè°ƒç”¨ dispatch_async ç­‰æ–¹æ³•æ—¶ä»»åŠ¡è¿›å…¥é˜Ÿåˆ—ï¼Œç­‰å¾…è°ƒåº¦å™¨ï¼ˆlibdispatchï¼‰åˆ¤æ–­æ˜¯å¦éœ€è¦ä»çº¿ç¨‹æ± ä¸­å–çº¿ç¨‹æ‰§è¡Œã€‚\n\n2. ç»“åˆå†…æ ¸çš„è°ƒåº¦å™¨\nä½¿ç”¨ XNU å†…æ ¸æä¾›çš„ workloopï¼ˆåŸºäº kqueueï¼‰æ¥ç›‘è§†é˜Ÿåˆ—å˜åŒ–ã€‚\nåˆ©ç”¨ä¿¡å·é‡ã€åŸå­æ“ä½œã€äº’æ–¥é”æ§åˆ¶ä»»åŠ¡åŒæ­¥ã€‚\n\n\nå››ã€é˜Ÿåˆ—çš„è°ƒåº¦æœºåˆ¶1. dispatch_async &#x2F; dispatch_sync çš„åŒºåˆ«\n\n\næ–¹æ³•\nè°ƒåº¦è¡Œä¸º\næ˜¯å¦é˜»å¡çº¿ç¨‹\n\n\n\ndispatch_async\nå¼‚æ­¥å…¥é˜Ÿ\nå¦\n\n\ndispatch_sync\nåŒæ­¥æ‰§è¡Œï¼Œå½“å‰çº¿ç¨‹ç­‰å¾…ä»»åŠ¡å®Œæˆ\næ˜¯\n\n\nåº•å±‚é€šè¿‡ï¼š\n\ndispatch_asyncï¼šåˆ›å»ºä»»åŠ¡å¯¹è±¡ -&gt; æ”¾å…¥ç›®æ ‡é˜Ÿåˆ— -&gt; å”¤é†’çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹å¤„ç†\ndispatch_syncï¼šç›´æ¥è°ƒç”¨ä»»åŠ¡ï¼Œå¹¶ä½¿ç”¨ semaphore é˜»å¡å½“å‰çº¿ç¨‹ï¼Œç›´åˆ°ä»»åŠ¡æ‰§è¡Œå®Œ\n\n\näº”ã€QoSï¼ˆæœåŠ¡è´¨é‡ï¼‰æ§åˆ¶GCD æ”¯æŒ QoSï¼ˆQuality of Serviceï¼‰ç­‰çº§ï¼Œä¾‹å¦‚ï¼š\n\nuserInteractiveï¼ˆæœ€é«˜ï¼‰\nuserInitiated\ndefault\nutility\nbackgroundï¼ˆæœ€ä½ï¼‰\n\nè¿™äº›ä¼˜å…ˆçº§é€šè¿‡åº•å±‚è®¾ç½®çº¿ç¨‹è°ƒåº¦å±æ€§ï¼Œåœ¨å†…æ ¸ä¸­ä¼šå½±å“çº¿ç¨‹æŠ¢å å’Œæ‰§è¡Œé¡ºåºã€‚\n\nå…­ã€å…³é”®æ•°æ®ç»“æ„ï¼ˆæºç è§’åº¦ï¼‰1. dispatch_queue_sï¼ˆé˜Ÿåˆ—ç»“æ„ä½“ï¼‰åŒ…å«ï¼š\nstruct dispatch_queue_s &#123;    ...    dispatch_object_t _head;    // é˜Ÿåˆ—å¤´éƒ¨    dispatch_object_t _tail;    // é˜Ÿåˆ—å°¾éƒ¨    pthread_priority_t _priority; // ä¼˜å…ˆçº§    ...&#125;;\n\n2. dispatch_continuation_sï¼ˆå°è£… block çš„ä»»åŠ¡ç»“æ„ä½“ï¼‰struct dispatch_continuation_s &#123;    void *dc_func;     // block å‡½æ•°æŒ‡é’ˆ    void *dc_ctxt;     // block ä¸Šä¸‹æ–‡    ...&#125;;\n\n\nä¸ƒã€å¹¶å‘æ§åˆ¶ï¼šä¿¡å·é‡ã€æ …æ ã€ç»„\ndispatch_semaphoreï¼šåº•å±‚åŸºäº semaphore_tï¼ˆMach ä¿¡å·é‡ï¼‰\ndispatch_barrierï¼šå†™æ“ä½œæ—¶é˜»å¡å…¶ä»–ä»»åŠ¡ï¼Œåº•å±‚ä½¿ç”¨ä»»åŠ¡ä¾èµ–å’Œæ ‡è®°æœºåˆ¶å®ç°\ndispatch_groupï¼šé€šè¿‡è®¡æ•°å™¨è¿½è¸ªä»»åŠ¡ç»„çŠ¶æ€ï¼Œé…åˆä¿¡å·é‡å®ç°é€šçŸ¥\n\n\næ€»ç»“GCD æ˜¯åŸºäº libdispatch æ„å»ºçš„çº¿ç¨‹æ±  + é˜Ÿåˆ—è°ƒåº¦æ¡†æ¶ï¼Œå…¶æ ¸å¿ƒä¼˜åŠ¿åŒ…æ‹¬ï¼š\n\né«˜æ•ˆçš„çº¿ç¨‹å¤ç”¨\nç®€æ´çš„ API å°è£…ï¼ˆblockï¼‰\nåŠ¨æ€ä¼˜å…ˆçº§ç®¡ç†ï¼ˆQoSï¼‰\nåº•å±‚ç»“åˆå†…æ ¸æœºåˆ¶ï¼ˆå¦‚ kqueue å’Œ pthreadï¼‰\n\n","categories":["åŸºç¡€"]},{"title":"Day10-åˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨","url":"/2025/05/08/Day10-%E5%90%88%E5%B9%B6%E4%B8%A4%E4%B8%AA%E6%9C%89%E5%BA%8F%E9%93%BE%E8%A1%A8/","content":"ğŸ”— LeetCode 21 - Merge Two Sorted Lists\nğŸ“Œ é¢˜ç›®æè¿°å°†ä¸¤ä¸ªå‡åºé“¾è¡¨åˆå¹¶ä¸ºä¸€ä¸ªæ–°çš„å‡åºé“¾è¡¨å¹¶è¿”å›ã€‚æ–°é“¾è¡¨æ˜¯é€šè¿‡æ‹¼æ¥ä¸¤ä¸ªç»™å®šé“¾è¡¨çš„æ‰€æœ‰èŠ‚ç‚¹ç»„æˆçš„ã€‚\nç¤ºä¾‹ï¼š\nè¾“å…¥ï¼šl1 = [1,2,4], l2 = [1,3,4]è¾“å‡ºï¼š[1,1,2,3,4,4]\n\nğŸ’¡ è§£é¢˜æ€è·¯\nä½¿ç”¨é€’å½’æˆ–è¿­ä»£æ–¹æ³•ï¼›\næ¯”è¾ƒä¸¤ä¸ªé“¾è¡¨å½“å‰èŠ‚ç‚¹å€¼ï¼Œè¾ƒå°è€…æ¥å…¥æ–°é“¾è¡¨ï¼›\nä¾æ¬¡å‘ååˆå¹¶ç›´åˆ°ä¸€ä¸ªé“¾è¡¨ä¸ºç©ºã€‚\næ—¶é—´å¤æ‚åº¦ï¼šO(n + m)\nç©ºé—´å¤æ‚åº¦ï¼šO(n + m)ï¼ˆé€’å½’æ ˆï¼‰æˆ– O(1)ï¼ˆè¿­ä»£ï¼‰\n\n\nâœ… JavaScript å®ç°ï¼ˆè¿­ä»£ï¼‰var mergeTwoLists = function(l1, l2) &#123;    const dummy = new ListNode(-1);    let curr = dummy;    while (l1 &amp;&amp; l2) &#123;        if (l1.val &lt; l2.val) &#123;            curr.next = l1;            l1 = l1.next;        &#125; else &#123;            curr.next = l2;            l2 = l2.next;        &#125;        curr = curr.next;    &#125;    curr.next = l1 || l2;    return dummy.next;&#125;;\n\n\nğŸ§  æ€è€ƒæ‹“å±•\nå¦‚æœé“¾è¡¨æ˜¯é™åºçš„æ€ä¹ˆåŠï¼Ÿ\nå¦‚ä½•ä½¿ç”¨é€’å½’æ–¹å¼å®ç°ï¼Ÿ\nèƒ½å¦æ‹“å±•ä¸ºåˆå¹¶ k ä¸ªæœ‰åºé“¾è¡¨ï¼Ÿ\n\n","categories":["ç®—æ³•"]},{"title":"Day2-ç”¨æ ˆå®ç°é˜Ÿåˆ—","url":"/2025/04/24/Day2-%E7%94%A8%E6%A0%88%E5%AE%9E%E7%8E%B0%E9%98%9F%E5%88%97/","content":"ğŸ”— LeetCode 232 - Implement Queue using Stacks\nğŸ“Œ é¢˜ç›®æè¿°ï¼šä½¿ç”¨ä¸¤ä¸ªæ ˆ stackIn å’Œ stackOut å®ç°ä¸€ä¸ªé˜Ÿåˆ—ï¼Œæ”¯æŒä»¥ä¸‹æ“ä½œï¼š\n\npush(x)ï¼šå°†å…ƒç´  x æ¨åˆ°é˜Ÿåˆ—çš„æœ«å°¾\npop()ï¼šç§»é™¤é˜Ÿåˆ—å¼€å¤´çš„å…ƒç´ å¹¶è¿”å›\npeek()ï¼šè¿”å›é˜Ÿåˆ—å¼€å¤´çš„å…ƒç´ \nempty()ï¼šè¿”å›é˜Ÿåˆ—æ˜¯å¦ä¸ºç©º\n\nè¦æ±‚ï¼šåªèƒ½ä½¿ç”¨æ ˆçš„æ ‡å‡†æ“ä½œï¼ˆpush, pop, peek, emptyï¼‰\n\nğŸ’¡ è§£é¢˜æ€è·¯ï¼š\nå…¥é˜Ÿæ“ä½œï¼ˆpushï¼‰ç›´æ¥å¾€ stackIn ä¸­åŠ å…ƒç´ ï¼›\nå‡ºé˜Ÿæ“ä½œï¼ˆpop æˆ– peekï¼‰æ—¶ï¼Œå¦‚æœ stackOut ä¸ºç©ºï¼Œåˆ™å°† stackIn ä¸­çš„æ‰€æœ‰å…ƒç´ å€’åºè½¬ç§»åˆ° stackOutï¼›\nä¿è¯å…ˆè¿›å…ˆå‡ºï¼ˆFIFOï¼‰çš„é¡ºåºã€‚\n\n\nâœ… JavaScript å®ç°ï¼švar MyQueue = function () &#123;    this.stackIn = [];    this.stackOut = [];&#125;;MyQueue.prototype.push = function (x) &#123;    this.stackIn.push(x);&#125;;MyQueue.prototype.pop = function () &#123;    if (this.stackOut.length === 0) &#123;        while (this.stackIn.length) &#123;            this.stackOut.push(this.stackIn.pop());        &#125;    &#125;    return this.stackOut.pop();&#125;;MyQueue.prototype.peek = function () &#123;    if (this.stackOut.length === 0) &#123;        while (this.stackIn.length) &#123;            this.stackOut.push(this.stackIn.pop());        &#125;    &#125;    return this.stackOut[this.stackOut.length - 1];&#125;;MyQueue.prototype.empty = function () &#123;    return this.stackIn.length === 0 &amp;&amp; this.stackOut.length === 0;&#125;;\n\n\n\nğŸ§  æ€è€ƒæ‹“å±•ï¼š\nå¦‚æœåè¿‡æ¥æ˜¯â€œç”¨é˜Ÿåˆ—å®ç°æ ˆâ€åº”è¯¥æ€ä¹ˆåšï¼ŸğŸ‘‰ LeetCode 225\né˜Ÿåˆ—ç›¸å…³æ‹“å±•é¢˜ï¼šæ»‘åŠ¨çª—å£æœ€å¤§å€¼ã€æœ€å°æ ˆç­‰\n\n","categories":["ç®—æ³•"],"tags":["ç®—æ³•"]},{"title":"Day2-View å¸ƒå±€æµç¨‹","url":"/2025/04/24/Day2-View-%E5%B8%83%E5%B1%80%E6%B5%81%E7%A8%8B/","content":"View å¸ƒå±€æµç¨‹è¯¦è§£ä¸€ã€å¸ƒå±€æµç¨‹æ€»è§ˆiOS çš„è§†å›¾å¸ƒå±€æµç¨‹ç”± UIKit ç®¡ç†ï¼Œæ ¸å¿ƒéµå¾ªã€Œä»çˆ¶åˆ°å­ã€ä»å¤–å‘å†…ã€çš„é€’å½’æ›´æ–°æ–¹å¼ã€‚æ¶‰åŠçš„å…³é”®æ–¹æ³•æœ‰ï¼š\n\nlayoutSubviewsï¼šçœŸæ­£è¿›è¡Œå­è§†å›¾ä½ç½®å¸ƒå±€çš„åœ°æ–¹\nsetNeedsLayoutï¼šæ ‡è®°è§†å›¾ä¸ºéœ€è¦é‡æ–°å¸ƒå±€\nlayoutIfNeededï¼šç«‹å³å¼ºåˆ¶å¸ƒå±€\n\nå¸ƒå±€æµç¨‹å¦‚ä¸‹ï¼šå±æ€§å˜åŒ–ï¼ˆå¦‚ frameï¼‰æˆ–æ‰‹åŠ¨è§¦å‘â†“è°ƒç”¨ setNeedsLayoutï¼ˆæ ‡è®°éœ€è¦å¸ƒå±€ï¼‰â†“ä¸‹ä¸€ä¸ª runloop æ‰§è¡Œ layoutIfNeededâ†“ç³»ç»Ÿé€’å½’è°ƒç”¨ layoutSubviews è¿›è¡Œå¸ƒå±€\n\näºŒã€å…³é”®æ–¹æ³•è¯¦è§£1. setNeedsLayout\nä½œç”¨ï¼šæ ‡è®°å½“å‰è§†å›¾ä¸ºâ€œéœ€è¦é‡æ–°å¸ƒå±€â€\nè°ƒç”¨æ—¶æœºï¼šå½“è§†å›¾çŠ¶æ€æˆ–ä¾èµ–æ•°æ®å˜åŒ–æ—¶\næ³¨æ„ï¼šä¸ä¼šç«‹å³æ‰§è¡Œ layoutSubviewsï¼Œè€Œæ˜¯åœ¨ä¸‹ä¸€ä¸ª runloop è¿›è¡Œå¸ƒå±€\n\n[self.view setNeedsLayout];\n\n2. layoutIfNeeded\nä½œç”¨ï¼šç«‹å³æ‰§è¡Œå¸ƒå±€æµç¨‹ï¼ˆå¦‚æœå·²æ ‡è®°ï¼‰\nå¸¸ç”¨åœºæ™¯ï¼šåŠ¨ç”»ä¸­å¼ºåˆ¶æ›´æ–° layoutï¼Œç¡®ä¿è§†å›¾çŠ¶æ€æ­£ç¡®  [self.view layoutIfNeeded];\n\n3. layoutSubviews\nä½œç”¨ï¼šå¸ƒå±€å­è§†å›¾ï¼Œå­ç±»é€šè¿‡é‡å†™æ­¤æ–¹æ³•æ¥è‡ªå®šä¹‰å¸ƒå±€é€»è¾‘\nè°ƒç”¨æ–¹å¼ï¼šç³»ç»Ÿè‡ªåŠ¨è°ƒç”¨ï¼Œæˆ–é€šè¿‡ layoutIfNeeded é—´æ¥è§¦å‘  - (void)layoutSubviews &#123;    [super layoutSubviews];    self.label.frame = CGRectMake(10, 10, 100, 40);&#125;\n\nä¸‰ã€å¸ƒå±€è§¦å‘æ—¶æœºå¸ƒå±€æµç¨‹ä¼šåœ¨ä»¥ä¸‹æƒ…å†µä¸‹è‡ªåŠ¨è§¦å‘ï¼š\n\nè§†å›¾åˆå§‹åŒ–å®Œæˆåé¦–æ¬¡æ·»åŠ åˆ°è§†å›¾å±‚çº§ä¸­\nframe &#x2F; bounds &#x2F; center å±æ€§æ”¹å˜\nè°ƒç”¨ setNeedsLayout + layoutIfNeeded\nå±å¹•æ—‹è½¬ã€è®¾å¤‡æ–¹å‘å˜åŒ–\nAuto Layout çº¦æŸå˜åŒ–\n\nå››ã€Auto Layout å‚ä¸å¸ƒå±€æµç¨‹å½“ä½¿ç”¨ Auto Layoutï¼ˆè‡ªåŠ¨å¸ƒå±€ï¼‰æ—¶ï¼š\n\nä¸æ¨èåœ¨ layoutSubviews ä¸­è®¾ç½® frame\næ›´æ–°çº¦æŸåº”åœ¨ updateConstraints æ–¹æ³•ä¸­å®Œæˆ\nupdateConstraints â†’ layoutSubviews â†’ drawRect æ˜¯å®Œæ•´çš„è°ƒç”¨é“¾  - (void)updateConstraints &#123;    // æ›´æ–°çº¦æŸ    [super updateConstraints];&#125;\n\näº”ã€UIView ä¸ CALayer çš„å…³ç³»\næ¯ä¸ª UIView éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„ CALayer\nUIView.frame å®é™…ä¸Šæ˜¯æ“ä½œ CALayer.frame\nå¸ƒå±€æœ¬è´¨ä¸Šæ˜¯åœ¨æ›´æ–°å›¾å±‚çš„å±æ€§  NSLog(@&quot;%@&quot;, NSStringFromCGRect(self.view.layer.frame));\n\nå…­ã€æ–‡å­—ç‰ˆå¸ƒå±€æµç¨‹å›¾[è§†å›¾å±æ€§å˜æ›´]      â†“[setNeedsLayout] â†’ æ ‡è®°å¸ƒå±€      â†“[ä¸‹ä¸€ä¸ª runloop]      â†“[layoutIfNeeded] â†’ åˆ¤æ–­å¹¶è§¦å‘å¸ƒå±€      â†“[layoutSubviews] â†’ æ›´æ–°å­è§†å›¾ frame\n\nä¸ƒã€é¢è¯•é«˜é¢‘é—®é¢˜æ•´ç†Q1ï¼šlayoutSubviews å’Œ drawRect æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ\nlayoutSubviewsï¼šç”¨äºæ›´æ–°å­è§†å›¾çš„å¸ƒå±€\ndrawRectï¼šç”¨äºè‡ªå®šä¹‰è§†å›¾ç»˜å›¾ï¼ˆå¦‚ Core Graphicsï¼‰\n\nQ2ï¼šå¦‚ä½•ç«‹å³è§¦å‘å¸ƒå±€ï¼Ÿ[self.view setNeedsLayout];[self.view layoutIfNeeded];\n\nQ3ï¼šä»€ä¹ˆæ—¶å€™ä¼šè°ƒç”¨ layoutSubviewsï¼Ÿ\næ·»åŠ åˆ°çˆ¶è§†å›¾å\nframe æ”¹å˜\nsetNeedsLayout + layoutIfNeeded\nAuto Layout è§¦å‘\n\nQ4ï¼šå¦‚ä½•åœ¨åŠ¨ç”»ä¸­ç¡®ä¿å¸ƒå±€ç”Ÿæ•ˆï¼Ÿ[UIView animateWithDuration:0.3 animations:^&#123;    // ä¿®æ”¹å¸ƒå±€å‰ç½®æ¡ä»¶    [self.view layoutIfNeeded]; // å¼ºåˆ¶ç«‹å³å¸ƒå±€&#125;];\n\nå…«ã€å‚è€ƒèµ„æ–™\nApple Developer æ–‡æ¡£ï¼šUIView Class Reference\nå®˜æ–¹æŒ‡å—ï¼šView Programming Guide for iOS\n\n","categories":["åŸºç¡€"]},{"title":"Day3-Block åˆ†ç±»ã€å˜é‡æ•è·ä¸ä½œç”¨åŸŸ","url":"/2025/04/25/Day3-Block-%E5%88%86%E7%B1%BB%E3%80%81%E5%8F%98%E9%87%8F%E6%8D%95%E8%8E%B7%E4%B8%8E%E4%BD%9C%E7%94%A8%E5%9F%9F/","content":"Block åˆ†ç±»ã€å˜é‡æ•è·ä¸ä½œç”¨åŸŸä¸€ã€Block çš„åˆ†ç±»Block åœ¨ Objective-C ä¸­ï¼Œæ ¹æ®å…¶å­˜å‚¨ä½ç½®å’Œç”Ÿå‘½å‘¨æœŸåˆ†ä¸ºä»¥ä¸‹ä¸‰ç±»ï¼š\n\n\n\nBlock ç±»å‹\nå­˜å‚¨ä½ç½®\nç‰¹ç‚¹è¯´æ˜\n\n\n\nGlobal Block\nå…¨å±€åŒº\nä¸æ•è·å¤–éƒ¨å˜é‡\n\n\nStack Block\næ ˆä¸Š\næ•è·å¤–éƒ¨å˜é‡ï¼Œéšæ ˆå¸§é”€æ¯\n\n\nHeap Block\nå †ä¸Š\næ•è·å¤–éƒ¨å˜é‡ï¼ŒBlock_copy åå­˜åœ¨å †ä¸Š\n\n\nç¤ºä¾‹ï¼švoid (^block1)(void) = ^&#123;    NSLog(@&quot;Hello&quot;);&#125;;// Global Blockint a = 10;void (^block2)(void) = ^&#123;    NSLog(@&quot;a = %d&quot;, a);&#125;;// Stack Blockvoid (^block3)(void) = [block2 copy];// Heap Block\n\n\näºŒã€å˜é‡æ•è·ï¼ˆCaptured Variablesï¼‰1. é»˜è®¤æ•è·ï¼ˆå€¼è¯­ä¹‰ï¼‰Block é»˜è®¤ä»¥å€¼æ–¹å¼æ‹·è´å±€éƒ¨å˜é‡ï¼Œä¸å¯ä¿®æ”¹ã€‚\nint a = 5;void (^block)(void) = ^&#123;    NSLog(@&quot;a is %d&quot;, a);&#125;;a = 6;block(); // è¾“å‡º a is 5\n\n2. __block ä¿®é¥°ï¼ˆå¼•ç”¨è¯­ä¹‰ï¼‰å…è®¸åœ¨ Block å†…éƒ¨ä¿®æ”¹å¤–éƒ¨å˜é‡ã€‚\n__block int a = 5;void (^block)(void) = ^&#123;    a = 10;&#125;;block();NSLog(@&quot;a is %d&quot;, a); // è¾“å‡º a is 10\n\n3. å¯¹è±¡æ•è·ï¼ˆæŒ‡é’ˆè¯­ä¹‰ï¼‰å¯¹è±¡å˜é‡ä»¥æŒ‡é’ˆå½¢å¼æ•è·ï¼Œä¼šè¢«å¼ºå¼•ç”¨ã€‚\nNSString *str = @&quot;Hello&quot;;void (^block)(void) = ^&#123;    NSLog(@&quot;%@&quot;, str);&#125;;// str è¢« retain\n\n\nä¸‰ã€ä½œç”¨åŸŸä¸å†…å­˜ç®¡ç†ç”Ÿå‘½å‘¨æœŸï¼š\nStack Block ç”Ÿå‘½å‘¨æœŸçŸ­ï¼Œè¶…å‡ºä½œç”¨åŸŸä¼šè¢«é”€æ¯ã€‚\néœ€è¦å¼‚æ­¥ä½¿ç”¨æ—¶ï¼Œå¿…é¡»å°† Block copy åˆ°å †ä¸Šï¼Œå˜ä¸º Heap Blockã€‚\nARC ä¸‹è‡ªåŠ¨è¿›è¡Œ copy æ“ä½œï¼›MRC éœ€æ‰‹åŠ¨è°ƒç”¨ Block_copyã€‚\n\nç¤ºä¾‹ï¼ˆARC å¼‚æ­¥å®‰å…¨ï¼‰ï¼šdispatch_async(dispatch_get_global_queue(0, 0), ^&#123;    NSLog(@&quot;Block executed&quot;);&#125;);// ARC è‡ªåŠ¨ copy åˆ°å †\n\n\nå››ã€Swift ä¸­çš„é—­åŒ…æ•è·Swift ä¸­é—­åŒ…é»˜è®¤å¼ºå¼•ç”¨æ•è·å¯¹è±¡ï¼š\nclass MyClass &#123;    var name = &quot;Test&quot;    func doSomething() &#123;        DispatchQueue.global().async &#123; [weak self] in            print(self?.name ?? &quot;nil&quot;)        &#125;    &#125;&#125;\n\nä½¿ç”¨ [weak self] &#x2F; [unowned self] å¯é¿å…å¾ªç¯å¼•ç”¨ã€‚\n\näº”ã€å°ç»“å¯¹æ¯”è¡¨\n\n\nåˆ†ç±»\næ˜¯å¦æ•è·å˜é‡\nå­˜å‚¨ä½ç½®\nç”Ÿå‘½å‘¨æœŸæ§åˆ¶\n\n\n\nGlobal Block\nå¦\nå…¨å±€åŒº\nç¨‹åºç”Ÿå‘½å‘¨æœŸå†…å¸¸é©»\n\n\nStack Block\næ˜¯\næ ˆä¸Š\néšæ ˆå¸§é”€æ¯\n\n\nHeap Block\næ˜¯\nå †ä¸Š\nBlock_copy åå­˜åœ¨äºå †ä¸­\n\n\n","categories":["åŸºç¡€"]},{"title":"Day3-æœ‰æ•ˆçš„æ‹¬å·","url":"/2025/04/25/Day3-%E6%9C%89%E6%95%88%E7%9A%84%E6%8B%AC%E5%8F%B7/","content":"ğŸ”— LeetCode 20 - Valid Parentheses\nğŸ“Œ é¢˜ç›®æè¿°ç»™å®šä¸€ä¸ªåªåŒ…æ‹¬ &#39;(&#39;, &#39;)&#39;, &#39;&#123;&#39;, &#39;&#125;&#39;, &#39;[&#39;, &#39;]&#39; çš„å­—ç¬¦ä¸² sï¼Œåˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦æ˜¯æœ‰æ•ˆçš„ã€‚\næœ‰æ•ˆå­—ç¬¦ä¸²éœ€æ»¡è¶³ï¼š\n\nå·¦æ‹¬å·å¿…é¡»ç”¨ç›¸åŒç±»å‹çš„å³æ‹¬å·é—­åˆã€‚\nå·¦æ‹¬å·å¿…é¡»ä»¥æ­£ç¡®çš„é¡ºåºé—­åˆã€‚\nç©ºå­—ç¬¦ä¸²ä¹Ÿä¸ºæœ‰æ•ˆå­—ç¬¦ä¸²ã€‚\n\n\nğŸ’¡ è§£é¢˜æ€è·¯\nä½¿ç”¨æ ˆç»“æ„æ¥å¤„ç†æ‹¬å·åŒ¹é…ï¼›\né‡åˆ°å·¦æ‹¬å·å°±å…¥æ ˆï¼Œé‡åˆ°å³æ‹¬å·æ—¶åˆ¤æ–­æ˜¯å¦å’Œæ ˆé¡¶é…å¯¹ï¼›\nè‹¥åŒ¹é…ï¼Œåˆ™å¼¹å‡ºæ ˆé¡¶ï¼›å¦åˆ™ç›´æ¥è¿”å› falseï¼›\næœ€åæ ˆä¸ºç©ºï¼Œåˆ™ä¸ºåˆæ³•å­—ç¬¦ä¸²ã€‚\n\n\nâœ… JavaScript å®ç°var isValid = function (s) &#123;    const stack = [];    const map = &#123;        &#x27;)&#x27;: &#x27;(&#x27;,        &#x27;&#125;&#x27;: &#x27;&#123;&#x27;,        &#x27;]&#x27;: &#x27;[&#x27;    &#125;;    for (let char of s) &#123;        if ([&#x27;(&#x27;, &#x27;&#123;&#x27;, &#x27;[&#x27;].includes(char)) &#123;            stack.push(char);        &#125; else &#123;            if (stack.pop() !== map[char]) &#123;                return false;            &#125;        &#125;    &#125;    return stack.length === 0;&#125;;\n\n\nğŸ§  æ€è€ƒæ‹“å±•\næ‹¬å·åŒ¹é…æ˜¯æ ˆç»“æ„ç»å…¸åº”ç”¨ï¼Œè¯·ç†è§£å…¶åº•å±‚æ€æƒ³ï¼›\nLeetCode æ‹“å±•é¢˜æ¨èï¼š\n22. Generate Parenthesesï¼ˆæ‹¬å·ç”Ÿæˆï¼‰\n32. Longest Valid Parenthesesï¼ˆæœ€é•¿æœ‰æ•ˆæ‹¬å·ï¼‰\n\n\n\n","categories":["ç®—æ³•"]},{"title":"Day4-Block å†…å­˜ç®¡ç† & å¾ªç¯å¼•ç”¨åˆ†æ","url":"/2025/04/27/Day4-Block-%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86-%E5%BE%AA%E7%8E%AF%E5%BC%95%E7%94%A8%E5%88%86%E6%9E%90/","content":"Block å†…å­˜ç®¡ç† &amp; å¾ªç¯å¼•ç”¨åˆ†æ1. Block çš„ç»“æ„ä½“æœ¬è´¨Block åœ¨åº•å±‚å…¶å®æ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼š\nstruct Block_literal &#123;    void *isa;                      // æŒ‡å‘ Block ç±»å¯¹è±¡    int flags;                      // æ ‡å¿—ä½ï¼ˆæ˜¯å¦æœ‰ copy/dispose ç­‰ï¼‰    int reserved;                   // ä¿ç•™å­—æ®µ    void (*invoke)(void *, ...);     // å‡½æ•°æŒ‡é’ˆï¼ŒBlock å®é™…æ‰§è¡Œé€»è¾‘    struct Block_descriptor *descriptor;  // Block æè¿°ä¿¡æ¯    // captured variables...&#125;;\n\n2. æ•è·å¤–éƒ¨å˜é‡æ—¶ï¼Œå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ\n\n\nå˜é‡ç±»å‹\næ•è·æ–¹å¼\nå†…å­˜ç®¡ç†è¡Œä¸º\n\n\n\nåŸºæœ¬æ•°æ®ç±»å‹ï¼ˆint&#x2F;floatï¼‰\nå€¼æ‹·è´\nä¸å½±å“å†…å­˜ç®¡ç†\n\n\nObjective-C å¯¹è±¡\nå¼ºå¼•ç”¨ï¼ˆretainï¼‰\néœ€è¦æ³¨æ„å¾ªç¯å¼•ç”¨\n\n\n__block ä¿®é¥°çš„å¯¹è±¡\næŒ‡é’ˆæ‹·è´ï¼Œä½†æœ¬èº«ä»å¯èƒ½å¼ºå¼•ç”¨\néœ€é…åˆ __weak __block\n\n\n3. Block çš„ copy å’Œ dispose å‡½æ•°Block å¦‚æœæ•è·äº†å¯¹è±¡ï¼Œåº•å±‚ä¼šè‡ªåŠ¨ç”Ÿæˆ copy å’Œ dispose å‡½æ•°ï¼š\n\ncopy ï¼š retain æ•è·çš„å¯¹è±¡\ndispose ï¼š release æ•è·çš„å¯¹è±¡\n\nç®€åŒ–ç¤ºä¾‹ï¼š\nvoid _Block_copy(void *dst, void *src) &#123;    objc_retain(capturedObj);&#125;void _Block_dispose(void *src) &#123;    objc_release(capturedObj);&#125;\n\n4. æ·±å±‚æ¬¡çš„å¾ªç¯å¼•ç”¨åˆ†æå¸¸è§å¯¼è‡´ Block å¾ªç¯å¼•ç”¨çš„åœºæ™¯ï¼š\n\nNSTimer &#x2F; CADisplayLink &#x2F; GCD\nå¼‚æ­¥ä»»åŠ¡ (dispatch_async)\né“¾å¼è°ƒç”¨\n\næ ‡å‡†é˜²å¾ªç¯å†™æ³•ï¼š\n__weak typeof(self) weakSelf = self;self.myBlock = ^&#123;    __strong typeof(weakSelf) strongSelf = weakSelf;    if (!strongSelf) return;    [strongSelf doSomething];&#125;;\n\n\n\nBlock é«˜é¢‘é¢è¯•é—®ç­”1. Block çš„ç±»å‹æœ‰å“ªäº›ï¼Ÿåˆ†åˆ«ä»€ä¹ˆæ—¶å€™å‡ºç°ï¼Ÿç­”ï¼š\n\nGlobal Blockï¼šä¸æ•è·å¤–éƒ¨å˜é‡ï¼Œå­˜å‚¨åœ¨å…¨å±€åŒºã€‚\nStack Blockï¼šæ•è·äº†å¤–éƒ¨å˜é‡ï¼Œå­˜å‚¨åœ¨æ ˆä¸Šã€‚\nMalloc Blockï¼šæ‹·è´è‡ª Stack Blockï¼Œå­˜å‚¨åœ¨å †ä¸Šã€‚\n\nARC ä¸‹åªå­˜åœ¨ Global Block å’Œ Malloc Blockã€‚\n\n2. Block åœ¨ ARC ä¸‹æ˜¯å¦‚ä½•å†…å­˜ç®¡ç†çš„ï¼Ÿç­”ï¼š\n\nARC ä¼šè‡ªåŠ¨å¯¹ Block æ‰§è¡Œ copy æ“ä½œï¼Œå°†å…¶ä»æ ˆæ‹·è´åˆ°å †ä¸Šã€‚\nä½¿ç”¨ __strong æŒ‡é’ˆæŒæœ‰ Block æ—¶ï¼Œé»˜è®¤æ˜¯å † Blockã€‚\n\n\n3. å¦‚ä½•åˆ¤æ–­ä¸€ä¸ª Block æ˜¯å¦é€ æˆäº†å¾ªç¯å¼•ç”¨ï¼Ÿç­”ï¼š\n\næ£€æŸ¥ Block å†…æ˜¯å¦ä½¿ç”¨äº† selfã€‚\næ£€æŸ¥ self æ˜¯å¦å¼ºå¼•ç”¨äº† Blockï¼ˆæ¯”å¦‚ Block æ˜¯ self çš„å±æ€§ï¼‰ã€‚\nä½¿ç”¨ Instruments çš„ Leaks å·¥å…·åˆ†æå†…å­˜æ³„æ¼ã€‚\n\n\n4. __block ä¿®é¥°ç¬¦åœ¨ ARC å’Œ MRC ä¸‹åˆ†åˆ«æ˜¯ä»€ä¹ˆè¡Œä¸ºï¼Ÿç­”ï¼š\n\nMRCï¼š__block å…è®¸ä¿®æ”¹å˜é‡ï¼Œä½†ä¸ä¼šè‡ªåŠ¨ç®¡ç†å¼•ç”¨è®¡æ•°ã€‚\nARCï¼š__block å…è®¸ä¿®æ”¹ï¼Œä½†å¹¶ä¸ä¼šå¼±åŒ–å¼•ç”¨å…³ç³»ï¼Œéœ€è¦è‡ªå·±å¤„ç†å¼±å¼•ç”¨ã€‚\n\n\n5. Block ä¸ºä»€ä¹ˆå®¹æ˜“å¼•èµ·å†…å­˜æ³„æ¼ï¼Ÿå…·ä½“æœ‰å“ªäº›åœºæ™¯ï¼Ÿç­”ï¼šå› ä¸º Block æ•è·å˜é‡æ˜¯å¼ºå¼•ç”¨ï¼Œç‰¹åˆ«æ˜¯å¯¹è±¡æŒ‡é’ˆï¼Œå¦‚ä¸‹åœºæ™¯å¸¸å‡ºé—®é¢˜ï¼š\n\nUIViewController çš„ Block å±æ€§å†…éƒ¨å¼•ç”¨äº† self\nNSTimerã€CADisplayLinkã€GCD ä¸­çš„ Block\n\nè§£å†³åŠæ³•ï¼š\n\nä½¿ç”¨ __weak\nå®šæ—¶å™¨ä½¿ç”¨ weakProxy\nGCD æ³¨æ„ç”Ÿå‘½å‘¨æœŸæ§åˆ¶\n\n\nå°ç»“ç†è§£ Block çš„å†…å­˜ç‰¹æ€§ã€å¼•ç”¨å…³ç³»å˜åŒ–ï¼ˆstack â†’ heapï¼‰ã€ä»¥åŠåœ¨ ARC ä¸‹çš„é»˜è®¤ copy æœºåˆ¶ï¼Œæ˜¯å½»åº•æŒæ¡ iOS å†…å­˜ç®¡ç†çš„å…³é”®ã€‚\n","categories":["åŸºç¡€"]},{"title":"Day4-æœ‰æ•ˆçš„å­—æ¯å¼‚ä½è¯","url":"/2025/04/27/Day4-%E6%9C%89%E6%95%88%E7%9A%84%E5%AD%97%E6%AF%8D%E5%BC%82%E4%BD%8D%E8%AF%8D/","content":"ğŸ”— LeetCode 242 - Valid Anagram\nğŸ“Œ é¢˜ç›®æè¿°ï¼šç»™å®šä¸¤ä¸ªå­—ç¬¦ä¸² s å’Œ tï¼Œç¼–å†™ä¸€ä¸ªå‡½æ•°æ¥åˆ¤æ–­ t æ˜¯å¦æ˜¯ s çš„å­—æ¯å¼‚ä½è¯ã€‚\nå­—æ¯å¼‚ä½è¯çš„å®šä¹‰ï¼šå¦‚æœä¸¤ä¸ªå­—ç¬¦ä¸²ä¸­çš„å­—æ¯å‡ºç°çš„é¢‘ç‡ç›¸åŒä¸”å­—ç¬¦å®Œå…¨ä¸€è‡´ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªå­—ç¬¦ä¸²æ˜¯å­—æ¯å¼‚ä½è¯ã€‚\n\nğŸ’¡ è§£é¢˜æ€è·¯ï¼šâ€¢\tå°†ä¸¤ä¸ªå­—ç¬¦ä¸² s å’Œ t çš„å­—æ¯å‡ºç°é¢‘æ¬¡ç»Ÿè®¡å‡ºæ¥ï¼Œè‹¥ä¸¤ä¸ªå­—ç¬¦ä¸²çš„å­—æ¯é¢‘æ¬¡å®Œå…¨ç›¸åŒï¼Œåˆ™å®ƒä»¬æ˜¯å­—æ¯å¼‚ä½è¯ã€‚\nâ€¢\té€šè¿‡ä½¿ç”¨å“ˆå¸Œè¡¨æˆ–æ•°ç»„å­˜å‚¨å­—æ¯çš„é¢‘ç‡ã€‚\n\n\nâœ… JavaScript å®ç°ï¼švar isAnagram = function (s, t) &#123;    if (s.length !== t.length) return false;        const count = new Array(26).fill(0);        for (let i = 0; i &lt; s.length; i++) &#123;        count[s.charCodeAt(i) - &#x27;a&#x27;.charCodeAt(0)]++;        count[t.charCodeAt(i) - &#x27;a&#x27;.charCodeAt(0)]--;    &#125;        for (let i = 0; i &lt; 26; i++) &#123;        if (count[i] !== 0) return false;    &#125;        return true;&#125;;\n\n\n\n\nğŸ§  æ€è€ƒæ‹“å±•ï¼šâ€¢\tå­—æ¯å¼‚ä½è¯é—®é¢˜çš„ä¼˜åŒ–ï¼šå¦‚ä½•å‡å°‘ä¸å¿…è¦çš„æ¯”è¾ƒï¼Œæå‡ç®—æ³•æ•ˆç‡ï¼Ÿ\nâ€¢\tå¯¹æ¯”å…¶ä»–å­—ç¬¦ä¸²ç›¸å…³çš„é¢˜ç›®ï¼Œæ¯”å¦‚ 387. First Unique Character in a Stringã€‚\n\n\n","categories":["ç®—æ³•"]},{"title":"Day5-Objective-C Runtime åŸºç¡€ç»“æ„","url":"/2025/04/28/Day5-Objective-C-Runtime-%E5%9F%BA%E7%A1%80%E7%BB%93%E6%9E%84/","content":"Objective-C Runtime åŸºç¡€ç»“æ„Objective-C è¿è¡Œæ—¶ç³»ç»Ÿï¼ˆRuntimeï¼‰æ˜¯ Objective-C è¯­è¨€çš„æ ¸å¿ƒéƒ¨åˆ†ï¼Œå®ƒåœ¨ç¨‹åºè¿è¡ŒæœŸé—´è´Ÿè´£ç®¡ç†ç±»ã€å¯¹è±¡ã€æ–¹æ³•è°ƒç”¨ç­‰è¡Œä¸ºã€‚\nä¸»è¦çš„ç»“æ„ä½“å’Œç»„ä»¶åŒ…æ‹¬ï¼š\n1. objc_classï¼ˆç±»ç»“æ„ä½“ï¼‰struct objc_class &#123;    Class isa;                // æŒ‡å‘å…ƒç±»    Class super_class;        // çˆ¶ç±»    const char *name;         // ç±»å    long version;             // ç‰ˆæœ¬ä¿¡æ¯    long info;                // ç±»ä¿¡æ¯æ ‡å¿—    long instance_size;       // ç±»å®ä¾‹çš„å¤§å°    struct objc_ivar_list *ivars;    // æˆå‘˜å˜é‡åˆ—è¡¨    struct objc_method_list **methodLists; // æ–¹æ³•åˆ—è¡¨ï¼ˆæ•°ç»„ï¼‰    struct objc_cache *cache; // æ–¹æ³•ç¼“å­˜    struct objc_protocol_list *protocols; // åè®®åˆ—è¡¨&#125;;\n\næ³¨æ„ï¼šç°ä»£ Runtime ä¸­ï¼Œç»“æ„ä½“å·²ç»å˜åŒ–äº†ï¼Œä¸Šè¿°æ˜¯ç»å…¸ï¼ˆæ—©æœŸï¼‰çš„æè¿°ï¼Œæ–°çš„ç‰ˆæœ¬æ›´å¤æ‚ä¸”é«˜åº¦å°è£…ã€‚\n\n\n2. objc_objectï¼ˆå¯¹è±¡ç»“æ„ä½“ï¼‰struct objc_object &#123;    Class isa;  // æŒ‡å‘å¯¹è±¡æ‰€å±çš„ç±»&#125;;\n\næ¯ä¸€ä¸ªå¯¹è±¡åº•å±‚å…¶å®å°±æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œæœ€é‡è¦çš„æˆå‘˜å°±æ˜¯ isaã€‚\nisa æ—¢å¯ä»¥æŒ‡å‘ Classï¼Œä¹Ÿå¯ä»¥æŒ‡å‘ Meta-Classï¼ˆå…ƒç±»ï¼‰ã€‚\n\n\n3. objc_methodï¼ˆæ–¹æ³•ç»“æ„ä½“ï¼‰struct objc_method &#123;    SEL name;      // æ–¹æ³•é€‰æ‹©å™¨ï¼ˆSelectorï¼‰    char *types;   // æ–¹æ³•çš„å‚æ•°å’Œè¿”å›å€¼ç±»å‹ç¼–ç     IMP imp;       // æ–¹æ³•å®ç°çš„å‡½æ•°æŒ‡é’ˆ&#125;;\n\nSEL æ˜¯æ–¹æ³•åçš„å”¯ä¸€æ ‡è¯†ã€‚\nIMP æ˜¯å‡½æ•°æŒ‡é’ˆï¼Œæœ¬è´¨ä¸Šå°±æ˜¯ C å‡½æ•°çš„åœ°å€ã€‚\n\n\n4. objc_ivarï¼ˆæˆå‘˜å˜é‡ç»“æ„ä½“ï¼‰struct objc_ivar &#123;    char *name;        // å˜é‡å    char *typeEncoding; // ç±»å‹ç¼–ç     int offset;         // å˜é‡åœ¨å¯¹è±¡å†…å­˜ä¸­çš„åç§»é‡&#125;;\n\næˆå‘˜å˜é‡çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬åå­—ã€ç±»å‹å’Œå†…å­˜ä½ç½®ã€‚\n\n\n5. objc_propertyï¼ˆå±æ€§ç»“æ„ä½“ï¼‰åœ¨ç°ä»£ Runtime é‡Œé¢ï¼Œå±æ€§ä¹Ÿæœ‰è‡ªå·±çš„ç»“æ„ï¼š\ntypedef struct &#123;    const char *name;            // å±æ€§å    const char *attributes;      // å±æ€§ä¿®é¥°åˆ—è¡¨ï¼ˆä¾‹å¦‚ï¼šT@&quot;NSString&quot;,C,N,V_nameï¼‰&#125; objc_property_t;\n\nå±æ€§å…¶å®æ˜¯æˆå‘˜å˜é‡ + ä¸€äº›ç‰¹å®šç‰¹æ€§ï¼ˆgetter&#x2F;setterè§„åˆ™ï¼‰ã€‚\n\n\nå°æ€»ç»“\n\n\nç»„ä»¶\nä½œç”¨\n\n\n\nobjc_object\næ‰€æœ‰å¯¹è±¡çš„åŸºç¡€\n\n\nobjc_class\nç±»å¯¹è±¡æè¿°ç»“æ„\n\n\nobjc_method\næ–¹æ³•çš„å®šä¹‰\n\n\nobjc_ivar\næˆå‘˜å˜é‡å®šä¹‰\n\n\nobjc_property\nå±æ€§å®šä¹‰\n\n\n\nè¿›é˜¶è¡¥å……åœ¨ ç°ä»£ Objective-C Runtimeï¼ˆå¦‚ iOS 14+ï¼‰ï¼Œè¿™äº›ç»“æ„ä½“å®é™…ä¸Šè¢«è¿›ä¸€æ­¥å°è£…ä¼˜åŒ–ï¼Œæ¯”å¦‚ï¼š\n\nç±»ä½¿ç”¨ objc_class å’Œ objc_data_bits_tï¼ˆè”åˆä½“ï¼‰åˆ†ç¦»äº†ç¼“å­˜ã€åªè¯»æ•°æ®ç­‰ã€‚\nmethodList ä¹Ÿä½¿ç”¨æ›´ç´§å‡‘çš„é“¾è¡¨å­˜å‚¨ã€‚\nisa æŒ‡é’ˆé€šè¿‡ isa æŒ‡é’ˆä¼˜åŒ–ï¼ˆISAæŒ‡é’ˆæ‰“åŒ…ï¼‰ åŒ…å«äº†æ›´å¤šä¿¡æ¯ï¼Œæ¯”å¦‚å¼•ç”¨è®¡æ•°ã€æ˜¯å¦æœ‰C++ææ„å‡½æ•°ç­‰ã€‚\n\n\nç°ä»£ Objective-C Runtime çš„ä¼˜åŒ–\n\nobjc_class å’Œ objc_data_bits_t çš„åˆ†ç¦»\n\næ—©æœŸï¼ˆä¼ ç»Ÿï¼‰çš„ç»“æ„ï¼š\nåœ¨æ—©æœŸçš„ Objective-C Runtime ä¸­ï¼Œç±»å¯¹è±¡ï¼ˆobjc_classï¼‰åŒ…å«äº†æ‰€æœ‰å…³äºç±»çš„æè¿°ä¿¡æ¯ï¼ŒåŒ…æ‹¬ï¼š\n\nisa æŒ‡é’ˆï¼ˆæŒ‡å‘å…ƒç±»ï¼‰\nsuper_classï¼ˆçˆ¶ç±»æŒ‡é’ˆï¼‰\næˆå‘˜å˜é‡ã€æ–¹æ³•åˆ—è¡¨ã€å±æ€§ç­‰\n\nè¿™ç§ç»“æ„è™½ç„¶ç®€å•ï¼Œä½†éšç€ iOS è®¾å¤‡æ€§èƒ½çš„æé«˜ï¼Œè¿è¡Œæ—¶ç³»ç»Ÿä¹Ÿéœ€è¦å¯¹è¿™äº›æ•°æ®ç»“æ„è¿›è¡Œä¼˜åŒ–ã€‚\nç°ä»£ä¼˜åŒ–ï¼š\nåœ¨ iOS 14 åŠä¹‹åçš„ç‰ˆæœ¬ä¸­ï¼ŒObjective-C Runtime é€šè¿‡ åˆ†ç¦» ç±»çš„å„ä¸ªç»„æˆéƒ¨åˆ†ï¼Œæé«˜äº†æ€§èƒ½å’Œå†…å­˜æ•ˆç‡ã€‚\nobjc_class ç°åœ¨ä¸»è¦åŒ…å« å…ƒç±»çš„å¼•ç”¨ï¼Œè€Œå…¶å®ƒæ•°æ®ï¼ˆå¦‚æ–¹æ³•åˆ—è¡¨ã€å±æ€§ã€æˆå‘˜å˜é‡ç­‰ï¼‰è¢«ç§»åˆ°äº† objc_data_bits_t ç»“æ„ä¸­ã€‚è¿™ç§æ–¹å¼çš„å¥½å¤„æ˜¯ï¼š\n\nç¼“å­˜å‹å¥½ï¼šç±»çš„å…ƒæ•°æ®å¯ä»¥è¢«å­˜å‚¨åœ¨å†…å­˜çš„ç´§å‡‘åŒºåŸŸï¼Œæé«˜äº†ç¼“å­˜å‘½ä¸­ç‡ã€‚\nåˆ†ç¦»å­˜å‚¨ï¼šç±»æ•°æ®å’Œæ–¹æ³•æ•°æ®åˆ†å¼€å­˜å‚¨ï¼Œé¿å…äº†å†—ä½™çš„å†…å­˜å ç”¨ã€‚\nå¢å¼ºçš„çµæ´»æ€§ï¼šå¯ä»¥åœ¨ä¸åŒçš„ç¡¬ä»¶æ¶æ„ä¸‹å¯¹è¿™äº›æ•°æ®è¿›è¡Œä¸åŒçš„å¸ƒå±€ï¼Œä»¥ä¾¿æ›´å¥½åœ°é€‚é…ä¸åŒçš„å†…å­˜å’Œå¤„ç†å™¨ç‰¹æ€§ã€‚\n\nä¾‹å­ï¼š\nobjc_class ç»“æ„å˜å¾—éå¸¸ç®€æ´ï¼š\nstruct objc_class &#123;    Class isa;                // æŒ‡å‘å…ƒç±»    Class super_class;        // çˆ¶ç±»    const char *name;         // ç±»å    ...    objc_data_bits_t data;    // ç±»çš„å…¶å®ƒå…ƒæ•°æ®ï¼Œå¦‚æ–¹æ³•ã€å±æ€§ã€ç¼“å­˜ç­‰&#125;;\n\nè€Œ objc_data_bits_t åˆ™åŒ…å«äº†å®é™…çš„æ•°æ®éƒ¨åˆ†ï¼š\nunion objc_data_bits_t &#123;    struct &#123;        method_list_t *methodList;   // æ–¹æ³•åˆ—è¡¨        ivar_list_t *ivarList;       // æˆå‘˜å˜é‡åˆ—è¡¨        property_list_t *propertyList; // å±æ€§åˆ—è¡¨        cache_t cache;               // æ–¹æ³•ç¼“å­˜    &#125;;    uintptr_t raw; // åŸå§‹å†…å­˜è¡¨ç¤º&#125;;\n\n\n\n\nmethodList å­˜å‚¨çš„ä¼˜åŒ–\n\næ—©æœŸå­˜å‚¨ï¼š\nä¼ ç»Ÿçš„ methodList æ˜¯åŸºäºé“¾è¡¨ï¼ˆLinked Listï¼‰å­˜å‚¨çš„ã€‚è¿™ç§æ–¹å¼è™½ç„¶ç®€å•ï¼Œä½†æŸ¥æ‰¾æ–¹æ³•æ—¶æ•ˆç‡è¾ƒä½ï¼Œå°¤å…¶æ˜¯åœ¨ç±»å±‚çº§å¾ˆæ·±æˆ–è€…æ–¹æ³•å¾ˆå¤šçš„æƒ…å†µä¸‹ã€‚\nç°ä»£ä¼˜åŒ–ï¼š\nåœ¨ç°ä»£çš„ Runtime ç³»ç»Ÿä¸­ï¼ŒmethodList ä¸å†æ˜¯å•çº¯çš„é“¾è¡¨ã€‚å®ƒç°åœ¨é‡‡ç”¨äº†ä¸€ç§ ç´§å‡‘çš„é“¾è¡¨ç»“æ„ï¼Œå¹¶ä¸”ç»“åˆäº† å“ˆå¸Œè¡¨ï¼ˆHash Tableï¼‰ æˆ–è€… äºŒå‰æœç´¢æ ‘ï¼ˆBinary Search Treeï¼‰ï¼Œå¤§å¤§æé«˜äº†æ–¹æ³•æŸ¥æ‰¾çš„æ•ˆç‡ã€‚\n\nå“ˆå¸Œè¡¨ï¼šé€šè¿‡å“ˆå¸Œå€¼æ¥å­˜å‚¨æ–¹æ³•ï¼ŒæŸ¥æ‰¾æ“ä½œæ—¶é—´å¤æ‚åº¦ä¸º O(1)ã€‚\näºŒå‰æœç´¢æ ‘ï¼šå¦‚æœæ–¹æ³•åˆ—è¡¨è¾ƒå¤§ï¼Œå¯èƒ½ä½¿ç”¨æ ‘ç»“æ„æ¥æé«˜æŸ¥æ‰¾æ€§èƒ½ï¼ˆç‰¹åˆ«æ˜¯æ–¹æ³•åæ’åºåï¼‰ã€‚\n\nè¿™ç§ä¼˜åŒ–ä½¿å¾—å¯¹äºé¢‘ç¹è°ƒç”¨çš„æ–¹æ³•ï¼Œèƒ½å¤Ÿä»¥æ›´é«˜çš„æ•ˆç‡è¿›è¡ŒæŸ¥æ‰¾ã€‚\nä¼˜åŒ–çš„å¥½å¤„ï¼š\n\næ–¹æ³•æŸ¥æ‰¾é€Ÿåº¦æ›´å¿«ã€‚\né™ä½äº†å†…å­˜å ç”¨ï¼Œå°¤å…¶åœ¨æ–¹æ³•å¾ˆå¤šçš„ç±»ä¸­è¡¨ç°å°¤ä¸ºçªå‡ºã€‚\n\n\nisa æŒ‡é’ˆä¼˜åŒ–ï¼ˆISAæŒ‡é’ˆæ‰“åŒ…ï¼‰\n\næ—©æœŸ isa æŒ‡é’ˆï¼š\næ—©æœŸçš„ isa æŒ‡é’ˆå®é™…ä¸Šæ˜¯ä¸€ä¸ªå•çº¯çš„æŒ‡é’ˆï¼Œå®ƒæŒ‡å‘å½“å‰å¯¹è±¡æ‰€å±çš„ç±»ã€‚å½“æˆ‘ä»¬éœ€è¦åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡çš„ç±»å‹æ—¶ï¼Œå¿…é¡»é€šè¿‡è¿™ä¸ªæŒ‡é’ˆè¿›è¡ŒæŸ¥æ‰¾ã€‚è¿™ä¸ªè¿‡ç¨‹è™½ç„¶æœ‰æ•ˆï¼Œä½†éšç€å†…å­˜å’Œå¤„ç†å™¨æ¶æ„çš„å˜åŒ–ï¼Œå…¶æ•ˆç‡å¹¶æ²¡æœ‰å¾—åˆ°æœ€ä¼˜çš„åˆ©ç”¨ã€‚\nç°ä»£ä¼˜åŒ–ï¼š\niOS 14 åŠä¹‹åçš„ç‰ˆæœ¬å¼•å…¥äº† ISA æŒ‡é’ˆæ‰“åŒ…ï¼ˆISA pointer packingï¼‰ çš„æ¦‚å¿µï¼Œä½¿å¾— isa æŒ‡é’ˆå˜å¾—æ›´åŠ é«˜æ•ˆã€‚å…·ä½“æ¥è¯´ï¼š\n\nå‹ç¼©æŒ‡é’ˆï¼šisa ä¸ä»…ä»…æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œå®ƒåŒ…å«äº†æ›´å¤šçš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬ï¼š\nå¼•ç”¨è®¡æ•°ï¼šå¯ä»¥é€šè¿‡ isa å­—æ®µç›´æ¥è·å–å¯¹è±¡çš„å¼•ç”¨è®¡æ•°ï¼ˆè€Œä¸éœ€è¦é¢å¤–çš„å­—æ®µï¼‰ã€‚\nC++ ææ„å‡½æ•°æ”¯æŒï¼šå¯¹äº C++ å¯¹è±¡ï¼Œisa å¯ä»¥åŒ…å«ä¸€ä¸ªæ ‡è®°ï¼Œè¡¨æ˜è¯¥å¯¹è±¡æ˜¯å¦æœ‰ C++ ææ„å‡½æ•°éœ€è¦è°ƒç”¨ã€‚\næŒ‡é’ˆå‹ç¼©ï¼šé’ˆå¯¹ 64 ä½è®¾å¤‡ï¼ŒæŒ‡é’ˆå·²ç»è¢«å‹ç¼©ï¼ŒèŠ‚çœäº†å†…å­˜ç©ºé—´ã€‚\næŒ‡é’ˆå¸ƒå±€ï¼šé€šè¿‡ä¼˜åŒ–æŒ‡é’ˆçš„å¸ƒå±€ï¼Œå¯ä»¥å‡å°‘å†…å­˜è®¿é—®çš„å»¶è¿Ÿã€‚ä¾‹å¦‚ï¼Œå°†å¸¸ç”¨çš„æ ‡è®°å’Œä¿¡æ¯æ”¾åœ¨ isa ä¸­ï¼Œå‡å°‘äº†ç¼“å­˜ç¼ºå¤±çš„æ¦‚ç‡ã€‚\n\nç»“æ„å˜åŒ–ï¼š\nstruct objc_object &#123;    Class isa;   // å‹ç¼©åçš„ isa æŒ‡é’ˆï¼ŒåŒ…å«æ›´å¤šä¿¡æ¯&#125;;\n\nè¿™ç§ä¼˜åŒ–ä½¿å¾—ï¼š\tâ€¢\tå†…å­˜ä½¿ç”¨ï¼šå‡å°‘äº†å†…å­˜å ç”¨ã€‚\tâ€¢\tæ•ˆç‡æå‡ï¼šè®¿é—®å¯¹è±¡æ‰€å±ç±»æ—¶çš„æ•ˆç‡å¤§å¹…æé«˜ã€‚\n\næ€»ç»“\nåœ¨ç°ä»£ Objective-C Runtime ä¸­ï¼Œç»“æ„ä½“çš„ä¼˜åŒ–å’ŒæŒ‡é’ˆçš„æ‰“åŒ…å¤§å¤§æå‡äº†ç³»ç»Ÿçš„æ€§èƒ½ï¼Œå°¤å…¶æ˜¯åœ¨å†…å­˜å ç”¨å’Œæ–¹æ³•æŸ¥æ‰¾é€Ÿåº¦ä¸Šã€‚é‡ç‚¹ä¼˜åŒ–å¦‚ä¸‹ï¼š\tâ€¢\tobjc_class å’Œ objc_data_bits_t çš„åˆ†ç¦»ï¼šæé«˜äº†å†…å­˜å¸ƒå±€çš„ç´§å‡‘æ€§å’Œæ•ˆç‡ã€‚\tâ€¢\tmethodList çš„ä¼˜åŒ–ï¼šç»“åˆå“ˆå¸Œè¡¨å’ŒäºŒå‰æœç´¢æ ‘ï¼Œæé«˜äº†æ–¹æ³•æŸ¥æ‰¾çš„æ•ˆç‡ã€‚\tâ€¢\tisa æŒ‡é’ˆä¼˜åŒ–ï¼šé€šè¿‡æŒ‡é’ˆæ‰“åŒ…ï¼Œå‡å°‘äº†å†…å­˜å ç”¨ï¼Œå¹¶åŠ é€Ÿäº†å¯¹è±¡çš„ç±»å‹æŸ¥æ‰¾å’Œå¼•ç”¨è®¡æ•°ç®¡ç†ã€‚\nè¿™äº›æ”¹è¿›çš„æ ¸å¿ƒç›®çš„æ˜¯ï¼šæå‡æ€§èƒ½ã€å‡å°‘å†…å­˜å ç”¨ï¼Œç‰¹åˆ«æ˜¯åœ¨ iOS è®¾å¤‡ä¸Šï¼Œç¡®ä¿è¿è¡Œæ—¶ç³»ç»Ÿèƒ½å¤Ÿåœ¨æœ‰é™çš„ç¡¬ä»¶èµ„æºä¸Šé«˜æ•ˆè¿è¡Œã€‚\n\n","categories":["åŸºç¡€"]},{"title":"Day5-ä¸¤æ•°ä¹‹å’Œ II - è¾“å…¥æœ‰åºæ•°ç»„","url":"/2025/04/28/Day5-%E4%B8%A4%E6%95%B0%E4%B9%8B%E5%92%8C-II-%E8%BE%93%E5%85%A5%E6%9C%89%E5%BA%8F%E6%95%B0%E7%BB%84/","content":"ğŸ”— LeetCode 167 - Two Sum II - Input Array Is Sorted\nğŸ“Œ é¢˜ç›®æè¿°ç»™å®šä¸€ä¸ªå·²æŒ‰å‡åºæ’åˆ—çš„æ•´æ•°æ•°ç»„ numbers å’Œä¸€ä¸ªç›®æ ‡å€¼ targetï¼Œè¯·ä½ åœ¨æ•°ç»„ä¸­æ‰¾å‡ºä¸¤ä¸ªæ•°ï¼Œä½¿å¾—å®ƒä»¬çš„å’Œä¸ºç›®æ ‡å€¼ targetï¼Œå¹¶è¿”å›è¿™ä¸¤ä¸ªæ•°çš„ä¸‹æ ‡ã€‚\næ³¨æ„ï¼š  \n\nè¿”å›çš„ç­”æ¡ˆæ˜¯ä¸€ä¸ª 1 ç´¢å¼•çš„æ•°ç»„ã€‚\nå‡è®¾æ¯ä¸ªè¾“å…¥åªå¯¹åº”ä¸€ä¸ªç­”æ¡ˆï¼Œä¸”ä½ ä¸å¯ä»¥é‡å¤ä½¿ç”¨æ•°ç»„ä¸­çš„å…ƒç´ ã€‚\n\n\nğŸ’¡ è§£é¢˜æ€è·¯\nç”±äºæ•°ç»„å·²æ’åºï¼Œå¯ä»¥ä½¿ç”¨åŒæŒ‡é’ˆæ³•ï¼š\n\nåˆå§‹åŒ–ä¸¤ä¸ªæŒ‡é’ˆï¼Œä¸€ä¸ªæŒ‡å‘æ•°ç»„çš„å¼€å¤´ï¼Œä¸€ä¸ªæŒ‡å‘æ•°ç»„çš„æœ«å°¾ã€‚\nå¦‚æœä¸¤æŒ‡é’ˆæŒ‡å‘çš„å…ƒç´ ä¹‹å’Œç­‰äºç›®æ ‡å€¼ï¼Œè¿”å›è¿™ä¸¤ä¸ªæŒ‡é’ˆçš„ä¸‹æ ‡ï¼›\nå¦‚æœå’Œå°äºç›®æ ‡å€¼ï¼Œè¯´æ˜éœ€è¦å¢å¤§å’Œï¼Œå·¦æŒ‡é’ˆå³ç§»ï¼›\nå¦‚æœå’Œå¤§äºç›®æ ‡å€¼ï¼Œè¯´æ˜éœ€è¦å‡å°å’Œï¼Œå³æŒ‡é’ˆå·¦ç§»ã€‚\n\n\nè¿™ç§æ–¹æ³•æ—¶é—´å¤æ‚åº¦æ˜¯ O(n)ï¼Œæ•ˆç‡è¾ƒé«˜ã€‚\n\n\n\nâœ… JavaScript å®ç°var twoSum = function (numbers, target) &#123;    let left = 0;    let right = numbers.length - 1;        while (left &lt; right) &#123;        const sum = numbers[left] + numbers[right];        if (sum === target) &#123;            return [left + 1, right + 1];  // æ³¨æ„è¿”å›çš„ä¸‹æ ‡æ˜¯ä» 1 å¼€å§‹çš„        &#125; else if (sum &lt; target) &#123;            left++;        &#125; else &#123;            right--;        &#125;    &#125;&#125;;\n\n\nğŸ§  æ€è€ƒæ‹“å±•\nå¦‚æœæ•°ç»„ä¸æ˜¯æœ‰åºçš„ï¼Œå¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜ï¼Ÿ\næœ¬é¢˜å’Œ LeetCode 1. Two Sum çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿå®ƒæ˜¯å¦‚ä½•åˆ©ç”¨æ’åºä¼˜åŒ–è§£æ³•çš„ï¼Ÿ\n\n\n","categories":["ç®—æ³•"]},{"title":"Day6-Runtime å®æˆ˜æŠ€å·§","url":"/2025/04/29/Day6-Runtime-%E5%AE%9E%E6%88%98%E6%8A%80%E5%B7%A7/","content":"ä¸€ã€å®šä¹‰Runtime æ˜¯ä»€ä¹ˆï¼Ÿ\n\nObjective-C çš„ Runtime å®é™…ä¸Šæ˜¯ C è¯­è¨€çš„ä¸€å¥—å‡½æ•°å’Œç±»åº“ï¼Œç”¨äºæ”¯æŒ Objective-C ç¼–ç¨‹è¯­è¨€çš„åŠ¨æ€æ€§ï¼ŒåŒ…æ‹¬ç±»çš„åˆ›å»ºã€æ–¹æ³•è°ƒç”¨ã€å±æ€§è®¿é—®ç­‰ã€‚\n\n\näºŒã€Runtime å®æˆ˜æŠ€å·§1.Method Swizzlingï¼ˆæ–¹æ³•äº¤æ¢ï¼‰1. ä»€ä¹ˆæ˜¯ Method Swizzlingï¼Ÿ\nå®šä¹‰ï¼šåœ¨ç¨‹åºè¿è¡Œæ—¶ï¼Œäº¤æ¢ä¸¤ä¸ªæ–¹æ³•å®ç°çš„è¿‡ç¨‹ã€‚\næœ¬è´¨ï¼šä¿®æ”¹æ–¹æ³•å¯¹åº”çš„ IMPï¼ˆæŒ‡å‘å‡½æ•°å®ç°çš„æŒ‡é’ˆï¼‰ã€‚\nå¸¸ç”¨åœºæ™¯ï¼š\nç»™ç³»ç»Ÿæ–¹æ³•åŠ åŠŸèƒ½\næ›¿æ¢ç³»ç»Ÿæ–¹æ³•è¡Œä¸º\nAOP\n\n\n\n2. å¦‚ä½•å®ç° Swizzlingï¼Ÿå¸¸ç”¨ APIï¼š\nMethod class_getInstanceMethod(Class cls, SEL name);void method_exchangeImplementations(Method m1, Method m2);\n\nä»£ç ç¤ºä¾‹ï¼š\n@implementation UIViewController (Swizzling)+ (void)load &#123;    static dispatch_once_t onceToken;    dispatch_once(&amp;onceToken, ^&#123;        Method originalMethod = class_getInstanceMethod(self, @selector(viewWillAppear:));        Method swizzledMethod = class_getInstanceMethod(self, @selector(my_viewWillAppear:));        method_exchangeImplementations(originalMethod, swizzledMethod);    &#125;);&#125;- (void)my_viewWillAppear:(BOOL)animated &#123;    NSLog(@&quot;é¡µé¢å°†è¦å‡ºç°ï¼š%@&quot;, self);    [self my_viewWillAppear:animated];&#125;@end\n\n3. æ³¨æ„äº‹é¡¹\n+load å’Œ dispatch_once ä¿è¯åªæ‰§è¡Œä¸€æ¬¡ã€‚\nç¡®ä¿æ–¹æ³•å­˜åœ¨ï¼Œé¿å…å¼•èµ·ç¨‹åºå´©æºƒã€‚\næ³¨æ„ç»§æ‰¿å…³ç³»å’Œå­ç±»è¦†ç›–é—®é¢˜ã€‚\n\n\n2.æ¶ˆæ¯è½¬å‘æœºåˆ¶1. ä»€ä¹ˆæ˜¯æ¶ˆæ¯è½¬å‘ï¼Ÿ\nå½“å¯¹è±¡æ”¶åˆ°æ— æ³•å“åº”çš„æ¶ˆæ¯ï¼Œæœ‰ä¸‰æ¬¡æœºä¼šå¤„ç†ï¼š\nåŠ¨æ€æ–¹æ³•è§£æï¼ˆresolveInstanceMethod:ï¼‰\nå¤‡ç”¨æ¥æ”¶è€…ï¼ˆforwardingTargetForSelector:ï¼‰\nå®Œæ•´æ¶ˆæ¯è½¬å‘ï¼ˆforwardInvocation:ï¼‰\n\n\n\n2. è¯¦ç»†æµç¨‹ï¼ˆï¼‘ï¼‰åŠ¨æ€æ–¹æ³•è§£æ+ (BOOL)resolveInstanceMethod:(SEL)sel\nç¤ºä¾‹ï¼š\n+ (BOOL)resolveInstanceMethod:(SEL)sel &#123;    if (sel == @selector(run)) &#123;        class_addMethod(self, sel, (IMP)runFunction, &quot;v@:&quot;);        return YES;    &#125;    return [super resolveInstanceMethod:sel];&#125;\n\nï¼ˆï¼’ï¼‰å¿«é€Ÿè½¬å‘- (id)forwardingTargetForSelector:(SEL)aSelector\nç¤ºä¾‹ï¼š\n- (id)forwardingTargetForSelector:(SEL)aSelector &#123;    if (aSelector == @selector(run)) &#123;        return self.delegate;    &#125;    return [super forwardingTargetForSelector:aSelector];&#125;\n\nï¼ˆï¼“ï¼‰å®Œæ•´æ¶ˆæ¯è½¬å‘- (NSMethodSignature *)methodSignatureForSelector:(SEL)aSelector- (void)forwardInvocation:(NSInvocation *)anInvocation\nç¤ºä¾‹ï¼š\n- (NSMethodSignature *)methodSignatureForSelector:(SEL)aSelector &#123;    if (aSelector == @selector(run)) &#123;        return [NSMethodSignature signatureWithObjCTypes:&quot;v@:&quot;];    &#125;    return [super methodSignatureForSelector:aSelector];&#125;- (void)forwardInvocation:(NSInvocation *)anInvocation &#123;    SEL sel = [anInvocation selector];    if ([self.delegate respondsToSelector:sel]) &#123;        [anInvocation invokeWithTarget:self.delegate];    &#125; else &#123;        [super forwardInvocation:anInvocation];    &#125;&#125;\n\n3. å…³è”å¯¹è±¡ (Associated Objects)å®šä¹‰ï¼šåœ¨ä¸æ”¹åŠ¨åŸç±»çš„åŸºç¡€ä¸Šï¼Œç»™åˆ†ç±»ã€æ‰©å±•ç±»å¢åŠ å®ä½“å±æ€§ã€‚\nå¸¸ç”¨ APIï¼š\n\nobjc_setAssociatedObject\nobjc_getAssociatedObject\n\nåº”ç”¨åœºæ™¯ï¼š\n\nUIButton å¢åŠ é˜²é‡å¤ç‚¹å‡»æ—¶é—´é—´éš”\n\n4. åŠ¨æ€ç”Ÿæˆç±»å’Œæ–¹æ³•å¸¸ç”¨ APIï¼š\n\nobjc_allocateClassPair\nclass_addMethod\n\nåº”ç”¨åœºæ™¯ï¼š\n\nKVO å†…éƒ¨åŸç†ï¼ˆåˆ›å»ºå­ç±»ï¼‰\nORMæ¡†æ¶è‡ªåŠ¨ç”Ÿæˆå¯¹åº”å±æ€§\n\n5. å®Œå…¨è‡ªåŠ¨ NSCoding å®Œæˆæ€è·¯ï¼šé€šè¿‡ Runtime éå† ivarï¼Œè‡ªåŠ¨ encode&#x2F;decodeï¼Œæ— éœ€æ‰‹å†™ä»£ç ã€‚\nåº”ç”¨åœºæ™¯ï¼š\n\nModel æŒä¹…åŒ–\nç®€åŒ–ç”¨æˆ·æ•°æ®å¤„ç†\n\n6. å®ç°å®‰å…¨é˜²æŠ¤ï¼ˆé˜² Crashï¼‰æ€è·¯ï¼šæ›´æ¢ NSArray, NSDictionary, NSString ç­‰ç±»çš„æ–¹æ³•ï¼Œé˜²æ­¢è·¯å¾„é”™è¯¯ã€ç´¢å¼•è¶Šç•Œç­‰ crashã€‚\nåº”ç”¨åœºæ™¯ï¼š\n\nå®‰å…¨æ€§æ¡†æ¶ SafeKit\né¡¹ç›®å®‰å…¨çº§åˆ«æå‡\n\n7. æ•°æ®æ¨¡å‹å®ä½“åŒ–ï¼ˆå®Œå…¨è‡ªåŠ¨åŒ–ç­‰ï¼‰æ€è·¯ï¼šé€šè¿‡ property åˆ—è¡¨ï¼Œæ ¹æ® key-value å°† JSON è½¬ä¸º Modelï¼Œæˆ–åè½¬ã€‚\nåº”ç”¨åœºæ™¯ï¼š\n\nYYModel\nMJExtension\n\n8. æ–¹æ³•æ›¿æ¢ IMPåº”ç”¨ï¼š\n\nhook ç³»ç»Ÿæ–¹æ³•ï¼Œå¹¶åŠ è‡ªå·±é€»è¾‘\næ§åˆ¶æ–¹æ³•æ‰§è¡Œæµç¨‹\n\nç¤ºä¾‹ï¼š\n\nåœ¨ App è¿›å…¥å‰åå°æ—¶ï¼Œç»Ÿä¸€ç®¡ç†å°è£…\n\n9. é«˜çº§æ¶ˆæ¯è½¬å‘ (NSProxy)åº”ç”¨ï¼š\n\nå¼±ä»£ç†ï¼ˆé¿å…å¾ªç¯å¼•ç”¨ã€Timer æ³„æ¼ï¼‰\nå¤šä»£ç†åŒæ­¥åˆ†å‘\næ€§èƒ½å¼ºåŒ–\n\n\nä¸‰ã€å®æˆ˜æ¡ˆä¾‹æ¡ˆä¾‹1ï¼šé˜²æ­¢ UIButton é‡å¤ç‚¹å‡»èƒŒæ™¯\n\nUIButton è¿ç»­ç‚¹å‡»å®¹æ˜“é€ æˆæ¥å£é‡å¤è¯·æ±‚ã€‚\næƒ³ç»™æ‰€æœ‰ UIButton åŠ é˜²æŠ–ï¼Œä¸æ”¹åŠ¨ç°æœ‰ä¸šåŠ¡ä»£ç ã€‚\n\n\næ€è·¯\nç”¨ Method Swizzlingï¼Œæ›¿æ¢ sendAction:to:forEvent: æ–¹æ³•ï¼Œåœ¨é‡Œé¢åŠ èŠ‚æµé€»è¾‘ã€‚\n\nä»£ç ç¤ºä¾‹\nUIButton+AntiRepeat.h\n#import &lt;UIKit/UIKit.h&gt;@interface UIButton (AntiRepeat)@property (nonatomic, assign) NSTimeInterval eventInterval; // ç‚¹å‡»é—´éš”@property (nonatomic, assign) NSTimeInterval lastEventTime; // ä¸Šæ¬¡ç‚¹å‡»æ—¶é—´@end\nUIButton+AntiRepeat.m\n#import &quot;UIButton+AntiRepeat.h&quot;#import &lt;objc/runtime.h&gt;@implementation UIButton (AntiRepeat)+ (void)load &#123;    static dispatch_once_t onceToken;    dispatch_once(&amp;onceToken, ^&#123;        Method original = class_getInstanceMethod(self, @selector(sendAction:to:forEvent:));        Method swizzled = class_getInstanceMethod(self, @selector(my_sendAction:to:forEvent:));        method_exchangeImplementations(original, swizzled);    &#125;);&#125;// å…³è”å¯¹è±¡ eventInterval- (NSTimeInterval)eventInterval &#123;    return [objc_getAssociatedObject(self, _cmd) doubleValue];&#125;- (void)setEventInterval:(NSTimeInterval)eventInterval &#123;    objc_setAssociatedObject(self, @selector(eventInterval), @(eventInterval), OBJC_ASSOCIATION_RETAIN_NONATOMIC);&#125;// å…³è”å¯¹è±¡ lastEventTime- (NSTimeInterval)lastEventTime &#123;    return [objc_getAssociatedObject(self, _cmd) doubleValue];&#125;- (void)setLastEventTime:(NSTimeInterval)lastEventTime &#123;    objc_setAssociatedObject(self, @selector(lastEventTime), @(lastEventTime), OBJC_ASSOCIATION_RETAIN_NONATOMIC);&#125;// æ–°çš„æ–¹æ³•- (void)my_sendAction:(SEL)action to:(id)target forEvent:(UIEvent *)event &#123;    if (NSDate.date.timeIntervalSince1970 - self.lastEventTime &lt; self.eventInterval) &#123;        return; // ç‚¹å‡»é—´éš”å¤ªçŸ­ï¼Œå¿½ç•¥    &#125;    self.lastEventTime = NSDate.date.timeIntervalSince1970;    [self my_sendAction:action to:target forEvent:event];&#125;@end\n\n\n\nä½¿ç”¨\nUIButton *btn = [UIButton buttonWithType:UIButtonTypeSystem];btn.eventInterval = 1.0; // è®¾ç½® 1 ç§’å†…ä¸èƒ½é‡å¤ç‚¹å‡»\n\nè®²è§£è¦ç‚¹\n\nsendAction:to:forEvent: æ˜¯ UIButton å¤„ç†ç‚¹å‡»äº‹ä»¶çš„å…¥å£ã€‚\né€šè¿‡ Swizzlingï¼Œåœ¨ä¸æ”¹ä¸šåŠ¡ä»£ç çš„æƒ…å†µä¸‹ç»Ÿä¸€åŠ äº†é˜²æŠ–ã€‚\nä½¿ç”¨ objc_setAssociatedObject ç»™åˆ†ç±»åŠ¨æ€æ·»åŠ å±æ€§ï¼Œè®°å½•æœ€åä¸€æ¬¡ç‚¹å‡»æ—¶é—´ã€‚\n\næ¡ˆä¾‹2ï¼šç”¨ NSProxy å®ç°å¼±ä»£ç†ï¼ˆé˜²æ­¢ Timer å¾ªç¯å¼•ç”¨ï¼‰\nNSProxy ä½œä¸ºä¸­ä»‹\nå¼±æŒ target\n\nèƒŒæ™¯\n\nNSTimer é»˜è®¤å¼ºå¼•ç”¨ targetï¼Œå®¹æ˜“é€ æˆå†…å­˜æ³„æ¼ï¼ˆå¾ªç¯å¼•ç”¨ï¼‰ã€‚\n\n\næ€è·¯\nä½¿ç”¨ NSProxy ä¸­è½¬ï¼Œè®© Timer å¼±å¼•ç”¨çœŸæ­£çš„ targetã€‚\n\nä»£ç ç¤ºä¾‹\nTimerWeakProxy.h\n#import &lt;Foundation/Foundation.h&gt;@interface TimerWeakProxy : NSProxy+ (instancetype)proxyWithTarget:(id)target;@end\nTimerWeakProxy.m\n#import &quot;TimerWeakProxy.h&quot;@interface TimerWeakProxy ()@property (nonatomic, weak) id target;@end@implementation TimerWeakProxy+ (instancetype)proxyWithTarget:(id)target &#123;    TimerWeakProxy *proxy = [TimerWeakProxy alloc];    proxy.target = target;    return proxy;&#125;- (id)forwardingTargetForSelector:(SEL)selector &#123;    return self.target;&#125;- (void)forwardInvocation:(NSInvocation *)invocation &#123;    [invocation invokeWithTarget:self.target];&#125;- (NSMethodSignature *)methodSignatureForSelector:(SEL)sel &#123;    return [self.target methodSignatureForSelector:sel];&#125;@end\n\n\nä½¿ç”¨\nself.timer = [NSTimer scheduledTimerWithTimeInterval:1.0                                              target:[TimerWeakProxy proxyWithTarget:self]                                            selector:@selector(timerAction)                                            userInfo:nil                                             repeats:YES];\n\n\nè®²è§£è¦ç‚¹\n\nTimerWeakProxy æŒæœ‰ target çš„å¼±å¼•ç”¨ï¼Œé˜²æ­¢å¾ªç¯å¼•ç”¨ã€‚\nforwardingTargetForSelector: æä¾›å¿«é€Ÿæ¶ˆæ¯è½¬å‘ï¼Œæé«˜æ€§èƒ½ã€‚\n\næ¡ˆä¾‹3ï¼šè‡ªåŠ¨ JSON -&gt; Model æ˜ å°„\nåˆ©ç”¨ property åˆ—è¡¨éå†\né«˜æ•ˆæ–¹ä¾¿ï¼Œæ€§èƒ½å¥½\n\næ¡ˆä¾‹4ï¼šå®‰å…¨é˜²æŠ¤å¥—ä»¶\nNSArrayã€NSDictionary è¿›è¡Œæ–¹æ³•æ›¿æ¢ï¼Œé˜²æ­¢é”™è¯¯æ“ä½œ\n\n\nå››ã€å®Œæ•´æ€ç»´å›¾\n\n\næŠ€æœ¯\nä½œç”¨\nå…·ä½“åœºæ™¯\n\n\n\nMethod Swizzling\nä¿®æ”¹ç³»ç»Ÿæ–¹æ³•\nAOP æ‰“ç‚¹\n\n\næ¶ˆæ¯è½¬å‘\nåŠ¨æ€å¤„ç†æœªçŸ¥æ–¹æ³•\nå¼±ä»£ç†\n\n\nAssociated Object\næ‰©å±•åˆ†ç±»å±æ€§\nUIButton é˜²é‡ç‚¹\n\n\nè‡ªåŠ¨ NSCoding\nè‡ªåŠ¨åŒ–å­˜å‚¨è¿è´¯\nModel æŒä¹…åŒ–\n\n\nNSProxy\né«˜çº§è½¬å‘\nTimer å¼±ä»£ç†\n\n\n\näº”ã€å¸¸è€ƒé—®é¢˜\nè¯´è¯´ä½ å¯¹ Runtime çš„ç†è§£ï¼Ÿ\n\n\nRuntime æ˜¯ OC çš„è¿è¡Œæ—¶ç³»ç»Ÿï¼Œå…è®¸ç¨‹åºåœ¨è¿è¡Œæ—¶è¿›è¡Œå¯¹è±¡æ“ä½œï¼ˆå¦‚æ¶ˆæ¯å‘é€ã€æ–¹æ³•äº¤æ¢ã€ç±»åˆ›å»ºç­‰ï¼‰ã€‚\nåŠ¨æ€æ€§æ˜¯ Objective-C æœ€é‡è¦çš„ç‰¹æ€§ä¹‹ä¸€ï¼ŒåŸºäº Runtime å®ç°ã€‚\n\n\n\nä»€ä¹ˆæ˜¯ Method Swizzlingï¼Ÿä½¿ç”¨æ—¶æ³¨æ„ä»€ä¹ˆï¼Ÿ\n\n\nå®šä¹‰ï¼šäº¤æ¢ä¸¤ä¸ªæ–¹æ³•çš„å®ç°ã€‚\næ³¨æ„ï¼š\nä½¿ç”¨ dispatch_once ä¿è¯åªäº¤æ¢ä¸€æ¬¡ã€‚\nç¡®è®¤æ–¹æ³•å­˜åœ¨å†äº¤æ¢ï¼Œé¿å…å´©æºƒã€‚\nç»´æŠ¤å¥½è°ƒç”¨é“¾ï¼Œé˜²æ­¢æ­»å¾ªç¯ã€‚\né¿å…è¿‡åº¦ä½¿ç”¨ï¼Œç ´åå°è£…æ€§ã€‚\n\n\n\nMethod Swizzling å¸¸ç”¨åœ¨å“ªäº›åœºæ™¯ï¼Ÿ\n\n\nç»Ÿä¸€åŠ æ—¥å¿—æ‰“ç‚¹ï¼ˆæ¯”å¦‚ UIViewController ç”Ÿå‘½å‘¨æœŸï¼‰\næ›¿æ¢ç³»ç»Ÿæ–¹æ³•åŠŸèƒ½ï¼ˆå¦‚ç»Ÿè®¡ç‚¹å‡»äº‹ä»¶ï¼‰\nAOP ç¼–ç¨‹å®è·µ\næ¡†æ¶å†…éƒ¨å¢å¼ºï¼ˆå¦‚ AFNetworking çš„æŸäº› hookï¼‰\n\n\n\næ¶ˆæ¯å‘é€æµç¨‹æ˜¯æ€æ ·çš„ï¼Ÿ\n\n\nè°ƒç”¨æ–¹æ³• -&gt; è½¬æˆ objc_msgSend å‘é€æ¶ˆæ¯ã€‚\nå¦‚æœæ‰¾ä¸åˆ°æ–¹æ³•ï¼š\nåŠ¨æ€æ–¹æ³•è§£æï¼ˆresolveInstanceMethod:ï¼‰\nå¿«é€Ÿè½¬å‘ï¼ˆforwardingTargetForSelector:ï¼‰\nå®Œæ•´æ¶ˆæ¯è½¬å‘ï¼ˆforwardInvocation:ï¼‰\næœ€åæŠ›å‡º unrecognized selector sent to instance å¼‚å¸¸ã€‚\n\n\n\n\n\næ¶ˆæ¯è½¬å‘å’Œä»£ç†æ¨¡å¼æœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ\n\n\nä»£ç†ï¼ˆdelegateï¼‰æœ¬è´¨å°±æ˜¯æ¶ˆæ¯è½¬å‘çš„ä¸€ç§åº”ç”¨ã€‚\nå¯ä»¥é€šè¿‡ forwardingTargetForSelector: æŠŠä¸æ”¯æŒçš„æ–¹æ³•äº¤ç»™ä»£ç†å¯¹è±¡æ‰§è¡Œã€‚\nå¤æ‚ä»£ç†æ¨¡å¼ï¼ˆå¦‚ NSProxy å¤šä»£ç†ï¼‰å°±æ˜¯ç”¨å®Œæ•´æ¶ˆæ¯è½¬å‘å®ç°çš„ã€‚\n\n\n\nSwizzling å’Œ Hook çš„åŒºåˆ«ï¼Ÿ\n\n\nSwizzlingï¼šæŒ‡â€œæ–¹æ³•äº¤æ¢â€ï¼Œä¸»è¦æ”¹å˜å¯¹è±¡çš„æ–¹æ³•å®ç°ã€‚\nHookï¼šæ›´å¹¿ä¹‰ï¼ŒæŒ‡æ‹¦æˆªå¹¶ä¿®æ”¹ç¨‹åºæ‰§è¡Œè¿‡ç¨‹ï¼Œå¯ä»¥æ˜¯æ–¹æ³•å±‚é¢ã€å‡½æ•°å±‚é¢ï¼ˆFishhookï¼‰ã€ç”šè‡³æ˜¯æ±‡ç¼–æŒ‡ä»¤å±‚é¢ã€‚\n\n\n\nä¸ºä»€ä¹ˆ +load æ–¹æ³•é€‚åˆåš Swizzlingï¼Ÿ\n\n\n+load æ˜¯åœ¨ç±»ï¼ˆæˆ–åˆ†ç±»ï¼‰è¢«åŠ è½½åˆ°å†…å­˜æ—¶ç«‹å³è°ƒç”¨çš„ï¼Œä¼˜å…ˆäº main()ã€‚\nä¿è¯åœ¨å¯¹è±¡ä½¿ç”¨å‰å°±å®Œæˆæ–¹æ³•äº¤æ¢ã€‚\n\nè¡¥å……ï¼šå¦‚æœæƒ³æ›´çµæ´»æ§åˆ¶ï¼ŒæŸäº›æ¡†æ¶ï¼ˆå¦‚ Aspectsï¼‰ä¼šåœ¨ +initialize åš Swizzlingï¼Œä½†è¦æ³¨æ„ initialize åªä¼šåœ¨ç¬¬ä¸€æ¬¡å‘é€æ¶ˆæ¯å‰è°ƒç”¨ã€‚\n\n\nä½¿ç”¨ Runtime æœ‰å“ªäº›é£é™©ï¼Ÿ\n\n\næ–¹æ³•äº¤æ¢è¿‡å¤šï¼Œå®¹æ˜“å¯¼è‡´éš¾ä»¥ç»´æŠ¤å’Œè°ƒè¯•ã€‚\næ¶ˆæ¯è½¬å‘é“¾è¿‡é•¿ï¼Œå¯èƒ½å¯¼è‡´æ€§èƒ½ä¸‹é™ã€‚\nåŠ¨æ€æ·»åŠ æ–¹æ³•æ—¶å‚æ•°ç±»å‹ç­¾åä¸æ­£ç¡®ï¼Œå¯èƒ½å¯¼è‡´è¿è¡Œæ—¶å´©æºƒã€‚\næ— æ³•è¢«ç¼–è¯‘å™¨é™æ€æ£€æŸ¥ï¼Œå‡ºé”™æ—¶å¾ˆéš¾å®šä½ã€‚\n\n\n\nNSProxy æ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆéœ€è¦å®ƒï¼Ÿ\n\n\nNSProxy æ˜¯ä¸€ä¸ªè½»é‡çº§çš„åŸºç±»ï¼Œä¸“é—¨ç”¨äºå®ç°æ¶ˆæ¯è½¬å‘ã€‚\nå…¸å‹åœºæ™¯ï¼š\nè¿œç¨‹æ–¹æ³•è°ƒç”¨ï¼ˆRPCï¼‰\nå¤šä»£ç†ç®¡ç†ï¼ˆå¦‚ YYTextKeyboardManagerï¼‰\nç›¸æ¯” NSObjectï¼ŒNSProxy æ²¡æœ‰å®ä¾‹å˜é‡ï¼Œç›´æ¥èµ°å®Œæ•´æ¶ˆæ¯è½¬å‘æµç¨‹ã€‚\n\n\n","categories":["åŸºç¡€"]},{"title":"Day6-åˆ é™¤æœ‰åºæ•°ç»„ä¸­çš„é‡å¤é¡¹","url":"/2025/04/29/Day6-%E5%88%A0%E9%99%A4%E6%9C%89%E5%BA%8F%E6%95%B0%E7%BB%84%E4%B8%AD%E7%9A%84%E9%87%8D%E5%A4%8D%E9%A1%B9/","content":"ğŸ”— LeetCode 26 - Remove Duplicates from Sorted Array\nğŸ“Œ é¢˜ç›®æè¿°ç»™ä½ ä¸€ä¸ª å‡åºæ’åˆ— çš„æ•°ç»„ numsï¼Œè¯·ä½ åŸåœ°åˆ é™¤é‡å¤å‡ºç°çš„å…ƒç´ ï¼Œä½¿æ¯ä¸ªå…ƒç´ åªå‡ºç°ä¸€æ¬¡ï¼Œè¿”å›åˆ é™¤åæ•°ç»„çš„æ–°é•¿åº¦ã€‚ä¸è¦ä½¿ç”¨é¢å¤–çš„æ•°ç»„ç©ºé—´ï¼Œä½ å¿…é¡»åœ¨ O(1) é¢å¤–ç©ºé—´çš„æ¡ä»¶ä¸‹åŸåœ°ä¿®æ”¹è¾“å…¥æ•°ç»„ã€‚\nç¤ºä¾‹ï¼š\nè¾“å…¥: nums = [1,1,2]è¾“å‡º: 2, nums = [1,2,_]\n\n\nğŸ’¡ è§£é¢˜æ€è·¯\nä½¿ç”¨ åŒæŒ‡é’ˆï¼š\n\nslow æŒ‡é’ˆè¡¨ç¤ºå½“å‰å¤„ç†çš„å”¯ä¸€å…ƒç´ ä¸‹æ ‡ï¼›\nfast æŒ‡é’ˆéå†æ•°ç»„ï¼Œå½“é‡åˆ°ä¸€ä¸ªä¸ nums[slow] ä¸åŒçš„å…ƒç´ æ—¶ï¼Œå°†å…¶èµ‹å€¼ç»™ nums[slow + 1]ï¼Œç„¶å slow å‰è¿›ä¸€æ­¥ã€‚\n\n\néå†ç»“æŸåï¼Œslow + 1 å°±æ˜¯æ–°æ•°ç»„çš„é•¿åº¦ã€‚\n\næ—¶é—´å¤æ‚åº¦ï¼šO(n)\n\nç©ºé—´å¤æ‚åº¦ï¼šO(1)\n\n\n\nâœ… JavaScript å®ç°var removeDuplicates = function(nums) &#123;    if (nums.length === 0) return 0;        let slow = 0;        for (let fast = 1; fast &lt; nums.length; fast++) &#123;        if (nums[fast] !== nums[slow]) &#123;            slow++;            nums[slow] = nums[fast];        &#125;    &#125;        return slow + 1;&#125;;\n\n\nğŸ§  æ€è€ƒæ‹“å±•\nå¦‚æœè¦æ±‚æ¯ä¸ªå…ƒç´ æœ€å¤šå‡ºç°ä¸¤æ¬¡æ€ä¹ˆåŠï¼Ÿï¼ˆå‚è€ƒ LeetCode 80ï¼‰\nè¿™é“é¢˜ä¸ºä»€ä¹ˆå¿…é¡»æ˜¯åŸåœ°ä¿®æ”¹ï¼Ÿæœ‰ä»€ä¹ˆå®é™…åº”ç”¨åœºæ™¯ï¼Ÿ\n\n\n","categories":["ç®—æ³•"]},{"title":"Day7-Runtime&Block","url":"/2025/04/30/Day7-Runtime&Block/","content":"RuntimeiOS Runtimeï¼Œé€šå¸¸ç§°ä¸ºObjective-C Runtimeï¼Œæ˜¯iOSå¼€å‘ä¸­ä¸€ä¸ªè‡³å…³é‡è¦çš„ç»„ä»¶ã€‚å®ƒæ˜¯ä¸€å¥—åº•å±‚çš„Cè¯­è¨€APIï¼Œä¸ºObjective-Cçš„åŠ¨æ€ç‰¹æ€§æä¾›äº†å¼ºå¤§çš„æ”¯æŒã€‚æœ¬æ–‡å°†å¯¹iOS Runtimeè¿›è¡Œæ·±å…¥çš„è§£æï¼Œä»åŸºæœ¬æ¦‚å¿µåˆ°ä¸»è¦åŠŸèƒ½ï¼Œå†åˆ°å®é™…åº”ç”¨å’Œæ³¨æ„äº‹é¡¹ï¼Œå…¨æ–¹ä½åœ°å±•ç¤ºè¿™ä¸€æŠ€æœ¯çš„é­…åŠ›ã€‚\nä¸€ã€RuntimeåŸºæœ¬æ¦‚å¿µRuntimeï¼Œå³è¿è¡Œæ—¶ï¼ŒæŒ‡çš„æ˜¯ç¨‹åºåœ¨è¿è¡Œè¿‡ç¨‹ä¸­è¿›è¡Œçš„ä¸€ç³»åˆ—æ“ä½œã€‚åœ¨Objective-Cä¸­ï¼ŒRuntimeç³»ç»Ÿå…è®¸æˆ‘ä»¬åœ¨ç¨‹åºè¿è¡Œæ—¶åŠ¨æ€åœ°æ“ä½œç±»å’Œå¯¹è±¡ï¼Œæ‰§è¡Œè¯¸å¦‚æ£€æŸ¥å’Œæ”¹å˜å¯¹è±¡ã€äº¤æ¢æ–¹æ³•å®ç°ã€åŠ¨æ€æ·»åŠ æ–¹æ³•æˆ–å±æ€§ç­‰æ“ä½œã€‚è¿™ç§åŠ¨æ€æ€§ä¸ºå¼€å‘è€…å¸¦æ¥äº†æå¤§çš„çµæ´»æ€§ã€‚\nObjective-Cä½œä¸ºä¸€é—¨åŠ¨æ€è¯­è¨€ï¼Œä¸Cè¯­è¨€ç­‰é™æ€è¯­è¨€åœ¨ç¼–è¯‘å’Œè¿è¡Œæ—¶æœ‰ç€æ˜¾è‘—çš„åŒºåˆ«ã€‚é™æ€è¯­è¨€åœ¨ç¼–è¯‘é˜¶æ®µå°±ç¡®å®šäº†æ‰€æœ‰çš„æ–¹æ³•è°ƒç”¨å’Œå¯¹è±¡ç±»å‹ï¼Œè€ŒåŠ¨æ€è¯­è¨€åˆ™åœ¨è¿è¡Œæ—¶æ‰ç¡®å®šè¿™äº›æ“ä½œã€‚Objective-Cé€šè¿‡Runtimeç³»ç»Ÿå®ç°äº†è¿™ä¸€åŠ¨æ€æ€§ï¼Œä½¿å¾—æˆ‘ä»¬å¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°åˆ›å»ºç±»å’Œå¯¹è±¡ã€è¿›è¡Œæ¶ˆæ¯ä¼ é€’å’Œè½¬å‘ã€‚\näºŒã€Runtimeæ•°æ®ç»“æ„åœ¨æ·±å…¥Runtimeçš„åŠŸèƒ½ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆäº†è§£å…¶åº•å±‚çš„æ•°æ®ç»“æ„ã€‚iOS Runtimeçš„æ ¸å¿ƒæ•°æ®ç»“æ„åŒ…æ‹¬objc_classã€objc_objectç­‰ã€‚\n\nobjc_objectï¼šè¿™æ˜¯æ‰€æœ‰Objective-Cå¯¹è±¡çš„åŸºç±»ç»“æ„ä½“ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªisaæŒ‡é’ˆï¼ŒæŒ‡å‘è¯¥å¯¹è±¡æ‰€å±çš„ç±»ã€‚\n\nobjc_classï¼šè¿™æ˜¯ç±»çš„ç»“æ„ä½“ï¼Œå®ƒç»§æ‰¿è‡ªobjc_objectã€‚objc_classä¸­åŒ…å«äº†ç±»çš„å„ç§ä¿¡æ¯ï¼Œå¦‚çˆ¶ç±»æŒ‡é’ˆã€æ–¹æ³•åˆ—è¡¨ã€æ–¹æ³•ç¼“å­˜ã€å±æ€§åˆ—è¡¨ã€åè®®åˆ—è¡¨ç­‰ã€‚\n\nisaï¼šæŒ‡å‘è¯¥ç±»çš„å…ƒç±»ï¼ˆmeta-classï¼‰ï¼Œå…ƒç±»ä¸­å­˜å‚¨äº†ç±»çš„ç±»æ–¹æ³•ã€‚\nsuper_classï¼šæŒ‡å‘è¯¥ç±»çš„çˆ¶ç±»ã€‚\nnameï¼šç±»çš„åç§°ã€‚\nversionï¼šç±»çš„ç‰ˆæœ¬ä¿¡æ¯ã€‚\ninfoï¼šç±»çš„è¯¦ç»†ä¿¡æ¯ã€‚\ninstance_sizeï¼šè¯¥ç±»å®ä¾‹å¯¹è±¡çš„å¤§å°ã€‚\nmethodListsï¼šæŒ‡å‘è¯¥ç±»çš„å®ä¾‹æ–¹æ³•åˆ—è¡¨çš„æŒ‡é’ˆçš„æŒ‡é’ˆï¼Œå¯ä»¥åŠ¨æ€ä¿®æ”¹ã€‚\ncacheï¼šæ–¹æ³•ç¼“å­˜ï¼Œç”¨äºå­˜å‚¨è¢«é¢‘ç¹è°ƒç”¨çš„æ–¹æ³•ï¼Œä»¥æé«˜æŸ¥æ‰¾æ•ˆç‡ã€‚\nprotocolsï¼šæŒ‡å‘è¯¥ç±»çš„åè®®åˆ—è¡¨ã€‚\n\n\n\nä¸‰ã€Runtimeä¸»è¦åŠŸèƒ½iOS Runtimeæä¾›äº†è®¸å¤šå¼ºå¤§çš„åŠŸèƒ½ï¼Œè¿™äº›åŠŸèƒ½ä½¿å¾—Objective-Cæˆä¸ºä¸€é—¨æå…·åŠ¨æ€æ€§çš„ç¼–ç¨‹è¯­è¨€ã€‚\n\nåŠ¨æ€æ·»åŠ ç±»å’Œæ–¹æ³•ï¼š\nRuntimeå…è®¸æˆ‘ä»¬åœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°åˆ›å»ºæ–°çš„ç±»ï¼Œå¹¶å‘å·²æœ‰çš„ç±»ä¸­æ·»åŠ æ–°çš„æ–¹æ³•æˆ–å®ä¾‹å˜é‡ã€‚è¿™ç§åŠ¨æ€æ€§ä½¿å¾—æˆ‘ä»¬å¯ä»¥åœ¨ä¸ä¿®æ”¹åŸæœ‰ä»£ç çš„æƒ…å†µä¸‹ï¼Œä¸ºç±»æ·»åŠ æ–°çš„åŠŸèƒ½ã€‚ä¾‹å¦‚ï¼Œé€šè¿‡objc_allocateClassPairå’Œobjc_registerClassPairå‡½æ•°å¯ä»¥åŠ¨æ€åˆ›å»ºå’Œæ³¨å†Œä¸€ä¸ªæ–°çš„ç±»ï¼›é€šè¿‡class_addMethodå‡½æ•°å¯ä»¥å‘å·²æœ‰çš„ç±»ä¸­æ·»åŠ æ–°çš„æ–¹æ³•ã€‚\n\næ¶ˆæ¯ä¼ é€’å’Œæ¶ˆæ¯è½¬å‘ï¼š\nObjective-Cä¸­çš„æ–¹æ³•è°ƒç”¨å®é™…ä¸Šæ˜¯ä¸€ç§æ¶ˆæ¯ä¼ é€’æœºåˆ¶ã€‚å½“æˆ‘ä»¬å‘ä¸€ä¸ªå¯¹è±¡å‘é€æ¶ˆæ¯æ—¶ï¼ŒRuntimeç³»ç»Ÿä¼šæ ¹æ®æ¶ˆæ¯çš„åç§°ï¼ˆå³é€‰æ‹©å™¨SELï¼‰åœ¨å¯¹è±¡çš„ç±»åŠå…¶çˆ¶ç±»ä¸­æŸ¥æ‰¾å¯¹åº”çš„æ–¹æ³•å®ç°ã€‚å¦‚æœæ‰¾åˆ°äº†åŒ¹é…çš„æ–¹æ³•ï¼Œå°±è°ƒç”¨è¯¥æ–¹æ³•ï¼›å¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œåˆ™è¿›å…¥æ¶ˆæ¯è½¬å‘æœºåˆ¶ã€‚æ¶ˆæ¯è½¬å‘æœºåˆ¶å…è®¸æˆ‘ä»¬åœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°å¤„ç†æœªå®ç°çš„æ–¹æ³•è°ƒç”¨ï¼Œè€Œä¸æ˜¯ç›´æ¥å´©æºƒã€‚ä¾‹å¦‚ï¼Œé€šè¿‡å®ç°forwardingTargetForSelector:æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥å°†æœªå®ç°çš„æ¶ˆæ¯è½¬å‘ç»™å…¶ä»–å¯¹è±¡æ¥å¤„ç†ã€‚\n\nå…³è”å¯¹è±¡ï¼š\nRuntimeå…è®¸æˆ‘ä»¬ç»™ç°æœ‰çš„ç±»åŠ¨æ€åœ°å…³è”æ–°çš„å±æ€§ã€‚è¿™ç§å…³è”å±æ€§ä¸ä¼šæ”¹å˜åŸæœ‰ç±»çš„ç»“æ„ï¼Œä¹Ÿä¸ä¼šå½±å“å…¶ä»–ç±»çš„ä½¿ç”¨ã€‚è¿™åœ¨æŸäº›æƒ…å†µä¸‹å¯ä»¥é¿å…å­ç±»åŒ–ï¼Œä»è€Œç®€åŒ–ä»£ç ç»“æ„ã€‚ä¾‹å¦‚ï¼Œé€šè¿‡objc_setAssociatedObjectå’Œobjc_getAssociatedObjectå‡½æ•°å¯ä»¥ä¸ºå¯¹è±¡å…³è”å’Œè·å–æ–°çš„å±æ€§ã€‚\n\nè·å–ç±»ä¿¡æ¯ï¼š\nRuntimeæä¾›äº†ä¸€ç³»åˆ—å‡½æ•°æ¥è·å–ç±»çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç±»åã€çˆ¶ç±»ã€å®ä¾‹å˜é‡ã€æ–¹æ³•åˆ—è¡¨ã€åè®®åˆ—è¡¨ç­‰ã€‚è¿™äº›ä¿¡æ¯å¯¹äºè°ƒè¯•å’Œåå°„ç­‰é«˜çº§æ“ä½œéå¸¸æœ‰ç”¨ã€‚ä¾‹å¦‚ï¼Œé€šè¿‡class_getNameå‡½æ•°å¯ä»¥è·å–ç±»çš„åç§°ï¼›é€šè¿‡class_copyMethodListå‡½æ•°å¯ä»¥è·å–ç±»çš„æ–¹æ³•åˆ—è¡¨ã€‚\n\næ–¹æ³•äº¤æ¢ï¼š\nRuntimeå…è®¸æˆ‘ä»¬åœ¨è¿è¡Œæ—¶äº¤æ¢ä¸¤ä¸ªæ–¹æ³•çš„å®ç°ã€‚è¿™ç§åŠŸèƒ½åœ¨æŸäº›æƒ…å†µä¸‹å¯ä»¥ç”¨æ¥å®ç°æ–¹æ³•çš„æ›¿æ¢æˆ–è°ƒè¯•ã€‚ä¾‹å¦‚ï¼Œé€šè¿‡method_exchangeImplementationså‡½æ•°å¯ä»¥äº¤æ¢ä¸¤ä¸ªæ–¹æ³•çš„å®ç°ã€‚\n\n\nå››ã€Runtimeå®é™…åº”ç”¨iOS Runtimeåœ¨å¼€å‘ä¸­æœ‰ç€å¹¿æ³›çš„åº”ç”¨ï¼Œä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„ç”¨ä¾‹å’Œç¤ºä¾‹ï¼š\n\nç»™ç³»ç»Ÿç±»æ·»åŠ å±æ€§æˆ–æ–¹æ³•ï¼š\né€šè¿‡Runtimeï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºç³»ç»Ÿç±»ï¼ˆå¦‚NSStringã€UIButtonç­‰ï¼‰æ·»åŠ æ–°çš„å±æ€§æˆ–æ–¹æ³•ã€‚è¿™ç§æ“ä½œé€šå¸¸ç”¨äºæ‰©å±•ç³»ç»Ÿç±»çš„åŠŸèƒ½ï¼Œè€Œæ— éœ€åˆ›å»ºå­ç±»ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºNSStringç±»æ·»åŠ ä¸€ä¸ªè®¡ç®—å­—ç¬¦ä¸²å“ˆå¸Œå€¼çš„æ–¹æ³•ã€‚\n\næ–¹æ³•äº¤æ¢ï¼š\næ–¹æ³•äº¤æ¢æ˜¯Runtimeçš„ä¸€ä¸ªå¼ºå¤§åŠŸèƒ½ï¼Œå®ƒå…è®¸æˆ‘ä»¬åœ¨è¿è¡Œæ—¶äº¤æ¢ä¸¤ä¸ªæ–¹æ³•çš„å®ç°ã€‚è¿™ç§æ“ä½œé€šå¸¸ç”¨äºè°ƒè¯•æˆ–å®ç°æŸäº›ç‰¹å®šçš„åŠŸèƒ½ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡äº¤æ¢UIViewControllerçš„viewDidLoadå’ŒviewWillAppear:æ–¹æ³•çš„å®ç°æ¥è§‚å¯Ÿè¿™ä¸¤ä¸ªæ–¹æ³•åœ¨ä¸åŒæ—¶æœºä¸‹çš„è¡Œä¸ºã€‚\n\nKVOï¼ˆKey-Value Observingï¼‰å’ŒKVCï¼ˆKey-Value Codingï¼‰ï¼š\nKVOå’ŒKVCæ˜¯Objective-Cä¸­çš„ä¸¤ç§é«˜çº§ç‰¹æ€§ï¼Œå®ƒä»¬åˆ†åˆ«ç”¨äºè§‚å¯Ÿå¯¹è±¡å±æ€§çš„å˜åŒ–å’Œé€šè¿‡é”®å€¼å¯¹æ¥è®¿é—®å¯¹è±¡çš„å±æ€§ã€‚è¿™ä¸¤ç§ç‰¹æ€§éƒ½ä¾èµ–äºRuntimeç³»ç»Ÿæ¥å®ç°ã€‚ä¾‹å¦‚ï¼ŒKVOé€šè¿‡Runtimeåœ¨å¯¹è±¡çš„å±æ€§è¢«ä¿®æ”¹æ—¶è§¦å‘ç›¸åº”çš„é€šçŸ¥ï¼›KVCåˆ™é€šè¿‡Runtimeåœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°è®¿é—®å’Œä¿®æ”¹å¯¹è±¡çš„å±æ€§ã€‚\n\nå­—å…¸è½¬æ¨¡å‹ï¼š\nåœ¨iOSå¼€å‘ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦å°†JSONå­—å…¸è½¬æ¢ä¸ºæ¨¡å‹å¯¹è±¡ã€‚é€šè¿‡Runtimeï¼Œæˆ‘ä»¬å¯ä»¥å®ç°ä¸€ä¸ªé€šç”¨çš„å­—å…¸è½¬æ¨¡å‹çš„å·¥å…·ç±»ï¼Œè¯¥å·¥å…·ç±»å¯ä»¥è‡ªåŠ¨åœ°å°†JSONå­—å…¸ä¸­çš„é”®å€¼å¯¹æ˜ å°„åˆ°æ¨¡å‹å¯¹è±¡çš„å±æ€§ä¸Šã€‚è¿™ç§æ“ä½œå¤§å¤§æé«˜äº†ä»£ç çš„å¯é‡ç”¨æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚\n\næ¶ˆæ¯è½¬å‘æœºåˆ¶ï¼š\nå½“å¯¹è±¡æ¥æ”¶åˆ°ä¸€ä¸ªæœªå®ç°çš„æ¶ˆæ¯æ—¶ï¼Œå¯ä»¥é€šè¿‡æ¶ˆæ¯è½¬å‘æœºåˆ¶æ¥åŠ¨æ€åœ°å¤„ç†è¿™ä¸ªæ¶ˆæ¯ã€‚è¿™ç§æœºåˆ¶å…è®¸æˆ‘ä»¬åœ¨ä¸æ”¹å˜åŸæœ‰ä»£ç çš„æƒ…å†µä¸‹ï¼Œä¸ºå¯¹è±¡æ·»åŠ æ–°çš„åŠŸèƒ½æˆ–å¤„ç†é”™è¯¯æƒ…å†µã€‚ä¾‹å¦‚ï¼Œå½“å¯¹è±¡æ¥æ”¶åˆ°ä¸€ä¸ªæœªå®ç°çš„æ–¹æ³•è°ƒç”¨æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å®ç°forwardingTargetForSelector:æˆ–forwardInvocation:æ–¹æ³•æ¥å¤„ç†è¿™ä¸ªæ¶ˆæ¯ã€‚\n\n\näº”ã€æ³¨æ„äº‹é¡¹è™½ç„¶iOS Runtimeæä¾›äº†è®¸å¤šå¼ºå¤§çš„åŠŸèƒ½ï¼Œä½†åœ¨ä½¿ç”¨æ—¶ä¹Ÿéœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š\n\nç¨³å®šæ€§ï¼š\nåŠ¨æ€åœ°ä¿®æ”¹ç±»çš„ç»“æ„å’Œè¡Œä¸ºå¯èƒ½ä¼šç ´åä»£ç çš„ç¨³å®šæ€§ã€‚å› æ­¤ï¼Œåœ¨ä½¿ç”¨RuntimeåŠŸèƒ½æ—¶éœ€è¦è°¨æ…è€ƒè™‘å…¶å¯¹ç³»ç»Ÿç¨³å®šæ€§çš„å½±å“ã€‚\n\nå¯ç»´æŠ¤æ€§ï¼š\nè¿‡åº¦ä½¿ç”¨RuntimeåŠŸèƒ½å¯èƒ½ä¼šé™ä½ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚å› æ­¤ï¼Œåœ¨å¼€å‘è¿‡ç¨‹ä¸­éœ€è¦æƒè¡¡åˆ©å¼Šï¼Œåˆç†åœ°ä½¿ç”¨RuntimeåŠŸèƒ½ã€‚\n\næ€§èƒ½ï¼š\nè™½ç„¶Runtimeç³»ç»Ÿæä¾›äº†è®¸å¤šé«˜æ•ˆçš„æ•°æ®ç»“æ„å’Œç®—æ³•æ¥ä¼˜åŒ–æ€§èƒ½ï¼Œä½†åœ¨æŸäº›æƒ…å†µä¸‹ï¼ˆå¦‚é¢‘ç¹åœ°åŠ¨æ€æ·»åŠ æˆ–åˆ é™¤æ–¹æ³•ï¼‰ï¼Œä»ç„¶å¯èƒ½ä¼šå¯¹æ€§èƒ½äº§ç”Ÿä¸€å®šçš„å½±å“ã€‚å› æ­¤ï¼Œåœ¨ä½¿ç”¨RuntimeåŠŸèƒ½æ—¶éœ€è¦å…³æ³¨å…¶å¯¹æ€§èƒ½çš„å½±å“ã€‚\n\n\nå…­ã€æ€»ç»“iOS Runtimeæ˜¯Objective-Cè¯­è¨€åŠ¨æ€ç‰¹æ€§çš„åŸºçŸ³ï¼Œå®ƒæä¾›äº†ä¸€ç³»åˆ—å¼ºå¤§çš„åŠŸèƒ½æ¥æ”¯æŒåŠ¨æ€æ€§å’Œçµæ´»æ€§ã€‚é€šè¿‡æ·±å…¥äº†è§£Runtimeçš„åŸºæœ¬æ¦‚å¿µã€æ•°æ®ç»“æ„ã€ä¸»è¦åŠŸèƒ½å’Œå®é™…åº”ç”¨ï¼Œæˆ‘ä»¬å¯ä»¥æ›´å¥½åœ°åˆ©ç”¨è¿™ä¸€æŠ€æœ¯æ¥å¼€å‘é«˜æ•ˆã€çµæ´»å’Œå¯ç»´æŠ¤çš„iOSåº”ç”¨ç¨‹åºã€‚åŒæ—¶ï¼Œä¹Ÿéœ€è¦æ³¨æ„åœ¨ä½¿ç”¨RuntimeåŠŸèƒ½æ—¶ä¿æŒä»£ç çš„ç¨³å®šæ€§å’Œå¯è¯»æ€§ã€‚\nBlockBlockæ˜¯è‹¹æœå…¬å¸åœ¨OSX10.6å’ŒiOS4.0ä¸­å¼•å…¥çš„ä¸€é¡¹åŠŸèƒ½ï¼Œå®ƒæå¤§åœ°ä¸°å¯Œäº†Cè¯­è¨€çš„ç‰¹æ€§ï¼Œå¹¶æä¾›äº†ç±»ä¼¼å…¶ä»–è¯­è¨€ä¸­é—­åŒ…ï¼ˆclosureï¼‰çš„åŠŸèƒ½ã€‚Blockæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªå¸¦æœ‰è‡ªåŠ¨å˜é‡ï¼ˆå±€éƒ¨å˜é‡ï¼‰çš„åŒ¿åå‡½æ•°ï¼Œå…¶åº•å±‚å®ç°åŒ…å«isaæŒ‡é’ˆï¼Œå› æ­¤ä¹Ÿå¯ä»¥è¢«çœ‹ä½œæ˜¯å—å¯¹è±¡ã€‚æœ¬æ–‡å°†æ·±å…¥è§£æiOSä¸­çš„Blockï¼ŒåŒ…æ‹¬å…¶æ¦‚å¿µã€å£°æ˜ä¸å®šä¹‰ã€æ•è·å˜é‡çš„æœºåˆ¶ã€å†…å­˜ç®¡ç†ä»¥åŠä½¿ç”¨åœºæ™¯ç­‰æ–¹é¢ã€‚\nä¸€ã€Blockçš„åŸºç¡€æ¦‚å¿µBlockåˆç§°ä¸ºå—æˆ–å—å¯¹è±¡ï¼Œæ˜¯è‹¹æœåœ¨æ”¹è¿›C&#x2F;OC&#x2F;C++&#x2F;OC++ç­‰è¯­è¨€çš„ç¼–è¯‘å¤„ç†æ—¶çš„é‡è¦æˆæœã€‚å®ƒçš„å‡ºç°æ—¨åœ¨æ›¿ä»£æŒ‡é’ˆå‡½æ•°ï¼Œä½¿å¾—ä»£ç æ›´åŠ ç®€æ´å’Œæ˜“ç”¨ã€‚Blockçš„è¯­æ³•ç»“æ„åŒ…æ‹¬è¿”å›ç±»å‹ã€å˜é‡åï¼ˆå¯çœç•¥ï¼‰ã€å‚æ•°åˆ—è¡¨ä»¥åŠå®ç°ä½“ï¼Œä½¿ç”¨è„±å­—ç¬¦â€œ^â€å’ŒèŠ±æ‹¬å·â€œ{}â€æ¥è¡¨ç¤ºã€‚\näºŒã€Blockçš„å£°æ˜ä¸å®šä¹‰Blockçš„å£°æ˜è¯­æ³•ç›¸å¯¹ç‹¬ç‰¹ï¼Œæ ¼å¼ä¸ºâ€œè¿”å›å€¼ç±»å‹(^blockå˜é‡å)(å‚æ•°åˆ—è¡¨)â€ã€‚ä¾‹å¦‚ï¼Œâ€œint(^personBlock)(NSString ,int)â€å£°æ˜äº†ä¸€ä¸ªåä¸ºpersonBlockçš„Blockå˜é‡ï¼Œå®ƒæ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼ˆä¸€ä¸ªNSStringç±»å‹å’Œä¸€ä¸ªintç±»å‹ï¼‰ï¼Œå¹¶è¿”å›ä¸€ä¸ªintç±»å‹çš„å€¼ã€‚\nBlockçš„å®šä¹‰åˆ™æ˜¯åœ¨å£°æ˜çš„åŸºç¡€ä¸Šï¼Œä½¿ç”¨â€œ&#x3D;â€ç¬¦å·å’Œâ€œ^â€ç¬¦å·æ¥å¼•å…¥å®ç°ä½“ã€‚ä¾‹å¦‚ï¼š\nNSString* (^personBlock)(NSString*,int) = ^(NSString* name, int age)&#123;    NSLog(@&quot;å¹´é¾„==%d&quot;, age);    return name;&#125;;\n\nè¿™æ®µä»£ç å®šä¹‰äº†ä¸€ä¸ªåä¸ºpersonBlockçš„Blockï¼Œå®ƒæ¥æ”¶ä¸€ä¸ªNSString*ç±»å‹çš„nameå’Œä¸€ä¸ªintç±»å‹çš„ageä½œä¸ºå‚æ•°ï¼Œæ‰“å°å¹´é¾„å¹¶è¿”å›nameã€‚\nä¸‰ã€Blockæ•è·å˜é‡çš„æœºåˆ¶Blockå¯ä»¥æ•è·å…¶å£°æ˜èŒƒå›´å†…çš„æ‰€æœ‰å˜é‡ï¼Œä½†æ•è·çš„è‡ªåŠ¨å˜é‡é»˜è®¤æ˜¯ä¸å¯ä¿®æ”¹çš„ã€‚å¦‚æœéœ€è¦ä¿®æ”¹ï¼Œåˆ™éœ€è¦åœ¨å˜é‡å‰åŠ ä¸Š__blockä¿®é¥°ç¬¦ã€‚__blockä¿®é¥°ç¬¦å‘Šè¯‰ç¼–è¯‘å™¨ï¼Œè¯¥å˜é‡å¯èƒ½ä¼šåœ¨Blockä¸­è¢«ä¿®æ”¹ï¼Œå› æ­¤éœ€è¦åœ¨Blockçš„å®ç°ä½“ä¸­ä¿ç•™ä¸€ä¸ªæŒ‡å‘è¯¥å˜é‡çš„æŒ‡é’ˆã€‚\næ­¤å¤–ï¼ŒBlockæ€»èƒ½ä¿®æ”¹å®ä¾‹å˜é‡ã€é™æ€å˜é‡ã€å…¨å±€å˜é‡å’Œå…¨å±€é™æ€å˜é‡ï¼Œæ— éœ€åŠ __blockä¿®é¥°ç¬¦ã€‚\nå››ã€Blockçš„å†…å­˜ç®¡ç†åœ¨iOSä¸­ï¼ŒBlockçš„å†…å­˜ç®¡ç†æ˜¯ä¸€ä¸ªé‡è¦çš„è€ƒè™‘å› ç´ ã€‚Blockæœ‰ä¸‰ç§å­˜å‚¨ä½ç½®ï¼šæ ˆï¼ˆ_NSConcreteStackBlockï¼‰ã€å †ï¼ˆ_NSConcreteMallocBlockï¼‰å’Œå…¨å±€ï¼ˆ_NSConcreteGlobalBlockï¼‰ã€‚\n\næ ˆä¸Šçš„Blockï¼šå½“Blockåœ¨æ–¹æ³•å†…éƒ¨å£°æ˜ä¸”æ²¡æœ‰å¼•ç”¨å¤–éƒ¨å˜é‡æ—¶ï¼Œå®ƒé€šå¸¸è¢«åˆ†é…åœ¨æ ˆä¸Šã€‚æ ˆä¸Šçš„Blockåœ¨æ–¹æ³•è¿”å›æ—¶ä¼šè¢«é”€æ¯ã€‚\nå †ä¸Šçš„Blockï¼šå½“Blockå¼•ç”¨å¤–éƒ¨å˜é‡æˆ–ä½œä¸ºå±æ€§å­˜å‚¨æ—¶ï¼Œå®ƒä¼šè¢«å¤åˆ¶åˆ°å †ä¸Šã€‚å †ä¸Šçš„Blockåœ¨å¼•ç”¨è®¡æ•°ä¸º0æ—¶æ‰ä¼šè¢«é”€æ¯ã€‚\nå…¨å±€çš„Blockï¼šä¸è®¿é—®ä»»ä½•å¤–éƒ¨å˜é‡çš„Blockå¯ä»¥è¢«è§†ä¸ºå…¨å±€Blockï¼Œå®ƒä»¬é€šå¸¸è¢«åˆ†é…åœ¨å…¨å±€æ•°æ®åŒºã€‚\n\nåœ¨ARCï¼ˆè‡ªåŠ¨å¼•ç”¨è®¡æ•°ï¼‰ç¯å¢ƒä¸‹ï¼Œç³»ç»Ÿé€šå¸¸ä¼šè‡ªåŠ¨å°†Blockä»æ ˆå¤åˆ¶åˆ°å †ä¸Šï¼Œä»¥é¿å…æ ˆä¸Šçš„Blockè¢«é”€æ¯ã€‚ç„¶è€Œï¼Œåœ¨MRCï¼ˆæ‰‹åŠ¨å¼•ç”¨è®¡æ•°ï¼‰ç¯å¢ƒä¸‹ï¼Œå¼€å‘è€…éœ€è¦æ‰‹åŠ¨ç®¡ç†Blockçš„å†…å­˜ã€‚\näº”ã€Blockçš„ä½¿ç”¨åœºæ™¯Blockåœ¨iOSå¼€å‘ä¸­æœ‰å¹¿æ³›çš„åº”ç”¨åœºæ™¯ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºï¼š\n\nä½œä¸ºå‚æ•°ä¼ é€’ï¼šBlockå¯ä»¥ä½œä¸ºå‡½æ•°çš„å‚æ•°ä¼ é€’ï¼Œè¿™ä½¿å¾—å‡½æ•°èƒ½å¤Ÿæ¥æ”¶ä¸€æ®µä»£ç ä½œä¸ºå‚æ•°ï¼Œå¹¶åœ¨éœ€è¦æ—¶æ‰§è¡Œè¿™æ®µä»£ç ã€‚è¿™ç§ç‰¹æ€§ä½¿å¾—Blockåœ¨å›è°ƒå‡½æ•°ã€åŠ¨ç”»å¤„ç†ç­‰æ–¹é¢éå¸¸æœ‰ç”¨ã€‚\né—­åŒ…ï¼šBlockçš„é—­åŒ…ç‰¹æ€§ä½¿å¾—å®ƒèƒ½å¤Ÿæ•è·å¹¶ä¿ç•™å…¶å£°æ˜èŒƒå›´å†…çš„å˜é‡ï¼Œå³ä½¿è¿™äº›å˜é‡åœ¨Blockå¤–éƒ¨å·²ç»è¢«é”€æ¯ã€‚è¿™ä½¿å¾—Blockèƒ½å¤Ÿåœ¨å¼‚æ­¥æ“ä½œã€å®šæ—¶å™¨å›è°ƒç­‰åœºæ™¯ä¸­ä¿æŒå¯¹å¤–éƒ¨å˜é‡çš„è®¿é—®ã€‚\né€‚é…å™¨æ¨¡å¼ï¼šBlockå¯ä»¥ç”¨ä½œé€‚é…å™¨æ¨¡å¼ä¸­çš„â€œè½¬æ¢å‡½æ•°â€ï¼Œå°†ä¸€ç§æ¥å£è½¬æ¢ä¸ºå¦ä¸€ç§æ¥å£ã€‚è¿™åœ¨å¤„ç†ä¸åŒæ•°æ®æºæˆ–ä¸åŒæ ¼å¼çš„æ•°æ®æ—¶éå¸¸æœ‰ç”¨ã€‚\nè§£å†³å¾ªç¯å¼•ç”¨ï¼šåœ¨ä½¿ç”¨Blockæ—¶ï¼Œéœ€è¦æ³¨æ„å¾ªç¯å¼•ç”¨çš„é—®é¢˜ã€‚ç‰¹åˆ«æ˜¯å½“Blockä½œä¸ºå¯¹è±¡çš„å±æ€§å­˜å‚¨æ—¶ï¼Œå¦‚æœå¯¹è±¡ä¹ŸæŒæœ‰Blockçš„å¼•ç”¨ï¼Œå°±ä¼šå½¢æˆå¾ªç¯å¼•ç”¨ã€‚ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œå¯ä»¥ä½¿ç”¨__weakå…³é”®å­—æ¥å£°æ˜å¯¹å¯¹è±¡çš„å¼±å¼•ç”¨ï¼Œä»è€Œåœ¨Blockä¸­é¿å…å¾ªç¯å¼•ç”¨ã€‚\n\nå…­ã€Blockä½¿ç”¨æ³¨æ„ç‚¹åŠå¸¸è§é—®é¢˜\nBlockä½œä¸ºç±»å˜é‡å±æ€§æ—¶ç”¨copyä¿®é¥°ï¼š\n\nåŸå› ï¼šBlockä½œä¸ºç±»å±æ€§æ—¶ï¼Œç”¨copyä¿®é¥°ç¬¦å¯ä»¥å°†Blockä»æ ˆæ‹·è´åˆ°å †ä¸­ï¼Œé˜²æ­¢Blockåœ¨æ–¹æ³•è¿”å›åè¢«é”€æ¯ã€‚\næ³¨æ„ï¼šèµ‹å€¼ç»™ä¸€ä¸ªweakå˜é‡æ—¶ï¼ŒBlockä¸ä¼šè¢«copyåˆ°å †ä¸Šã€‚\n\n\nä¸èƒ½ä¿®æ”¹å¤–éƒ¨è‡ªåŠ¨å˜é‡é—®é¢˜ï¼š\n\nè§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨__blockä¿®é¥°ç¬¦æ¥ä¿®é¥°éœ€è¦ä¿®æ”¹çš„å¤–éƒ¨è‡ªåŠ¨å˜é‡ã€‚\n\n\nå¾ªç¯å¼•ç”¨é—®é¢˜ï¼š\n\nè§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨__weakå…³é”®å­—æ¥å£°æ˜å¯¹å¯¹è±¡çš„å¼±å¼•ç”¨ï¼Œä»è€Œé¿å…å¾ªç¯å¼•ç”¨ã€‚åœ¨éœ€è¦è®¿é—®selfå±æ€§æ—¶ï¼Œå¯ä»¥åœ¨Blockå†…éƒ¨ä½¿ç”¨[weak self]å’Œ[strong self]çš„æŠ€å·§æ¥ç¡®ä¿selfåœ¨Blockæ‰§è¡ŒæœŸé—´ä¸ä¼šè¢«é‡Šæ”¾ã€‚\n\n\n\nä¸ƒã€æ€»ç»“Blockæ˜¯iOSå¼€å‘ä¸­ä¸€é¡¹éå¸¸å¼ºå¤§çš„åŠŸèƒ½ï¼Œå®ƒæä¾›äº†ç®€æ´ä¸”æ˜“ç”¨çš„æ¥å£æ¥å°è£…ä»£ç å—ï¼Œå¹¶å…è®¸æ•è·å’Œä¿ç•™å¤–éƒ¨å˜é‡ã€‚ç„¶è€Œï¼Œåœ¨ä½¿ç”¨Blockæ—¶ï¼Œä¹Ÿéœ€è¦æ³¨æ„å…¶å†…å­˜ç®¡ç†å’Œå¾ªç¯å¼•ç”¨ç­‰é—®é¢˜ã€‚é€šè¿‡æ·±å…¥ç†è§£Blockçš„åº•å±‚å®ç°å’Œä½¿ç”¨åœºæ™¯ï¼Œå¼€å‘è€…å¯ä»¥æ›´åŠ é«˜æ•ˆåœ°åˆ©ç”¨è¿™ä¸€åŠŸèƒ½æ¥ç¼–å†™å‡ºæ›´åŠ ä¼˜é›…å’Œå¥å£®çš„ä»£ç ã€‚\n","categories":["åŸºç¡€"]},{"title":"Day7-åˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨","url":"/2025/04/30/Day7-%E5%90%88%E5%B9%B6%E4%B8%A4%E4%B8%AA%E6%9C%89%E5%BA%8F%E9%93%BE%E8%A1%A8/","content":"ğŸ”— LeetCode 21 - Merge Two Sorted Lists\nğŸ“Œ é¢˜ç›®æè¿°å°†ä¸¤ä¸ªå‡åºé“¾è¡¨åˆå¹¶ä¸ºä¸€ä¸ªæ–°çš„ å‡åº é“¾è¡¨å¹¶è¿”å›ã€‚æ–°é“¾è¡¨æ˜¯é€šè¿‡æ‹¼æ¥ç»™å®šçš„ä¸¤ä¸ªé“¾è¡¨çš„æ‰€æœ‰èŠ‚ç‚¹ç»„æˆçš„ã€‚\nç¤ºä¾‹ï¼š\nè¾“å…¥: l1 = [1,2,4], l2 = [1,3,4]è¾“å‡º: [1,1,2,3,4,4]\n\n\nğŸ’¡ è§£é¢˜æ€è·¯\nä½¿ç”¨ é€’å½’ æˆ– è¿­ä»£ æ–¹æ³•é€æ­¥å°†ä¸¤ä¸ªé“¾è¡¨ä¸­è¾ƒå°çš„èŠ‚ç‚¹è¿æ¥èµ·æ¥ï¼›\n\né€’å½’å†™æ³•ç®€æ´ä¼˜é›…ï¼Œä½†è¿­ä»£å†™æ³•æ›´å®¹æ˜“æ§åˆ¶ç©ºé—´å¤æ‚åº¦ã€‚\n\næ—¶é—´å¤æ‚åº¦ï¼šO(n + m)ï¼Œå…¶ä¸­ n å’Œ m åˆ†åˆ«æ˜¯ä¸¤ä¸ªé“¾è¡¨çš„é•¿åº¦ï¼›\n\nç©ºé—´å¤æ‚åº¦ï¼š\n\né€’å½’ï¼šO(n + m)ï¼Œå› ä¸ºé€’å½’æ ˆï¼›\nè¿­ä»£ï¼šO(1)\n\n\n\n\nâœ… JavaScript å®ç°ï¼ˆè¿­ä»£ï¼‰var mergeTwoLists = function(l1, l2) &#123;    let dummy = new ListNode(-1);    let current = dummy;    while (l1 !== null &amp;&amp; l2 !== null) &#123;        if (l1.val &lt;= l2.val) &#123;            current.next = l1;            l1 = l1.next;        &#125; else &#123;            current.next = l2;            l2 = l2.next;        &#125;        current = current.next;    &#125;    current.next = l1 !== null ? l1 : l2;    return dummy.next;&#125;;\n\n\nâœ… JavaScript å®ç°ï¼ˆé€’å½’ï¼‰var mergeTwoLists = function(l1, l2) &#123;    if (l1 === null) return l2;    if (l2 === null) return l1;    if (l1.val &lt;= l2.val) &#123;        l1.next = mergeTwoLists(l1.next, l2);        return l1;    &#125; else &#123;        l2.next = mergeTwoLists(l1, l2.next);        return l2;    &#125;&#125;;\n\n\nğŸ§  æ€è€ƒæ‹“å±•\nå¦‚ä½•åœ¨ä¸åˆ›å»ºæ–°é“¾è¡¨èŠ‚ç‚¹çš„æƒ…å†µä¸‹åˆå¹¶ï¼Ÿ\nå¦‚æœé“¾è¡¨ä¸æ˜¯å‡åºè€Œæ˜¯æ— åºï¼Œå¦‚ä½•åˆå¹¶åæ’åºï¼Ÿ\n\n\n","categories":["ç®—æ³•"]},{"title":"Day8-RunLoop æ„æˆä¸çº¿ç¨‹ä¿æ´»","url":"/2025/05/06/Day8-RunLoop-%E6%9E%84%E6%88%90%E4%B8%8E%E7%BA%BF%E7%A8%8B%E4%BF%9D%E6%B4%BB/","content":"ä¸€ã€RunLoop çš„æ„æˆRunLoop æ˜¯åŸºäº CFRunLoopRefï¼ˆCore Foundation å±‚ï¼‰æ„å»ºçš„ï¼ŒNSRunLoop æ˜¯å…¶ Foundation å±‚çš„å°è£…ã€‚æ ¸å¿ƒç»„æˆå¦‚ä¸‹ï¼š\n1. RunLoop å¯¹è±¡\næ¯æ¡çº¿ç¨‹éƒ½æœ‰å”¯ä¸€çš„ä¸€ä¸ª RunLoop å¯¹è±¡ï¼ˆä¸»çº¿ç¨‹é»˜è®¤åˆ›å»ºï¼Œå­çº¿ç¨‹éœ€æ‰‹åŠ¨åˆ›å»ºï¼‰ã€‚\n\n2. RunLoopMode\nRunLoop åœ¨ä»»ä¸€æ—¶åˆ»åªèƒ½è¿è¡Œåœ¨ä¸€ç§æ¨¡å¼ä¸‹ã€‚\nå¸¸è§æ¨¡å¼ï¼š\nNSDefaultRunLoopMode\nUITrackingRunLoopMode\nNSRunLoopCommonModes\n\n\n\n3. Sourceï¼ˆäº‹ä»¶æºï¼‰\nSource0ï¼šéåŸºäº Port çš„ï¼Œå¦‚ performSelector:onThread:\nSource1ï¼šåŸºäº Port çš„ï¼Œå¦‚ GCD ä¸»çº¿ç¨‹é€šä¿¡\n\n4. Timer\nNSTimer å’Œ CADisplayLink éƒ½ä¾èµ– RunLoop\n\n5. Observerï¼ˆè§‚å¯Ÿè€…ï¼‰\nç›‘å¬ RunLoop çŠ¶æ€å˜åŒ–ï¼Œå¦‚å°†è¦è¿›å…¥ã€å³å°†å¤„ç†äº‹ä»¶ã€å³å°†ä¼‘çœ ç­‰\n\n6. Port\nçº¿ç¨‹é€šä¿¡è½½ä½“ï¼Œé…åˆ Source1 ä½¿ç”¨\n\n\näºŒã€RunLoop ä¸çº¿ç¨‹ä¿æ´»1. å­çº¿ç¨‹é»˜è®¤è¡Œä¸ºä»»åŠ¡æ‰§è¡Œå®Œå³é€€å‡ºï¼Œå› ä¸ºæ²¡æœ‰ RunLoopã€‚\n2. çº¿ç¨‹ä¿æ´»æ–¹å¼- (void)startThread &#123;    NSThread *thread = [[NSThread alloc] initWithBlock:^&#123;        [[NSRunLoop currentRunLoop] addPort:[NSPort port] forMode:NSDefaultRunLoopMode];        [[NSRunLoop currentRunLoop] run];    &#125;];    [thread start];&#125;\n\n3. æ³¨æ„äº‹é¡¹\nrun ä¼šé˜»å¡çº¿ç¨‹ã€‚\nRunLoop éœ€è¦è‡³å°‘ä¸€ä¸ª Input Source å¦åˆ™ä¼šç«‹åˆ»é€€å‡ºã€‚\n\n\nä¸‰ã€RunLoop çš„å®é™…åº”ç”¨ï¼ˆå«ç¤ºä¾‹ï¼‰1. ä¿æŒçº¿ç¨‹ä¸é€€å‡ºåå°æ—¥å¿—æ”¶é›†&#x2F;è§£ç ä»»åŠ¡ä¸­ä½¿ç”¨ RunLoop ä¿æ´»çº¿ç¨‹ã€‚\n2. äº‹ä»¶å“åº”æœºåˆ¶å¦‚ Touchã€Button ç‚¹å‡»ï¼Œé€šè¿‡ Source1 åˆ†å‘ç»™ä¸»çº¿ç¨‹ RunLoopã€‚\n3. å®šæ—¶å™¨NSTimer&#x2F;CADisplayLink ä¾èµ– RunLoop è§¦å‘ã€‚\n4. GCD ä¸»é˜Ÿåˆ—å›è°ƒå»¶è¿Ÿä¸»çº¿ç¨‹å¡é¡¿æ—¶å»¶è¿Ÿæ‰§è¡Œï¼ŒåŸå› æ˜¯ GCD å›è°ƒä¾èµ– Source1ã€‚\n5. UI æ»šåŠ¨ä¸äº‹ä»¶éš”ç¦»æ»šåŠ¨ UIScrollView æ—¶åˆ‡æ¢ Modeï¼Œæš‚åœå®šæ—¶å™¨è§¦å‘ã€‚\n6. AutoreleasePool ç®¡ç†RunLoop æ¯æ¬¡å¾ªç¯è‡ªåŠ¨åˆ›å»º&#x2F;é‡Šæ”¾ poolï¼Œé˜²æ­¢æ³„éœ²ã€‚\n7. çº¿ç¨‹é—´é€šä¿¡åŸºäº Port çš„æ¶ˆæ¯ä¼ é€’ï¼Œç»“åˆ Source1 å®ç°ã€‚\n\nå››ã€RunLoop å®ç°åŸç†RunLoop æœ¬è´¨æ˜¯ä¸€ä¸ªåŸºäºäº‹ä»¶å¾ªç¯çš„ç»“æ„ï¼š\nwhile (!stop) &#123;    __CFRunLoopDoObservers(kCFRunLoopEntry);    __CFRunLoopDoTimers();    __CFRunLoopDoSources0();    mach_msg(); // ç­‰å¾…æ¶ˆæ¯å”¤é†’    __CFRunLoopDoSources1();    __CFRunLoopDoObservers(kCFRunLoopExit);&#125;\n\næ ¸å¿ƒæœºåˆ¶ï¼š\n\n\næ¨¡å—\nè¯´æ˜\n\n\n\nmach_port\nåº•å±‚é€šä¿¡æœºåˆ¶\n\n\nSource0\nè‡ªå®šä¹‰äº‹ä»¶\n\n\nSource1\nç³»ç»Ÿäº‹ä»¶ï¼ˆå¦‚ GCDï¼‰\n\n\nTimer\nå®šæ—¶ä»»åŠ¡\n\n\nObserver\nçŠ¶æ€ç›‘å¬\n\n\nMode\näº‹ä»¶éš”ç¦»ä¸åˆ‡æ¢æ¨¡å¼\n\n\nMode ä¸ Input Source å…³ç³»ç»“æ„ï¼šRunLoop â”œâ”€â”€ ModeA â”‚    â”œâ”€â”€ Source0 â”‚    â”œâ”€â”€ Source1 â”‚    â”œâ”€â”€ Timer â”‚    â””â”€â”€ Observer â””â”€â”€ ModeB      â”œâ”€â”€ Source0      â””â”€â”€ ...\n\n\näº”ã€æ€»ç»“\n\n\nåˆ†ç±»\nåº”ç”¨\n\n\n\nUIäº¤äº’\näº‹ä»¶å“åº”ã€è§¦æ‘¸åˆ†å‘ã€ä¸»é˜Ÿåˆ— GCD\n\n\nå¤šçº¿ç¨‹\nçº¿ç¨‹ä¿æ´»ã€çº¿ç¨‹é€šä¿¡\n\n\næ€§èƒ½ä¼˜åŒ–\næ»šåŠ¨æ—¶æš‚åœåŠ¨ç”»\n\n\nå†…å­˜ç®¡ç†\nè‡ªåŠ¨é‡Šæ”¾æ± ç®¡ç†\n\n\nåŠ¨ç”»å¤„ç†\nCADisplayLink åˆ·æ–°å¸§ç‡\n\n\n","categories":["åŸºç¡€"]},{"title":"Day8-éªŒè¯å›æ–‡ä¸²","url":"/2025/05/06/Day8-%E9%AA%8C%E8%AF%81%E5%9B%9E%E6%96%87%E4%B8%B2/","content":"ğŸ”— LeetCode 125 - Valid Palindrome\nğŸ“Œ é¢˜ç›®æè¿°ç»™å®šä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œåˆ¤æ–­å®ƒæ˜¯å¦æ˜¯å›æ–‡ï¼Œåªè€ƒè™‘å­—æ¯å’Œæ•°å­—å­—ç¬¦ï¼Œå¯ä»¥å¿½ç•¥å­—æ¯çš„å¤§å°å†™ã€‚\nç¤ºä¾‹ï¼š\nè¾“å…¥: &quot;A man, a plan, a canal: Panama&quot;è¾“å‡º: trueè¾“å…¥: &quot;race a car&quot;è¾“å‡º: false\n\n\nğŸ’¡ è§£é¢˜æ€è·¯\nä½¿ç”¨åŒæŒ‡é’ˆæ³•ï¼›\n\nä»å¤´å°¾ä¸¤ç«¯éå†ï¼Œåªä¿ç•™å­—æ¯å’Œæ•°å­—ï¼Œç»Ÿä¸€è½¬æˆå°å†™åæ¯”è¾ƒï¼›\n\nå¿½ç•¥å…¶ä»–ç¬¦å·ã€‚\n\næ—¶é—´å¤æ‚åº¦ï¼šO(n)\n\nç©ºé—´å¤æ‚åº¦ï¼šO(1)\n\n\n\nâœ… JavaScript å®ç°var isPalindrome = function(s) &#123;    let left = 0, right = s.length - 1;    while (left &lt; right) &#123;        while (left &lt; right &amp;&amp; !isAlphaNum(s[left])) left++;        while (left &lt; right &amp;&amp; !isAlphaNum(s[right])) right--;        if (s[left].toLowerCase() !== s[right].toLowerCase()) return false;        left++;        right--;    &#125;    return true;&#125;;function isAlphaNum(c) &#123;    return /^[a-zA-Z0-9]$/.test(c);&#125;\n\n\nğŸ§  æ€è€ƒæ‹“å±•\nå¦‚ä½•å¤„ç† Unicode å­—ç¬¦ï¼ˆå¦‚ä¸­æ–‡ã€Emojiï¼‰ï¼Ÿ\nå¦‚æœéœ€è¦è€ƒè™‘å›æ–‡å­ä¸²ï¼Œå¦‚ä½•ä¼˜åŒ–ï¼Ÿ\n\n\n","categories":["ç®—æ³•"]},{"title":"Day9-RunLoop å¡é¡¿ä¼˜åŒ–ä¸ç›‘æ§å®ç°","url":"/2025/05/07/Day9-RunLoop-%E5%8D%A1%E9%A1%BF%E4%BC%98%E5%8C%96%E4%B8%8E%E7%9B%91%E6%8E%A7%E5%AE%9E%E7%8E%B0/","content":"iOS RunLoop å¡é¡¿ä¼˜åŒ–æŒ‡å—ä¸€ã€ç†è§£ RunLoop å¡é¡¿çš„æœ¬è´¨1. RunLoop åŸºæœ¬æœºåˆ¶RunLoop æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªäº‹ä»¶å¾ªç¯æœºåˆ¶ï¼Œä¸»è¦ç”¨äºçº¿ç¨‹çš„ä»»åŠ¡è°ƒåº¦ã€‚åœ¨ä¸»çº¿ç¨‹ä¸­ï¼ŒRunLoop è´Ÿè´£å¤„ç†ï¼š\n\nè§¦æ‘¸äº‹ä»¶\nå®šæ—¶å™¨äº‹ä»¶ï¼ˆNSTimerã€CADisplayLinkï¼‰\nUI æ¸²æŸ“\nGCD ä¸»é˜Ÿåˆ—ä»»åŠ¡\nç³»ç»Ÿäº‹ä»¶ï¼ˆæ¯”å¦‚é”®ç›˜å¼¹å‡ºï¼‰\n\n2. å¡é¡¿ç°è±¡åŸå› ä¸»çº¿ç¨‹å¡é¡¿çš„æœ¬è´¨æ˜¯ RunLoop é•¿æ—¶é—´æ²¡æœ‰è¿”å›åˆ°ç©ºé—²çŠ¶æ€ï¼Œå¸¸è§åŸå› ï¼š\n\nåŒæ­¥è€—æ—¶ä»»åŠ¡é˜»å¡ä¸»çº¿ç¨‹ï¼ˆå¦‚æ–‡ä»¶ IOã€ç½‘ç»œè¯·æ±‚ã€å¤æ‚è®¡ç®—ï¼‰\nUI æ¸²æŸ“è¿‡æ…¢ï¼ˆå¤§é‡ç»˜åˆ¶ã€å›¾ç‰‡è§£ç ï¼‰\né«˜é¢‘æ¬¡å®šæ—¶å™¨ä»»åŠ¡\næ­»é”æˆ–çº¿ç¨‹æŠ¢å èµ„æº\n\näºŒã€RunLoop å¡é¡¿ç›‘æ§1. ä½¿ç”¨ RunLoop Observer æ£€æµ‹å¡é¡¿CFRunLoopObserverRef observer = CFRunLoopObserverCreateWithHandler(NULL, kCFRunLoopAllActivities, YES, 0, ^(CFRunLoopObserverRef observer, CFRunLoopActivity activity) &#123;    // è®°å½•è¿›å…¥å’Œé€€å‡ºæ—¶é—´ï¼Œåˆ¤æ–­è€—æ—¶&#125;);CFRunLoopAddObserver(CFRunLoopGetMain(), observer, kCFRunLoopCommonModes);\n\n2. å¸¸ç”¨å·¥å…·\nFPS ç›‘æ§å·¥å…·\nTime Profilerï¼ˆå®šä½å¡é¡¿è°ƒç”¨æ ˆï¼‰\nInstruments çš„ Core Animationï¼ˆæ£€æµ‹ UI ç»˜åˆ¶ï¼‰\nè‡ªè¡Œå®ç°å¡é¡¿ç›‘æ§ï¼ˆå¯è®¾å®šé˜ˆå€¼ï¼Œå¦‚è¶…è¿‡ 200msï¼‰\n\nä¸‰ã€RunLoop å¡é¡¿ä¼˜åŒ–ç­–ç•¥1. å‡å°‘ä¸»çº¿ç¨‹å‹åŠ›\nè€—æ—¶æ“ä½œå¼‚æ­¥å¤„ç†ï¼šå¦‚ç½‘ç»œã€æ•°æ®åº“ã€å‹ç¼©ã€è§£ç \nä½¿ç”¨ GCD æˆ– NSOperation å°†ä»»åŠ¡æ”¾åœ¨å­çº¿ç¨‹\n\nDispatchQueue.global().async &#123;    // è€—æ—¶æ“ä½œ    DispatchQueue.main.async &#123;        // å›ä¸»çº¿ç¨‹æ›´æ–° UI    &#125;&#125;\n\n2. å»¶è¿Ÿæˆ–åˆ†æ‰¹æ‰§è¡Œä»»åŠ¡\nä½¿ç”¨ RunLoop idle æ—¶æœºå¤„ç†ä»»åŠ¡\nåˆ©ç”¨ CADisplayLink æ‹†åˆ†ä»»åŠ¡ï¼ˆå…¸å‹å¦‚ tableView cell å¼‚æ­¥ç»˜åˆ¶ï¼‰\n\nCADisplayLink *link = [CADisplayLink displayLinkWithTarget:self selector:@selector(step)];[link addToRunLoop:[NSRunLoop mainRunLoop] forMode:NSRunLoopCommonModes];\n\n3. å›¾åƒåŠ è½½ä¼˜åŒ–\nå›¾ç‰‡è§£ç ã€å‹ç¼©å¤„ç†æ”¾åˆ°å­çº¿ç¨‹\nä½¿ç”¨å¼‚æ­¥å›¾ç‰‡åŠ è½½æ¡†æ¶ï¼ˆå¦‚ SDWebImageã€Kingfisherï¼‰\n\n4. ä¼˜åŒ– UI ç»˜åˆ¶\nå‡å°‘ä¸å¿…è¦çš„è§†å›¾å±‚çº§\nåˆç†ä½¿ç”¨ rasterization, shouldRasterizeï¼Œé¿å…é¢‘ç¹é‡ç»˜\nå°½é‡ä½¿ç”¨ CALayer åšåŠ¨ç”»æˆ–ç»˜åˆ¶\n\n5. ä¼˜åŒ–å®šæ—¶å™¨\né¿å…ä½¿ç”¨è¿‡å¤šé«˜é¢‘ç‡çš„ NSTimer\nç”¨ CADisplayLink æˆ– DispatchSourceTimer ç²¾ç¡®æ§åˆ¶\næ³¨æ„é‡Šæ”¾å®šæ—¶å™¨ï¼Œé˜²æ­¢å¾ªç¯å¼•ç”¨æˆ–å†…å­˜æ³„æ¼\n\nå››ã€è¿›é˜¶å»ºè®®ä½¿ç”¨ RunLoop æ¨¡å‹å®ç°ä»»åŠ¡è°ƒåº¦ï¼ˆå¦‚ YYKit çš„ AsyncLayerï¼‰æ ¸å¿ƒæ€æƒ³ï¼š\n\nä¸»çº¿ç¨‹æ¯å¸§ç©ºé—²é˜¶æ®µå¤„ç†å°‘é‡ä»»åŠ¡ï¼ˆæ¯å¸§åˆ†æ‰¹ï¼‰\né¿å…é˜»å¡ä¸»çº¿ç¨‹\n\nåˆ©ç”¨ä¿¡å·é‡&#x2F; watchdog æ£€æµ‹ä¸¥é‡å¡é¡¿å¯ç”¨ dispatch_semaphore é…åˆå­çº¿ç¨‹æ£€æµ‹ä¸»çº¿ç¨‹é•¿æ—¶é—´ä¸å“åº”ï¼Œè¿›è¡Œå¡é¡¿ä¸ŠæŠ¥ã€‚\näº”ã€æ€»ç»“\n\n\nä¼˜åŒ–æ‰‹æ®µ\næ˜¯å¦æ¨è\nåœºæ™¯è¯´æ˜\n\n\n\nè€—æ—¶ä»»åŠ¡å¼‚æ­¥åŒ–\nâœ…\nç½‘ç»œã€å›¾ç‰‡ã€è®¡ç®—ç­‰\n\n\nUI ç»˜åˆ¶ä¼˜åŒ–\nâœ…\nå¤šå›¾é¡µé¢ã€å¤æ‚è§†å›¾\n\n\nRunLoop ç©ºé—²ä»»åŠ¡è°ƒåº¦\nâœ…\næ‰¹é‡ä»»åŠ¡ï¼Œé™ä½ç¬æ—¶å‹åŠ›\n\n\nå¡é¡¿ç›‘æ§å·¥å…·æ¥å…¥\nâœ…\næå‰å‘ç°é—®é¢˜\n\n\nè‡ªå®šä¹‰ RunLoop è°ƒåº¦\nâœ…\né«˜é˜¶ä¼˜åŒ–ï¼Œå¦‚ä»»åŠ¡ä¼˜å…ˆçº§\n\n\n\niOS ä¸»çº¿ç¨‹å¡é¡¿ç›‘æ§å®ç°æ–¹æ¡ˆğŸ”§ æ–¹æ¡ˆæ ¸å¿ƒæ€è·¯\nåˆ©ç”¨ CFRunLoopObserver ç›‘å¬ RunLoop å„é˜¶æ®µï¼›\nåœ¨å­çº¿ç¨‹ä¸­å¼€å¯å®šæ—¶å™¨ï¼Œæ£€æŸ¥ä¸»çº¿ç¨‹æ˜¯å¦é•¿æ—¶é—´åœç•™åœ¨æŸä¸ªé˜¶æ®µï¼›\nè¶…è¿‡é˜ˆå€¼ï¼ˆå¦‚ 200msï¼‰å³åˆ¤å®šä¸ºå¡é¡¿ï¼Œå¹¶è®°å½•å †æ ˆã€‚\n\nâœ… ç¤ºä¾‹ä»£ç ï¼ˆObjective-Cï¼‰@interface MainThreadMonitor : NSObject@end@implementation MainThreadMonitor &#123;    CFRunLoopObserverRef observer;    dispatch_semaphore_t semaphore;    CFRunLoopActivity activity;    BOOL isMonitoring;&#125;- (instancetype)init &#123;    if (self = [super init]) &#123;        semaphore = dispatch_semaphore_create(0);    &#125;    return self;&#125;- (void)startMonitoring &#123;    if (isMonitoring) return;    isMonitoring = YES;    // 1. è®¾ç½® RunLoop è§‚å¯Ÿè€…    CFRunLoopObserverContext context = &#123;0, (__bridge void *)self, NULL, NULL, NULL&#125;;    observer = CFRunLoopObserverCreate(NULL, kCFRunLoopAllActivities, YES, 0, &amp;runLoopCallback, &amp;context);    CFRunLoopAddObserver(CFRunLoopGetMain(), observer, kCFRunLoopCommonModes);        // 2. åœ¨å­çº¿ç¨‹ä¸­æ£€æµ‹ä¸»çº¿ç¨‹å¡é¡¿    dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_HIGH, 0), ^&#123;        while (self-&gt;isMonitoring) &#123;            long result = dispatch_semaphore_wait(self-&gt;semaphore, dispatch_time(DISPATCH_TIME_NOW, 200 * NSEC_PER_MSEC));            if (result != 0) &#123;                if (self-&gt;activity == kCFRunLoopBeforeSources || self-&gt;activity == kCFRunLoopAfterWaiting) &#123;                    NSLog(@&quot;âš ï¸ å‘ç°å¡é¡¿&quot;);                    [self logMainThreadStack];                &#125;            &#125;        &#125;    &#125;);&#125;// RunLoop å›è°ƒstatic void runLoopCallback(CFRunLoopObserverRef observer, CFRunLoopActivity act, void *info) &#123;    MainThreadMonitor *monitor = (__bridge MainThreadMonitor *)info;    monitor-&gt;activity = act;    dispatch_semaphore_signal(monitor-&gt;semaphore);&#125;// æ‰“å°ä¸»çº¿ç¨‹å †æ ˆ- (void)logMainThreadStack &#123;    thread_act_t thread = mach_thread_self();    NSString *stack = [self getStackForThread:mach_thread_self()];    NSLog(@&quot;å¡é¡¿å †æ ˆï¼š%@&quot;, stack);&#125;// è·å–å †æ ˆï¼ˆå¯ç”¨ PLCrashReporter æˆ–è‡ªå·±è§£æï¼‰- (NSString *)getStackForThread:(thread_t)thread &#123;    void *callstack[128];    int frames = backtrace(callstack, 128);    char **strs = backtrace_symbols(callstack, frames);    NSMutableString *stack = [NSMutableString string];    for (int i = 0; i &lt; frames; i++) &#123;        [stack appendFormat:@&quot;%s&quot;, strs[i]];    &#125;    free(strs);    return stack;&#125;- (void)stopMonitoring &#123;    if (!isMonitoring) return;    isMonitoring = NO;    if (observer) &#123;        CFRunLoopRemoveObserver(CFRunLoopGetMain(), observer, kCFRunLoopCommonModes);        CFRelease(observer);        observer = NULL;    &#125;&#125;@end\n\nğŸ“Œ ä½¿ç”¨æ–¹å¼MainThreadMonitor *monitor = [[MainThreadMonitor alloc] init];[monitor startMonitoring];\n\nğŸš€ è¡¥å……ä¼˜åŒ–å»ºè®®\nä¸Šä¼ å¡é¡¿ä¿¡æ¯ åˆ°æœåŠ¡ç«¯åˆ†æï¼ˆåŒ…æ‹¬æ—¶é—´æˆ³ã€å †æ ˆã€è®¾å¤‡ä¿¡æ¯ç­‰ï¼‰ï¼›\nä½¿ç”¨ PLCrashReporter æ•è·å®Œæ•´å †æ ˆï¼›\né¿å…è¯¯æŠ¥ï¼ˆå¯è®¾å®š N æ¬¡è¿ç»­å¡é¡¿åæ‰è§¦å‘ä¸ŠæŠ¥ï¼‰ï¼›\næ·»åŠ  FPS ç›‘æ§ä½œä¸ºè¾…åŠ©å‚è€ƒã€‚\n\niOS å®Œæ•´å †æ ˆæ•è·å®ç°åŸç†ğŸ” æ ˆå¸§æ•è·çš„åŸç†æ¦‚è¿°1. æ ˆå¸§ç»“æ„ï¼ˆä»¥ x86_64 ä¸ºä¾‹ï¼‰æ¯æ¬¡å‡½æ•°è°ƒç”¨æ—¶ï¼Œç³»ç»Ÿä¼šåœ¨æ ˆä¸­ä¿å­˜ï¼š\n\nè¿”å›åœ°å€ï¼ˆreturn addressï¼‰\nä¸Šä¸€ä¸ªå‡½æ•°çš„æ ˆå¸§æŒ‡é’ˆï¼ˆframe pointerï¼‰\nå‡½æ•°å‚æ•°å’Œå±€éƒ¨å˜é‡\n\nå› æ­¤ï¼Œé€šè¿‡ å½“å‰å¸§çš„ frame pointerï¼ˆrbpï¼‰ï¼Œå¯ä»¥å›æº¯å‰ä¸€ä¸ªå‡½æ•°çš„å¸§ï¼Œå½¢æˆè°ƒç”¨é“¾ã€‚\nå½“å‰æ ˆå¸§ï¼š| return address || previous RBP   |  &lt;---- å½“å‰ RBP æŒ‡å‘è¿™é‡Œ| arguments      || local vars     |\n\nä¸æ–­éå† RBPï¼Œå°±å¯ä»¥å¾—åˆ°ä¸€è¿ä¸²çš„è°ƒç”¨è·¯å¾„ã€‚\n\n2. backtrace() ä¸ backtrace_symbols()è‹¹æœç³»ç»Ÿæä¾›äº† glibc çš„æ¥å£ï¼Œèƒ½è·å–å½“å‰çº¿ç¨‹çš„è°ƒç”¨æ ˆä¿¡æ¯ï¼š\nvoid *callstack[128];int frames = backtrace(callstack, 128);  // è·å¾— return address æ•°ç»„char **strs = backtrace_symbols(callstack, frames); // è½¬ä¸ºç¬¦å·åŒ–å­—ç¬¦ä¸²\n\n\nbacktrace()ï¼šè¿”å›æŒ‡é’ˆæ•°ç»„ï¼Œæ¯ä¸ªæŒ‡é’ˆæ˜¯ä¸€ä¸ªè¿”å›åœ°å€ï¼ˆPC å€¼ï¼‰\nbacktrace_symbols()ï¼šå°†åœ°å€è§£æä¸ºå‡½æ•°åï¼ˆå¸¦ç¬¦å·ä¿¡æ¯ï¼‰\n\n\nâœ… é€‚ç”¨äºå½“å‰çº¿ç¨‹âŒ æ— æ³•æ•è·å…¶ä»–çº¿ç¨‹çš„å †æ ˆ\n\n\nğŸ§  æ•è·å…¶ä»–çº¿ç¨‹å †æ ˆçš„é«˜çº§åšæ³•1. ä½¿ç”¨ Mach çº¿ç¨‹ API è·å–ä¸Šä¸‹æ–‡macOS å’Œ iOS çš„çº¿ç¨‹ç”± Mach çº¿ç¨‹é©±åŠ¨ï¼Œå¯ä½¿ç”¨å¦‚ä¸‹æ–¹å¼è·å–ä»»æ„çº¿ç¨‹çš„çŠ¶æ€ï¼š\nthread_act_t thread = mach_thread_self(); // æˆ–ä¸»çº¿ç¨‹ mach_port_ARM_THREAD_STATE64 state;mach_msg_type_number_t count = _ARM_THREAD_STATE64_COUNT;thread_get_state(thread, ARM_THREAD_STATE64, (thread_state_t)&amp;state, &amp;count);\n\n\nå¯æ‹¿åˆ°å¯„å­˜å™¨ä¿¡æ¯ï¼ˆå¦‚ pc, lr, fpï¼‰\nä» fpï¼ˆframe pointerï¼‰å¼€å§‹ï¼Œæ‰‹åŠ¨è§£æå†…å­˜è·å–è°ƒç”¨é“¾\n\n2. ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“å°è£…ï¼ˆæ¨èï¼‰\nPLCrashReporter\nKSCrash\n\nå®ƒä»¬åœ¨å´©æºƒæˆ–å¡é¡¿æ—¶ï¼š\n\næŒ‚èµ·çº¿ç¨‹\nè¯»å–çº¿ç¨‹ä¸Šä¸‹æ–‡å¯„å­˜å™¨ï¼ˆå¦‚ pcã€spã€fpï¼‰\næ‰‹åŠ¨å›æº¯è°ƒç”¨æ ˆ\nè¿›è¡Œç¬¦å·åŒ–è¾“å‡º\n\n\nâš ï¸ æ³¨æ„äº‹é¡¹\næ‰‹åŠ¨è¯»å–çº¿ç¨‹å¯„å­˜å™¨æœ‰é£é™©ï¼ˆéœ€æŒ‚èµ·çº¿ç¨‹ï¼Œé˜²æ­¢æ ˆå˜åŒ–ï¼‰\nå¯¹äºä¼˜åŒ–æˆ–å†…è”å‡½æ•°ï¼Œå¯èƒ½æ— æ³•è·å–å®Œæ•´ä¿¡æ¯\nç³»ç»Ÿå‡½æ•°ç¬¦å·åŒ–ä¾èµ– dSYM æˆ–ç¬¦å·è¡¨\n\n\nâœ… å„æ–¹æ¡ˆå¯¹æ¯”\n\n\næ–¹æ³•\nä¼˜åŠ¿\nå±€é™\n\n\n\nbacktrace\nç®€å•æ˜“ç”¨ï¼Œå½“å‰çº¿ç¨‹è°ƒç”¨æ ˆ\nä»…å½“å‰çº¿ç¨‹ï¼Œä¿¡æ¯ä¸å®Œæ•´\n\n\nMach API + å¯„å­˜å™¨è§£æ\nå¯æ•è·ä»»æ„çº¿ç¨‹å †æ ˆ\nå®ç°å¤æ‚ï¼Œéœ€æŒ‚èµ·çº¿ç¨‹\n\n\nPLCrashReporter\nç¨³å®šå°è£…ï¼Œæ”¯æŒå´©æºƒ&#x2F;å¡é¡¿&#x2F;ç¬¦å·åŒ–\nå¢åŠ ä¾èµ–åŒ…ï¼Œå¤§å°ç•¥å¤§\n\n\n\nğŸ“Œ æ¨èå®è·µ\nå¼‚å¸¸æˆ–å¡é¡¿å‘ç”Ÿæ—¶æš‚åœä¸»çº¿ç¨‹ â†’ è·å–å¯„å­˜å™¨çŠ¶æ€ â†’ å›æº¯è°ƒç”¨é“¾\nä½¿ç”¨ç¬¬ä¸‰æ–¹åº“å¦‚ PLCrashReporter è¿›è¡Œå®‰å…¨å°è£…\næ­é…ç¬¦å·è¡¨ï¼ˆ.dSYMï¼‰è¿›è¡Œç¬¦å·åŒ–ï¼Œä»¥ä¾¿è¿œç¨‹åˆ†æ\n\n","categories":["åŸºç¡€"]},{"title":"Day9-æœ‰æ•ˆçš„æ‹¬å·","url":"/2025/05/07/Day9-%E6%9C%89%E6%95%88%E7%9A%84%E6%8B%AC%E5%8F%B7/","content":"ğŸ”— LeetCode 20 - Valid Parentheses\nğŸ“Œ é¢˜ç›®æè¿°ç»™å®šä¸€ä¸ªåªåŒ…æ‹¬ (ã€)ã€&#123;ã€&#125;ã€[ã€] çš„å­—ç¬¦ä¸²ï¼Œåˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦æœ‰æ•ˆã€‚\næœ‰æ•ˆå­—ç¬¦ä¸²éœ€æ»¡è¶³ï¼š\n\nå·¦æ‹¬å·å¿…é¡»ç”¨ç›¸åŒç±»å‹çš„å³æ‹¬å·é—­åˆã€‚\nå·¦æ‹¬å·å¿…é¡»ä»¥æ­£ç¡®çš„é¡ºåºé—­åˆã€‚\n\nç¤ºä¾‹ï¼š\nè¾“å…¥: &quot;()[]&#123;&#125;&quot;è¾“å‡º: trueè¾“å…¥: &quot;(]&quot;è¾“å‡º: false\n\n\nğŸ’¡ è§£é¢˜æ€è·¯\nä½¿ç”¨æ ˆï¼ˆstackï¼‰æ•°æ®ç»“æ„ï¼›\n\néå†å­—ç¬¦ä¸²ï¼Œé‡åˆ°å·¦æ‹¬å·å…¥æ ˆï¼›\n\né‡åˆ°å³æ‹¬å·æ—¶å¼¹å‡ºæ ˆé¡¶å…ƒç´ è¿›è¡ŒåŒ¹é…ï¼›\n\nå¦‚æœæœ€åæ ˆä¸ºç©ºï¼Œåˆ™æ˜¯æœ‰æ•ˆçš„æ‹¬å·åºåˆ—ã€‚\n\næ—¶é—´å¤æ‚åº¦ï¼šO(n)\n\nç©ºé—´å¤æ‚åº¦ï¼šO(n)\n\n\n\nâœ… JavaScript å®ç°var isValid = function(s) &#123;    const stack = [];    const map = &#123;        &#x27;)&#x27;: &#x27;(&#x27;,        &#x27;]&#x27;: &#x27;[&#x27;,        &#x27;&#125;&#x27;: &#x27;&#123;&#x27;    &#125;;    for (let c of s) &#123;        if ([&#x27;(&#x27;, &#x27;&#123;&#x27;, &#x27;[&#x27;].includes(c)) &#123;            stack.push(c);        &#125; else &#123;            if (stack.pop() !== map[c]) return false;        &#125;    &#125;    return stack.length === 0;&#125;;\n\n\nğŸ§  æ€è€ƒæ‹“å±•\nå¦‚æœåŠ å…¥å­—ç¬¦ä¸²ä¸­çš„å…¶ä»–å­—ç¬¦è¦å¦‚ä½•å¤„ç†ï¼Ÿ\nå¦‚æœæ‹¬å·åµŒå¥—å±‚æ•°éå¸¸æ·±ï¼Œæœ‰ä¼˜åŒ–ç©ºé—´å—ï¼Ÿ\n\n\n","categories":["ç®—æ³•"]},{"title":"Hello World","url":"/2025/04/21/hello-world/","content":"Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub.\nQuick StartCreate a new post$ hexo new &quot;My New Post&quot;\n\nMore info: Writing\nRun server$ hexo server\n\nMore info: Server\nGenerate static files$ hexo generate\n\nMore info: Generating\nDeploy to remote sites$ hexo deploy\n\nMore info: Deployment\n"},{"title":"å­¦ä¹ è®¡åˆ’","url":"/2025/04/23/%E5%AD%A6%E4%B9%A0%E8%AE%A1%E5%88%92/","content":"æ¯æ—¥èŠ‚å¥å»ºè®®ï¼š\nğŸ“– æŠ€æœ¯çŸ¥è¯†å­¦ä¹ ï¼š1.5h\nğŸ§± é¡¹ç›®å›é¡¾ &amp; ç³»ç»Ÿè®¾è®¡ï¼š1h\nğŸ§  ç®—æ³•è®­ç»ƒï¼š1h\nğŸ¤ é¢è¯•é¢˜æ¼”ç»ƒï¼š1h\nğŸ““ æ€»ç»“è®°å½•ï¼š0.5h\n\n\nğŸ—“ï¸ ç¬¬ 1 å‘¨ï¼šUIKitã€Blockã€Runtime\n\n\næ˜ŸæœŸ\nå­¦ä¹ å†…å®¹\n\n\n\nå‘¨ä¸€\nUIKit äº‹ä»¶ä¼ é€’æœºåˆ¶ &amp; Responder Chain\n\n\nå‘¨äºŒ\nView å¸ƒå±€æµç¨‹ï¼ˆlayoutSubviews ç­‰ï¼‰\n\n\nå‘¨ä¸‰\nBlock åˆ†ç±»ã€å˜é‡æ•è·ä¸ä½œç”¨åŸŸ\n\n\nå‘¨å››\nBlock å†…å­˜ç®¡ç† &amp; å¾ªç¯å¼•ç”¨åˆ†æ\n\n\nå‘¨äº”\nObjective-C Runtime åŸºç¡€ç»“æ„\n\n\nå‘¨å…­\nRuntime å®æˆ˜æŠ€å·§ï¼ˆSwizzlingã€æ¶ˆæ¯è½¬å‘ï¼‰\n\n\nå‘¨æ—¥\nå¤ç›˜æ€»ç»“ + è¾“å‡ºç¬”è®°ï¼ˆRuntime&#x2F;Block&#x2F;UIï¼‰\n\n\n\nğŸ—“ï¸ ç¬¬ 2 å‘¨ï¼šRunLoopã€çº¿ç¨‹ã€å†…å­˜ç®¡ç†\n\n\næ˜ŸæœŸ\nå­¦ä¹ å†…å®¹\n\n\n\nå‘¨ä¸€\nRunLoop æ„æˆä¸çº¿ç¨‹ä¿æ´»\n\n\nå‘¨äºŒ\nRunLoop å¡é¡¿ä¼˜åŒ–åœºæ™¯å®æˆ˜\n\n\nå‘¨ä¸‰\nGCD è¿›é˜¶ï¼šbarrier&#x2F;group&#x2F;target queue\n\n\nå‘¨å››\nGCD vs NSOperation æ¡†æ¶å¯¹æ¯”\n\n\nå‘¨äº”\nARC æœ¬è´¨ã€Weak å®ç°ã€å¾ªç¯å¼•ç”¨å¤„ç†\n\n\nå‘¨å…­\nå†…å­˜æ³„æ¼æ’æŸ¥ã€åƒµå°¸å¯¹è±¡ä¸ MRC å›é¡¾\n\n\nå‘¨æ—¥\næ€»ç»“è„‘å›¾ï¼šRunLoop + å¤šçº¿ç¨‹ + å†…å­˜ç®¡ç†\n\n\n\nğŸ—“ï¸ ç¬¬ 3 å‘¨ï¼šé¡¹ç›®å¤ç›˜ + ç½‘ç»œ &amp; ç¼“å­˜\n\n\næ˜ŸæœŸ\nå­¦ä¹ å†…å®¹\n\n\n\nå‘¨ä¸€\nä¸»é¡¹ç›®æ¶æ„æ¢³ç† + æ¶æ„å›¾åˆç¨¿\n\n\nå‘¨äºŒ\nNSURLSession æ–­ç‚¹ç»­ä¼  + ç½‘ç»œå°è£…\n\n\nå‘¨ä¸‰\nç½‘ç»œåº“åº•å±‚ï¼šAFNetworkingã€Alamofire\n\n\nå‘¨å››\nç¼“å­˜ç­–ç•¥ + URLProtocol æ‹¦æˆª\n\n\nå‘¨äº”\næ•°æ®æŒä¹…åŒ–æ–¹æ¡ˆï¼ˆCoreData&#x2F;SQLiteï¼‰\n\n\nå‘¨å…­\nç¦»çº¿ç¼“å­˜æ¶æ„å›¾ + å®é™…åœºæ™¯æ€»ç»“\n\n\nå‘¨æ—¥\nè¾“å‡ºï¼šé¡¹ç›®äº®ç‚¹ bullet listï¼ˆ10 æ¡ï¼‰\n\n\n\nğŸ—“ï¸ ç¬¬ 4 å‘¨ï¼šæ¶æ„æ¨¡å¼ &amp; åŠ¨æ€åŒ–æŠ€æœ¯\n\n\næ˜ŸæœŸ\nå­¦ä¹ å†…å®¹\n\n\n\nå‘¨ä¸€\nMVC&#x2F;MVVM&#x2F;VIPER&#x2F;Redux æ¨¡å¼æ€»ç»“\n\n\nå‘¨äºŒ\næ¨¡å—åŒ–è®¾è®¡ + è·¯ç”±æœºåˆ¶å®è·µ\n\n\nå‘¨ä¸‰\nè·¨ç»„ä»¶é€šä¿¡æ–¹æ¡ˆï¼ˆRouter &#x2F; URLSchemeï¼‰\n\n\nå‘¨å››\nçƒ­æ›´æ–°æ–¹æ¡ˆï¼ˆJSPatch &#x2F; Flutter &#x2F; RNï¼‰\n\n\nå‘¨äº”\nå­—èŠ‚è·³åŠ¨é«˜é¢‘æ¶æ„ç±»é¢è¯•é¢˜æ•´ç†\n\n\nå‘¨å…­\né¡¹ç›®æ¶æ„æ¼”è®²æ¨¡æ‹Ÿ\n\n\nå‘¨æ—¥\næ¶æ„å›¾æœ€ç»ˆç‰ˆ + é¡¹ç›®å¤ç›˜æ–‡æ¡£æ•´ç†\n\n\n\nğŸ—“ï¸ ç¬¬ 5 å‘¨ï¼šç³»ç»Ÿè®¾è®¡ &amp; ç®—æ³•è¿›é˜¶\n\n\næ˜ŸæœŸ\nå­¦ä¹ å†…å®¹\n\n\n\nå‘¨ä¸€\nç³»ç»Ÿè®¾è®¡é¢˜ï¼šè§†é¢‘æ’­æ”¾ App è®¾è®¡\n\n\nå‘¨äºŒ\nè§†é¢‘ç¼“å­˜ã€å¼‚å¸¸å¤„ç†æ¨¡å—\n\n\nå‘¨ä¸‰\nå›¾ç‰‡åŠ è½½ä¼˜åŒ–ï¼ˆLRU&#x2F;å¼‚æ­¥è§£ç ï¼‰\n\n\nå‘¨å››\nå¤šçº¿ç¨‹æ•°æ®ä¸€è‡´æ€§åœºæ™¯é¢˜\n\n\nå‘¨äº”\nå¯åŠ¨ä¼˜åŒ– &amp; ç™½å±ä¼˜åŒ–åœºæ™¯\n\n\nå‘¨å…­\nç®—æ³•ä¸“é¢˜ï¼šæ»‘åŠ¨çª—å£ + æœç´¢ç±»\n\n\nå‘¨æ—¥\nè¾“å‡ºç³»ç»Ÿè®¾è®¡ç­”é¢˜ç¨¿ï¼ˆé™„å›¾+è¦ç‚¹ï¼‰\n\n\n\nğŸ—“ï¸ ç¬¬ 6 å‘¨ï¼šçœŸé¢˜ç²¾ç»ƒ + æ¨¡æ‹Ÿé¢è¯•\n\n\næ˜ŸæœŸ\nå­¦ä¹ å†…å®¹\n\n\n\nå‘¨ä¸€\nå­—èŠ‚è·³åŠ¨ iOS é¢ç»æ¨¡æ‹Ÿä¸€è½®\n\n\nå‘¨äºŒ\nç®—æ³• + é¡¹ç›® + ç³»ç»Ÿè®¾è®¡è‡ªæµ‹\n\n\nå‘¨ä¸‰\né¢ç»é«˜é¢‘é¢˜å£å¤´å›ç­”è®­ç»ƒ\n\n\nå‘¨å››\nç³»ç»Ÿè®¾è®¡ + æ¡†æ¶ç±»é—®é¢˜æ¼”ç»ƒ\n\n\nå‘¨äº”\nç®—æ³•é¢è¯•é¢˜ï¼šæ‰‹å†™ç»å…¸é¢˜\n\n\nå‘¨å…­\næ¨¡æ‹Ÿé¢è¯•ï¼ˆå¯æ‰¾æœ‹å‹&#x2F;AI æ¼”ç»ƒï¼‰\n\n\nå‘¨æ—¥\næ€»ç»“é”™é¢˜ã€é¢è¯•è¡¨ç°å¤ç›˜ç¬”è®°\n\n\n\nğŸ—“ï¸ ç¬¬ 7 å‘¨ï¼šç®€å†æ‰“ç£¨ + é«˜é¢‘å›é¡¾\n\n\næ˜ŸæœŸ\nå­¦ä¹ å†…å®¹\n\n\n\nå‘¨ä¸€\nç®€å†ä¼˜åŒ– + STAR æ³•é¡¹ç›®ç²¾ç‚¼\n\n\nå‘¨äºŒ\né«˜é¢‘ iOS é¢è¯•é¢˜ Top20 æ¢³ç†\n\n\nå‘¨ä¸‰\né¡¹ç›®æ·±æŒ–å›ç­”æ¼”ç»ƒ\n\n\nå‘¨å››\nç®—æ³•æ¯æ—¥ä¸‰é¢˜ï¼ˆé“¾è¡¨&#x2F;DP&#x2F;å­—ç¬¦ä¸²ï¼‰\n\n\nå‘¨äº”\nçªç ´çŸ¥è¯†çŸ­æ¿æ¨¡å—\n\n\nå‘¨å…­\nå½•åˆ¶é¡¹ç›®è®²è§£ or æŠ€æœ¯è®²æ¼”è§†é¢‘\n\n\nå‘¨æ—¥\næ€»ç»“ç­”é¢˜è¯æœ¯æ–‡æ¡£ &amp; PPT èµ„æ–™\n\n\n\nğŸ—“ï¸ ç¬¬ 8 å‘¨ï¼šå†²åˆº &amp; æ¨¡æ‹Ÿæ¼”ç»ƒ\n\n\næ˜ŸæœŸ\nå­¦ä¹ å†…å®¹\n\n\n\nå‘¨ä¸€\nå¿«é€Ÿè¿‡ä¸€éé¢è¯• 50 é—®\n\n\nå‘¨äºŒ\næ¨¡æ‹Ÿå®Œæ•´é¡¹ç›®ç­”è¾©æ¼”è®²\n\n\nå‘¨ä¸‰\né«˜é¢‘ç®—æ³•åˆ·é¢˜ï¼ˆ6 é¢˜å†²åˆºï¼‰\n\n\nå‘¨å››\næ¨¡æ‹Ÿå®Œæ•´é¢è¯•ï¼ˆå…¨æµç¨‹ï¼‰\n\n\nå‘¨äº”\næ€»ç»“æ‰€æœ‰ç¬”è®° + ç²¾é€‰ç­”é¢˜å¡\n\n\nå‘¨å…­\nå¿ƒæ€è°ƒæ•´ &amp; å‡†å¤‡ç¯å¢ƒ\n\n\nå‘¨æ—¥\næ­£å¼é¢è¯• day ğŸš€ï¼ˆæˆ–ä¼‘æ¯å¤‡æˆ˜ï¼‰\n\n\n\n"},{"title":"é¿å…è§†å›¾ç»˜åˆ¶æ‰å¸§","url":"/2025/05/07/%E9%81%BF%E5%85%8D%E8%A7%86%E5%9B%BE%E7%BB%98%E5%88%B6%E6%8E%89%E5%B8%A7/","content":"å›¾åƒæ˜¾ç¤ºåŸç†iOS å›¾åƒæ˜¾ç¤ºçš„åŸç†æ¶‰åŠå¤šä¸ªå±‚æ¬¡ï¼Œä»åº•å±‚çš„ç¡¬ä»¶åŠ é€Ÿåˆ°ä¸Šå±‚çš„æ¡†æ¶å®ç°ã€‚UIKit æä¾›äº†é«˜å±‚æ¬¡çš„ APIï¼Œç”¨äºç®¡ç†åº”ç”¨çš„ç”¨æˆ·ç•Œé¢å…ƒç´ ï¼ŒåŒ…æ‹¬è§†å›¾ã€æ§ä»¶å’Œå›¾åƒæ˜¾ç¤ºã€‚UIImageView æ˜¯ UIKit ä¸­ç”¨äºæ˜¾ç¤ºå›¾åƒçš„ä¸»è¦ç±»ã€‚Core Graphics (ä¹Ÿç§°ä¸º Quartz) æ˜¯ iOS çš„ 2D ç»˜å›¾å¼•æ“ã€‚å®ƒç›´æ¥ä¸ç¡¬ä»¶äº¤äº’ï¼Œè´Ÿè´£å›¾å½¢çš„ç»˜åˆ¶å’Œå¤„ç†ã€‚UIKit çš„è®¸å¤šç»˜å›¾æ“ä½œæœ€ç»ˆéƒ½é€šè¿‡ Core Graphics å®ç°ã€‚Core Animation æ˜¯ iOS ç”¨æ¥å¤„ç†åŠ¨ç”»å’Œå›¾åƒæ¸²æŸ“çš„æ¡†æ¶ã€‚æ¯ä¸ª UIView éƒ½æœ‰ä¸€ä¸ªå…³è”çš„ CALayerï¼Œç”¨äºå¤„ç†å›¾åƒå’Œå†…å®¹çš„æ¸²æŸ“ã€‚Core Animation è´Ÿè´£å°†è¿™äº›å›¾å±‚çš„å†…å®¹æäº¤åˆ°å±å¹•ä¸Šï¼Œå¹¶å¤„ç†å›¾å±‚ä¹‹é—´çš„åŠ¨ç”»ã€‚\niOS ä½¿ç”¨ OpenGL ES æˆ– Metal ä½œä¸ºåº•å±‚å›¾å½¢æ¸²æŸ“ç®¡çº¿ã€‚UIKit å’Œ Core Animation ä¼šå°†å›¾åƒã€è§†å›¾å’ŒåŠ¨ç”»è½¬æ¢ä¸º GPU å¯ç†è§£çš„å‘½ä»¤ï¼Œå¹¶é€šè¿‡ OpenGL ES æˆ– Metal æ¸²æŸ“åˆ°å±å¹•ä¸Šã€‚\nå½“ä½ ä½¿ç”¨ UIImageView æ¥æ˜¾ç¤ºå›¾åƒæ—¶ï¼Œä»¥ä¸‹æ­¥éª¤ä¼šå‘ç”Ÿï¼š\n\nåŠ è½½å›¾åƒï¼šUIImage ç±»ç”¨äºåŠ è½½å›¾åƒèµ„æºã€‚ä½ å¯ä»¥ä»æ–‡ä»¶ç³»ç»Ÿã€ç½‘ç»œã€æˆ–èµ„æºåŒ…ä¸­åŠ è½½å›¾åƒã€‚\nè®¾ç½®å›¾åƒï¼šå°† UIImage å¯¹è±¡åˆ†é…ç»™ UIImageView çš„ image å±æ€§ã€‚\nå›¾å±‚æ˜¾ç¤ºï¼šUIImageView æ˜¯ä¸€ä¸ª UIView å­ç±»ï¼Œå› æ­¤å®ƒæœ‰ä¸€ä¸ªå…³è”çš„ CALayerã€‚UIImageView ä¼šå°†å›¾åƒè®¾ç½®ä¸ºå…¶å›¾å±‚çš„ contentsã€‚\næ¸²æŸ“å›¾åƒï¼šCore Animation å°†è´Ÿè´£å°† CALayer çš„å†…å®¹æäº¤åˆ° GPU è¿›è¡Œæ¸²æŸ“ï¼Œæœ€åæ˜¾ç¤ºåœ¨å±å¹•ä¸Šã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œå±•ç¤ºå¦‚ä½•åœ¨ iOS ä¸­ä½¿ç”¨ UIImageView æ¥æ˜¾ç¤ºå›¾åƒã€‚\n\nimport UIKitclass ViewController: UIViewController &#123;    override func viewDidLoad() &#123;        super.viewDidLoad()                // åˆ›å»º UIImage å¯¹è±¡        if let image = UIImage(named: &quot;example.jpg&quot;) &#123;                        // åˆ›å»º UIImageView å¯¹è±¡            let imageView = UIImageView(image: image)                        // è®¾ç½® UIImageView çš„å¤§å°å’Œä½ç½®            imageView.frame = CGRect(x: 50, y: 100, width: 200, height: 200)                        // è®¾ç½®å†…å®¹æ¨¡å¼            imageView.contentMode = .scaleAspectFill                        // å°† UIImageView æ·»åŠ åˆ°è§†å›¾ä¸­            self.view.addSubview(imageView)        &#125;    &#125;&#125;\niOS ä¼šè‡ªåŠ¨ç¼“å­˜ UIImage å¯¹è±¡ï¼Œä»¥æé«˜æ€§èƒ½å¹¶å‡å°‘å†…å­˜æ¶ˆè€—ã€‚UIImageView ä½¿ç”¨çš„å›¾åƒå¯ä»¥é€šè¿‡ç³»ç»Ÿçš„å›¾åƒç¼“å­˜æœºåˆ¶ä¼˜åŒ–ã€‚\nå¯¹äºå¤§å›¾åƒï¼Œæœ€å¥½ä½¿ç”¨åˆ†å—åŠ è½½æˆ–ç¼©ç•¥å›¾æ˜¾ç¤ºä»¥å‡å°‘å†…å­˜å ç”¨ã€‚å¯ä»¥ä½¿ç”¨ CGImageSource æ¥é€æ­¥åŠ è½½å›¾åƒã€‚\nä¸¾ä¸ªä¾‹å­ï¼š\nimport SwiftUIstruct ThumbnailImageView: View &#123;    let thumbnailImage: UIImage    let fullSizeImageURL: URL        @State private var fullSizeImage: UIImage? = nil    var body: some View &#123;        ZStack &#123;            if let fullSizeImage = fullSizeImage &#123;                Image(uiImage: fullSizeImage)                    .resizable()                    .scaledToFit()            &#125; else &#123;                Image(uiImage: thumbnailImage)                    .resizable()                    .scaledToFit()                    .onAppear(perform: loadFullSizeImage)            &#125;        &#125;    &#125;    private func loadFullSizeImage() &#123;        DispatchQueue.global().async &#123;            if let data = try? Data(contentsOf: fullSizeImageURL),               let image = UIImage(data: data) &#123;                DispatchQueue.main.async &#123;                    self.fullSizeImage = image                &#125;            &#125;        &#125;    &#125;&#125;\nåœ¨åŠ è½½å¤§å›¾æ—¶ä½¿ç”¨ CGImageSource é€æ­¥è§£ç å›¾ç‰‡ï¼Œåœ¨ä½åˆ†è¾¨ç‡æ—¶å‡å°‘å†…å­˜å ç”¨ã€‚\nimport UIKitfunc loadImageWithLowMemoryUsage(url: URL) -&gt; UIImage? &#123;    guard let source = CGImageSourceCreateWithURL(url as CFURL, nil) else &#123;        return nil    &#125;        let options: [NSString: Any] = [        kCGImageSourceShouldCache: false, // é¿å…ç›´æ¥ç¼“å­˜åˆ°å†…å­˜        kCGImageSourceShouldAllowFloat: true    ]        return CGImageSourceCreateImageAtIndex(source, 0, options as CFDictionary).flatMap &#123;        UIImage(cgImage: $0)    &#125;&#125;\nå¦‚æœå›¾åƒéœ€è¦ä»ç½‘ç»œåŠ è½½ï¼Œå»ºè®®ä½¿ç”¨å¼‚æ­¥åŠ è½½æ¥é¿å…é˜»å¡ä¸»çº¿ç¨‹ã€‚å¯ä»¥ç»“åˆä½¿ç”¨ URLSession æˆ–ç¬¬ä¸‰æ–¹åº“å¦‚ SDWebImage æ¥å®ç°ã€‚\nå¦‚æœä½ éœ€è¦è‡ªå®šä¹‰å›¾åƒæ˜¾ç¤ºæˆ–è¿›è¡Œå¤æ‚çš„å›¾å½¢å¤„ç†ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ Core Graphicsã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨ Core Graphics ç»˜åˆ¶å›¾åƒçš„ä¾‹å­ï¼š\nimport UIKitclass CustomView: UIView &#123;    override func draw(_ rect: CGRect) &#123;        guard let context = UIGraphicsGetCurrentContext() else &#123; return &#125;        // è®¾ç½®å¡«å……é¢œè‰²        context.setFillColor(UIColor.red.cgColor)        context.fill(rect)                // åŠ è½½å›¾ç‰‡        if let image = UIImage(named: &quot;example.jpg&quot;)?.cgImage &#123;            context.draw(image, in: rect)        &#125;    &#125;&#125;class ViewController: UIViewController &#123;    override func viewDidLoad() &#123;        super.viewDidLoad()                let customView = CustomView(frame: self.view.bounds)        self.view.addSubview(customView)    &#125;&#125;\nCPU å’Œ GPU åˆ†åˆ«åšäº†ä»€ä¹ˆCPU åšçš„äº‹æƒ…ï¼š\n\nè§†å›¾å±‚æ¬¡ç»“æ„çš„è®¡ç®—ï¼ˆView Hierarchy Calculationï¼‰ï¼š CPU è´Ÿè´£è®¡ç®—è§†å›¾çš„å±‚æ¬¡ç»“æ„ï¼ŒåŒ…æ‹¬è§†å›¾çš„ä½ç½®ã€å°ºå¯¸ã€é€æ˜åº¦å’Œå…¶ä»–å±æ€§ã€‚æ¯å½“è§†å›¾çš„è¿™äº›å±æ€§å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒCPU ä¼šé‡æ–°è®¡ç®—è¿™äº›ä¿¡æ¯ã€‚\nå¸ƒå±€ï¼ˆLayoutï¼‰ï¼š å½“ä½¿ç”¨ Auto Layout æˆ–æ‰‹åŠ¨å¸ƒå±€æ—¶ï¼ŒCPU ä¼šè®¡ç®—æ‰€æœ‰è§†å›¾çš„ä½ç½®å’Œå°ºå¯¸ã€‚æ¯”å¦‚è°ƒç”¨ layoutSubviews() æ–¹æ³•æ—¶ï¼ŒCPU ä¼šå‚ä¸å¸ƒå±€è®¡ç®—ã€‚\næ–‡æœ¬ç»˜åˆ¶ï¼ˆText Renderingï¼‰ï¼š å¦‚æœä½ åœ¨è§†å›¾ä¸­ç»˜åˆ¶æ–‡æœ¬ï¼Œæ¯”å¦‚ä½¿ç”¨ UILabel æˆ– CATextLayerï¼ŒCPU ä¼šè´Ÿè´£å¯¹æ–‡æœ¬è¿›è¡Œæ’ç‰ˆå’Œç»˜åˆ¶ã€‚\nå›¾åƒè§£ç ï¼ˆImage Decodingï¼‰ï¼š ä»ç½‘ç»œæˆ–ç£ç›˜åŠ è½½çš„å›¾åƒé€šå¸¸æ˜¯ç»è¿‡å‹ç¼©çš„æ ¼å¼ï¼ˆå¦‚ PNGã€JPEGï¼‰ã€‚CPU è´Ÿè´£å°†è¿™äº›å›¾åƒè§£ç ä¸ºå¯ä¾› GPU ä½¿ç”¨çš„åŸå§‹ä½å›¾æ ¼å¼ã€‚\nCore Graphics ç»˜åˆ¶ï¼ˆCore Graphics Drawingï¼‰ï¼š ä½¿ç”¨ CGContext è¿›è¡Œçš„æ‰€æœ‰ç»˜åˆ¶æ“ä½œï¼ˆå¦‚ç»˜åˆ¶è·¯å¾„ã€å¡«å……é¢œè‰²ç­‰ï¼‰éƒ½æ˜¯åœ¨ CPU ä¸Šæ‰§è¡Œçš„ã€‚\n\nä»£ç ç¤ºä¾‹\nclass CustomView: UIView &#123;    override func layoutSubviews() &#123;        super.layoutSubviews()        // CPU è´Ÿè´£å¸ƒå±€è®¡ç®—        let subview = UIView(frame: CGRect(x: 10, y: 10, width: 100, height: 50))        addSubview(subview)    &#125;    override func draw(_ rect: CGRect) &#123;        super.draw(rect)        // CPU è´Ÿè´£æ–‡æœ¬ç»˜åˆ¶        let text = &quot;Hello, World!&quot;        let attributes: [NSAttributedString.Key: Any] = [            .font: UIFont.systemFont(ofSize: 16),            .foregroundColor: UIColor.black        ]        text.draw(in: rect, withAttributes: attributes)    &#125;&#125;\nGPU åšçš„äº‹æƒ…ï¼š\n\nå›¾å±‚åˆæˆï¼ˆLayer Compositionï¼‰ï¼š GPU è´Ÿè´£å°†å„ä¸ªå›¾å±‚ï¼ˆå¦‚ UIView æˆ– CALayerï¼‰è¿›è¡Œåˆæˆå’Œæ¸²æŸ“ã€‚æ¯ä¸ªè§†å›¾æˆ–å›¾å±‚éƒ½ä¼šè¢«è½¬æ¢ä¸ºä¸€ä¸ªçº¹ç†ï¼ŒGPU ä¼šå°†è¿™äº›çº¹ç†ç»„åˆåˆ°æœ€ç»ˆçš„å¸§ç¼“å†²åŒºä¸­ã€‚\nå›¾åƒæ¸²æŸ“ï¼ˆImage Renderingï¼‰ï¼š GPU è´Ÿè´£æ¸²æŸ“å·²ç»ç”± CPU è§£ç çš„å›¾åƒä½å›¾ã€‚å®ƒè¿˜è´Ÿè´£å¤„ç†å„ç§å›¾åƒç‰¹æ•ˆï¼Œå¦‚æ¨¡ç³Šã€é˜´å½±ã€é€æ˜åº¦ç­‰ã€‚\nåŠ¨ç”»å¤„ç†ï¼ˆAnimations Handlingï¼‰ï¼š iOS ä¸­çš„å¤§å¤šæ•°åŠ¨ç”»ï¼ˆå¦‚ UIView åŠ¨ç”»å’Œ Core Animationï¼‰éƒ½æ˜¯åœ¨ GPU ä¸Šæ‰§è¡Œçš„ã€‚GPU è´Ÿè´£å¤„ç†åŠ¨ç”»çš„ä¸­é—´å¸§æ¸²æŸ“ã€‚\nOpenGL&#x2F;Metal ç»˜åˆ¶ï¼š å½“ä½¿ç”¨ OpenGL ES æˆ– Metal ç›´æ¥è¿›è¡Œå›¾å½¢ç»˜åˆ¶æ—¶ï¼ŒGPU ä¼šè´Ÿè´£æ‰§è¡Œè¿™äº›ç»˜åˆ¶å‘½ä»¤ã€‚\n\nUIView.animate(withDuration: 1.0) &#123;    self.view.alpha = 0.5    // è¿™æ®µä»£ç çš„åŠ¨ç”»æ¸²æŸ“ç”± GPU å¤„ç†&#125;\né€šå¸¸ï¼ŒCPU è´Ÿè´£å‡†å¤‡æ•°æ®ï¼ŒGPU è´Ÿè´£æ¸²æŸ“è¿™äº›æ•°æ®ã€‚ä¸ºäº†ä¼˜åŒ–æ€§èƒ½ï¼Œæˆ‘ä»¬åº”è¯¥å°½é‡å‡å°‘ CPU çš„è´Ÿæ‹…ï¼Œå‡å°‘å¤æ‚çš„å¸ƒå±€è®¡ç®—ã€é¿å…é¢‘ç¹çš„è§†å›¾å±‚æ¬¡å˜æ›´ï¼Œä»¥åŠå°½é‡å»¶è¿Ÿå›¾åƒè§£ç ç­‰æ“ä½œã€‚\nä¼˜åŒ–å»ºè®®ï¼š\n\nå°½é‡ç®€åŒ–è§†å›¾å±‚æ¬¡ç»“æ„ï¼š è¿‡å¤šçš„å­è§†å›¾ä¼šå¢åŠ  CPU çš„è®¡ç®—è´Ÿæ‹…ã€‚\nå‡å°‘è¿‡åº¦çš„é‡ç»˜ï¼š å°½é‡é¿å…é¢‘ç¹è°ƒç”¨ setNeedsDisplay æˆ– layoutSubviewsã€‚\nä½¿ç”¨å¼‚æ­¥å›¾åƒåŠ è½½å’Œè§£ç ï¼š é¿å…åœ¨ä¸»çº¿ç¨‹ä¸Šè¿›è¡Œå›¾åƒè§£ç ï¼Œä»¥å‡è½» CPU çš„è´Ÿæ‹…ã€‚\nåˆç†ä½¿ç”¨å›¾åƒç¼“å­˜ï¼š å°½é‡ä½¿ç”¨é€‚åˆå°ºå¯¸çš„å›¾ç‰‡ï¼Œé¿å… GPU å¤„ç†è¿‡å¤§å›¾åƒå¸¦æ¥çš„é¢å¤–å¼€é”€ã€‚\n\nUIView çš„ç»˜åˆ¶åŸç†UIView æ˜¯æ‰€æœ‰ç”¨æˆ·ç•Œé¢å…ƒç´ çš„åŸºç¡€ã€‚æ¯ä¸ª UIView å¯¹è±¡éƒ½è´Ÿè´£æ˜¾ç¤ºå†…å®¹ï¼Œå¹¶å“åº”ç”¨æˆ·è¾“å…¥ã€‚UIView çš„ç»˜åˆ¶è¿‡ç¨‹æ¶‰åŠå¤šä¸ªæ­¥éª¤ï¼Œä»å±‚çº§è§†å›¾ç³»ç»Ÿåˆ° Core Graphics å’Œ Core Animationã€‚\nUIView æ˜¯åŸºäºå±‚æ¬¡ç»“æ„çš„ï¼Œæ¯ä¸ª UIView éƒ½å¯ä»¥æœ‰å¤šä¸ªå­è§†å›¾ (subviews)ã€‚æ‰€æœ‰çš„è§†å›¾éƒ½ç”±ä¸€ä¸ªæ ¹è§†å›¾ (root view) ç®¡ç†ï¼Œé€šå¸¸æ˜¯ UIViewController çš„ view å±æ€§ã€‚\nç»˜åˆ¶æµç¨‹ï¼š\n\nå½“éœ€è¦æ›´æ–°ç•Œé¢æ—¶ï¼ˆå¦‚å±å¹•é¦–æ¬¡æ¸²æŸ“ã€è§†å›¾å†…å®¹æ›´æ–°ã€è§†å›¾å¤§å°å˜åŒ–ç­‰ï¼‰ï¼Œç³»ç»Ÿä¼šè§¦å‘è§†å›¾çš„ç»˜åˆ¶è¿‡ç¨‹ã€‚\nç³»ç»Ÿè°ƒç”¨è§†å›¾çš„ setNeedsDisplay æˆ– setNeedsLayout æ–¹æ³•æ ‡è®°è§†å›¾ä¸ºâ€œéœ€è¦æ›´æ–°â€çŠ¶æ€ã€‚\nç³»ç»Ÿåœ¨ä¸‹ä¸€ä¸ªè¿è¡Œå¾ªç¯ä¸­è°ƒç”¨ drawRect: æ–¹æ³•ç»˜åˆ¶è§†å›¾ã€‚\n\nUIView çš„ç»˜åˆ¶æ˜¯é€šè¿‡ Core Graphics æ¥å®Œæˆçš„ã€‚Core Graphics æ˜¯ä¸€ä¸ª 2D ç»˜å›¾å¼•æ“ï¼Œå¯ä»¥è¿›è¡Œå›¾å½¢ç»˜åˆ¶ã€å›¾åƒå¤„ç†ç­‰ã€‚Core Animation è´Ÿè´£å°† UIView çš„å†…å®¹æ˜¾ç¤ºåœ¨å±å¹•ä¸Šã€‚å®ƒå°†æ‰€æœ‰çš„ç»˜åˆ¶æ“ä½œä½œä¸ºåŠ¨ç”»å›¾å±‚ (CALayer&#96;) çš„æ›´æ–°å¹¶è¿›è¡Œåˆæˆï¼Œæœ€åå‘ˆç°ç»™ç”¨æˆ·ã€‚\nUIView ç»˜åˆ¶æµç¨‹çš„å…³é”®æ­¥éª¤ï¼š\n\nsetNeedsDisplay å’Œ setNeedsLayoutï¼š\nsetNeedsDisplayï¼šæ ‡è®°è§†å›¾ä¸ºéœ€è¦é‡ç»˜ï¼Œä¼šåœ¨ä¸‹ä¸€æ¬¡å±å¹•åˆ·æ–°æ—¶è°ƒç”¨ drawRect: æ–¹æ³•ã€‚\nsetNeedsLayoutï¼šæ ‡è®°è§†å›¾éœ€è¦é‡æ–°å¸ƒå±€ï¼Œä¼šåœ¨ä¸‹ä¸€æ¬¡å¸ƒå±€å‘¨æœŸè°ƒç”¨ layoutSubviews æ–¹æ³•ã€‚\n\n\ndrawRect:ï¼š\ndrawRect: æ–¹æ³•æ˜¯ UIView è‡ªå®šä¹‰ç»˜åˆ¶çš„å…¥å£ã€‚åœ¨è¿™é‡Œï¼Œå¯ä»¥ä½¿ç”¨ Core Graphics è¿›è¡Œå›¾å½¢ç»˜åˆ¶ã€‚\n\n\n\nä»¥ä¸‹æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰ UIView çš„ç¤ºä¾‹ï¼Œå®ƒåœ¨å±å¹•ä¸Šç»˜åˆ¶ä¸€ä¸ªç®€å•çš„çŸ©å½¢ï¼š\nimport UIKitclass CustomView: UIView &#123;        // ä»…åœ¨åˆå§‹åŒ–æ—¶è°ƒç”¨ä¸€æ¬¡    override init(frame: CGRect) &#123;        super.init(frame: frame)        // è®¾ç½®è§†å›¾çš„ä¸€äº›å±æ€§ï¼Œä¾‹å¦‚èƒŒæ™¯é¢œè‰²        self.backgroundColor = UIColor.white    &#125;        required init?(coder: NSCoder) &#123;        super.init(coder: coder)    &#125;        // é‡å†™ drawRect: æ–¹æ³•æ¥æ‰§è¡Œè‡ªå®šä¹‰ç»˜åˆ¶ã€‚ä½¿ç”¨ Core Graphics API æ¥ç»˜åˆ¶ä¸€ä¸ªè“è‰²çš„çŸ©å½¢ã€‚    override func draw(_ rect: CGRect) &#123;        super.draw(rect)                // è·å–å½“å‰çš„ç»˜å›¾ä¸Šä¸‹æ–‡ï¼Œè¿™æ˜¯ä¸€ä¸ª Core Graphics çš„ `CGContext` å¯¹è±¡ï¼Œå®ƒä»£è¡¨ç€ä¸€ä¸ªç»˜åˆ¶ç¯å¢ƒã€‚        guard let context = UIGraphicsGetCurrentContext() else &#123; return &#125;                // è®¾ç½®å¡«å……é¢œè‰²        context.setFillColor(UIColor.blue.cgColor)                // åˆ›å»ºä¸€ä¸ªçŸ©å½¢        let rectangle = CGRect(x: 50, y: 50, width: 200, height: 100)                // åœ¨ä¸Šä¸‹æ–‡ä¸­ç»˜åˆ¶çŸ©å½¢        context.addRect(rectangle)        context.drawPath(using: .fill)    &#125;&#125;// ä½¿ç”¨è‡ªå®šä¹‰è§†å›¾class ViewController: UIViewController &#123;        override func viewDidLoad() &#123;        super.viewDidLoad()                // åˆ›å»ºå¹¶æ·»åŠ è‡ªå®šä¹‰è§†å›¾        let customView = CustomView(frame: CGRect(x: 0, y: 0, width: 300, height: 300))        self.view.addSubview(customView)    &#125;&#125;\nUIView çš„ç»˜åˆ¶åŸç†æ ¸å¿ƒæ˜¯åŸºäº Core Graphics å’Œ Core Animationï¼Œé€šè¿‡ drawRect: æ–¹æ³•è¿›è¡Œè‡ªå®šä¹‰ç»˜åˆ¶ã€‚è¿™ä¸ªè¿‡ç¨‹æ¶‰åŠåˆ°å¤šä¸ªæ­¥éª¤ï¼ŒåŒ…æ‹¬è§†å›¾å±‚æ¬¡ç»“æ„ã€ç»˜åˆ¶æµç¨‹ã€ä¸Šä¸‹æ–‡è·å–ï¼Œä»¥åŠæœ€ç»ˆçš„å†…å®¹åˆæˆå¹¶å‘ˆç°ç»™ç”¨æˆ·ã€‚åœ¨å®é™…å¼€å‘ä¸­ï¼Œè‡ªå®šä¹‰ç»˜åˆ¶çš„ UIView å¾€å¾€ç”¨äºå®ç°ç‰¹æ®Šçš„å›¾å½¢æ•ˆæœæˆ–è‡ªå®šä¹‰ UI æ§ä»¶ã€‚\nå¼‚æ­¥ç»˜åˆ¶å¼‚æ­¥ç»˜åˆ¶ä¸»è¦æŒ‡çš„æ˜¯åœ¨åå°çº¿ç¨‹ä¸­å¤„ç†ç»˜åˆ¶æ“ä½œï¼Œä»¥é¿å…é˜»å¡ä¸»çº¿ç¨‹ã€‚Core Graphics å’Œ UIKit æä¾›äº†æ”¯æŒå¼‚æ­¥ç»˜åˆ¶çš„åŠŸèƒ½ã€‚\nä½¿ç”¨ Core Graphics çš„å¼‚æ­¥ç»˜åˆ¶ã€‚ä½¿ç”¨ UIGraphicsBeginImageContextWithOptions å‡½æ•°åœ¨åå°çº¿ç¨‹ä¸­åˆ›å»ºä¸€ä¸ª CGContextã€‚ä½¿ç”¨ GCD æˆ– NSOperationQueue æ¥åœ¨åå°çº¿ç¨‹ä¸­è¿›è¡Œç»˜åˆ¶æ“ä½œã€‚å®Œæˆç»˜åˆ¶åï¼Œå°†ç»“æœè¿”å›ä¸»çº¿ç¨‹ä»¥æ›´æ–° UIã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªå¼‚æ­¥ç»˜åˆ¶çš„ç¤ºä¾‹ä»£ç ï¼š\nimport UIKitclass AsyncDrawingView: UIView &#123;        private var asyncImage: UIImage?        override func draw(_ rect: CGRect) &#123;        super.draw(rect)                // å¦‚æœæœ‰å¼‚æ­¥ç»˜åˆ¶çš„å›¾ç‰‡ï¼Œç›´æ¥ç»˜åˆ¶å®ƒ        asyncImage?.draw(in: rect)    &#125;        func drawAsync() &#123;        Task &#123;            // åˆ›å»ºå›¾å½¢ä¸Šä¸‹æ–‡            let size = self.bounds.size            UIGraphicsBeginImageContextWithOptions(size, false, 0.0)            guard let context = UIGraphicsGetCurrentContext() else &#123; return &#125;                        // è¿›è¡Œç»˜åˆ¶æ“ä½œ            context.setFillColor(UIColor.blue.cgColor)            context.fill(CGRect(x: 0, y: 0, width: size.width, height: size.height))                        // è·å–ç»˜åˆ¶ç»“æœ            let image = UIGraphicsGetImageFromCurrentImageContext()            UIGraphicsEndImageContext()                        // æ›´æ–° UIï¼Œå›åˆ°ä¸»çº¿ç¨‹            await MainActor.run &#123;                self.asyncImage = image                self.setNeedsDisplay() // è§¦å‘ draw(_:) æ–¹æ³•é‡æ–°ç»˜åˆ¶            &#125;        &#125;    &#125;&#125;\nä½¿ç”¨ UIKit çš„å¼‚æ­¥ç»˜åˆ¶\nå¯¹äºå¤æ‚çš„å¼‚æ­¥ç»˜åˆ¶ï¼Œç‰¹åˆ«æ˜¯æ¶‰åŠ UIView çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥è€ƒè™‘è¿™ä¸¤ä¸ªæ–¹æ³•ã€‚é¦–å…ˆæ˜¯è‡ªå®šä¹‰ CALayer å¹¶å®ç°å…¶ draw(in:) æ–¹æ³•æ¥è¿›è¡Œå¼‚æ­¥ç»˜åˆ¶ã€‚å…¶æ¬¡æ˜¯ä½¿ç”¨ UIView çš„ draw(:) æ–¹æ³•ï¼Œåœ¨å­ç±»ä¸­é‡å†™ draw(:) æ–¹æ³•ï¼Œå¹¶ç»“åˆå¼‚æ­¥æ“ä½œæ¥æ›´æ–°ç»˜åˆ¶å†…å®¹ã€‚\nimport UIKitclass AsyncDrawingLayer: CALayer &#123;        override func draw(in ctx: CGContext) &#123;        super.draw(in: ctx)                Task &#123;            // åœ¨å­çº¿ç¨‹ä¸­æ‰§è¡Œç»˜åˆ¶æ“ä½œ            await withCheckedContinuation &#123; continuation in                Task.detached &#123;                    // æ‰§è¡Œç»˜åˆ¶æ“ä½œ                    ctx.setFillColor(UIColor.red.cgColor)                    ctx.fill(self.bounds)                                        // å®Œæˆç»˜åˆ¶æ“ä½œåç»§ç»­                    continuation.resume()                &#125;            &#125;                        // å›åˆ°ä¸»çº¿ç¨‹æ›´æ–° UI            await MainActor.run &#123;                self.setNeedsDisplay() // è§¦å‘ draw(in:) é‡æ–°ç»˜åˆ¶            &#125;        &#125;    &#125;&#125;\nç¦»å±æ¸²æŸ“ç¦»å±æ¸²æŸ“ï¼ˆOffscreen Renderingï¼‰åœ¨ iOS ä¸­æ˜¯æŒ‡åœ¨æ˜¾ç¤ºå™¨æ˜¾ç¤ºå†…å®¹ä¹‹å‰ï¼Œå…ˆåœ¨å†…å­˜ä¸­å®Œæˆæ¸²æŸ“ã€‚è¿™ç§æ–¹å¼çš„ä¸»è¦ä»£ä»·ä½“ç°åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š\n\nå†…å­˜æ¶ˆè€—ï¼šç¦»å±æ¸²æŸ“ä¼šå ç”¨é¢å¤–çš„å†…å­˜ï¼Œå› ä¸ºæ¯æ¬¡æ¸²æŸ“éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å›¾åƒç¼“å†²åŒºï¼ˆå³ç¦»å±ç¼“å­˜ï¼‰ã€‚è¿™äº›ç¼“å­˜å¯èƒ½ä¼šè¿…é€Ÿæ¶ˆè€—å¤§é‡å†…å­˜ï¼Œç‰¹åˆ«æ˜¯å¯¹äºå¤æ‚çš„è§†å›¾æˆ–é«˜åˆ†è¾¨ç‡çš„å›¾åƒã€‚\nå¤„ç†æ—¶é—´ï¼šè¿›è¡Œç¦»å±æ¸²æŸ“æ—¶ï¼ŒCPU å’Œ GPU éœ€è¦é¢å¤–çš„æ—¶é—´æ¥å¤„ç†æ¸²æŸ“æ“ä½œã€‚è¿™å¯èƒ½ä¼šå¯¼è‡´æ¸²æŸ“æ—¶é—´å¢åŠ ï¼Œå½±å“åˆ°åº”ç”¨çš„æµç•…æ€§ã€‚\nä¸Šä¸‹æ–‡åˆ‡æ¢ï¼šç¦»å±æ¸²æŸ“éœ€è¦å°†æ¸²æŸ“æ“ä½œä»ä¸»çº¿ç¨‹è½¬ç§»åˆ°åå°çº¿ç¨‹æˆ–é¢å¤–çš„å›¾å½¢ä¸Šä¸‹æ–‡ï¼Œè¿™å¢åŠ äº†ä¸Šä¸‹æ–‡åˆ‡æ¢çš„å¼€é”€ã€‚\nç»˜åˆ¶æ¬¡æ•°ï¼šæ¯æ¬¡éœ€è¦é‡æ–°ç»˜åˆ¶æ—¶ï¼ˆä¾‹å¦‚è§†å›¾çš„å†…å®¹æ›´æ–°ï¼‰ï¼Œéƒ½éœ€è¦æ‰§è¡Œç¦»å±æ¸²æŸ“ï¼Œè¿™å¯èƒ½å¯¼è‡´é¢‘ç¹çš„æ¸²æŸ“æ“ä½œï¼Œä»è€Œå½±å“æ€§èƒ½ã€‚\n\näº§ç”Ÿç¦»å±æ¸²æŸ“çš„å¸¸è§åŸå› æœ‰ï¼š\n\nåœ†è§’ï¼ˆCorner Radiusï¼‰ï¼šå¦‚æœåœ¨è§†å›¾æˆ–å›¾å±‚ä¸Šåº”ç”¨åœ†è§’æ•ˆæœï¼ŒiOS éœ€è¦åœ¨ç¦»å±ç¼“å­˜ä¸­å®Œæˆè¿™äº›æ“ä½œï¼Œå°¤å…¶æ˜¯å½“åœ†è§’åŠå¾„è¾ƒå¤§æ—¶ã€‚\né˜´å½±ï¼ˆShadowï¼‰ï¼šé˜´å½±æ•ˆæœé€šå¸¸éœ€è¦ç¦»å±æ¸²æŸ“ï¼Œå› ä¸ºé˜´å½±éœ€è¦åœ¨åŸå§‹è§†å›¾ä¹‹å¤–çš„åŒºåŸŸè¿›è¡Œå¤„ç†ã€‚\né€æ˜åº¦ï¼ˆOpacityï¼‰ï¼šå¯¹äºåŠé€æ˜çš„è§†å›¾æˆ–å›¾å±‚ï¼ŒiOS éœ€è¦è¿›è¡Œç¦»å±æ¸²æŸ“ä»¥æ­£ç¡®å¤„ç†æ··åˆæ•ˆæœã€‚\nå¤æ‚çš„å›¾å½¢æ“ä½œï¼šæ¯”å¦‚è·¯å¾„ï¼ˆUIBezierPathï¼‰çš„å¤æ‚ç»˜åˆ¶ï¼Œä¹Ÿå¯èƒ½å¯¼è‡´ç¦»å±æ¸²æŸ“ã€‚\n\né¿å…ç¦»å±æ¸²æŸ“çš„ä¼˜åŒ–ã€‚å¦‚æœè§†å›¾çš„å†…å®¹ä¸ä¼šé¢‘ç¹å˜åŒ–ï¼Œå¯ä»¥å°†è§†å›¾æ¸²æŸ“åˆ° layer.contents ä¸­ï¼Œä»è€Œé¿å…æ¯æ¬¡ç»˜åˆ¶æ—¶çš„ç¦»å±æ¸²æŸ“å¼€é”€ã€‚å°½é‡é¿å…å¤æ‚çš„åœ†è§’ã€é˜´å½±æ•ˆæœï¼Œæˆ–è€…ä½¿ç”¨æ›´ç®€å•çš„å›¾å½¢æ“ä½œã€‚å¦‚å¯èƒ½ï¼Œå‡å°‘å¯¹ layer çš„å±æ€§è®¾ç½®ï¼Œå°¤å…¶æ˜¯é‚£äº›å¯èƒ½å¼•èµ·ç¦»å±æ¸²æŸ“çš„å±æ€§ã€‚\n","categories":["æ€§èƒ½ä¼˜åŒ–"],"tags":["æ€§èƒ½ä¼˜åŒ–","å¡é¡¿ç›‘æ§"]},{"title":"Swift è¯­æ³•","url":"/2025/05/07/Swift-%E8%AF%AD%E6%B3%95/","content":"è¯­æ³•åŸºç¡€å˜é‡å˜é‡æ˜¯å¯å˜çš„ï¼Œä½¿ç”¨ var ä¿®é¥°ï¼Œå¸¸é‡æ˜¯ä¸å¯å˜çš„ï¼Œä½¿ç”¨ let ä¿®é¥°ã€‚ç±»ã€ç»“æ„ä½“å’Œæšä¸¾é‡Œçš„å˜é‡æ˜¯å±æ€§ã€‚\nvar v1:String = &quot;hi&quot; // æ ‡æ³¨ç±»å‹var v2 = &quot;ç±»å‹æ¨å¯¼&quot;let l1 = &quot;æ ‡é¢˜&quot; // å¸¸é‡class a &#123;    let p1 = 3    var p2: Int &#123;        p1 * 3    &#125;&#125;\nå±æ€§æ²¡æœ‰ set å¯ä»¥çœç•¥ getï¼Œå¦‚æœæœ‰ set éœ€åŠ  getã€‚å˜é‡è®¾ç½®å‰é€šè¿‡ willSet è®¿é—®åˆ°ï¼Œå˜é‡è®¾ç½®åé€šè¿‡ didSet è®¿é—®ã€‚\næ‰“å°æ§åˆ¶å°æ‰“å°å€¼\nprint(&quot;hi&quot;)let i = 14print(i)print(&quot;9æœˆ\\(i)æ˜¯å°æŸ æª¬çš„ç”Ÿæ—¥&quot;)for i in 1...3&#123;    print(i)&#125;// output:// 1// 2// 3// ä½¿ç”¨terminatorä½¿å¾ªç¯æ‰“å°æ›´æ•´æ´for i in 1...3 &#123;    print(&quot;\\(i) &quot;, terminator: &quot;&quot;)&#125;// output:// 1 2 3\næ³¨é‡Š// å•è¡Œæ³¨é‡Š/*å¤šè¡Œæ³¨é‡Šç¬¬ä¸€è¡Œã€‚å¤šè¡Œæ³¨é‡Šç¬¬äºŒè¡Œã€‚*/ // MARK: ä¼šåœ¨ minimap ä¸Šå±•ç¤º// TODO: å¾…åš// FIXME: å¾…ä¿®å¤\n!?å¯é€‰å¯èƒ½ä¼šæ˜¯ nil çš„å˜é‡å°±æ˜¯å¯é€‰å˜é‡ã€‚å½“å˜é‡ä¸º nil é€šè¿‡??æ“ä½œç¬¦å¯ä»¥æä¾›ä¸€ä¸ªé»˜è®¤å€¼ã€‚\nvar o: Int? = nillet i = o ?? 0\nSE-0345 if let shorthand for shadowing an existing optional variable å¼•å…¥çš„æ–°è¯­æ³•ï¼Œç”¨äº unwrapping optinalã€‚\nlet s1: String? = &quot;hey&quot;let s2: String? = &quot;u&quot;if let s1 &#123;    print(s1)&#125;guard let s1, let s2 else &#123; return &#125;print(s1 + &quot; &quot; + s2)\né—­åŒ…é—­åŒ…ä¹Ÿå¯ä»¥å«åš lambdaï¼Œæ˜¯åŒ¿åå‡½æ•°ï¼Œå¯¹åº” OC çš„ blockã€‚\nlet a1 = [1,3,2].sorted(by: &#123; (l: Int, r: Int) -&gt; Bool in    return l &lt; r&#125;)// å¦‚æœé—­åŒ…æ˜¯å”¯ä¸€çš„å‚æ•°å¹¶åœ¨è¡¨è¾¾å¼æœ€åå¯ä»¥ä½¿ç”¨ç»“å°¾é—­åŒ…è¯­æ³•ï¼Œå†™æ³•ç®€åŒ–ä¸ºlet a2 = [1,3,2].sorted &#123; (l: Int, r: Int) -&gt; Bool in    return l &lt; r&#125;// å·²çŸ¥ç±»å‹å¯ä»¥çœç•¥let a3 = [1,3,2].sorted &#123; l, r in    return l &lt; r&#125;// é€šè¿‡ä½ç½®æ¥ä½¿ç”¨é—­åŒ…çš„å‚æ•°ï¼Œæœ€åç®€åŒ–å¦‚ä¸‹ï¼šlet a4 = [1,3,2].sorted &#123; $0 &lt; $1 &#125;\nå‡½æ•°ä¹Ÿæ˜¯é—­åŒ…çš„ä¸€ç§ï¼Œå‡½æ•°çš„å‚æ•°ä¹Ÿå¯ä»¥æ˜¯é—­åŒ…ã€‚@escaping è¡¨ç¤ºé€ƒé€¸é—­åŒ…ï¼Œé€ƒé€¸é—­åŒ…æ˜¯å¯ä»¥åœ¨å‡½æ•°è¿”å›ä¹‹åç»§ç»­è°ƒç”¨çš„ã€‚@autoclosure è¡¨ç¤ºè‡ªåŠ¨é—­åŒ…ï¼Œå¯ä»¥ç”¨æ¥çœç•¥èŠ±æ‹¬å·ã€‚\nSE-0326 æé«˜äº† Swift å¯¹é—­åŒ…ä½¿ç”¨å‚æ•°å’Œç±»å‹æ¨æ–­çš„èƒ½åŠ›ã€‚å¦‚ä¸‹ä»£ç ï¼š\nlet a = [1,2,3]let r = a.map &#123; i in    if i &gt;= 2 &#123;        return &quot;\\(i) å¤§äºç­‰äº2&quot;    &#125; else &#123;        return &quot;\\(i) å°äº2&quot;    &#125;&#125;print(r)\nå‡½æ•°å‡½æ•°å¯ä»¥ä½œä¸ºå¦ä¸€ä¸ªå‡½æ•°çš„å‚æ•°ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºå¦ä¸€ä¸ªå‡½æ•°çš„è¿”å›ã€‚å‡½æ•°æ˜¯ç‰¹æ®Šçš„é—­åŒ…ï¼Œåœ¨ç±»ã€ç»“æ„ä½“å’Œæšä¸¾ä¸­æ˜¯æ–¹æ³•ã€‚\n// ä¸ºå‚æ•°è®¾ç½®é»˜è®¤å€¼func f1(p: String = &quot;p&quot;) -&gt; String &#123;    &quot;p is \\(p)&quot;&#125;// å‡½æ•°ä½œä¸ºå‚æ•°func f2(fn: (String) -&gt; String, p: String) -&gt; String &#123;    return fn(p)&#125;print(f2(fn:f1, p: &quot;d&quot;)) // p is d// å‡½æ•°ä½œä¸ºè¿”å›å€¼func f3(p: String) -&gt; (String) -&gt; String &#123;    return f1&#125;print(f3(p: &quot;yes&quot;)(&quot;no&quot;)) // p is no\nå‡½æ•°å¯ä»¥è¿”å›å¤šä¸ªå€¼ï¼Œå‡½æ•°æ˜¯å¯ä»¥åµŒå¥—çš„ï¼Œä¹Ÿå°±æ˜¯å‡½æ•°é‡Œå†…å¯ä»¥å®šä¹‰å‡½æ•°ï¼Œå‡½æ•°å†…å®šä¹‰çš„å‡½æ•°å¯ä»¥è®¿é—®è‡ªå·±ä½œç”¨åŸŸå¤–å‡½æ•°å†…çš„å˜é‡ã€‚inout è¡¨ç¤ºçš„æ˜¯è¾“å…¥è¾“å‡ºå‚æ•°ï¼Œå‡½æ•°å¯ä»¥åœ¨å‡½æ•°å†…æ”¹å˜è¾“å…¥è¾“å‡ºå‚æ•°ã€‚defer æ ‡è¯†çš„ä»£ç å—ä¼šåœ¨å‡½æ•°è¿”å›ä¹‹å‰æ‰§è¡Œã€‚\nå‡½æ•°åœ¨ Swift 5.4 æ—¶å¼€å§‹æœ‰äº†ä½¿ç”¨å¤šä¸ªå˜é‡å‚æ•°çš„èƒ½åŠ›ï¼Œä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š\nfunc f4(s: String..., i: Int...) &#123;    print(s)    print(i)&#125;f4(s: &quot;one&quot;, &quot;two&quot;, &quot;three&quot;, i: 1, 2, 3)/// [&quot;one&quot;, &quot;two&quot;, &quot;three&quot;]/// [1, 2, 3]\nåµŒå¥—å‡½æ•°å¯ä»¥é‡è½½ï¼ŒåµŒå¥—å‡½æ•°å¯ä»¥åœ¨å£°æ˜å‡½æ•°ä¹‹å‰è°ƒç”¨ä»–ã€‚\nfunc f5() &#123;    nf5()    func nf5() &#123;        print(&quot;this is nested function&quot;)    &#125;&#125;f5() // this is nested function\nè®¿é—®æ§åˆ¶åœ¨ Xcode é‡Œçš„ target å°±æ˜¯æ¨¡å—ï¼Œä½¿ç”¨ import å¯å¯¼å…¥æ¨¡å—ã€‚æ¨¡å—å†…åŒ…å«æºæ–‡ä»¶ï¼Œæ¯ä¸ªæºæ–‡ä»¶é‡Œå¯ä»¥æœ‰å¤šä¸ªç±»ã€ç»“æ„ä½“ã€æšä¸¾å’Œå‡½æ•°ç­‰å¤šç§ç±»å‹ã€‚è®¿é—®çº§åˆ«å¯ä»¥é€šè¿‡ä¸€äº›å…³é”®å­—æè¿°ï¼Œåˆ†ä¸ºå¦‚ä¸‹å‡ ç§ï¼š\n\nopenï¼šåœ¨æ¨¡å—å¤–å¯ä»¥è°ƒç”¨å’Œç»§æ‰¿ã€‚\npublicï¼šåœ¨æ¨¡å—å¤–å¯è°ƒç”¨ä¸å¯ç»§æ‰¿ï¼Œopen åªé€‚ç”¨ç±»å’Œç±»æˆå‘˜ã€‚\ninternalï¼šé»˜è®¤çº§åˆ«ï¼Œæ¨¡å—å†…å¯è·¨æºæ–‡ä»¶è°ƒç”¨ï¼Œæ¨¡å—å¤–ä¸å¯è°ƒç”¨ã€‚\nfileprivateï¼šåªèƒ½åœ¨æºæ–‡ä»¶å†…è®¿é—®ã€‚\nprivateï¼šåªèƒ½åœ¨æ‰€åœ¨çš„ä½œç”¨åŸŸå†…è®¿é—®ã€‚\n\né‡å†™ç»§æ‰¿ç±»çš„æˆå‘˜ï¼Œå¯ä»¥è®¾ç½®æˆå‘˜æ¯”çˆ¶ç±»çš„è¿™ä¸ªæˆå‘˜æ›´é«˜çš„è®¿é—®çº§åˆ«ã€‚Setter çš„çº§åˆ«å¯ä»¥ä½äºå¯¹åº”çš„ Getter çš„çº§åˆ«ï¼Œæ¯”å¦‚è®¾ç½® Setter è®¿é—®çº§åˆ«ä¸º privateï¼Œå¯ä»¥åœ¨å±æ€§ä½¿ç”¨ private(set) æ¥ä¿®é¥°ã€‚\nRegexæ ‡å‡†åº“å¤šäº†ä¸ª Regex ç±»å‹ï¼ŒRegex è¯­æ³•ä¸ Perlã€Pythonã€Rubyã€Javaã€NSRegularExpression å’Œè®¸å¤šå…¶ä»–è¯­è¨€å…¼å®¹ã€‚å¯ä»¥ç”¨ let regex &#x3D; try! Regex(â€œa[bc]+â€) æˆ– let regex &#x3D; &#x2F;a[bc]+&#x2F; å†™æ³•æ¥ä½¿ç”¨ã€‚SE-0350 Regex Type and Overview å¼•å…¥ Regex ç±»å‹ã€‚SE-0351 Regex builder DSL ä½¿ç”¨ result builder æ¥æ„å»ºæ­£åˆ™è¡¨è¾¾å¼çš„ DSLã€‚SE-0354 Regex Literals ç®€åŒ–çš„æ­£åˆ™è¡¨è¾¾å¼ã€‚SE-0357 Regex-powered string processing algorithms ææ¡ˆé‡Œæœ‰åŸºäºæ­£åˆ™è¡¨è¾¾å¼çš„æ–°å­—ç¬¦ä¸²å¤„ç†ç®—æ³•ã€‚\nRegexBuilder æ–‡æ¡£\nsession Meet Swift Regex ã€Swift Regex: Beyond the basics\nRegex ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š\nlet s1 = &quot;I am not a good painter&quot;print(s1.ranges(of: /good/))do &#123;    let regGood = try Regex(&quot;[a-z]ood&quot;)    print(s1.replacing(regGood, with: &quot;bad&quot;))&#125; catch &#123;    print(error)&#125;print(s1.trimmingPrefix(/i am /.ignoresCase()))let reg1 = /(.+?) read (\\d+) books./let reg2 = /(?&lt;name&gt;.+?) read (?&lt;books&gt;\\d+) books./let s2 = &quot;Jack read 3 books.&quot;do &#123;    if let r1 = try reg1.wholeMatch(in: s2) &#123;        print(r1.1)        print(r1.2)    &#125;    if let r2 = try reg2.wholeMatch(in: s2) &#123;        print(&quot;name:&quot; + r2.name)        print(&quot;books:&quot; + r2.books)    &#125;&#125; catch &#123;    print(error)&#125;\nä½¿ç”¨ regex builders çš„å®˜æ–¹ç¤ºä¾‹ï¼š\n// Text to parse:// CREDIT  03/02/2022  Payroll from employer     $200.23// CREDIT  03/03/2022  Suspect A           $2,000,000.00// DEBIT   03/03/2022  Ted&#x27;s Pet Rock Sanctuary    $2,000,000.00// DEBIT   03/05/2022  Doug&#x27;s Dugout Dogs      $33.27import RegexBuilderlet fieldSeparator = /\\s&#123;2,&#125;|\\t/let transactionMatcher = Regex &#123;  /CREDIT|DEBIT/  fieldSeparator  One(.date(.numeric, locale: Locale(identifier: &quot;en_US&quot;), timeZone: .gmt)) // ğŸ‘ˆğŸ» we define which data locale/timezone we want to use  fieldSeparator  OneOrMore &#123;    NegativeLookahead &#123; fieldSeparator &#125; // ğŸ‘ˆğŸ» we stop as soon as we see one field separator    CharacterClass.any  &#125;  fieldSeparator  One(.localizedCurrency(code: &quot;USD&quot;).locale(Locale(identifier: &quot;en_US&quot;)))&#125;\nåœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­æ•è·æ•°æ®ï¼Œä½¿ç”¨ Captureï¼š\nlet fieldSeparator = /\\s&#123;2,&#125;|\\t/let transactionMatcher = Regex &#123;  Capture &#123; /CREDIT|DEBIT/ &#125; // ğŸ‘ˆğŸ»  fieldSeparator  Capture &#123; One(.date(.numeric, locale: Locale(identifier: &quot;en_US&quot;), timeZone: .gmt)) &#125; // ğŸ‘ˆğŸ»  fieldSeparator  Capture &#123; // ğŸ‘ˆğŸ»    OneOrMore &#123;      NegativeLookahead &#123; fieldSeparator &#125;      CharacterClass.any    &#125;  &#125;  fieldSeparator  Capture &#123; One(.localizedCurrency(code: &quot;USD&quot;).locale(Locale(identifier: &quot;en_US&quot;))) &#125; // ğŸ‘ˆğŸ»&#125;// transactionMatcher: Regex&lt;(Substring, Substring, Date, Substring, Decimal)&gt;\nåŸºç¡€ç±»å‹æ•°å­—æ•°å­—çš„ç±»å‹æœ‰ Intã€Float å’Œ Double\n// Intlet i1 = 100let i2 = 22print(i1 / i2) // å‘ä¸‹å–æ•´å¾— 4// Floatlet f1: Float = 100.0let f2: Float = 22.0print(f1 / f2) // 4.5454545let f3: Float16 = 5.0 // macOS è¿˜ä¸èƒ½ç”¨let f4: Float32 = 5.0let f5: Float64 = 5.0let f6: Float80 = 5.0print(f4, f5, f6) // 5.0 5.0 5.0// Doublelet d1: Double = 100.0let d2: Double = 22.0print(d1 / d2) // 4.545454545454546// å­—é¢é‡print(Int(0b10101)) // 0b å¼€å¤´æ˜¯äºŒè¿›åˆ¶ print(Int(0x00afff)) // 0x å¼€å¤´æ˜¯åå…­è¿›åˆ¶print(2.5e4) // 2.5x10^4 åè¿›åˆ¶ç”¨ eprint(0xAp2) // 10*2^2  åå…­è¿›åˆ¶ç”¨ pprint(2_000_000) // 2000000// isMultiple(of:) æ–¹æ³•æ£€æŸ¥ä¸€ä¸ªæ•°å­—æ˜¯å¦æ˜¯å¦ä¸€ä¸ªæ•°å­—çš„å€æ•°let i3 = 36print(i3.isMultiple(of: 9)) // true\nå¤„ç†æ•°å­—æœ‰ floorã€ceilã€roundã€‚floor æ˜¯å‘ä¸‹å–æ•´ï¼Œåªå–æ•´æ•°éƒ¨åˆ†ï¼›cell æ˜¯å‘ä¸Šå–æ•´ï¼Œåªè¦æœ‰ä¸ä¸ºé›¶çš„å°æ•°ï¼Œæ•´æ•°å°±åŠ 1;round æ˜¯å››èˆäº”å…¥ã€‚\nå¸ƒå°”æ•°å¸ƒå°”æ•°æœ‰ true å’Œ false ä¸¤ç§å€¼ï¼Œè¿˜æœ‰ä¸€ä¸ªèƒ½å¤Ÿåˆ‡æ¢è¿™ä¸¤ä¸ªå€¼çš„ toggle æ–¹æ³•ã€‚\nvar b = falseb.toggle() // trueb.toggle() // false\nå­—ç¬¦ä¸²let s1 = &quot;Hi! This is a string. Cool?&quot;/// è½¬ä¹‰ç¬¦ \\n è¡¨ç¤ºæ¢è¡Œã€‚/// å…¶å®ƒè½¬ä¹‰å­—ç¬¦æœ‰ \\0 ç©ºå­—ç¬¦)ã€\\t æ°´å¹³åˆ¶è¡¨ç¬¦ ã€\\n æ¢è¡Œç¬¦ã€\\r å›è½¦ç¬¦let s2 = &quot;Hi!\\nThis is a string. Cool?&quot;// å¤šè¡Œlet s3 = &quot;&quot;&quot;Hi!This is a string.Cool?&quot;&quot;&quot;// é•¿åº¦print(s3.count)print(s3.isEmpty)// æ‹¼æ¥print(s3 + &quot;\\nSure!&quot;)// å­—ç¬¦ä¸²ä¸­æ’å…¥å˜é‡let i = 1print(&quot;Today is good day, double \\(i)\\(i)!&quot;)/// éå†å­—ç¬¦ä¸²/// è¾“å‡ºï¼š/// o/// n/// efor c in &quot;one&quot; &#123;    print(c)&#125;// æŸ¥æ‰¾print(s3.lowercased().contains(&quot;cool&quot;)) // true// æ›¿æ¢let s4 = &quot;one is two&quot;let newS4 = s4.replacingOccurrences(of: &quot;two&quot;, with: &quot;one&quot;)print(newS4)// åˆ é™¤ç©ºæ ¼å’Œæ¢è¡Œlet s5 = &quot; Simple line. \\n\\n  &quot;print(s5.trimmingCharacters(in: .whitespacesAndNewlines))// åˆ‡å‰²æˆæ•°ç»„let s6 = &quot;one/two/three&quot;let a1 = s6.components(separatedBy: &quot;/&quot;) // ç»§æ‰¿è‡ª NSString çš„æ¥å£print(a1) // [&quot;one&quot;, &quot;two&quot;, &quot;three&quot;]let a2 = s6.split(separator: &quot;/&quot;)print(a2) // [&quot;one&quot;, &quot;two&quot;, &quot;three&quot;] å±äºåˆ‡ç‰‡ï¼Œæ€§èƒ½è¾ƒ components æ›´å¥½// åˆ¤æ–­æ˜¯å¦æ˜¯æŸç§ç±»å‹let c1: Character = &quot;ğŸ¤”&quot;print(c1.isASCII) // falseprint(c1.isSymbol) // trueprint(c1.isLetter) // falseprint(c1.isNumber) // falseprint(c1.isUppercase) // false// å­—ç¬¦ä¸²å’Œ Data äº’è½¬let data = Data(&quot;hi&quot;.utf8)let s7 = String(decoding: data, as: UTF8.self)print(s7) // hi// å­—ç¬¦ä¸²å¯ä»¥å½“ä½œé›†åˆæ¥ç”¨ã€‚let revered = s7.reversed()print(String(revered))\nUnicodeã€Character å’Œ SubString ç­‰å†…å®¹å‚è§å®˜æ–¹å­—ç¬¦ä¸²æ–‡æ¡£ï¼šStrings and Characters â€” The Swift Programming Language (Swift 5.1)\nå­—ç¬¦ä¸²å­—é¢ç¬¦å·å¯ä»¥å‚çœ‹ã€ŠString literals in Swiftã€‹ã€‚\nåŸå§‹å­—ç¬¦ä¸²\n// åŸå§‹å­—ç¬¦ä¸²åœ¨å­—ç¬¦ä¸²å‰åŠ ä¸Šä¸€ä¸ªæˆ–å¤šä¸ª#ç¬¦å·ã€‚é‡Œé¢çš„åŒå¼•å·å’Œè½¬ä¹‰ç¬¦å·å°†ä¸å†èµ·ä½œç”¨äº†ï¼Œå¦‚æœæƒ³è®©è½¬ä¹‰ç¬¦èµ·ä½œç”¨ï¼Œéœ€è¦åœ¨è½¬ä¹‰ç¬¦åé¢åŠ ä¸Š#ç¬¦å·ã€‚let s8 = #&quot;\\(s7)\\#(s7) &quot;one&quot; and &quot;two&quot;\\n. \\#nThe second line.&quot;#print(s8)/// \\(s7)hi &quot;one&quot; and &quot;two&quot;\\n./// The second line.// åŸå§‹å­—ç¬¦ä¸²åœ¨æ­£åˆ™ä½¿ç”¨æ•ˆæœæ›´ä½³ï¼Œåæ–œæ æ›´å°‘äº†ã€‚let s9 = &quot;\\\\\\\\[A-Z]+[A-Za-z]+\\\\.[a-z]+&quot;let s10 = #&quot;\\\\[A-Z]+[A-Za-z]+\\.[a-z]+&quot;#print(s9) // \\\\[A-Z]+[A-Za-z]+\\.[a-z]+print(s10) // \\\\[A-Z]+[A-Za-z]+\\.[a-z]+\nSwift5.7 String Index å¤§å‡çº§ String Index Overhaul\næšä¸¾Swiftçš„æšä¸¾æœ‰ç±»çš„ä¸€äº›ç‰¹æ€§ï¼Œæ¯”å¦‚è®¡ç®—å±æ€§ã€å®ä¾‹æ–¹æ³•ã€æ‰©å±•ã€éµå¾ªåè®®ç­‰ç­‰ã€‚\nenum E1:String, CaseIterable &#123;    case e1, e2 = &quot;12&quot;&#125;// å…³è”å€¼enum E2 &#123;    case e1([String])    case e2(Int)&#125;let e1 = E2.e1([&quot;one&quot;,&quot;two&quot;])let e2 = E2.e2(3)switch e1 &#123;case .e1(let array):    print(array)case .e2(let int):    print(int)&#125;print(e2)// åŸå§‹å€¼print(E1.e1.rawValue)// éµå¾ª CaseIterable åè®®å¯è¿­ä»£for ie in E1.allCases &#123;    print(&quot;show \\(ie)&quot;)&#125;// é€’å½’æšä¸¾enum RE &#123;    case v(String)    indirect case node(l:RE, r:RE)&#125;let lNode = RE.v(&quot;left&quot;)let rNode = RE.v(&quot;right&quot;)let pNode = RE.node(l: lNode, r: rNode)switch pNode &#123;case .v(let string):    print(string)case .node(let l, let r):    print(l,r)    switch l &#123;    case .v(let string):        print(string)    case .node(let l, let r):        print(l, r)    &#125;    switch r &#123;    case .v(let string):        print(string)    case .node(let l, let r):        print(l, r)    &#125;&#125;\n@unknown ç”¨æ¥åŒºåˆ†å›ºå®šçš„æšä¸¾å’Œå¯èƒ½æ”¹å˜çš„æšä¸¾çš„èƒ½åŠ›ã€‚@unknown ç”¨äºé˜²æ­¢æœªæ¥æ–°å¢æšä¸¾å±æ€§ä¼šè¿›è¡Œæé†’æç¤ºå®Œå–„æ¯ä¸ª case çš„å¤„ç†ã€‚\n// @unknownenum E3 &#123;    case e1, e2, e3&#125;func fe1(e: E3) &#123;    switch e &#123;    case .e1:        print(&quot;e1 ok&quot;)    case .e2:        print(&quot;e2 ok&quot;)    case .e3:        print(&quot;e3 ok&quot;)    @unknown default:        print(&quot;not ok&quot;)    &#125;&#125;\nç¬¦åˆ Comparable åè®®çš„æšä¸¾å¯ä»¥è¿›è¡Œæ¯”è¾ƒã€‚\n// Comparable æšä¸¾æ¯”è¾ƒenum E4: Comparable &#123;    case e1, e2    case e3(i: Int)    case e4&#125;let e3 = E4.e4let e4 = E4.e3(i: 3)let e5 = E4.e3(i: 2)let e6 = E4.e1print(e3 &gt; e4) // truelet a1 = [e3, e4, e5, e6]let a2 = a1.sorted()for i in a2 &#123;    print(i.self)&#125;/// e1/// e3(i: 2)/// e3(i: 3)/// e4\nå…ƒç»„å…ƒç»„é‡Œçš„å€¼ç±»å‹å¯ä»¥æ˜¯ä¸åŒçš„ã€‚å…ƒç»„å¯ä»¥çœ‹æˆæ˜¯åŒ¿åçš„ç»“æ„ä½“ã€‚\nlet t1 = (p1: 1, p2: &quot;two&quot;, p3: [1,2,3])print(t1.p1)print(t1.p3)// ç±»å‹æ¨å¯¼let t2 = (1, &quot;two&quot;, [1,2,3])// é€šè¿‡ä¸‹æ ‡è®¿é—®print(t2.1) // two// åˆ†è§£å…ƒç»„let (dp1, dp2, _) = t2print(dp1)print(dp2)\næ³›å‹å’Œåè®®æ³›å‹å¯ä»¥å‡å°‘é‡å¤ä»£ç ï¼Œæ˜¯ä¸€ç§æŠ½è±¡çš„è¡¨è¾¾æ–¹å¼ã€‚where å…³é”®å­—å¯ä»¥å¯¹æ³›å‹åšçº¦æŸã€‚\nfunc fn&lt;T&gt;(p: T) -&gt; [T] &#123;    var r = [T]()    r.append(p)    return r&#125;print(fn(p: &quot;one&quot;))// ç»“æ„ä½“struct S1&lt;T&gt; &#123;    var arr = [T]()    mutating func add(_ p: T) &#123;        arr.append(p)    &#125;&#125;var s1 = S1(arr: [&quot;zero&quot;])s1.add(&quot;one&quot;)s1.add(&quot;two&quot;)print(s1.arr) // [&quot;zero&quot;, &quot;one&quot;, &quot;two&quot;]\nå…³è”ç±»å‹\nprotocol pc &#123;    associatedtype T    mutating func add(_ p: T)&#125;struct S2: pc &#123;    typealias T = String // ç±»å‹æ¨å¯¼ï¼Œå¯çœç•¥    var strs = [String]()    mutating func add(_ p: String) &#123;        strs.append(p)    &#125;&#125;\næ³›å‹é€‚ç”¨äºåµŒå¥—ç±»å‹\nstruct S3&lt;T&gt; &#123;    struct S4 &#123;        var p: T    &#125;        var p1: T    var p2: S4&#125;let s2 = S3(p1: 1, p2: S3.S4(p: 3))let s3 = S3(p1: &quot;one&quot;, p2: S3.S4(p: &quot;three&quot;))print(s2,s3)\nsession Embrace Swift generics ã€Design protocol interfaces in Swift\nswift 5.6 å’Œä¹‹å‰ç¼–å†™æ³›å‹æ¥å£å¦‚ä¸‹ï¼š\nfunc feed&lt;A&gt;(_ animal: A) where A: Animal// ğŸ‘†ğŸ»ğŸ‘‡ğŸ» Equivalentsfunc feed&lt;A: Animal&gt;(_ animal: A)\nswift 5.7 å¯ä»¥è¿™æ ·å†™ï¼š\nfunc feed(_ animal: some Animal)\nsome å…³é”®å­—å¯ä»¥ç”¨äºå‚æ•°å’Œç»“æ„ç±»å‹ã€‚some ä¼šä¿è¯ç±»å‹å…³ç³»ï¼Œè€Œ any ä¼šæŒæœ‰ä»»æ„å…·ä½“ç±»å‹ï¼Œåˆ é™¤ç±»å‹å…³ç³»ã€‚\nSE-0347 Type inference from default expressions æ‰©å±• Swift æ³›å‹å‚æ•°ç±»å‹çš„é»˜è®¤å€¼èƒ½åŠ›ã€‚å¦‚ä¸‹ä»£ç ç¤ºä¾‹ï¼š\nfunc suffledArray&lt;T: Sequence&gt;(from options: T = 1...100) -&gt; [T.Element] &#123;    Array(options.shuffled())&#125;print(suffledArray())print(suffledArray(from: [&quot;one&quot;, &quot;two&quot;, &quot;three&quot;]))\nSE-0341 Opaque Parameter Declarations ä½¿ç”¨ some å‚æ•°ç®€åŒ–æ³›å‹å‚æ•°å£°æ˜ã€‚SE-0328 Structural opaque result types æ‰©å¤§ä¸é€æ˜ç»“æœè¿”å›ç±»å‹å¯ä»¥ä½¿ç”¨çš„èŒƒå›´ã€‚SE-0360 Opaque result types with limited availability å¯ç”¨æ€§æœ‰é™çš„ä¸é€æ˜ç»“æœç±»å‹ï¼Œæ¯”å¦‚ if #available(macOS 13.0, *) {} å°±å¯ä»¥æ ¹æ®ç³»ç»Ÿä¸åŒç‰ˆæœ¬è¿”å›ä¸åŒç±»å‹ï¼Œæ–°ç‰ˆæœ¬å‡ºç°æ–°ç±»å‹çš„ View å°±å¯ä»¥å’Œä»¥å‰çš„ View ç±»å‹åŒºåˆ«å¼€ã€‚\nSE-0309 Unlock existentials for all protocols æ”¹è¿›äº† existentials å’Œ æ³›å‹çš„äº¤äº’ã€‚è¿™æ ·å°±å¯ä»¥æ›´æ–¹ä¾¿çš„æ£€æŸ¥ Any ç±»å‹çš„ä¸¤ä¸ªå€¼æ˜¯å¦ç›¸ç­‰\nany å…³é”®å­—å……å½“çš„æ˜¯ç±»å‹æ“¦é™¤çš„åŠ©æ‰‹ï¼Œæ˜¯é€šè¿‡å‘ŠçŸ¥ç¼–è¯‘å™¨ä½ ä½¿ç”¨ existential ä½œä¸ºç±»å‹ï¼Œæ­¤è¯­æ³•å¯å…¼å®¹ä»¥å‰ç³»ç»Ÿã€‚\nSE-0346 Lightweight same-type requirements for primary associated types å¼•å…¥ä¸€ç§æ–°è¯­æ³•ï¼Œç”¨äºç¬¦åˆæ³›å‹å‚æ•°å¹¶é€šè¿‡ç›¸åŒç±»å‹è¦æ±‚çº¦æŸå…³è”ç±»å‹ã€‚SE-0358 Primary Associated Types in the Standard Library å¼•å…¥ä¸»è¦å…³è”ç±»å‹æ¦‚å¿µï¼Œå¹¶å°†å…¶å¸¦å…¥äº†æ ‡å‡†åº“ã€‚è¿™äº›å…³è”ç±»å‹å¾ˆåƒæ³›å‹ï¼Œå…è®¸å¼€å‘è€…å°†ç»™å®šå…³è”ç±»å‹çš„ç±»å‹æŒ‡å®šä¸ºé€šç”¨çº¦æŸã€‚\nSE-0353 Constrained Existential Types åŸºäº SE-0309 å’Œ SE-0346 ææ¡ˆï¼Œåœ¨ existential ç±»å‹çš„ä¸Šä¸‹æ–‡ä¸­é‡ç”¨è½»é‡å…³è”ç±»å‹çš„çº¦æŸã€‚\nSE-0352 Implicitly Opened Existentials å…è®¸ Swift åœ¨å¾ˆå¤šæƒ…å†µä¸‹ä½¿ç”¨åè®®è°ƒç”¨æ³›å‹å‡½æ•°ã€‚\nSwift è®ºå›ä¸Šä¸€ä¸ªå¯¹ any å’Œ some å…³é”®å­—è¯­æ³•ä½¿ç”¨åœºæ™¯çš„è®¨è®ºï¼ŒDo any and some help with â€œProtocol Oriented Testingâ€ at all? ã€‚\nä¸é€æ˜ç±»å‹ä¸é€æ˜ç±»å‹ä¼šéšè—ç±»å‹ï¼Œè®©ä½¿ç”¨è€…æ›´å…³æ³¨åŠŸèƒ½ã€‚ä¸é€æ˜ç±»å‹å’Œåè®®å¾ˆç±»ä¼¼ï¼Œä¸åŒçš„æ˜¯ä¸é€æ˜æ¯”åè®®é™å®šçš„è¦å¤šï¼Œåè®®èƒ½å¤Ÿå¯¹åº”æ›´å¤šç±»å‹ã€‚\nprotocol P &#123;    func f() -&gt; String&#125;struct S1: P &#123;    func f() -&gt; String &#123;        return &quot;one\\n&quot;    &#125;&#125;struct S2&lt;T: P&gt;: P &#123;    var p: T    func f() -&gt; String &#123;        return p.f() + &quot;two\\n&quot;    &#125;&#125;struct S3&lt;T1: P, T2: P&gt;: P &#123;    var p1: T1    var p2: T2    func f() -&gt; String &#123;        return p1.f() + p2.f() + &quot;three\\n&quot;    &#125;&#125;func someP() -&gt; some P &#123;    return S3(p1: S1(), p2: S2(p: S1()))&#125;let r = someP()print(r.f())\nå‡½æ•°è°ƒç”¨è€…å†³å®šè¿”å›ä»€ä¹ˆç±»å‹æ˜¯æ³›å‹ï¼Œå‡½æ•°è‡ªèº«å†³å®šè¿”å›ä»€ä¹ˆç±»å‹ä½¿ç”¨ä¸é€æ˜è¿”å›ç±»å‹ã€‚\nResultResult ç±»å‹ç”¨æ¥å¤„ç†é”™è¯¯ï¼Œç‰¹åˆ«é€‚ç”¨å¼‚æ­¥æ¥å£çš„é”™è¯¯å¤„ç†ã€‚\nextension URLSession &#123;    func dataTaskWithResult(        with url: URL,        handler: @escaping (Result&lt;Data, Error&gt;) -&gt; Void    ) -&gt; URLSessionDataTask &#123;        dataTask(with: url) &#123; data, _, err in            if let err = err &#123;                handler(.failure(err))            &#125; else &#123;                handler(.success(data ?? Data()))            &#125;        &#125;    &#125;&#125;let url = URL(string: &quot;https://ming1016.github.io/&quot;)!// ä»¥å‰ç½‘ç»œè¯·æ±‚let t1 = URLSession.shared.dataTask(with: url) &#123;    data, _, error in    if let err = error &#123;        print(err)    &#125; else if let data = data &#123;        print(String(decoding: data, as: UTF8.self))    &#125;&#125;t1.resume()// ä½¿ç”¨ Result ç½‘ç»œè¯·æ±‚let t2 = URLSession.shared.dataTaskWithResult(with: url) &#123; result in    switch result &#123;    case .success(let data):        print(String(decoding: data, as: UTF8.self))    case .failure(let err):        print(err)    &#125;&#125;t2.resume()\nç±»å‹è½¬æ¢ä½¿ç”¨ is å…³é”®å­—è¿›è¡Œç±»å‹åˆ¤æ–­ï¼Œ ä½¿ç”¨as å…³é”®å­—æ¥è½¬æ¢æˆå­ç±»ã€‚\nclass S0 &#123;&#125;class S1: S0 &#123;&#125;class S2: S0 &#123;&#125;var a = [S0]()a.append(S1())a.append(S2())for e in a &#123;    // ç±»å‹åˆ¤æ–­    if e is S1 &#123;        print(&quot;Type is S1&quot;)    &#125; else if e is S2 &#123;        print(&quot;Type is S2&quot;)    &#125;    // ä½¿ç”¨ as å…³é”®å­—è½¬æ¢æˆå­ç±»    if let s1 = e as? S1 &#123;        print(&quot;As S1 \\(s1)&quot;)    &#125; else if let s2 = e as? S2 &#123;        print(&quot;As S2 \\(s2)&quot;)    &#125;&#125;\nç±»å’Œç»“æ„ä½“ç±»ç±»å¯ä»¥å®šä¹‰å±æ€§ã€æ–¹æ³•ã€æ„é€ å™¨ã€ä¸‹æ ‡æ“ä½œã€‚ç±»ä½¿ç”¨æ‰©å±•æ¥æ‰©å±•åŠŸèƒ½ï¼Œéµå¾ªåè®®ã€‚ç±»è¿˜ä»¥ç»§æ‰¿ï¼Œè¿è¡Œæ—¶æ£€æŸ¥å®ä¾‹ç±»å‹ã€‚\nclass C &#123;    var p: String    init(_ p: String) &#123;        self.p = p    &#125;        // ä¸‹æ ‡æ“ä½œ    subscript(s: String) -&gt; String &#123;        get &#123;            return p + s        &#125;        set &#123;            p = s + newValue        &#125;    &#125;&#125;let c = C(&quot;hi&quot;)print(c.p)print(c[&quot; ming&quot;])c[&quot;k&quot;] = &quot;v&quot;print(c.p)\nç»“æ„ä½“ ç»“æ„ä½“æ˜¯å€¼ç±»å‹ï¼Œå¯ä»¥å®šä¹‰å±æ€§ã€æ–¹æ³•ã€æ„é€ å™¨ã€ä¸‹æ ‡æ“ä½œã€‚ç»“æ„ä½“ä½¿ç”¨æ‰©å±•æ¥æ‰©å±•åŠŸèƒ½ï¼Œéµå¾ªåè®®ã€‚\nstruct S &#123;    var p1: String = &quot;&quot;    var p2: Int&#125;extension S &#123;    func f() -&gt; String &#123;        return p1 + String(p2)    &#125;&#125;var s = S(p2: 1)s.p1 = &quot;1&quot;print(s.f()) // 11\nå±æ€§ç±»ã€ç»“æ„ä½“æˆ–æšä¸¾é‡Œçš„å˜é‡å¸¸é‡å°±æ˜¯ä»–ä»¬çš„å±æ€§ã€‚\nstruct S &#123;    static let sp = &quot;ç±»å‹å±æ€§&quot; // ç±»å‹å±æ€§é€šè¿‡ç±»å‹æœ¬èº«è®¿é—®ï¼Œéå®ä¾‹è®¿é—®    var p1: String = &quot;&quot;    var p2: Int = 1    // cp æ˜¯è®¡ç®—å±æ€§    var cp: Int &#123;        get &#123;            return p2 * 2        &#125;        set &#123;            p2 = newValue + 2        &#125;    &#125;    // åªæœ‰ getter çš„æ˜¯åªè¯»è®¡ç®—å±æ€§    var rcp: Int &#123;        p2 * 4    &#125;&#125;print(S.sp)print(S().cp) // 2var s = S()s.cp = 3print(s.p2) // 5print(S().rcp) // 4\nwillSet å’Œ didSet æ˜¯å±æ€§è§‚å¯Ÿå™¨ï¼Œå¯ä»¥åœ¨å±æ€§å€¼è®¾ç½®å‰åæ’å…¥è‡ªå·±çš„é€»è¾‘å¤„ç†ã€‚\né”®è·¯å¾„è¡¨è¾¾å¼ä½œä¸ºå‡½æ•°\nstruct S2 &#123;    let p1: String    let p2: Int&#125;let s2 = S2(p1: &quot;one&quot;, p2: 1)let s3 = S2(p1: &quot;two&quot;, p2: 2)let a1 = [s2, s3]let a2 = a1.map(\\.p1)print(a2) // [&quot;one&quot;, &quot;two&quot;]\næ–¹æ³•enum E: String &#123;    case one, two, three    func showRawValue() &#123;        print(rawValue)    &#125;&#125;let e = E.threee.showRawValue() // three// å¯å˜çš„å®ä¾‹æ–¹æ³•ï¼Œä½¿ç”¨ mutating æ ‡è®°struct S &#123;    var p: String    mutating func addFullStopForP() &#123;        p += &quot;.&quot;    &#125;&#125;var s = S(p: &quot;hi&quot;)s.addFullStopForP()print(s.p)// ç±»æ–¹æ³•class C &#123;    class func cf() &#123;        print(&quot;ç±»æ–¹æ³•&quot;)    &#125;&#125;\nstaticå’Œclasså…³é”®å­—ä¿®é¥°çš„æ–¹æ³•ç±»ä¼¼ OC çš„ç±»æ–¹æ³•ã€‚static å¯ä»¥ä¿®é¥°å­˜å‚¨å±æ€§ï¼Œè€Œ class ä¸èƒ½ï¼›class ä¿®é¥°çš„æ–¹æ³•å¯ä»¥ç»§æ‰¿ï¼Œè€Œ static ä¸èƒ½ã€‚åœ¨åè®®ä¸­éœ€ç”¨ static æ¥ä¿®é¥°ã€‚\né™æ€ä¸‹æ ‡æ–¹æ³•\n// é™æ€ä¸‹æ ‡struct S2 &#123;    static var sp = [String: Int]()        static subscript(_ s: String, d: Int = 10) -&gt; Int &#123;        get &#123;            return sp[s] ?? d        &#125;        set &#123;            sp[s] = newValue        &#125;    &#125;&#125;S2[&quot;key1&quot;] = 1S2[&quot;key2&quot;] = 2print(S2[&quot;key2&quot;]) // 2print(S2[&quot;key3&quot;]) // 10\nè‡ªå®šä¹‰ç±»å‹ä¸­å®ç°äº† callAsFunction() çš„è¯ï¼Œè¯¥ç±»å‹çš„å€¼å°±å¯ä»¥ç›´æ¥è°ƒç”¨ã€‚\n// callAsFunction()struct S3 &#123;    var p1: String        func callAsFunction() -&gt; String &#123;        return &quot;show \\(p1)&quot;    &#125;&#125;let s2 = S3(p1: &quot;hi&quot;)print(s2()) // show hi\nç»§æ‰¿ç±»èƒ½ç»§æ‰¿å¦ä¸€ä¸ªç±»ï¼Œç»§æ‰¿å®ƒçš„æ–¹æ³•ã€å±æ€§ç­‰ã€‚\n// ç±»ç»§æ‰¿class C1 &#123;    var p1: String    var cp1: String &#123;        get &#123;            return p1 + &quot; like ATM&quot;        &#125;        set &#123;            p1 = p1 + newValue        &#125;    &#125;    init(p1: String) &#123;        self.p1 = p1    &#125;    func sayHi() &#123;        print(&quot;Hi! \\(p1)&quot;)    &#125;&#125;class C2: C1 &#123;    var p2: String    init(p2: String) &#123;        self.p2 = p2        super.init(p1: p2 + &quot;&#x27;s father&quot;)    &#125;&#125;C2(p2: &quot;Lemon&quot;).sayHi() // Hi! Lemon&#x27;s father// é‡å†™çˆ¶ç±»æ–¹æ³•class C3: C2 &#123;    override func sayHi() &#123;        print(&quot;Hi! \\(p2)&quot;)    &#125;&#125;C3(p2: &quot;Lemon&quot;).sayHi() // Hi! Lemon// é‡å†™è®¡ç®—å±æ€§class C4: C1 &#123;    override var cp1: String &#123;        get &#123;            return p1 + &quot; like Out of the blade&quot;        &#125;        set &#123;            p1 = p1 + newValue        &#125;    &#125;&#125;print(C1(p1: &quot;Lemon&quot;).cp1) // Lemon like ATMprint(C4(p1: &quot;Lemon&quot;).cp1) // Lemon like Out of the blade\né€šè¿‡ final å…³é”®å­—å¯ä»¥é˜²æ­¢ç±»è¢«ç»§æ‰¿ï¼Œfinal è¿˜å¯ä»¥ç”¨äºå±æ€§å’Œæ–¹æ³•ã€‚ä½¿ç”¨ super å…³é”®å­—æŒ‡ä»£çˆ¶ç±»ã€‚\nå‡½æ•°å¼mapmap å¯ä»¥ä¾æ¬¡å¤„ç†æ•°ç»„ä¸­å…ƒç´ ï¼Œå¹¶è¿”å›ä¸€ä¸ªå¤„ç†åçš„æ–°æ•°ç»„ã€‚\nlet a1 = [&quot;a&quot;, &quot;b&quot;, &quot;c&quot;]let a2 = a1.map &#123;    &quot;\\($0)2&quot;&#125;print(a2) // [&quot;a2&quot;, &quot;b2&quot;, &quot;c2&quot;]\nä½¿ç”¨ compactMap å¯ä»¥è¿‡æ»¤ nil çš„å…ƒç´ ã€‚flatMap ä¼šå°†å¤šä¸ªæ•°ç»„åˆæˆä¸€ä¸ªæ•°ç»„è¿”å›ã€‚\nfilteræ ¹æ®æŒ‡å®šæ¡ä»¶è¿”å›\nlet a1 = [&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;call my name&quot;]let a2 = a1.filter &#123;    $0.prefix(1) == &quot;c&quot;&#125;print(a2) // [&quot;c&quot;, &quot;call my name&quot;]\nreducereduce å¯ä»¥å°†è¿­ä»£ä¸­è¿”å›çš„ç»“æœç”¨äºä¸‹ä¸ªè¿­ä»£ä¸­ï¼Œå¹¶ï¼Œè¿˜èƒ½è®©ä½ è®¾ä¸ªåˆå§‹å€¼ã€‚\nlet a1 = [&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;call my name.&quot;, &quot;get it?&quot;]let a2 = a1.reduce(&quot;Hey u,&quot;, &#123; partialResult, s in    // partialResult æ˜¯å‰é¢è¿”å›çš„å€¼ï¼Œs æ˜¯éå†åˆ°å½“å‰çš„å€¼    partialResult + &quot; \\(s)&quot;&#125;)print(a2) // Hey u, a b c call my name. get it?\nsortedæ’åº\n// ç±»å‹éµå¾ª Comparablelet a1 = [&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;call my name.&quot;, &quot;get it?&quot;]let a2 = a1.sorted()let a3 = a1.sorted(by: &gt;)let a4 = a1.sorted(by: &lt;)print(a2) // Hey u, a b c call my name. get it?print(a3) // [&quot;get it?&quot;, &quot;call my name.&quot;, &quot;c&quot;, &quot;b&quot;, &quot;a&quot;]print(a4) // [&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;call my name.&quot;, &quot;get it?&quot;]// ç±»å‹ä¸éµå¾ª Comparablestruct S &#123;    var s: String    var i: Int&#125;let a5 = [S(s: &quot;a&quot;, i: 0), S(s: &quot;b&quot;, i: 1), S(s: &quot;c&quot;, i: 2)]let a6 = a5    .sorted &#123; l, r in        l.i &gt; r.i    &#125;    .map &#123;        $0.i    &#125;print(a6) // [2, 1, 0]\næ§åˆ¶æµIf// iflet s = &quot;hi&quot;if s.isEmpty &#123;    print(&quot;String is Empty&quot;)&#125; else &#123;    print(&quot;String is \\(s)&quot;)&#125;// ä¸‰å…ƒæ¡ä»¶s.isEmpty ? print(&quot;String is Empty again&quot;) : print(&quot;String is \\(s) again&quot;)// if let-elsefunc f(s: String?) &#123;    if let s1 = s &#123;        print(&quot;s1 is \\(s1)&quot;)    &#125; else &#123;        print(&quot;s1 is nothing&quot;)    &#125;    // nil-coalescing    let s2 = s ?? &quot;nothing&quot;    print(&quot;s2 is \\(s2)&quot;)&#125;f(s: &quot;something&quot;)f(s: nil)// if case letenum E &#123;    case c1(String)    case c2([String])        func des() &#123;        switch self &#123;        case .c1(let string):            print(string)        case .c2(let array):            print(array)        &#125;    &#125;&#125;E.c1(&quot;enum c1&quot;).des()E.c2([&quot;one&quot;, &quot;two&quot;, &quot;three&quot;]).des()\nGuardæ›´å¥½åœ°å¤„ç†å¼‚å¸¸æƒ…å†µ\n// guardfunc f1(p: String) -&gt; String &#123;    guard p.isEmpty != true else &#123;        return &quot;Empty string.&quot;    &#125;    return &quot;String \\(p) is not empty.&quot;&#125;print(f1(p: &quot;&quot;)) // Empty string.print(f1(p: &quot;lemon&quot;)) // String lemon is not empty.// guard letfunc f2(p1: String?) -&gt; String &#123;    guard let p2 = p1 else &#123;        return &quot;Nil.&quot;    &#125;    return &quot;String \\(p2) is not nil.&quot;&#125;print(f2(p1: nil)) // Nil.print(f2(p1: &quot;lemon&quot;)) // String lemon is not nil.\néå†let a = [&quot;one&quot;, &quot;two&quot;, &quot;three&quot;]for str in a &#123;    print(str)&#125;a.forEach &#123; str in    print(str)&#125;// ä½¿ç”¨ä¸‹æ ‡èŒƒå›´for i in 0..&lt;10 &#123;    print(i)&#125;for i in 0...9 &#123;     print(i) &#125;// ä½¿ç”¨ enumeratedï¼Œi æ˜¯ä¸‹æ ‡ï¼Œstr æ˜¯å…ƒç´ for (i, str) in a.enumerated() &#123;    print(&quot;ç¬¬\\(i + 1)ä¸ªæ˜¯:\\(str)&quot;)&#125;// for in wherefor str in a where str.prefix(1) == &quot;t&quot; &#123;    print(str)&#125;// å­—å…¸ for inï¼Œéå†æ˜¯æ— åºçš„let dic = [    &quot;one&quot;: 1,    &quot;two&quot;: 2,    &quot;three&quot;: 3]for (k, v) in dic &#123;    print(&quot;key is \\(k), value is \\(v)&quot;)&#125;dic.forEach &#123; (k, v) in    print(&quot;key is \\(k), value is \\(v)&quot;)&#125;// stridefor i in stride(from: 10, through: 0, by: -2) &#123;    print(i)&#125;/* 10 8 6 4 2 0 */ // åœ¨å¾ªç¯ä¸­ä½¿ç”¨ continue å’Œ breakfor i in 0..&lt;10 &#123;    if i % 2 == 0 &#123;        continue    &#125;    print(i)&#125;// åœ¨å¾ªç¯ä¸­ä½¿ç”¨ wherefor i in 0..&lt;10 where i % 2 == 0 &#123;    print(i)&#125;\nWhile// whilevar i1 = 10while i1 &gt; 0 &#123;    print(&quot;positive even number \\(i1)&quot;)    i1 -= 2&#125;// repeat whilevar i2 = 10repeat &#123;    print(&quot;positive even number \\(i2)&quot;)    i2 -= 2&#125; while i2 &gt; 0\nä½¿ç”¨ break ç»“æŸéå†ï¼Œä½¿ç”¨ continue è·³è¿‡å½“å‰ä½œç”¨åŸŸï¼Œç»§ç»­ä¸‹ä¸ªå¾ªç¯\nSwitchfunc f1(pa: String, t:(String, Int)) &#123;    var p1 = 0    var p2 = 10    switch pa &#123;    case &quot;one&quot;:        p1 = 1    case &quot;two&quot;:        p1 = 2        fallthrough // ç»§ç»­åˆ°ä¸‹ä¸ª case ä¸­    default:        p2 = 0    &#125;    print(&quot;p1 is \\(p1)&quot;)    print(&quot;p2 is \\(p2)&quot;)        // å…ƒç»„    switch t &#123;    case (&quot;0&quot;, 0):        print(&quot;zero&quot;)    case (&quot;1&quot;, 1):        print(&quot;one&quot;)    default:        print(&quot;no&quot;)    &#125;&#125;f1(pa: &quot;two&quot;, t:(&quot;1&quot;, 1))/* p1 is 2 p2 is 0 one */// æšä¸¾enum E &#123;    case one, two, three, unknown(String)&#125;func f2(pa: E) &#123;    var p: String    switch pa &#123;    case .one:        p = &quot;1&quot;    case .two:        p = &quot;2&quot;    case .three:        p = &quot;3&quot;    case let .unknown(u) where Int(u) ?? 0 &gt; 0 : // æšä¸¾å…³è”å€¼ï¼Œä½¿ç”¨ where å¢åŠ æ¡ä»¶        p = u    case .unknown(_):        p = &quot;negative number&quot;    &#125;    print(p)&#125;f2(pa: E.one) // 1f2(pa: E.unknown(&quot;10&quot;)) // 10f2(pa: E.unknown(&quot;-10&quot;)) // negative number\né›†åˆæ•°ç»„æ•°ç»„æ˜¯æœ‰åºé›†åˆ\nvar a0: [Int] = [1, 10]a0.append(2)a0.remove(at: 0)print(a0) // [10, 2]let a1 = [&quot;one&quot;, &quot;two&quot;, &quot;three&quot;]let a2 = [&quot;three&quot;, &quot;four&quot;]// æ‰¾ä¸¤ä¸ªé›†åˆçš„ä¸åŒlet dif = a1.difference(from: a2) // swiftçš„ diffing ç®—æ³•åœ¨è¿™ http://www.xmailserver.org/diff2.pdf swiftå®ç°åœ¨  swift/stdlib/public/core/Diffing.swiftfor c in dif &#123;    switch c &#123;    case .remove(let o, let e, let a):        print(&quot;offset:\\(o), element:\\(e), associatedWith:\\(String(describing: a))&quot;)    case .insert(let o, let e, let a):        print(&quot;offset:\\(o), element:\\(e), associatedWith:\\(String(describing: a))&quot;)    &#125;&#125;/* remove offset:1, element:four, associatedWith:nil insert offset:0, element:one, associatedWith:nil insert offset:1, element:two, associatedWith:nil */let a3 = a2.applying(dif) ?? [] // å¯ä»¥ç”¨äºæ·»åŠ åˆ é™¤åŠ¨ç”»print(a3) // [&quot;one&quot;, &quot;two&quot;, &quot;three&quot;]\ndif æœ‰ç¬¬ä¸‰ä¸ª case å€¼ .insert(let offset, let element, let associatedWith) å¯ä»¥è·Ÿè¸ªæˆå¯¹çš„å˜åŒ–ï¼Œç”¨äºé«˜çº§åŠ¨ç”»ã€‚\nä»æ•°ç»„ä¸­éšæœºå–ä¸€ä¸ªå…ƒç´ \nprint(a0.randomElement() ?? 0)\næ•°ç»„æ’åº\n// æ’åºstruct S1 &#123;    let n: Int    var b = true&#125;let a4 = [    S1(n: 1),    S1(n: 10),    S1(n: 3),    S1(n: 2)]let a5 = a4.sorted &#123; i1, i2 in    i1.n &lt; i2.n&#125;for n in a5 &#123;    print(n)&#125;/// S1(n: 1)/// S1(n: 2)/// S1(n: 3)/// S1(n: 10)let a6 = [1,10,4,7,2]print(a6.sorted(by: &gt;)) // [10, 7, 4, 2, 1]\nå¯ä»¥åŠ åˆ°æ•°ç»„æ‰©å±•ä¸­ï¼Œé€šè¿‡æ‰©å±•çº¦æŸèƒ½å¤ŸæŒ‡å®šç‰¹å®šå…ƒç´ ç±»å‹çš„æ’åºï¼Œä»£ç å¦‚ä¸‹ï¼š\nextension Array where Element == Int &#123;    // å‡åº    func intSortedASC() -&gt; [Int] &#123;        return self.sorted(by: &lt;)    &#125;    // é™åº    func intSortedDESC() -&gt; [Int] &#123;        return self.sorted(by: &lt;)    &#125;&#125;print(a6.intSortedASC()) // ä½¿ç”¨æ‰©å±•å¢åŠ è‡ªå®šä¹‰æ’åºèƒ½åŠ›\nåœ¨æ•°ç»„ä¸­æ£€ç´¢æ»¡è¶³æ¡ä»¶çš„å…ƒç´ ï¼Œä»£ç å¦‚ä¸‹ï¼š\n// ç¬¬ä¸€ä¸ªæ»¡è¶³æ¡ä»¶äº†å°±è¿”å›let a7 = a4.first &#123;    $0.n == 10&#125;print(a7?.n ?? 0)// æ˜¯å¦éƒ½æ»¡è¶³äº†æ¡ä»¶print(a4.allSatisfy &#123; $0.n == 1 &#125;) // falseprint(a4.allSatisfy(\\.b)) // true// æ‰¾å‡ºæœ€å¤§çš„é‚£ä¸ªprint(a4.max(by: &#123; e1, e2 in    e1.n &lt; e2.n&#125;) ?? S1(n: 0))// S1(n: 10, b: true)// çœ‹çœ‹æ˜¯å¦åŒ…å«æŸä¸ªå…ƒç´ print(a4.contains(where: &#123;    $0.n == 7&#125;))// false\nä¸€äº›åˆ‡å‰²æ•°ç»„çš„æ–¹æ³•ã€‚\n// åˆ‡ç‰‡// å–å‰3ä¸ªï¼Œå¹¶ä¸æ˜¯ç›´æ¥å¤åˆ¶ï¼Œå¯¹äºå¤§çš„æ•°ç»„æœ‰æ€§èƒ½ä¼˜åŠ¿ã€‚print(a6[..&lt;3]) // [1, 10, 4] éœ€è¦åšè¶Šç•Œæ£€æŸ¥print(a6.prefix(30)) // [1, 10, 4, 7, 2] ä¸éœ€è¦åšè¶Šç•Œæ£€æŸ¥ï¼Œä¹Ÿæ˜¯åˆ‡ç‰‡ï¼Œæ€§èƒ½ä¸€æ ·// å»æ‰å‰3ä¸ªprint(a6.dropFirst(3)) // [7, 2]\nprefix(while:) å’Œ drop(while:) æ–¹æ³•ï¼Œé¡ºåºéå†æ‰§è¡Œé—­åŒ…é‡Œçš„é€»è¾‘åˆ¤æ–­ï¼Œæ»¡è¶³æ¡ä»¶å°±è¿”å›ï¼Œé‡åˆ°ä¸åŒ¹é…å°±ä¼šåœæ­¢éå†ã€‚prefix è¿”å›æ»¡è¶³æ¡ä»¶çš„å…ƒç´ é›†åˆï¼Œdrop è¿”å›åœæ­¢éå†ä¹‹åé‚£äº›å…ƒç´ é›†åˆã€‚\nlet a8 = [8, 9, 20, 1, 35, 3]let a9 = a8.prefix &#123;    $0 &lt; 30&#125;print(a9) // [8, 9, 20, 1]let a10 = a8.drop &#123;    $0 &lt; 30&#125;print(a10) // [35, 3]\næ¯” filter æ›´é«˜æ•ˆçš„åˆ é™¤å…ƒç´ çš„æ–¹æ³• removeAll\n// åˆ é™¤æ‰€æœ‰ä¸æ»¡è¶³æ¡ä»¶çš„å…ƒç´ var a11 = [1, 3, 5, 12, 25]a11.removeAll &#123; $0 &lt; 10 &#125;print(a11) // [12, 25]// åˆ›å»ºæœªåˆå§‹åŒ–çš„æ•°ç»„let a12 = (0...4).map &#123; _ in    Int.random(in: 0...5)&#125;print(a12) // [0, 3, 3, 2, 5] éšæœº\n#if ç”¨äºåç¼€è¡¨è¾¾å¼\n// #if ç”¨äºåç¼€è¡¨è¾¾å¼let a13 = a11#if os(iOS)    .count#else    .reduce(0, +)#endifprint(a13) //37\nSetsSet æ˜¯æ— åºé›†åˆï¼Œå…ƒç´ å”¯ä¸€\nlet s0: Set&lt;Int&gt; = [2, 4]let s1: Set = [2, 10, 6, 4, 8]let s2: Set = [7, 3, 5, 1, 9, 10]let s3 = s1.union(s2) // åˆé›†let s4 = s1.intersection(s2) // äº¤é›†let s5 = s1.subtracting(s2) // éäº¤é›†éƒ¨åˆ†let s6 = s1.symmetricDifference(s2) // éäº¤é›†çš„åˆé›†print(s3) // [4, 2, 1, 7, 3, 10, 8, 9, 6, 5]print(s4) // [10]print(s5) // [8, 4, 2, 6]print(s6) // [9, 1, 3, 4, 5, 2, 6, 8, 7]// s0 æ˜¯å¦è¢« s1 åŒ…å«print(s0.isSubset(of: s1)) // true// s1 æ˜¯å¦åŒ…å«äº† s0print(s1.isSuperset(of: s0)) // truelet s7: Set = [3, 5]// s0 å’Œ s7 æ˜¯å¦æœ‰äº¤é›†print(s0.isDisjoint(with: s7)) // true// å¯å˜ Setvar s8: Set = [&quot;one&quot;, &quot;two&quot;]s8.insert(&quot;three&quot;)s8.remove(&quot;one&quot;)print(s8) // [&quot;two&quot;, &quot;three&quot;]\nå­—å…¸å­—å…¸æ˜¯æ— åºé›†åˆï¼Œé”®å€¼å¯¹åº”ã€‚\nvar d1 = [    &quot;k1&quot;: &quot;v1&quot;,    &quot;k2&quot;: &quot;v2&quot;]d1[&quot;k3&quot;] = &quot;v3&quot;d1[&quot;k4&quot;] = nilprint(d1) // [&quot;k2&quot;: &quot;v2&quot;, &quot;k3&quot;: &quot;v3&quot;, &quot;k1&quot;: &quot;v1&quot;]for (k, v) in d1 &#123;    print(&quot;key is \\(k), value is \\(v)&quot;)&#125;/* key is k1, value is v1 key is k2, value is v2 key is k3, value is v3 */ if d1.isEmpty == false &#123;    print(d1.count) // 3&#125;// mapValueslet d2 = d1.mapValues &#123;    $0 + &quot;_new&quot;&#125;print(d2) // [&quot;k2&quot;: &quot;v2_new&quot;, &quot;k3&quot;: &quot;v3_new&quot;, &quot;k1&quot;: &quot;v1_new&quot;]// å¯¹å­—å…¸çš„å€¼æˆ–é”®è¿›è¡Œåˆ†ç»„let d3 = Dictionary(grouping: d1.values) &#123;    $0.count&#125;print(d3) // [2: [&quot;v1&quot;, &quot;v2&quot;, &quot;v3&quot;]]// ä»å­—å…¸ä¸­å–å€¼ï¼Œå¦‚æœé”®å¯¹åº”æ— å€¼ï¼Œåˆ™ä½¿ç”¨é€šè¿‡ default æŒ‡å®šçš„é»˜è®¤å€¼d1[&quot;k5&quot;, default: &quot;whatever&quot;] += &quot;.&quot;print(d1[&quot;k5&quot;] ?? &quot;&quot;) // whatever.let v1 = d1[&quot;k3&quot;, default: &quot;whatever&quot;]print(v1) // v3// compactMapValues() å¯¹å­—å…¸å€¼è¿›è¡Œè½¬æ¢å’Œè§£åŒ…ã€‚å¯ä»¥è§£å¯é€‰ç±»å‹ï¼Œå¹¶å»æ‰ nil å€¼let d4 = [    &quot;k1&quot;: 1,    &quot;k2&quot;: 2,    &quot;k3&quot;: nil]let d5 = d4.mapValues &#123; $0 &#125;let d6 = d4.compactMapValues&#123; $0 &#125;print(d5)// [&quot;k3&quot;: nil, &quot;k1&quot;: Optional(1), &quot;k2&quot;: Optional(2)]print(d6)// [&quot;k1&quot;: 1, &quot;k2&quot;: 2]\næ“ä½œç¬¦èµ‹å€¼let i1 = 1var i2 = i1i2 = 2print(i2) // 2i2 += 1print(i2) // 3i2 -= 2print(i2) // 1i2 *= 10print(i2) // 10i2 /= 2print(i2) // 5\nè®¡ç®—ç¬¦let i1 = 1let i2 = i1print((i1 + i2 - 1) * 10 / 2 % 3) // 2print(&quot;i&quot; + &quot;1&quot;) // i1// ä¸€å…ƒè¿ç®—ç¬¦print(-i1) // -1\næ¯”è¾ƒè¿ç®—ç¬¦éµå¾ª Equatable åè®®å¯ä»¥ä½¿ç”¨ &#x3D;&#x3D; å’Œ !&#x3D; æ¥åˆ¤æ–­æ˜¯å¦ç›¸ç­‰\nprint(1 &gt; 2) // falsestruct S: Equatable &#123;    var p1: String    var p2: Int&#125;let s1 = S(p1: &quot;one&quot;, p2: 1)let s2 = S(p1: &quot;two&quot;, p2: 2)let s3 = S(p1: &quot;one&quot;, p2: 2)let s4 = S(p1: &quot;one&quot;, p2: 1)print(s1 == s2) // falseprint(s1 == s3) // falseprint(s1 == s4) // true\nç±»éœ€è¦å®ç° &#x3D;&#x3D; å‡½æ•°\nclass C: Equatable &#123;    var p1: String    var p2: Int    init(p1: String, p2: Int) &#123;        self.p1 = p1        self.p2 = p2    &#125;        static func == (l: C, r: C) -&gt; Bool &#123;        return l.p1 == r.p1 &amp;&amp; l.p2 == r.p2    &#125;&#125;let c1 = C(p1: &quot;one&quot;, p2: 1)let c2 = C(p1: &quot;one&quot;, p2: 1)print(c1 == c2)// å…ƒç»„æ¯”è¾ƒ// ä¼šå…ˆæ¯”è¾ƒç¬¬ä¸€ä¸ªæ•°ï¼Œç¬¬ä¸€ä¸ªæ— æ³•æ¯”è¾ƒæ‰ä¼šæ¯”è¾ƒç¬¬äºŒä¸ªæ•°// å­—ç¬¦ä¸²æ¯”è¾ƒå’Œå­—æ¯å¤§å°è¿˜æœ‰é•¿åº¦æœ‰å…³ã€‚å…ˆæ¯”è¾ƒå­—æ¯å¤§å°ï¼Œåœ¨æ¯”è¾ƒé•¿åº¦(&quot;apple&quot;, 1) &lt; (&quot;apple&quot;, 2) // true(&quot;applf&quot;, 1) &lt; (&quot;apple&quot;, 2) // false(&quot;appl&quot;, 2) &lt; (&quot;apple&quot;, 1) // true(&quot;appm&quot;, 2) &lt; (&quot;apple&quot;, 1) // false\nä¸‰å…ƒç®€åŒ– if else å†™æ³•\n// if elsefunc f1(p: Int) &#123;    if p &gt; 0 &#123;        print(&quot;positive number&quot;)    &#125; else &#123;        print(&quot;negative number&quot;)    &#125;&#125;// ä¸‰å…ƒfunc f2(p: Int) &#123;    p &gt; 0 ? print(&quot;positive number&quot;) : print(&quot;negative number&quot;)&#125;f1(p: 1)f2(p: 1)\ncoalescingç®€åŒ– if let else å†™æ³•\n// if elsefunc f1(p: Int?) &#123;    if let i = p &#123;        print(&quot;p have value is \\(i)&quot;)    &#125; else &#123;        print(&quot;p is nil, use defalut value&quot;)    &#125;&#125;// ä½¿ç”¨ ??func f2(p: Int?) &#123;    let i = p ?? 0    print(&quot;p is \\(i)&quot;)&#125;\nèŒƒå›´ç®€åŒ–çš„å€¼èŒƒå›´è¡¨è¾¾æ–¹å¼ã€‚\n// å°é—­èŒƒå›´for i in 0...10 &#123;    print(i)&#125;// åŠå¼€èŒƒå›´for i in 0..&lt;10 &#123;    print(i)&#125;\n// å•ä¾§åŒºé—´let nums = [5,6,7,8]print(nums[2...]) // 7 8\né€»è¾‘let i1 = -1let i2 = 2if i1 != i2 &amp;&amp; (i1 &lt; 0 || i2 &lt; 0) &#123;    print(&quot;i1 and i2 not equal, and one of them is negative number.&quot;)&#125;\næ’ç­‰æ’ç­‰è¿”å›æ˜¯å¦å¼•ç”¨äº†ç›¸åŒå®ä¾‹ã€‚\nclass C &#123;    var p: String    init(p: String) &#123;        self.p = p    &#125;&#125;let c1 = C(p: &quot;one&quot;)let c2 = C(p: &quot;one&quot;)let c3 = c1print(c1 === c2) // falseprint(c1 === c3) // trueprint(c1 !== c2) // true\nè¿ç®—ç¬¦ä½è¿ç®—ç¬¦\nlet i1: UInt8 = 0b00001111let i2 = ~i1 // Bitwise NOT Operatorï¼ˆæŒ‰ä½å–åè¿ç®—ç¬¦ï¼‰ï¼Œå–ålet i3: UInt8 = 0b00111111let i4 = i1 &amp; i3 // Bitwise AND Operatorï¼ˆæŒ‰ä½ä¸è¿ç®—ç¬¦ï¼‰ï¼Œéƒ½ä¸º1æ‰æ˜¯1let i5 = i1 | i3 // Bitwise OR Operatorï¼ˆæŒ‰ä½æˆ–è¿ç®—ç¬¦ï¼‰ï¼Œæœ‰ä¸€ä¸ª1å°±æ˜¯1let i6 = i1 ^ i3 // Bitwise XOR Operatorï¼ˆæŒ‰ä½å¼‚æˆ–è¿ç®—ç¬¦ï¼‰ï¼Œä¸åŒä¸º1ï¼Œç›¸åŒä¸º0print(i1,i2,i3,i4,i5,i6)// &lt;&lt; æŒ‰ä½å·¦ç§»ï¼Œ&gt;&gt; æŒ‰ä½å³ç§»let i7 = i1 &lt;&lt; 1let i8 = i1 &gt;&gt; 2print(i7,i8)\næº¢å‡ºè¿ç®—ç¬¦ï¼Œæœ‰ &amp;+ã€&amp;- å’Œ &amp;*\nvar i1 = Int.maxprint(i1) // 9223372036854775807i1 = i1 &amp;+ 1print(i1) // -9223372036854775808i1 = i1 &amp;+ 10print(i1) // -9223372036854775798var i2 = UInt.maxi2 = i2 &amp;+ 1print(i2) // 0\nè¿ç®—ç¬¦å‡½æ•°åŒ…æ‹¬å‰ç¼€è¿ç®—ç¬¦ã€åç¼€è¿ç®—ç¬¦ã€å¤åˆèµ‹å€¼è¿ç®—ç¬¦ä»¥åŠç­‰ä»·è¿ç®—ç¬¦ã€‚å¦ï¼Œè¿˜å¯ä»¥è‡ªå®šä¹‰è¿ç®—ç¬¦ï¼Œæ–°çš„è¿ç®—ç¬¦è¦ç”¨ operator å…³é”®å­—è¿›è¡Œå®šä¹‰ï¼ŒåŒæ—¶è¦æŒ‡å®š prefixã€infix æˆ–è€… postfix ä¿®é¥°ç¬¦ã€‚\nSwiftè§„èŒƒå‚è€ƒï¼š\n\nSwift Style Guide\n\nå¤šç”¨é™æ€ç‰¹æ€§ã€‚swift åœ¨ç¼–è¯‘æœŸé—´æ‰€åšçš„ä¼˜åŒ–æ¯” OC è¦å¤šï¼Œè¿™æ˜¯ç”±äºä»–çš„é™æ€æ´¾å‘ã€æ³›å‹ç‰¹åŒ–ã€å†™æ—¶å¤åˆ¶è¿™äº›é™æ€ç‰¹æ€§å†³å®šçš„ã€‚å¦å¤–é€šè¿‡ final å’Œ private è¿™æ ·çš„è¡¨ç¤ºå¯å°†åŠ¨æ€ç‰¹æ€§è½¬åŒ–ä¸ºé™æ€æ–¹å¼ï¼Œç¼–è¯‘å¼€å¯ WMO å¯ä»¥è‡ªåŠ¨æ¨å¯¼å‡ºå“ªäº›åŠ¨æ€æ´¾å‘å¯è½¬åŒ–ä¸ºé™æ€æ´¾å‘ã€‚\nå¦‚ä½•é¿å…å´©æºƒï¼Ÿ\n\nå­—å…¸ï¼šç”¨ç»“æ„ä½“æ›¿ä»£\nAnyï¼šå¯ç”¨æ³›å‹æˆ–å…³è”å…³è”ç±»å‹æ›¿ä»£\nas? ï¼šå°‘ç”¨ AnyObjectï¼Œå¤šç”¨æ³›å‹æˆ–ä¸é€æ˜ç±»å‹\n!ï¼šè¦å°‘ç”¨\n\nå¥½çš„å®è·µï¼Ÿ\n\nå°‘ç”¨ç»§æ‰¿ï¼Œå¤šç”¨ protocol\nå¤šç”¨ extension å¯¹è‡ªå·±ä»£ç è¿›è¡Œç®¡ç†\n\nSwiftä¹¦å•\nã€ŠThinking in SwiftUIã€‹\nã€ŠSwift è¿›é˜¶ã€‹\nã€Šå‡½æ•°å¼Swiftã€‹\nã€Šæ·±å…¥è§£æMac OS X &amp; iOSæ“ä½œç³»ç»Ÿã€‹\nã€ŠLLVM Techniques, Tips, and Best Practices Clang and Middle-End Librariesã€‹\nã€ŠLearn LLVM 12ã€‹\nã€ŠCrafting Interpretersã€‹\nã€ŠTCP&#x2F;IP Illustratedã€‹\nã€Šæ¾æœ¬è¡Œå¼˜çš„ç¨‹åºä¸–ç•Œã€‹\nã€Šç°ä»£æ“ä½œç³»ç»Ÿã€‹\nã€Šæ·±å…¥ç†è§£è®¡ç®—æœºç³»ç»Ÿã€‹\nã€Šç¨‹åºå‘˜çš„è‡ªæˆ‘ä¿®å…»ã€‹\nã€ŠHead First è®¾è®¡æ¨¡å¼ã€‹\n\n"}]